/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/refresh-usage/route";
exports.ids = ["app/api/refresh-usage/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frefresh-usage%2Froute&page=%2Fapi%2Frefresh-usage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frefresh-usage%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frefresh-usage%2Froute&page=%2Fapi%2Frefresh-usage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frefresh-usage%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_janjedrach_Cursor_eduscribe_src_app_api_refresh_usage_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/refresh-usage/route.ts */ \"(rsc)/./src/app/api/refresh-usage/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/refresh-usage/route\",\n        pathname: \"/api/refresh-usage\",\n        filename: \"route\",\n        bundlePath: \"app/api/refresh-usage/route\"\n    },\n    resolvedPagePath: \"/Users/janjedrach/Cursor/eduscribe/src/app/api/refresh-usage/route.ts\",\n    nextConfigOutput,\n    userland: _Users_janjedrach_Cursor_eduscribe_src_app_api_refresh_usage_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/refresh-usage/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyZWZyZXNoLXVzYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZyZWZyZXNoLXVzYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcmVmcmVzaC11c2FnZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9anMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz1tZHgmcm9vdERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNxQjtBQUNsRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8/ZmMwOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvamFuamVkcmFjaC9DdXJzb3IvZWR1c2NyaWJlL3NyYy9hcHAvYXBpL3JlZnJlc2gtdXNhZ2Uvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwic3RhbmRhbG9uZVwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yZWZyZXNoLXVzYWdlL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcmVmcmVzaC11c2FnZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcmVmcmVzaC11c2FnZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9qYW5qZWRyYWNoL0N1cnNvci9lZHVzY3JpYmUvc3JjL2FwcC9hcGkvcmVmcmVzaC11c2FnZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcmVmcmVzaC11c2FnZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frefresh-usage%2Froute&page=%2Fapi%2Frefresh-usage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frefresh-usage%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/refresh-usage/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/refresh-usage/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _services_subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/services/subscription */ \"(rsc)/./src/services/subscription.ts\");\n\n\n\n// Initialize Supabase client\nconst supabaseUrl = \"https://xhljckmlzdshxibnqsbj.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA\";\n/**\n * POST endpoint to refresh user's saved notes count\n */ async function POST(request) {\n    console.log(\"[Refresh Usage API] Request received: POST\");\n    try {\n        // STEP 1: Authenticate the request\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            console.error(\"[Refresh Usage API] Authentication missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication required\",\n                message: \"Valid Bearer token is required\"\n            }, {\n                status: 401\n            });\n        }\n        // Initialize Supabase client with the token\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        // Verify the user's token\n        const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n        if (authError || !user) {\n            console.error(\"[Refresh Usage API] Authentication failed:\", authError?.message);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication failed\",\n                message: authError?.message || \"Invalid authentication token\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(`[Refresh Usage API] User authenticated: ${user.id}`);\n        // STEP 2: Refresh the saved notes count\n        console.log(\"[Refresh Usage API] Refreshing saved notes count...\");\n        const success = await (0,_services_subscription__WEBPACK_IMPORTED_MODULE_1__.refreshSavedNotesCount)(user.id, token);\n        if (!success) {\n            console.error(\"[Refresh Usage API] Failed to refresh saved notes count\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Refresh failed\",\n                message: \"Failed to refresh saved notes count\"\n            }, {\n                status: 500\n            });\n        }\n        // STEP 3: Get the updated usage data\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { data: usage, error: usageError } = await supabase.from(\"user_usage\").select(\"*\").eq(\"user_id\", user.id).eq(\"month_year\", currentMonth).single();\n        if (usageError) {\n            console.error(\"[Refresh Usage API] Error fetching updated usage:\", usageError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"Saved notes count refreshed successfully, but could not fetch updated data\"\n            });\n        }\n        console.log(`[Refresh Usage API] Successfully refreshed usage for user ${user.id}`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Saved notes count refreshed successfully\",\n            data: usage\n        });\n    } catch (error) {\n        console.error(\"[Refresh Usage API] Error refreshing usage:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Server error\",\n            message: \"An unexpected error occurred while refreshing usage\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n// Configure dynamic behavior to avoid caching\nconst dynamic = \"force-dynamic\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9yZWZyZXNoLXVzYWdlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXdEO0FBQ0g7QUFDWTtBQUVqRSw2QkFBNkI7QUFDN0IsTUFBTUcsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBRWpFOztDQUVDLEdBQ00sZUFBZUssS0FBS0MsT0FBb0I7SUFDN0NDLFFBQVFDLEdBQUcsQ0FBQztJQUVaLElBQUk7UUFDRixtQ0FBbUM7UUFDbkMsTUFBTUMsYUFBYUgsUUFBUUksT0FBTyxDQUFDQyxHQUFHLENBQUM7UUFDdkMsSUFBSSxDQUFDRixjQUFjLENBQUNBLFdBQVdHLFVBQVUsQ0FBQyxZQUFZO1lBQ3BETCxRQUFRTSxLQUFLLENBQUM7WUFDZCxPQUFPakIscURBQVlBLENBQUNrQixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNURixPQUFPO2dCQUNQRyxTQUFTO1lBQ1gsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ25CO1FBRUEsNENBQTRDO1FBQzVDLE1BQU1DLFFBQVFULFdBQVdVLE9BQU8sQ0FBQyxXQUFXO1FBQzVDLE1BQU1DLFdBQVd2QixtRUFBWUEsQ0FBQ0UsYUFBYUksaUJBQWlCO1lBQzFEa0IsUUFBUTtnQkFDTlgsU0FBUztvQkFDUFksZUFBZSxDQUFDLE9BQU8sRUFBRUosTUFBTSxDQUFDO2dCQUNsQztZQUNGO1FBQ0Y7UUFFQSwwQkFBMEI7UUFDMUIsTUFBTSxFQUFFSyxNQUFNLEVBQUVDLElBQUksRUFBRSxFQUFFWCxPQUFPWSxTQUFTLEVBQUUsR0FBRyxNQUFNTCxTQUFTTSxJQUFJLENBQUNDLE9BQU8sQ0FBQ1Q7UUFDekUsSUFBSU8sYUFBYSxDQUFDRCxNQUFNO1lBQ3RCakIsUUFBUU0sS0FBSyxDQUFDLDhDQUE4Q1ksV0FBV1Q7WUFDdkUsT0FBT3BCLHFEQUFZQSxDQUFDa0IsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEYsT0FBTztnQkFDUEcsU0FBU1MsV0FBV1QsV0FBVztZQUNqQyxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDbkI7UUFFQVYsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0NBQXdDLEVBQUVnQixLQUFLSSxFQUFFLENBQUMsQ0FBQztRQUVoRSx3Q0FBd0M7UUFDeENyQixRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFNTyxVQUFVLE1BQU1qQiw4RUFBc0JBLENBQUMwQixLQUFLSSxFQUFFLEVBQUVWO1FBRXRELElBQUksQ0FBQ0gsU0FBUztZQUNaUixRQUFRTSxLQUFLLENBQUM7WUFDZCxPQUFPakIscURBQVlBLENBQUNrQixJQUFJLENBQUM7Z0JBQ3ZCQyxTQUFTO2dCQUNURixPQUFPO2dCQUNQRyxTQUFTO1lBQ1gsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ25CO1FBRUEscUNBQXFDO1FBQ3JDLE1BQU1ZLGVBQWUsSUFBSUMsT0FBT0MsV0FBVyxHQUFHQyxLQUFLLENBQUMsR0FBRztRQUN2RCxNQUFNLEVBQUVULE1BQU1VLEtBQUssRUFBRXBCLE9BQU9xQixVQUFVLEVBQUUsR0FBRyxNQUFNZCxTQUM5Q2UsSUFBSSxDQUFDLGNBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsV0FBV2IsS0FBS0ksRUFBRSxFQUNyQlMsRUFBRSxDQUFDLGNBQWNSLGNBQ2pCUyxNQUFNO1FBRVQsSUFBSUosWUFBWTtZQUNkM0IsUUFBUU0sS0FBSyxDQUFDLHFEQUFxRHFCO1lBQ25FLE9BQU90QyxxREFBWUEsQ0FBQ2tCLElBQUksQ0FBQztnQkFDdkJDLFNBQVM7Z0JBQ1RDLFNBQVM7WUFDWDtRQUNGO1FBRUFULFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDBEQUEwRCxFQUFFZ0IsS0FBS0ksRUFBRSxDQUFDLENBQUM7UUFFbEYsT0FBT2hDLHFEQUFZQSxDQUFDa0IsSUFBSSxDQUFDO1lBQ3ZCQyxTQUFTO1lBQ1RDLFNBQVM7WUFDVE8sTUFBTVU7UUFDUjtJQUVGLEVBQUUsT0FBT3BCLE9BQVk7UUFDbkJOLFFBQVFNLEtBQUssQ0FBQywrQ0FBK0NBO1FBQzdELE9BQU9qQixxREFBWUEsQ0FBQ2tCLElBQUksQ0FBQztZQUN2QkMsU0FBUztZQUNURixPQUFPO1lBQ1BHLFNBQVM7WUFDVHVCLFNBQVMxQixNQUFNRyxPQUFPO1FBQ3hCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ25CO0FBQ0Y7QUFFQSw4Q0FBOEM7QUFDdkMsTUFBTXVCLFVBQVUsZ0JBQWdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1c2NyaWJlLy4vc3JjL2FwcC9hcGkvcmVmcmVzaC11c2FnZS9yb3V0ZS50cz9lOTcxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHsgcmVmcmVzaFNhdmVkTm90ZXNDb3VudCB9IGZyb20gJ0Avc2VydmljZXMvc3Vic2NyaXB0aW9uJztcblxuLy8gSW5pdGlhbGl6ZSBTdXBhYmFzZSBjbGllbnRcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMITtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZITtcblxuLyoqXG4gKiBQT1NUIGVuZHBvaW50IHRvIHJlZnJlc2ggdXNlcidzIHNhdmVkIG5vdGVzIGNvdW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnNvbGUubG9nKCdbUmVmcmVzaCBVc2FnZSBBUEldIFJlcXVlc3QgcmVjZWl2ZWQ6IFBPU1QnKTtcblxuICB0cnkge1xuICAgIC8vIFNURVAgMTogQXV0aGVudGljYXRlIHRoZSByZXF1ZXN0XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbUmVmcmVzaCBVc2FnZSBBUEldIEF1dGhlbnRpY2F0aW9uIG1pc3NpbmcnKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZCBCZWFyZXIgdG9rZW4gaXMgcmVxdWlyZWQnXG4gICAgICB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIC8vIEluaXRpYWxpemUgU3VwYWJhc2UgY2xpZW50IHdpdGggdGhlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gVmVyaWZ5IHRoZSB1c2VyJ3MgdG9rZW5cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIodG9rZW4pO1xuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tSZWZyZXNoIFVzYWdlIEFQSV0gQXV0aGVudGljYXRpb24gZmFpbGVkOicsIGF1dGhFcnJvcj8ubWVzc2FnZSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogYXV0aEVycm9yPy5tZXNzYWdlIHx8ICdJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHRva2VuJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtSZWZyZXNoIFVzYWdlIEFQSV0gVXNlciBhdXRoZW50aWNhdGVkOiAke3VzZXIuaWR9YCk7XG5cbiAgICAvLyBTVEVQIDI6IFJlZnJlc2ggdGhlIHNhdmVkIG5vdGVzIGNvdW50XG4gICAgY29uc29sZS5sb2coJ1tSZWZyZXNoIFVzYWdlIEFQSV0gUmVmcmVzaGluZyBzYXZlZCBub3RlcyBjb3VudC4uLicpO1xuICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCByZWZyZXNoU2F2ZWROb3Rlc0NvdW50KHVzZXIuaWQsIHRva2VuKTtcblxuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5lcnJvcignW1JlZnJlc2ggVXNhZ2UgQVBJXSBGYWlsZWQgdG8gcmVmcmVzaCBzYXZlZCBub3RlcyBjb3VudCcpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnUmVmcmVzaCBmYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlZnJlc2ggc2F2ZWQgbm90ZXMgY291bnQnXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIC8vIFNURVAgMzogR2V0IHRoZSB1cGRhdGVkIHVzYWdlIGRhdGFcbiAgICBjb25zdCBjdXJyZW50TW9udGggPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgNyk7XG4gICAgY29uc3QgeyBkYXRhOiB1c2FnZSwgZXJyb3I6IHVzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl91c2FnZScpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXG4gICAgICAuZXEoJ21vbnRoX3llYXInLCBjdXJyZW50TW9udGgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAodXNhZ2VFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1JlZnJlc2ggVXNhZ2UgQVBJXSBFcnJvciBmZXRjaGluZyB1cGRhdGVkIHVzYWdlOicsIHVzYWdlRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1NhdmVkIG5vdGVzIGNvdW50IHJlZnJlc2hlZCBzdWNjZXNzZnVsbHksIGJ1dCBjb3VsZCBub3QgZmV0Y2ggdXBkYXRlZCBkYXRhJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtSZWZyZXNoIFVzYWdlIEFQSV0gU3VjY2Vzc2Z1bGx5IHJlZnJlc2hlZCB1c2FnZSBmb3IgdXNlciAke3VzZXIuaWR9YCk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdTYXZlZCBub3RlcyBjb3VudCByZWZyZXNoZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGRhdGE6IHVzYWdlXG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tSZWZyZXNoIFVzYWdlIEFQSV0gRXJyb3IgcmVmcmVzaGluZyB1c2FnZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdTZXJ2ZXIgZXJyb3InLFxuICAgICAgbWVzc2FnZTogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQgd2hpbGUgcmVmcmVzaGluZyB1c2FnZScsXG4gICAgICBkZXRhaWxzOiBlcnJvci5tZXNzYWdlXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuXG4vLyBDb25maWd1cmUgZHluYW1pYyBiZWhhdmlvciB0byBhdm9pZCBjYWNoaW5nXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJzsgIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZUNsaWVudCIsInJlZnJlc2hTYXZlZE5vdGVzQ291bnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlBPU1QiLCJyZXF1ZXN0IiwiY29uc29sZSIsImxvZyIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0Iiwic3RhcnRzV2l0aCIsImVycm9yIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwic3RhdHVzIiwidG9rZW4iLCJyZXBsYWNlIiwic3VwYWJhc2UiLCJnbG9iYWwiLCJBdXRob3JpemF0aW9uIiwiZGF0YSIsInVzZXIiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsImlkIiwiY3VycmVudE1vbnRoIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJ1c2FnZSIsInVzYWdlRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJkZXRhaWxzIiwiZHluYW1pYyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/refresh-usage/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/subscription.ts":
/*!**************************************!*\
  !*** ./src/services/subscription.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   assignUserSubscription: () => (/* binding */ assignUserSubscription),\n/* harmony export */   checkUsageLimits: () => (/* binding */ checkUsageLimits),\n/* harmony export */   getPlanPricing: () => (/* binding */ getPlanPricing),\n/* harmony export */   getSubscriptionPlan: () => (/* binding */ getSubscriptionPlan),\n/* harmony export */   getSubscriptionPlans: () => (/* binding */ getSubscriptionPlans),\n/* harmony export */   getUserSubscription: () => (/* binding */ getUserSubscription),\n/* harmony export */   hasFeatureAccess: () => (/* binding */ hasFeatureAccess),\n/* harmony export */   incrementUsage: () => (/* binding */ incrementUsage),\n/* harmony export */   refreshSavedNotesCount: () => (/* binding */ refreshSavedNotesCount),\n/* harmony export */   updateSavedNotesCount: () => (/* binding */ updateSavedNotesCount)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/**\n * Subscription Service\n * \n * Handles subscription plans, usage tracking, and feature access control\n */ \n// Initialize Supabase client\nconst supabaseUrl = \"https://xhljckmlzdshxibnqsbj.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA\";\n/**\n * Get all available subscription plans\n */ async function getSubscriptionPlans() {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n    const { data, error } = await supabase.from(\"subscription_plans\").select(\"*\").eq(\"is_active\", true).order(\"price_monthly\", {\n        ascending: true\n    });\n    if (error) {\n        console.error(\"[Subscription] Error fetching plans:\", error);\n        throw new Error(\"Failed to fetch subscription plans\");\n    }\n    return data || [];\n}\n/**\n * Get user's current subscription with plan details\n */ async function getUserSubscription(userId, token) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n        global: {\n            headers: {\n                Authorization: `Bearer ${token}`\n            }\n        }\n    });\n    try {\n        // Use direct table query instead of RPC function\n        const { data: userSub, error } = await supabase.from(\"user_subscriptions\").select(`\n        id,\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        if (error) {\n            console.error(\"[Subscription] Error fetching user subscription:\", error);\n            return null;\n        }\n        if (!userSub || !userSub.subscription_plans) {\n            return null;\n        }\n        const planData = userSub.subscription_plans;\n        return {\n            subscription_id: userSub.id,\n            plan_id: userSub.plan_id,\n            plan_name: planData.name,\n            plan_display_name: planData.display_name,\n            billing_cycle: userSub.billing_cycle,\n            status: userSub.status,\n            current_period_end: userSub.current_period_end,\n            features: planData.features,\n            limits: planData.limits,\n            price_monthly: planData.price_monthly,\n            price_yearly: planData.price_yearly\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error in getUserSubscription:\", error);\n        return null;\n    }\n}\n/**\n * Get a specific subscription plan by ID\n */ async function getSubscriptionPlan(planId) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n    const { data, error } = await supabase.from(\"subscription_plans\").select(\"*\").eq(\"id\", planId).eq(\"is_active\", true).single();\n    if (error) {\n        console.error(\"[Subscription] Error fetching plan:\", error);\n        return null;\n    }\n    return data;\n}\n/**\n * Check if user can generate notes based on their plan and usage\n */ async function checkUsageLimits(userId, token, noteType = \"text\") {\n    try {\n        // Use direct table queries instead of RPC functions to avoid issues\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        console.log(\"[Subscription] Checking usage limits for user:\", userId);\n        // Get user's subscription directly\n        const { data: userSub, error: subError } = await supabase.from(\"user_subscriptions\").select(`\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        // Get current month usage directly\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { data: usage, error: usageError } = await supabase.from(\"user_usage\").select(\"*\").eq(\"user_id\", userId).eq(\"month_year\", currentMonth).single();\n        // Default free plan limits\n        const freePlanLimits = {\n            notes_per_month: 2,\n            max_saved_notes: 3,\n            max_text_length: 5000\n        };\n        const currentUsage = usage || {\n            notes_generated: 0,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 0,\n            month_year: currentMonth\n        };\n        // If usage record doesn't exist, create it\n        if (!usage) {\n            console.log(\"[Subscription] Creating usage record for current month:\", currentMonth);\n            const { error: createUsageError } = await supabase.from(\"user_usage\").insert({\n                user_id: userId,\n                month_year: currentMonth,\n                notes_generated: 0,\n                video_notes_count: 0,\n                file_notes_count: 0,\n                text_notes_count: 0,\n                total_saved_notes: 0,\n                updated_at: new Date().toISOString()\n            });\n            if (createUsageError) {\n                console.error(\"[Subscription] Warning: Could not create usage record:\", createUsageError);\n            }\n        }\n        // If no subscription found or error, try to create a free subscription\n        if (!userSub || subError) {\n            console.log(\"[Subscription] No active subscription found, attempting to create free subscription\");\n            if (subError) {\n                console.error(\"[Subscription] Subscription query error:\", subError);\n            }\n            // Try to create a free subscription for the user\n            const { error: createSubError } = await supabase.from(\"user_subscriptions\").insert({\n                user_id: userId,\n                plan_id: \"free\",\n                billing_cycle: \"monthly\",\n                status: \"active\",\n                current_period_start: new Date().toISOString(),\n                current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n                updated_at: new Date().toISOString()\n            }).select();\n            if (createSubError) {\n                console.error(\"[Subscription] Could not create free subscription:\", createSubError);\n            } else {\n                console.log(\"[Subscription] Created free subscription for user\");\n            }\n            // Return free plan limits regardless of whether we could create the subscription\n            const canGenerate = currentUsage.notes_generated < freePlanLimits.notes_per_month;\n            const canSave = currentUsage.total_saved_notes < freePlanLimits.max_saved_notes;\n            return {\n                canGenerate,\n                canSave,\n                reason: !canGenerate ? `Monthly limit reached (${freePlanLimits.notes_per_month} notes per month)` : !canSave ? `Storage limit reached (${freePlanLimits.max_saved_notes} saved notes maximum)` : undefined,\n                usage: currentUsage,\n                limits: freePlanLimits\n            };\n        }\n        const subscription = userSub;\n        const planData = subscription.subscription_plans;\n        if (!planData) {\n            console.error(\"[Subscription] Plan data not found for subscription:\", subscription);\n            // Fallback to free plan\n            const canGenerate = currentUsage.notes_generated < freePlanLimits.notes_per_month;\n            const canSave = currentUsage.total_saved_notes < freePlanLimits.max_saved_notes;\n            return {\n                canGenerate,\n                canSave,\n                reason: \"Plan data not found - using free plan limits\",\n                usage: currentUsage,\n                limits: freePlanLimits\n            };\n        }\n        console.log(\"[Subscription] Found subscription:\", {\n            planId: subscription.plan_id,\n            planLimits: planData.limits,\n            currentUsage: currentUsage\n        });\n        // Check monthly generation limit (handle unlimited case)\n        const monthlyLimit = planData.limits.notes_per_month;\n        const canGenerate = monthlyLimit === -1 || currentUsage.notes_generated < monthlyLimit;\n        // Check saved notes limit\n        const canSave = currentUsage.total_saved_notes < planData.limits.max_saved_notes;\n        let reason;\n        if (!canGenerate && monthlyLimit !== -1) {\n            reason = `Monthly limit reached (${monthlyLimit} notes per month)`;\n        } else if (!canSave) {\n            reason = `Storage limit reached (${planData.limits.max_saved_notes} saved notes maximum)`;\n        }\n        return {\n            canGenerate,\n            canSave,\n            reason,\n            usage: currentUsage,\n            limits: planData.limits\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error checking usage limits:\", error);\n        // Return restrictive fallback\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const fallbackUsage = {\n            notes_generated: 999,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 999,\n            month_year: currentMonth\n        };\n        return {\n            canGenerate: false,\n            canSave: false,\n            reason: \"Error checking subscription limits. Please try again.\",\n            usage: fallbackUsage,\n            limits: {\n                notes_per_month: 2,\n                max_saved_notes: 3,\n                max_text_length: 5000\n            }\n        };\n    }\n}\n/**\n * Increment user's usage count after successful note generation\n */ async function incrementUsage(userId, token, noteType = \"text\") {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        console.log(\"[Subscription] Incrementing usage for user:\", userId, \"type:\", noteType);\n        // Get current usage\n        const { data: currentUsage, error: fetchError } = await supabase.from(\"user_usage\").select(\"*\").eq(\"user_id\", userId).eq(\"month_year\", currentMonth).single();\n        if (fetchError && fetchError.code !== \"PGRST116\") {\n            console.error(\"[Subscription] Error fetching current usage:\", fetchError);\n            return false;\n        }\n        // Prepare update data\n        const updateData = {\n            notes_generated: (currentUsage?.notes_generated || 0) + 1,\n            updated_at: new Date().toISOString()\n        };\n        // Increment specific note type counter\n        if (noteType === \"video\") {\n            updateData.video_notes_count = (currentUsage?.video_notes_count || 0) + 1;\n        } else if (noteType === \"file\") {\n            updateData.file_notes_count = (currentUsage?.file_notes_count || 0) + 1;\n        } else if (noteType === \"text\") {\n            updateData.text_notes_count = (currentUsage?.text_notes_count || 0) + 1;\n        }\n        // Update or insert usage record\n        if (currentUsage) {\n            const { error: updateError } = await supabase.from(\"user_usage\").update(updateData).eq(\"user_id\", userId).eq(\"month_year\", currentMonth);\n            if (updateError) {\n                console.error(\"[Subscription] Error updating usage:\", updateError);\n                return false;\n            }\n        } else {\n            // Create new usage record\n            const insertData = {\n                user_id: userId,\n                month_year: currentMonth,\n                notes_generated: 1,\n                video_notes_count: noteType === \"video\" ? 1 : 0,\n                file_notes_count: noteType === \"file\" ? 1 : 0,\n                text_notes_count: noteType === \"text\" ? 1 : 0,\n                total_saved_notes: 0,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            };\n            const { error: insertError } = await supabase.from(\"user_usage\").insert(insertData);\n            if (insertError) {\n                console.error(\"[Subscription] Error creating usage record:\", insertError);\n                return false;\n            }\n        }\n        console.log(\"[Subscription] Successfully incremented usage\");\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error incrementing usage:\", error);\n        return false;\n    }\n}\n/**\n * Update saved notes count (used when notes are saved or deleted)\n */ async function updateSavedNotesCount(userId, token, count) {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        console.log(\"[Subscription] Updating saved notes count for user:\", userId, \"count:\", count);\n        // Upsert the saved notes count\n        const { error } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            total_saved_notes: Math.max(0, count),\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\"\n        });\n        if (error) {\n            console.error(\"[Subscription] Error updating saved notes count:\", error);\n            return false;\n        }\n        console.log(\"[Subscription] Successfully updated saved notes count\");\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error updating saved notes count:\", error);\n        return false;\n    }\n}\n/**\n * Refresh saved notes count by counting all notes from all tables\n */ async function refreshSavedNotesCount(userId, token) {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        console.log(\"[Subscription] Refreshing saved notes count for user:\", userId);\n        // Count notes from all tables including video_upload_notes\n        const [videoResult, fileResult, textResult, uploadVideoResult] = await Promise.all([\n            supabase.from(\"video_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            supabase.from(\"file_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            supabase.from(\"text_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            // Handle video_upload_notes table that might not exist in all environments\n            supabase.from(\"video_upload_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId).then((result)=>result, (error)=>{\n                console.warn(\"[Subscription] video_upload_notes table might not exist:\", error.message);\n                return {\n                    count: 0\n                };\n            })\n        ]);\n        const videoCount = videoResult.count || 0;\n        const fileCount = fileResult.count || 0;\n        const textCount = textResult.count || 0;\n        const uploadVideoCount = uploadVideoResult.count || 0;\n        const totalCount = videoCount + fileCount + textCount + uploadVideoCount;\n        console.log(\"[Subscription] Note counts:\", {\n            video: videoCount,\n            file: fileCount,\n            text: textCount,\n            video_upload: uploadVideoCount,\n            total: totalCount\n        });\n        // Update the usage record with the actual count\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { error } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            total_saved_notes: totalCount,\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\"\n        });\n        if (error) {\n            console.error(\"[Subscription] Error updating saved notes count:\", error);\n            return false;\n        }\n        console.log(\"[Subscription] Successfully refreshed saved notes count to:\", totalCount);\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error refreshing saved notes count:\", error);\n        return false;\n    }\n}\n/**\n * Get plan pricing with discount calculation\n */ function getPlanPricing(plan) {\n    const monthlyPrice = plan.price_monthly;\n    const yearlyPrice = plan.price_yearly;\n    const yearlyMonthlyEquivalent = yearlyPrice / 12;\n    const discountPercentage = monthlyPrice > 0 ? Math.round((1 - yearlyMonthlyEquivalent / monthlyPrice) * 100) : 0;\n    const yearlySavings = monthlyPrice * 12 - yearlyPrice;\n    return {\n        monthly: monthlyPrice,\n        yearly: yearlyPrice,\n        yearlyMonthlyEquivalent,\n        discountPercentage,\n        yearlySavings,\n        currency: plan.currency\n    };\n}\n/**\n * Check if user has access to a specific feature\n */ async function hasFeatureAccess(userId, token, feature) {\n    try {\n        const subscription = await getUserSubscription(userId, token);\n        if (!subscription) {\n            // Default free plan features\n            const freeFeatures = {\n                notes_generation: true,\n                quizzes: false,\n                youtube_support: true,\n                ppt_support: false,\n                export: false,\n                copy_paste: true,\n                upload_video: false,\n                priority_generation: false\n            };\n            return freeFeatures[feature] || false;\n        }\n        return subscription.features[feature] || false;\n    } catch (error) {\n        console.error(\"[Subscription] Error checking feature access:\", error);\n        return false; // Default to no access on error\n    }\n}\n/**\n * Assign subscription to user after successful payment\n */ async function assignUserSubscription(userId, token, planId, billingCycle, paymentData) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n        global: {\n            headers: {\n                Authorization: `Bearer ${token}`\n            }\n        }\n    });\n    try {\n        // Calculate period dates\n        const currentPeriodStart = new Date();\n        const currentPeriodEnd = new Date();\n        if (billingCycle === \"yearly\") {\n            currentPeriodEnd.setFullYear(currentPeriodEnd.getFullYear() + 1);\n        } else {\n            currentPeriodEnd.setMonth(currentPeriodEnd.getMonth() + 1);\n        }\n        // Prepare subscription data\n        const subscriptionData = {\n            user_id: userId,\n            plan_id: planId,\n            billing_cycle: billingCycle,\n            status: \"active\",\n            current_period_start: currentPeriodStart.toISOString(),\n            current_period_end: currentPeriodEnd.toISOString(),\n            cancel_at_period_end: false,\n            stripe_subscription_id: paymentData?.stripeSubscriptionId || null,\n            stripe_customer_id: paymentData?.stripeCustomerId || null,\n            updated_at: new Date().toISOString()\n        };\n        // Upsert subscription (update if exists, insert if new)\n        const { data: subscription, error: subscriptionError } = await supabase.from(\"user_subscriptions\").upsert(subscriptionData, {\n            onConflict: \"user_id\"\n        }).select(`\n        id,\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).single();\n        if (subscriptionError) {\n            console.error(\"[Subscription] Error assigning subscription:\", subscriptionError);\n            throw new Error(\"Failed to assign subscription\");\n        }\n        if (!subscription || !subscription.subscription_plans) {\n            throw new Error(\"Failed to retrieve subscription details\");\n        }\n        // Initialize usage tracking for current month\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { error: usageError } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            notes_generated: 0,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 0,\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\",\n            ignoreDuplicates: true\n        });\n        if (usageError) {\n            console.error(\"[Subscription] Warning: Failed to initialize usage tracking:\", usageError);\n        // Don't throw error here as subscription assignment was successful\n        }\n        const planData = subscription.subscription_plans;\n        return {\n            subscription_id: subscription.id,\n            plan_id: subscription.plan_id,\n            plan_name: planData.name,\n            plan_display_name: planData.display_name,\n            billing_cycle: subscription.billing_cycle,\n            status: subscription.status,\n            current_period_end: subscription.current_period_end,\n            features: planData.features,\n            limits: planData.limits,\n            price_monthly: planData.price_monthly,\n            price_yearly: planData.price_yearly\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error in assignUserSubscription:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNuQkssWUFBWSxJQUFJbkIsT0FBT0MsV0FBVztRQUNwQyxHQUFHO1lBQ0Q0QyxZQUFZO1lBQ1o2RCxrQkFBa0I7UUFDcEI7UUFFRixJQUFJdEcsWUFBWTtZQUNkckMsUUFBUU4sS0FBSyxDQUFDLGdFQUFnRTJDO1FBQzlFLG1FQUFtRTtRQUNyRTtRQUVBLE1BQU0xQixXQUFXaUQsYUFBYWxELGtCQUFrQjtRQUVoRCxPQUFPO1lBQ0xFLGlCQUFpQmdELGFBQWEvQyxFQUFFO1lBQ2hDQyxTQUFTOEMsYUFBYTlDLE9BQU87WUFDN0JDLFdBQVdKLFNBQVNLLElBQUk7WUFDeEJDLG1CQUFtQk4sU0FBU08sWUFBWTtZQUN4Q0MsZUFBZXlDLGFBQWF6QyxhQUFhO1lBQ3pDQyxRQUFRd0MsYUFBYXhDLE1BQU07WUFDM0JDLG9CQUFvQnVDLGFBQWF2QyxrQkFBa0I7WUFDbkRDLFVBQVVYLFNBQVNXLFFBQVE7WUFDM0JDLFFBQVFaLFNBQVNZLE1BQU07WUFDdkJDLGVBQWViLFNBQVNhLGFBQWE7WUFDckNDLGNBQWNkLFNBQVNjLFlBQVk7UUFDckM7SUFDRixFQUFFLE9BQU8vQixPQUFPO1FBQ2RNLFFBQVFOLEtBQUssQ0FBQyxtREFBbURBO1FBQ2pFLE1BQU1BO0lBQ1I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8uL3NyYy9zZXJ2aWNlcy9zdWJzY3JpcHRpb24udHM/MDRmOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN1YnNjcmlwdGlvbiBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgc3Vic2NyaXB0aW9uIHBsYW5zLCB1c2FnZSB0cmFja2luZywgYW5kIGZlYXR1cmUgYWNjZXNzIGNvbnRyb2xcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBJbml0aWFsaXplIFN1cGFiYXNlIGNsaWVudFxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvblBsYW4ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGRpc3BsYXlfbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBwcmljZV9tb250aGx5OiBudW1iZXI7XG4gIHByaWNlX3llYXJseTogbnVtYmVyO1xuICBjdXJyZW5jeTogc3RyaW5nO1xuICBmZWF0dXJlczoge1xuICAgIG5vdGVzX2dlbmVyYXRpb246IGJvb2xlYW47XG4gICAgcXVpenplczogYm9vbGVhbjtcbiAgICB5b3V0dWJlX3N1cHBvcnQ6IGJvb2xlYW47XG4gICAgcHB0X3N1cHBvcnQ6IGJvb2xlYW47XG4gICAgZXhwb3J0OiBib29sZWFuO1xuICAgIGNvcHlfcGFzdGU6IGJvb2xlYW47XG4gICAgdXBsb2FkX3ZpZGVvPzogYm9vbGVhbjtcbiAgICBwcmlvcml0eV9nZW5lcmF0aW9uPzogYm9vbGVhbjtcbiAgfTtcbiAgbGltaXRzOiB7XG4gICAgbm90ZXNfcGVyX21vbnRoOiBudW1iZXI7IC8vIC0xIG1lYW5zIHVubGltaXRlZFxuICAgIG1heF9zYXZlZF9ub3RlczogbnVtYmVyO1xuICAgIG1heF90ZXh0X2xlbmd0aDogbnVtYmVyO1xuICB9O1xuICBpc19hY3RpdmU6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlclN1YnNjcmlwdGlvbiB7XG4gIHN1YnNjcmlwdGlvbl9pZDogc3RyaW5nO1xuICBwbGFuX2lkOiBzdHJpbmc7XG4gIHBsYW5fbmFtZTogc3RyaW5nO1xuICBwbGFuX2Rpc3BsYXlfbmFtZTogc3RyaW5nO1xuICBiaWxsaW5nX2N5Y2xlOiAnbW9udGhseScgfCAneWVhcmx5JztcbiAgc3RhdHVzOiAnYWN0aXZlJyB8ICdjYW5jZWxsZWQnIHwgJ2V4cGlyZWQnIHwgJ3RyaWFsJztcbiAgY3VycmVudF9wZXJpb2RfZW5kOiBzdHJpbmc7XG4gIGZlYXR1cmVzOiBTdWJzY3JpcHRpb25QbGFuWydmZWF0dXJlcyddO1xuICBsaW1pdHM6IFN1YnNjcmlwdGlvblBsYW5bJ2xpbWl0cyddO1xuICBwcmljZV9tb250aGx5OiBudW1iZXI7XG4gIHByaWNlX3llYXJseTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJVc2FnZSB7XG4gIG5vdGVzX2dlbmVyYXRlZDogbnVtYmVyO1xuICB2aWRlb19ub3Rlc19jb3VudDogbnVtYmVyO1xuICBmaWxlX25vdGVzX2NvdW50OiBudW1iZXI7XG4gIHRleHRfbm90ZXNfY291bnQ6IG51bWJlcjtcbiAgdG90YWxfc2F2ZWRfbm90ZXM6IG51bWJlcjtcbiAgbW9udGhfeWVhcjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzYWdlQ2hlY2sge1xuICBjYW5HZW5lcmF0ZTogYm9vbGVhbjtcbiAgY2FuU2F2ZTogYm9vbGVhbjtcbiAgcmVhc29uPzogc3RyaW5nO1xuICB1c2FnZTogVXNlclVzYWdlO1xuICBsaW1pdHM6IFN1YnNjcmlwdGlvblBsYW5bJ2xpbWl0cyddO1xufVxuXG4vKipcbiAqIEdldCBhbGwgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbiBwbGFuc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9uUGxhbnMoKTogUHJvbWlzZTxTdWJzY3JpcHRpb25QbGFuW10+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG4gIFxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzdWJzY3JpcHRpb25fcGxhbnMnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAub3JkZXIoJ3ByaWNlX21vbnRobHknLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcbiAgICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgZmV0Y2hpbmcgcGxhbnM6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIHN1YnNjcmlwdGlvbiBwbGFucycpO1xuICB9XG4gIFxuICByZXR1cm4gZGF0YSB8fCBbXTtcbn1cblxuLyoqXG4gKiBHZXQgdXNlcidzIGN1cnJlbnQgc3Vic2NyaXB0aW9uIHdpdGggcGxhbiBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyU3Vic2NyaXB0aW9uKHVzZXJJZDogc3RyaW5nLCB0b2tlbjogc3RyaW5nKTogUHJvbWlzZTxVc2VyU3Vic2NyaXB0aW9uIHwgbnVsbD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgZ2xvYmFsOiB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gXG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgXG4gIHRyeSB7XG4gICAgLy8gVXNlIGRpcmVjdCB0YWJsZSBxdWVyeSBpbnN0ZWFkIG9mIFJQQyBmdW5jdGlvblxuICAgIGNvbnN0IHsgZGF0YTogdXNlclN1YiwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBpZCxcbiAgICAgICAgcGxhbl9pZCxcbiAgICAgICAgYmlsbGluZ19jeWNsZSxcbiAgICAgICAgc3RhdHVzLFxuICAgICAgICBjdXJyZW50X3BlcmlvZF9lbmQsXG4gICAgICAgIHN1YnNjcmlwdGlvbl9wbGFucyAoXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkaXNwbGF5X25hbWUsXG4gICAgICAgICAgZmVhdHVyZXMsXG4gICAgICAgICAgbGltaXRzLFxuICAgICAgICAgIHByaWNlX21vbnRobHksXG4gICAgICAgICAgcHJpY2VfeWVhcmx5XG4gICAgICAgIClcbiAgICAgIGApXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBmZXRjaGluZyB1c2VyIHN1YnNjcmlwdGlvbjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXVzZXJTdWIgfHwgIXVzZXJTdWIuc3Vic2NyaXB0aW9uX3BsYW5zKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBwbGFuRGF0YSA9IHVzZXJTdWIuc3Vic2NyaXB0aW9uX3BsYW5zIGFzIGFueTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaXB0aW9uX2lkOiB1c2VyU3ViLmlkLFxuICAgICAgcGxhbl9pZDogdXNlclN1Yi5wbGFuX2lkLFxuICAgICAgcGxhbl9uYW1lOiBwbGFuRGF0YS5uYW1lLFxuICAgICAgcGxhbl9kaXNwbGF5X25hbWU6IHBsYW5EYXRhLmRpc3BsYXlfbmFtZSxcbiAgICAgIGJpbGxpbmdfY3ljbGU6IHVzZXJTdWIuYmlsbGluZ19jeWNsZSxcbiAgICAgIHN0YXR1czogdXNlclN1Yi5zdGF0dXMsXG4gICAgICBjdXJyZW50X3BlcmlvZF9lbmQ6IHVzZXJTdWIuY3VycmVudF9wZXJpb2RfZW5kLFxuICAgICAgZmVhdHVyZXM6IHBsYW5EYXRhLmZlYXR1cmVzLFxuICAgICAgbGltaXRzOiBwbGFuRGF0YS5saW1pdHMsXG4gICAgICBwcmljZV9tb250aGx5OiBwbGFuRGF0YS5wcmljZV9tb250aGx5LFxuICAgICAgcHJpY2VfeWVhcmx5OiBwbGFuRGF0YS5wcmljZV95ZWFybHlcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGluIGdldFVzZXJTdWJzY3JpcHRpb246JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGEgc3BlY2lmaWMgc3Vic2NyaXB0aW9uIHBsYW4gYnkgSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN1YnNjcmlwdGlvblBsYW4ocGxhbklkOiBzdHJpbmcpOiBQcm9taXNlPFN1YnNjcmlwdGlvblBsYW4gfCBudWxsPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuICBcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYW5zJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ2lkJywgcGxhbklkKVxuICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAuc2luZ2xlKCk7XG4gICAgXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGZldGNoaW5nIHBsYW46JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIFxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGNhbiBnZW5lcmF0ZSBub3RlcyBiYXNlZCBvbiB0aGVpciBwbGFuIGFuZCB1c2FnZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tVc2FnZUxpbWl0cyhcbiAgdXNlcklkOiBzdHJpbmcsIFxuICB0b2tlbjogc3RyaW5nLCBcbiAgbm90ZVR5cGU6ICd2aWRlbycgfCAnZmlsZScgfCAndGV4dCcgPSAndGV4dCdcbik6IFByb21pc2U8VXNhZ2VDaGVjaz4ge1xuICB0cnkge1xuICAgIC8vIFVzZSBkaXJlY3QgdGFibGUgcXVlcmllcyBpbnN0ZWFkIG9mIFJQQyBmdW5jdGlvbnMgdG8gYXZvaWQgaXNzdWVzXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gQ2hlY2tpbmcgdXNhZ2UgbGltaXRzIGZvciB1c2VyOicsIHVzZXJJZClcblxuICAgIC8vIEdldCB1c2VyJ3Mgc3Vic2NyaXB0aW9uIGRpcmVjdGx5XG4gICAgY29uc3QgeyBkYXRhOiB1c2VyU3ViLCBlcnJvcjogc3ViRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBwbGFuX2lkLFxuICAgICAgICBiaWxsaW5nX2N5Y2xlLFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIGN1cnJlbnRfcGVyaW9kX2VuZCxcbiAgICAgICAgc3Vic2NyaXB0aW9uX3BsYW5zIChcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGRpc3BsYXlfbmFtZSxcbiAgICAgICAgICBmZWF0dXJlcyxcbiAgICAgICAgICBsaW1pdHMsXG4gICAgICAgICAgcHJpY2VfbW9udGhseSxcbiAgICAgICAgICBwcmljZV95ZWFybHlcbiAgICAgICAgKVxuICAgICAgYClcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ2FjdGl2ZScpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICAvLyBHZXQgY3VycmVudCBtb250aCB1c2FnZSBkaXJlY3RseVxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zdCB7IGRhdGE6IHVzYWdlLCBlcnJvcjogdXNhZ2VFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdtb250aF95ZWFyJywgY3VycmVudE1vbnRoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgLy8gRGVmYXVsdCBmcmVlIHBsYW4gbGltaXRzXG4gICAgY29uc3QgZnJlZVBsYW5MaW1pdHMgPSB7IFxuICAgICAgbm90ZXNfcGVyX21vbnRoOiAyLCBcbiAgICAgIG1heF9zYXZlZF9ub3RlczogMywgXG4gICAgICBtYXhfdGV4dF9sZW5ndGg6IDUwMDAgXG4gICAgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2FnZSA9IHVzYWdlIHx8IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogMCxcbiAgICAgIHZpZGVvX25vdGVzX2NvdW50OiAwLFxuICAgICAgZmlsZV9ub3Rlc19jb3VudDogMCxcbiAgICAgIHRleHRfbm90ZXNfY291bnQ6IDAsXG4gICAgICB0b3RhbF9zYXZlZF9ub3RlczogMCxcbiAgICAgIG1vbnRoX3llYXI6IGN1cnJlbnRNb250aFxuICAgIH07XG5cbiAgICAvLyBJZiB1c2FnZSByZWNvcmQgZG9lc24ndCBleGlzdCwgY3JlYXRlIGl0XG4gICAgaWYgKCF1c2FnZSkge1xuICAgICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIENyZWF0aW5nIHVzYWdlIHJlY29yZCBmb3IgY3VycmVudCBtb250aDonLCBjdXJyZW50TW9udGgpXG4gICAgICBjb25zdCB7IGVycm9yOiBjcmVhdGVVc2FnZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndXNlcl91c2FnZScpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGgsXG4gICAgICAgICAgbm90ZXNfZ2VuZXJhdGVkOiAwLFxuICAgICAgICAgIHZpZGVvX25vdGVzX2NvdW50OiAwLFxuICAgICAgICAgIGZpbGVfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgICAgdGV4dF9ub3Rlc19jb3VudDogMCxcbiAgICAgICAgICB0b3RhbF9zYXZlZF9ub3RlczogMCxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChjcmVhdGVVc2FnZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFdhcm5pbmc6IENvdWxkIG5vdCBjcmVhdGUgdXNhZ2UgcmVjb3JkOicsIGNyZWF0ZVVzYWdlRXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIG5vIHN1YnNjcmlwdGlvbiBmb3VuZCBvciBlcnJvciwgdHJ5IHRvIGNyZWF0ZSBhIGZyZWUgc3Vic2NyaXB0aW9uXG4gICAgaWYgKCF1c2VyU3ViIHx8IHN1YkVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gTm8gYWN0aXZlIHN1YnNjcmlwdGlvbiBmb3VuZCwgYXR0ZW1wdGluZyB0byBjcmVhdGUgZnJlZSBzdWJzY3JpcHRpb24nKVxuICAgICAgXG4gICAgICBpZiAoc3ViRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gU3Vic2NyaXB0aW9uIHF1ZXJ5IGVycm9yOicsIHN1YkVycm9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gVHJ5IHRvIGNyZWF0ZSBhIGZyZWUgc3Vic2NyaXB0aW9uIGZvciB0aGUgdXNlclxuICAgICAgY29uc3QgeyBlcnJvcjogY3JlYXRlU3ViRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX3N1YnNjcmlwdGlvbnMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgcGxhbl9pZDogJ2ZyZWUnLFxuICAgICAgICAgIGJpbGxpbmdfY3ljbGU6ICdtb250aGx5JyxcbiAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICAgIGN1cnJlbnRfcGVyaW9kX3N0YXJ0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgY3VycmVudF9wZXJpb2RfZW5kOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KCk7XG5cbiAgICAgIGlmIChjcmVhdGVTdWJFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBDb3VsZCBub3QgY3JlYXRlIGZyZWUgc3Vic2NyaXB0aW9uOicsIGNyZWF0ZVN1YkVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBDcmVhdGVkIGZyZWUgc3Vic2NyaXB0aW9uIGZvciB1c2VyJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBmcmVlIHBsYW4gbGltaXRzIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB3ZSBjb3VsZCBjcmVhdGUgdGhlIHN1YnNjcmlwdGlvblxuICAgICAgY29uc3QgY2FuR2VuZXJhdGUgPSBjdXJyZW50VXNhZ2Uubm90ZXNfZ2VuZXJhdGVkIDwgZnJlZVBsYW5MaW1pdHMubm90ZXNfcGVyX21vbnRoO1xuICAgICAgY29uc3QgY2FuU2F2ZSA9IGN1cnJlbnRVc2FnZS50b3RhbF9zYXZlZF9ub3RlcyA8IGZyZWVQbGFuTGltaXRzLm1heF9zYXZlZF9ub3RlcztcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FuR2VuZXJhdGUsXG4gICAgICAgIGNhblNhdmUsXG4gICAgICAgIHJlYXNvbjogIWNhbkdlbmVyYXRlID8gYE1vbnRobHkgbGltaXQgcmVhY2hlZCAoJHtmcmVlUGxhbkxpbWl0cy5ub3Rlc19wZXJfbW9udGh9IG5vdGVzIHBlciBtb250aClgIDpcbiAgICAgICAgICAgICAgICAhY2FuU2F2ZSA/IGBTdG9yYWdlIGxpbWl0IHJlYWNoZWQgKCR7ZnJlZVBsYW5MaW1pdHMubWF4X3NhdmVkX25vdGVzfSBzYXZlZCBub3RlcyBtYXhpbXVtKWAgOiB1bmRlZmluZWQsXG4gICAgICAgIHVzYWdlOiBjdXJyZW50VXNhZ2UsXG4gICAgICAgIGxpbWl0czogZnJlZVBsYW5MaW1pdHNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdXNlclN1YjtcbiAgICBjb25zdCBwbGFuRGF0YSA9IHN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fcGxhbnMgYXMgYW55O1xuICAgIFxuICAgIGlmICghcGxhbkRhdGEpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFBsYW4gZGF0YSBub3QgZm91bmQgZm9yIHN1YnNjcmlwdGlvbjonLCBzdWJzY3JpcHRpb24pO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gZnJlZSBwbGFuXG4gICAgICBjb25zdCBjYW5HZW5lcmF0ZSA9IGN1cnJlbnRVc2FnZS5ub3Rlc19nZW5lcmF0ZWQgPCBmcmVlUGxhbkxpbWl0cy5ub3Rlc19wZXJfbW9udGg7XG4gICAgICBjb25zdCBjYW5TYXZlID0gY3VycmVudFVzYWdlLnRvdGFsX3NhdmVkX25vdGVzIDwgZnJlZVBsYW5MaW1pdHMubWF4X3NhdmVkX25vdGVzO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW5HZW5lcmF0ZSxcbiAgICAgICAgY2FuU2F2ZSxcbiAgICAgICAgcmVhc29uOiAnUGxhbiBkYXRhIG5vdCBmb3VuZCAtIHVzaW5nIGZyZWUgcGxhbiBsaW1pdHMnLFxuICAgICAgICB1c2FnZTogY3VycmVudFVzYWdlLFxuICAgICAgICBsaW1pdHM6IGZyZWVQbGFuTGltaXRzXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gRm91bmQgc3Vic2NyaXB0aW9uOicsIHtcbiAgICAgIHBsYW5JZDogc3Vic2NyaXB0aW9uLnBsYW5faWQsXG4gICAgICBwbGFuTGltaXRzOiBwbGFuRGF0YS5saW1pdHMsXG4gICAgICBjdXJyZW50VXNhZ2U6IGN1cnJlbnRVc2FnZVxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgbW9udGhseSBnZW5lcmF0aW9uIGxpbWl0IChoYW5kbGUgdW5saW1pdGVkIGNhc2UpXG4gICAgY29uc3QgbW9udGhseUxpbWl0ID0gcGxhbkRhdGEubGltaXRzLm5vdGVzX3Blcl9tb250aDtcbiAgICBjb25zdCBjYW5HZW5lcmF0ZSA9IG1vbnRobHlMaW1pdCA9PT0gLTEgfHwgY3VycmVudFVzYWdlLm5vdGVzX2dlbmVyYXRlZCA8IG1vbnRobHlMaW1pdDtcbiAgICBcbiAgICAvLyBDaGVjayBzYXZlZCBub3RlcyBsaW1pdFxuICAgIGNvbnN0IGNhblNhdmUgPSBjdXJyZW50VXNhZ2UudG90YWxfc2F2ZWRfbm90ZXMgPCBwbGFuRGF0YS5saW1pdHMubWF4X3NhdmVkX25vdGVzO1xuICAgIFxuICAgIGxldCByZWFzb246IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBpZiAoIWNhbkdlbmVyYXRlICYmIG1vbnRobHlMaW1pdCAhPT0gLTEpIHtcbiAgICAgIHJlYXNvbiA9IGBNb250aGx5IGxpbWl0IHJlYWNoZWQgKCR7bW9udGhseUxpbWl0fSBub3RlcyBwZXIgbW9udGgpYDtcbiAgICB9IGVsc2UgaWYgKCFjYW5TYXZlKSB7XG4gICAgICByZWFzb24gPSBgU3RvcmFnZSBsaW1pdCByZWFjaGVkICgke3BsYW5EYXRhLmxpbWl0cy5tYXhfc2F2ZWRfbm90ZXN9IHNhdmVkIG5vdGVzIG1heGltdW0pYDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbkdlbmVyYXRlLFxuICAgICAgY2FuU2F2ZSxcbiAgICAgIHJlYXNvbixcbiAgICAgIHVzYWdlOiBjdXJyZW50VXNhZ2UsXG4gICAgICBsaW1pdHM6IHBsYW5EYXRhLmxpbWl0c1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgY2hlY2tpbmcgdXNhZ2UgbGltaXRzOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBSZXR1cm4gcmVzdHJpY3RpdmUgZmFsbGJhY2tcbiAgICBjb25zdCBjdXJyZW50TW9udGggPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgNyk7XG4gICAgY29uc3QgZmFsbGJhY2tVc2FnZSA9IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogOTk5LFxuICAgICAgdmlkZW9fbm90ZXNfY291bnQ6IDAsXG4gICAgICBmaWxlX25vdGVzX2NvdW50OiAwLFxuICAgICAgdGV4dF9ub3Rlc19jb3VudDogMCxcbiAgICAgIHRvdGFsX3NhdmVkX25vdGVzOiA5OTksXG4gICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGhcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBjYW5HZW5lcmF0ZTogZmFsc2UsXG4gICAgICBjYW5TYXZlOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ0Vycm9yIGNoZWNraW5nIHN1YnNjcmlwdGlvbiBsaW1pdHMuIFBsZWFzZSB0cnkgYWdhaW4uJyxcbiAgICAgIHVzYWdlOiBmYWxsYmFja1VzYWdlLFxuICAgICAgbGltaXRzOiB7IG5vdGVzX3Blcl9tb250aDogMiwgbWF4X3NhdmVkX25vdGVzOiAzLCBtYXhfdGV4dF9sZW5ndGg6IDUwMDAgfVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBJbmNyZW1lbnQgdXNlcidzIHVzYWdlIGNvdW50IGFmdGVyIHN1Y2Nlc3NmdWwgbm90ZSBnZW5lcmF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRVc2FnZShcbiAgdXNlcklkOiBzdHJpbmcsIFxuICB0b2tlbjogc3RyaW5nLCBcbiAgbm90ZVR5cGU6ICd2aWRlbycgfCAnZmlsZScgfCAndGV4dCcgPSAndGV4dCdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGdsb2JhbDoge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDcpO1xuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBJbmNyZW1lbnRpbmcgdXNhZ2UgZm9yIHVzZXI6JywgdXNlcklkLCAndHlwZTonLCBub3RlVHlwZSlcblxuICAgIC8vIEdldCBjdXJyZW50IHVzYWdlXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50VXNhZ2UsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ21vbnRoX3llYXInLCBjdXJyZW50TW9udGgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZmV0Y2hFcnJvciAmJiBmZXRjaEVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGZldGNoaW5nIGN1cnJlbnQgdXNhZ2U6JywgZmV0Y2hFcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUHJlcGFyZSB1cGRhdGUgZGF0YVxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogKGN1cnJlbnRVc2FnZT8ubm90ZXNfZ2VuZXJhdGVkIHx8IDApICsgMSxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgICAvLyBJbmNyZW1lbnQgc3BlY2lmaWMgbm90ZSB0eXBlIGNvdW50ZXJcbiAgICBpZiAobm90ZVR5cGUgPT09ICd2aWRlbycpIHtcbiAgICAgIHVwZGF0ZURhdGEudmlkZW9fbm90ZXNfY291bnQgPSAoY3VycmVudFVzYWdlPy52aWRlb19ub3Rlc19jb3VudCB8fCAwKSArIDE7XG4gICAgfSBlbHNlIGlmIChub3RlVHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgICB1cGRhdGVEYXRhLmZpbGVfbm90ZXNfY291bnQgPSAoY3VycmVudFVzYWdlPy5maWxlX25vdGVzX2NvdW50IHx8IDApICsgMTtcbiAgICB9IGVsc2UgaWYgKG5vdGVUeXBlID09PSAndGV4dCcpIHtcbiAgICAgIHVwZGF0ZURhdGEudGV4dF9ub3Rlc19jb3VudCA9IChjdXJyZW50VXNhZ2U/LnRleHRfbm90ZXNfY291bnQgfHwgMCkgKyAxO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgdXNhZ2UgcmVjb3JkXG4gICAgaWYgKGN1cnJlbnRVc2FnZSkge1xuICAgICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5lcSgnbW9udGhfeWVhcicsIGN1cnJlbnRNb250aCk7XG5cbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciB1cGRhdGluZyB1c2FnZTonLCB1cGRhdGVFcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIG5ldyB1c2FnZSByZWNvcmRcbiAgICAgIGNvbnN0IGluc2VydERhdGEgPSB7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbW9udGhfeWVhcjogY3VycmVudE1vbnRoLFxuICAgICAgICBub3Rlc19nZW5lcmF0ZWQ6IDEsXG4gICAgICAgIHZpZGVvX25vdGVzX2NvdW50OiBub3RlVHlwZSA9PT0gJ3ZpZGVvJyA/IDEgOiAwLFxuICAgICAgICBmaWxlX25vdGVzX2NvdW50OiBub3RlVHlwZSA9PT0gJ2ZpbGUnID8gMSA6IDAsXG4gICAgICAgIHRleHRfbm90ZXNfY291bnQ6IG5vdGVUeXBlID09PSAndGV4dCcgPyAxIDogMCxcbiAgICAgICAgdG90YWxfc2F2ZWRfbm90ZXM6IDAsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpO1xuXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgY3JlYXRpbmcgdXNhZ2UgcmVjb3JkOicsIGluc2VydEVycm9yKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBTdWNjZXNzZnVsbHkgaW5jcmVtZW50ZWQgdXNhZ2UnKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBpbmNyZW1lbnRpbmcgdXNhZ2U6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFVwZGF0ZSBzYXZlZCBub3RlcyBjb3VudCAodXNlZCB3aGVuIG5vdGVzIGFyZSBzYXZlZCBvciBkZWxldGVkKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2F2ZWROb3Rlc0NvdW50KFxuICB1c2VySWQ6IHN0cmluZywgXG4gIHRva2VuOiBzdHJpbmcsIFxuICBjb3VudDogbnVtYmVyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICBnbG9iYWw6IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gVXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQgZm9yIHVzZXI6JywgdXNlcklkLCAnY291bnQ6JywgY291bnQpXG5cbiAgICAvLyBVcHNlcnQgdGhlIHNhdmVkIG5vdGVzIGNvdW50XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgIC51cHNlcnQoe1xuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgIG1vbnRoX3llYXI6IGN1cnJlbnRNb250aCxcbiAgICAgICAgdG90YWxfc2F2ZWRfbm90ZXM6IE1hdGgubWF4KDAsIGNvdW50KSwgLy8gRW5zdXJlIG5vbi1uZWdhdGl2ZVxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0sIHtcbiAgICAgICAgb25Db25mbGljdDogJ3VzZXJfaWQsbW9udGhfeWVhcidcbiAgICAgIH0pO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciB1cGRhdGluZyBzYXZlZCBub3RlcyBjb3VudDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIFN1Y2Nlc3NmdWxseSB1cGRhdGVkIHNhdmVkIG5vdGVzIGNvdW50Jyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgdXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFJlZnJlc2ggc2F2ZWQgbm90ZXMgY291bnQgYnkgY291bnRpbmcgYWxsIG5vdGVzIGZyb20gYWxsIHRhYmxlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVmcmVzaFNhdmVkTm90ZXNDb3VudChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRva2VuOiBzdHJpbmdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGdsb2JhbDoge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIFJlZnJlc2hpbmcgc2F2ZWQgbm90ZXMgY291bnQgZm9yIHVzZXI6JywgdXNlcklkKTtcblxuICAgIC8vIENvdW50IG5vdGVzIGZyb20gYWxsIHRhYmxlcyBpbmNsdWRpbmcgdmlkZW9fdXBsb2FkX25vdGVzXG4gICAgY29uc3QgW3ZpZGVvUmVzdWx0LCBmaWxlUmVzdWx0LCB0ZXh0UmVzdWx0LCB1cGxvYWRWaWRlb1Jlc3VsdF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndmlkZW9fbm90ZXMnKVxuICAgICAgICAuc2VsZWN0KCdpZCcsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKSxcbiAgICAgIHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdmaWxlX25vdGVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZCksXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndGV4dF9ub3RlcycpXG4gICAgICAgIC5zZWxlY3QoJ2lkJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpLFxuICAgICAgLy8gSGFuZGxlIHZpZGVvX3VwbG9hZF9ub3RlcyB0YWJsZSB0aGF0IG1pZ2h0IG5vdCBleGlzdCBpbiBhbGwgZW52aXJvbm1lbnRzXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndmlkZW9fdXBsb2FkX25vdGVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLnRoZW4oXG4gICAgICAgICAgcmVzdWx0ID0+IHJlc3VsdCxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb25dIHZpZGVvX3VwbG9hZF9ub3RlcyB0YWJsZSBtaWdodCBub3QgZXhpc3Q6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgICAgIHJldHVybiB7IGNvdW50OiAwIH1cbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICBdKTtcblxuICAgIGNvbnN0IHZpZGVvQ291bnQgPSB2aWRlb1Jlc3VsdC5jb3VudCB8fCAwO1xuICAgIGNvbnN0IGZpbGVDb3VudCA9IGZpbGVSZXN1bHQuY291bnQgfHwgMDtcbiAgICBjb25zdCB0ZXh0Q291bnQgPSB0ZXh0UmVzdWx0LmNvdW50IHx8IDA7XG4gICAgY29uc3QgdXBsb2FkVmlkZW9Db3VudCA9IHVwbG9hZFZpZGVvUmVzdWx0LmNvdW50IHx8IDA7XG4gICAgY29uc3QgdG90YWxDb3VudCA9IHZpZGVvQ291bnQgKyBmaWxlQ291bnQgKyB0ZXh0Q291bnQgKyB1cGxvYWRWaWRlb0NvdW50O1xuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIE5vdGUgY291bnRzOicsIHtcbiAgICAgIHZpZGVvOiB2aWRlb0NvdW50LFxuICAgICAgZmlsZTogZmlsZUNvdW50LFxuICAgICAgdGV4dDogdGV4dENvdW50LFxuICAgICAgdmlkZW9fdXBsb2FkOiB1cGxvYWRWaWRlb0NvdW50LFxuICAgICAgdG90YWw6IHRvdGFsQ291bnRcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgdXNhZ2UgcmVjb3JkIHdpdGggdGhlIGFjdHVhbCBjb3VudFxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgLnVwc2VydCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbW9udGhfeWVhcjogY3VycmVudE1vbnRoLFxuICAgICAgICB0b3RhbF9zYXZlZF9ub3RlczogdG90YWxDb3VudCxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9LCB7XG4gICAgICAgIG9uQ29uZmxpY3Q6ICd1c2VyX2lkLG1vbnRoX3llYXInXG4gICAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgdXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBTdWNjZXNzZnVsbHkgcmVmcmVzaGVkIHNhdmVkIG5vdGVzIGNvdW50IHRvOicsIHRvdGFsQ291bnQpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIHJlZnJlc2hpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBwbGFuIHByaWNpbmcgd2l0aCBkaXNjb3VudCBjYWxjdWxhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGxhblByaWNpbmcocGxhbjogU3Vic2NyaXB0aW9uUGxhbikge1xuICBjb25zdCBtb250aGx5UHJpY2UgPSBwbGFuLnByaWNlX21vbnRobHk7XG4gIGNvbnN0IHllYXJseVByaWNlID0gcGxhbi5wcmljZV95ZWFybHk7XG4gIGNvbnN0IHllYXJseU1vbnRobHlFcXVpdmFsZW50ID0geWVhcmx5UHJpY2UgLyAxMjtcbiAgY29uc3QgZGlzY291bnRQZXJjZW50YWdlID0gbW9udGhseVByaWNlID4gMCA/IE1hdGgucm91bmQoKDEgLSB5ZWFybHlNb250aGx5RXF1aXZhbGVudCAvIG1vbnRobHlQcmljZSkgKiAxMDApIDogMDtcbiAgY29uc3QgeWVhcmx5U2F2aW5ncyA9IChtb250aGx5UHJpY2UgKiAxMikgLSB5ZWFybHlQcmljZTtcbiAgXG4gIHJldHVybiB7XG4gICAgbW9udGhseTogbW9udGhseVByaWNlLFxuICAgIHllYXJseTogeWVhcmx5UHJpY2UsXG4gICAgeWVhcmx5TW9udGhseUVxdWl2YWxlbnQsXG4gICAgZGlzY291bnRQZXJjZW50YWdlLFxuICAgIHllYXJseVNhdmluZ3MsXG4gICAgY3VycmVuY3k6IHBsYW4uY3VycmVuY3lcbiAgfTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gYSBzcGVjaWZpYyBmZWF0dXJlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYXNGZWF0dXJlQWNjZXNzKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgdG9rZW46IHN0cmluZyxcbiAgZmVhdHVyZToga2V5b2YgU3Vic2NyaXB0aW9uUGxhblsnZmVhdHVyZXMnXVxuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgZ2V0VXNlclN1YnNjcmlwdGlvbih1c2VySWQsIHRva2VuKTtcbiAgICBcbiAgICBpZiAoIXN1YnNjcmlwdGlvbikge1xuICAgICAgLy8gRGVmYXVsdCBmcmVlIHBsYW4gZmVhdHVyZXNcbiAgICAgIGNvbnN0IGZyZWVGZWF0dXJlcyA9IHtcbiAgICAgICAgbm90ZXNfZ2VuZXJhdGlvbjogdHJ1ZSxcbiAgICAgICAgcXVpenplczogZmFsc2UsXG4gICAgICAgIHlvdXR1YmVfc3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgcHB0X3N1cHBvcnQ6IGZhbHNlLFxuICAgICAgICBleHBvcnQ6IGZhbHNlLFxuICAgICAgICBjb3B5X3Bhc3RlOiB0cnVlLFxuICAgICAgICB1cGxvYWRfdmlkZW86IGZhbHNlLFxuICAgICAgICBwcmlvcml0eV9nZW5lcmF0aW9uOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGZyZWVGZWF0dXJlc1tmZWF0dXJlXSB8fCBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbi5mZWF0dXJlc1tmZWF0dXJlXSB8fCBmYWxzZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBjaGVja2luZyBmZWF0dXJlIGFjY2VzczonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBEZWZhdWx0IHRvIG5vIGFjY2VzcyBvbiBlcnJvclxuICB9XG59XG5cbi8qKlxuICogQXNzaWduIHN1YnNjcmlwdGlvbiB0byB1c2VyIGFmdGVyIHN1Y2Nlc3NmdWwgcGF5bWVudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduVXNlclN1YnNjcmlwdGlvbihcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRva2VuOiBzdHJpbmcsXG4gIHBsYW5JZDogc3RyaW5nLFxuICBiaWxsaW5nQ3ljbGU6ICdtb250aGx5JyB8ICd5ZWFybHknLFxuICBwYXltZW50RGF0YT86IHtcbiAgICBzdHJpcGVTdWJzY3JpcHRpb25JZD86IHN0cmluZztcbiAgICBzdHJpcGVDdXN0b21lcklkPzogc3RyaW5nO1xuICB9XG4pOiBQcm9taXNlPFVzZXJTdWJzY3JpcHRpb24gfCBudWxsPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICBnbG9iYWw6IHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gQ2FsY3VsYXRlIHBlcmlvZCBkYXRlc1xuICAgIGNvbnN0IGN1cnJlbnRQZXJpb2RTdGFydCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgY3VycmVudFBlcmlvZEVuZCA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgaWYgKGJpbGxpbmdDeWNsZSA9PT0gJ3llYXJseScpIHtcbiAgICAgIGN1cnJlbnRQZXJpb2RFbmQuc2V0RnVsbFllYXIoY3VycmVudFBlcmlvZEVuZC5nZXRGdWxsWWVhcigpICsgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRQZXJpb2RFbmQuc2V0TW9udGgoY3VycmVudFBlcmlvZEVuZC5nZXRNb250aCgpICsgMSk7XG4gICAgfVxuXG4gICAgLy8gUHJlcGFyZSBzdWJzY3JpcHRpb24gZGF0YVxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbkRhdGEgPSB7XG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBwbGFuX2lkOiBwbGFuSWQsXG4gICAgICBiaWxsaW5nX2N5Y2xlOiBiaWxsaW5nQ3ljbGUsXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnIGFzIGNvbnN0LFxuICAgICAgY3VycmVudF9wZXJpb2Rfc3RhcnQ6IGN1cnJlbnRQZXJpb2RTdGFydC50b0lTT1N0cmluZygpLFxuICAgICAgY3VycmVudF9wZXJpb2RfZW5kOiBjdXJyZW50UGVyaW9kRW5kLnRvSVNPU3RyaW5nKCksXG4gICAgICBjYW5jZWxfYXRfcGVyaW9kX2VuZDogZmFsc2UsXG4gICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkOiBwYXltZW50RGF0YT8uc3RyaXBlU3Vic2NyaXB0aW9uSWQgfHwgbnVsbCxcbiAgICAgIHN0cmlwZV9jdXN0b21lcl9pZDogcGF5bWVudERhdGE/LnN0cmlwZUN1c3RvbWVySWQgfHwgbnVsbCxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgICAvLyBVcHNlcnQgc3Vic2NyaXB0aW9uICh1cGRhdGUgaWYgZXhpc3RzLCBpbnNlcnQgaWYgbmV3KVxuICAgIGNvbnN0IHsgZGF0YTogc3Vic2NyaXB0aW9uLCBlcnJvcjogc3Vic2NyaXB0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC51cHNlcnQoc3Vic2NyaXB0aW9uRGF0YSwge1xuICAgICAgICBvbkNvbmZsaWN0OiAndXNlcl9pZCdcbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KGBcbiAgICAgICAgaWQsXG4gICAgICAgIHBsYW5faWQsXG4gICAgICAgIGJpbGxpbmdfY3ljbGUsXG4gICAgICAgIHN0YXR1cyxcbiAgICAgICAgY3VycmVudF9wZXJpb2RfZW5kLFxuICAgICAgICBzdWJzY3JpcHRpb25fcGxhbnMgKFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgZGlzcGxheV9uYW1lLFxuICAgICAgICAgIGZlYXR1cmVzLFxuICAgICAgICAgIGxpbWl0cyxcbiAgICAgICAgICBwcmljZV9tb250aGx5LFxuICAgICAgICAgIHByaWNlX3llYXJseVxuICAgICAgICApXG4gICAgICBgKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHN1YnNjcmlwdGlvbkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBhc3NpZ25pbmcgc3Vic2NyaXB0aW9uOicsIHN1YnNjcmlwdGlvbkVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFzc2lnbiBzdWJzY3JpcHRpb24nKTtcbiAgICB9XG5cbiAgICBpZiAoIXN1YnNjcmlwdGlvbiB8fCAhc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl9wbGFucykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgc3Vic2NyaXB0aW9uIGRldGFpbHMnKTtcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIHVzYWdlIHRyYWNraW5nIGZvciBjdXJyZW50IG1vbnRoXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDcpO1xuICAgIGNvbnN0IHsgZXJyb3I6IHVzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl91c2FnZScpXG4gICAgICAudXBzZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGgsXG4gICAgICAgIG5vdGVzX2dlbmVyYXRlZDogMCxcbiAgICAgICAgdmlkZW9fbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIGZpbGVfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIHRleHRfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIHRvdGFsX3NhdmVkX25vdGVzOiAwLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0sIHtcbiAgICAgICAgb25Db25mbGljdDogJ3VzZXJfaWQsbW9udGhfeWVhcicsXG4gICAgICAgIGlnbm9yZUR1cGxpY2F0ZXM6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgaWYgKHVzYWdlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFdhcm5pbmc6IEZhaWxlZCB0byBpbml0aWFsaXplIHVzYWdlIHRyYWNraW5nOicsIHVzYWdlRXJyb3IpO1xuICAgICAgLy8gRG9uJ3QgdGhyb3cgZXJyb3IgaGVyZSBhcyBzdWJzY3JpcHRpb24gYXNzaWdubWVudCB3YXMgc3VjY2Vzc2Z1bFxuICAgIH1cblxuICAgIGNvbnN0IHBsYW5EYXRhID0gc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl9wbGFucyBhcyBhbnk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgcGxhbl9pZDogc3Vic2NyaXB0aW9uLnBsYW5faWQsXG4gICAgICBwbGFuX25hbWU6IHBsYW5EYXRhLm5hbWUsXG4gICAgICBwbGFuX2Rpc3BsYXlfbmFtZTogcGxhbkRhdGEuZGlzcGxheV9uYW1lLFxuICAgICAgYmlsbGluZ19jeWNsZTogc3Vic2NyaXB0aW9uLmJpbGxpbmdfY3ljbGUsXG4gICAgICBzdGF0dXM6IHN1YnNjcmlwdGlvbi5zdGF0dXMsXG4gICAgICBjdXJyZW50X3BlcmlvZF9lbmQ6IHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQsXG4gICAgICBmZWF0dXJlczogcGxhbkRhdGEuZmVhdHVyZXMsXG4gICAgICBsaW1pdHM6IHBsYW5EYXRhLmxpbWl0cyxcbiAgICAgIHByaWNlX21vbnRobHk6IHBsYW5EYXRhLnByaWNlX21vbnRobHksXG4gICAgICBwcmljZV95ZWFybHk6IHBsYW5EYXRhLnByaWNlX3llYXJseVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgaW4gYXNzaWduVXNlclN1YnNjcmlwdGlvbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn0gIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZ2V0U3Vic2NyaXB0aW9uUGxhbnMiLCJzdXBhYmFzZSIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSIsIkVycm9yIiwiZ2V0VXNlclN1YnNjcmlwdGlvbiIsInVzZXJJZCIsInRva2VuIiwiZ2xvYmFsIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJ1c2VyU3ViIiwic2luZ2xlIiwic3Vic2NyaXB0aW9uX3BsYW5zIiwicGxhbkRhdGEiLCJzdWJzY3JpcHRpb25faWQiLCJpZCIsInBsYW5faWQiLCJwbGFuX25hbWUiLCJuYW1lIiwicGxhbl9kaXNwbGF5X25hbWUiLCJkaXNwbGF5X25hbWUiLCJiaWxsaW5nX2N5Y2xlIiwic3RhdHVzIiwiY3VycmVudF9wZXJpb2RfZW5kIiwiZmVhdHVyZXMiLCJsaW1pdHMiLCJwcmljZV9tb250aGx5IiwicHJpY2VfeWVhcmx5IiwiZ2V0U3Vic2NyaXB0aW9uUGxhbiIsInBsYW5JZCIsImNoZWNrVXNhZ2VMaW1pdHMiLCJub3RlVHlwZSIsImxvZyIsInN1YkVycm9yIiwiY3VycmVudE1vbnRoIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJ1c2FnZSIsInVzYWdlRXJyb3IiLCJmcmVlUGxhbkxpbWl0cyIsIm5vdGVzX3Blcl9tb250aCIsIm1heF9zYXZlZF9ub3RlcyIsIm1heF90ZXh0X2xlbmd0aCIsImN1cnJlbnRVc2FnZSIsIm5vdGVzX2dlbmVyYXRlZCIsInZpZGVvX25vdGVzX2NvdW50IiwiZmlsZV9ub3Rlc19jb3VudCIsInRleHRfbm90ZXNfY291bnQiLCJ0b3RhbF9zYXZlZF9ub3RlcyIsIm1vbnRoX3llYXIiLCJjcmVhdGVVc2FnZUVycm9yIiwiaW5zZXJ0IiwidXNlcl9pZCIsInVwZGF0ZWRfYXQiLCJjcmVhdGVTdWJFcnJvciIsImN1cnJlbnRfcGVyaW9kX3N0YXJ0Iiwibm93IiwiY2FuR2VuZXJhdGUiLCJjYW5TYXZlIiwicmVhc29uIiwidW5kZWZpbmVkIiwic3Vic2NyaXB0aW9uIiwicGxhbkxpbWl0cyIsIm1vbnRobHlMaW1pdCIsImZhbGxiYWNrVXNhZ2UiLCJpbmNyZW1lbnRVc2FnZSIsImZldGNoRXJyb3IiLCJjb2RlIiwidXBkYXRlRGF0YSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwiaW5zZXJ0RGF0YSIsImNyZWF0ZWRfYXQiLCJpbnNlcnRFcnJvciIsInVwZGF0ZVNhdmVkTm90ZXNDb3VudCIsImNvdW50IiwidXBzZXJ0IiwiTWF0aCIsIm1heCIsIm9uQ29uZmxpY3QiLCJyZWZyZXNoU2F2ZWROb3Rlc0NvdW50IiwidmlkZW9SZXN1bHQiLCJmaWxlUmVzdWx0IiwidGV4dFJlc3VsdCIsInVwbG9hZFZpZGVvUmVzdWx0IiwiUHJvbWlzZSIsImFsbCIsImhlYWQiLCJ0aGVuIiwicmVzdWx0Iiwid2FybiIsIm1lc3NhZ2UiLCJ2aWRlb0NvdW50IiwiZmlsZUNvdW50IiwidGV4dENvdW50IiwidXBsb2FkVmlkZW9Db3VudCIsInRvdGFsQ291bnQiLCJ2aWRlbyIsImZpbGUiLCJ0ZXh0IiwidmlkZW9fdXBsb2FkIiwidG90YWwiLCJnZXRQbGFuUHJpY2luZyIsInBsYW4iLCJtb250aGx5UHJpY2UiLCJ5ZWFybHlQcmljZSIsInllYXJseU1vbnRobHlFcXVpdmFsZW50IiwiZGlzY291bnRQZXJjZW50YWdlIiwicm91bmQiLCJ5ZWFybHlTYXZpbmdzIiwibW9udGhseSIsInllYXJseSIsImN1cnJlbmN5IiwiaGFzRmVhdHVyZUFjY2VzcyIsImZlYXR1cmUiLCJmcmVlRmVhdHVyZXMiLCJub3Rlc19nZW5lcmF0aW9uIiwicXVpenplcyIsInlvdXR1YmVfc3VwcG9ydCIsInBwdF9zdXBwb3J0IiwiZXhwb3J0IiwiY29weV9wYXN0ZSIsInVwbG9hZF92aWRlbyIsInByaW9yaXR5X2dlbmVyYXRpb24iLCJhc3NpZ25Vc2VyU3Vic2NyaXB0aW9uIiwiYmlsbGluZ0N5Y2xlIiwicGF5bWVudERhdGEiLCJjdXJyZW50UGVyaW9kU3RhcnQiLCJjdXJyZW50UGVyaW9kRW5kIiwic2V0RnVsbFllYXIiLCJnZXRGdWxsWWVhciIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJzdWJzY3JpcHRpb25EYXRhIiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJzdHJpcGVfc3Vic2NyaXB0aW9uX2lkIiwic3RyaXBlU3Vic2NyaXB0aW9uSWQiLCJzdHJpcGVfY3VzdG9tZXJfaWQiLCJzdHJpcGVDdXN0b21lcklkIiwic3Vic2NyaXB0aW9uRXJyb3IiLCJpZ25vcmVEdXBsaWNhdGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/subscription.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frefresh-usage%2Froute&page=%2Fapi%2Frefresh-usage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frefresh-usage%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();