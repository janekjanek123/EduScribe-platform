/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/stripe/cancel-subscription/route";
exports.ids = ["app/api/stripe/cancel-subscription/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&page=%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcancel-subscription%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&page=%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcancel-subscription%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_janjedrach_Cursor_eduscribe_src_app_api_stripe_cancel_subscription_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/stripe/cancel-subscription/route.ts */ \"(rsc)/./src/app/api/stripe/cancel-subscription/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/stripe/cancel-subscription/route\",\n        pathname: \"/api/stripe/cancel-subscription\",\n        filename: \"route\",\n        bundlePath: \"app/api/stripe/cancel-subscription/route\"\n    },\n    resolvedPagePath: \"/Users/janjedrach/Cursor/eduscribe/src/app/api/stripe/cancel-subscription/route.ts\",\n    nextConfigOutput,\n    userland: _Users_janjedrach_Cursor_eduscribe_src_app_api_stripe_cancel_subscription_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/stripe/cancel-subscription/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdHJpcGUlMkZjYW5jZWwtc3Vic2NyaXB0aW9uJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdHJpcGUlMkZjYW5jZWwtc3Vic2NyaXB0aW9uJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3RyaXBlJTJGY2FuY2VsLXN1YnNjcmlwdGlvbiUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9anMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz1tZHgmcm9vdERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNrQztBQUMvRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8/NjQ5ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvamFuamVkcmFjaC9DdXJzb3IvZWR1c2NyaWJlL3NyYy9hcHAvYXBpL3N0cmlwZS9jYW5jZWwtc3Vic2NyaXB0aW9uL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3RyaXBlL2NhbmNlbC1zdWJzY3JpcHRpb24vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdHJpcGUvY2FuY2VsLXN1YnNjcmlwdGlvblwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3RyaXBlL2NhbmNlbC1zdWJzY3JpcHRpb24vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvamFuamVkcmFjaC9DdXJzb3IvZWR1c2NyaWJlL3NyYy9hcHAvYXBpL3N0cmlwZS9jYW5jZWwtc3Vic2NyaXB0aW9uL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9zdHJpcGUvY2FuY2VsLXN1YnNjcmlwdGlvbi9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&page=%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcancel-subscription%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/stripe/cancel-subscription/route.ts":
/*!*********************************************************!*\
  !*** ./src/app/api/stripe/cancel-subscription/route.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/stripe */ \"(rsc)/./src/lib/stripe.ts\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\n\nasync function POST(request) {\n    try {\n        console.log(\"[Stripe Cancel] Processing subscription cancellation...\");\n        // Validate environment variables first\n        const supabaseUrl = \"https://xhljckmlzdshxibnqsbj.supabase.co\";\n        const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA\";\n        if (!supabaseUrl || !supabaseAnonKey) {\n            console.error(\"[Stripe Cancel] Missing Supabase environment variables:\", {\n                supabaseUrl: !!supabaseUrl,\n                supabaseAnonKey: !!supabaseAnonKey\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Server configuration error - missing Supabase credentials\"\n            }, {\n                status: 500\n            });\n        }\n        // Check authentication via Bearer token\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            console.error(\"[Stripe Cancel] Authentication missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication required\"\n            }, {\n                status: 401\n            });\n        }\n        const token = authHeader.substring(7);\n        // Verify user with Supabase\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey);\n        const { data: { user }, error: userError } = await supabase.auth.getUser(token);\n        if (userError || !user) {\n            console.error(\"[Stripe Cancel] Invalid user token:\", userError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid authentication\"\n            }, {\n                status: 401\n            });\n        }\n        const { subscriptionId } = await request.json();\n        if (!subscriptionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Subscription ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"[Stripe Cancel] Cancelling subscription for user:\", user.id, \"subscription:\", subscriptionId);\n        // Create user-authenticated Supabase client\n        const userSupabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        // Count total notes across ALL tables (including video_upload_notes)\n        console.log(\"[Stripe Cancel] Counting user notes from all tables...\");\n        const [textNotesResult, fileNotesResult, videoNotesResult, uploadVideoNotesResult] = await Promise.all([\n            userSupabase.from(\"text_notes\").select(\"id, created_at\", {\n                count: \"exact\"\n            }).eq(\"user_id\", user.id).order(\"created_at\", {\n                ascending: true\n            }),\n            userSupabase.from(\"file_notes\").select(\"id, created_at\", {\n                count: \"exact\"\n            }).eq(\"user_id\", user.id).order(\"created_at\", {\n                ascending: true\n            }),\n            userSupabase.from(\"video_notes\").select(\"id, created_at\", {\n                count: \"exact\"\n            }).eq(\"user_id\", user.id).order(\"created_at\", {\n                ascending: true\n            }),\n            // Add video upload notes support\n            userSupabase.from(\"video_upload_notes\").select(\"id, created_at\", {\n                count: \"exact\"\n            }).eq(\"user_id\", user.id).order(\"created_at\", {\n                ascending: true\n            }).then((result)=>result, (error)=>{\n                console.warn(\"[Stripe Cancel] video_upload_notes table might not exist, skipping:\", error.message);\n                return {\n                    data: [],\n                    count: 0\n                };\n            })\n        ]);\n        const textNotes = textNotesResult.data || [];\n        const fileNotes = fileNotesResult.data || [];\n        const videoNotes = videoNotesResult.data || [];\n        const uploadVideoNotes = uploadVideoNotesResult.data || [];\n        const allNotes = [\n            ...textNotes.map((note)=>({\n                    ...note,\n                    type: \"text\"\n                })),\n            ...fileNotes.map((note)=>({\n                    ...note,\n                    type: \"file\"\n                })),\n            ...videoNotes.map((note)=>({\n                    ...note,\n                    type: \"video\"\n                })),\n            ...uploadVideoNotes.map((note)=>({\n                    ...note,\n                    type: \"video_upload\"\n                }))\n        ].sort((a, b)=>new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n        const totalNotes = allNotes.length;\n        console.log(\"[Stripe Cancel] Total notes found:\", {\n            text: textNotes.length,\n            file: fileNotes.length,\n            video: videoNotes.length,\n            video_upload: uploadVideoNotes.length,\n            total: totalNotes\n        });\n        // Prepare note deletion statistics\n        let notesDeleted = {\n            text: 0,\n            file: 0,\n            video: 0,\n            video_upload: 0,\n            total: 0\n        };\n        // If user has more than 3 notes, delete the excess (keep the 3 oldest)\n        if (totalNotes > 3) {\n            const notesToDelete = allNotes.slice(3) // Remove everything after the first 3 (oldest)\n            ;\n            console.log(\"[Stripe Cancel] Notes to delete:\", notesToDelete.length);\n            // Group notes to delete by type for batch deletion\n            const textNotesToDelete = notesToDelete.filter((note)=>note.type === \"text\").map((note)=>note.id);\n            const fileNotesToDelete = notesToDelete.filter((note)=>note.type === \"file\").map((note)=>note.id);\n            const videoNotesToDelete = notesToDelete.filter((note)=>note.type === \"video\").map((note)=>note.id);\n            const uploadVideoNotesToDelete = notesToDelete.filter((note)=>note.type === \"video_upload\").map((note)=>note.id);\n            // Delete notes in batches by type\n            const deletionPromises = [];\n            if (textNotesToDelete.length > 0) {\n                deletionPromises.push(userSupabase.from(\"text_notes\").delete().in(\"id\", textNotesToDelete).then((result)=>{\n                    if (result.error) {\n                        console.error(\"[Stripe Cancel] Error deleting text notes:\", result.error);\n                        return {\n                            type: \"text\",\n                            count: 0,\n                            error: result.error\n                        };\n                    } else {\n                        notesDeleted.text = textNotesToDelete.length;\n                        console.log(\"[Stripe Cancel] Deleted text notes:\", textNotesToDelete.length);\n                        return {\n                            type: \"text\",\n                            count: textNotesToDelete.length,\n                            error: null\n                        };\n                    }\n                }));\n            }\n            if (fileNotesToDelete.length > 0) {\n                deletionPromises.push(userSupabase.from(\"file_notes\").delete().in(\"id\", fileNotesToDelete).then((result)=>{\n                    if (result.error) {\n                        console.error(\"[Stripe Cancel] Error deleting file notes:\", result.error);\n                        return {\n                            type: \"file\",\n                            count: 0,\n                            error: result.error\n                        };\n                    } else {\n                        notesDeleted.file = fileNotesToDelete.length;\n                        console.log(\"[Stripe Cancel] Deleted file notes:\", fileNotesToDelete.length);\n                        return {\n                            type: \"file\",\n                            count: fileNotesToDelete.length,\n                            error: null\n                        };\n                    }\n                }));\n            }\n            if (videoNotesToDelete.length > 0) {\n                deletionPromises.push(userSupabase.from(\"video_notes\").delete().in(\"id\", videoNotesToDelete).then((result)=>{\n                    if (result.error) {\n                        console.error(\"[Stripe Cancel] Error deleting video notes:\", result.error);\n                        return {\n                            type: \"video\",\n                            count: 0,\n                            error: result.error\n                        };\n                    } else {\n                        notesDeleted.video = videoNotesToDelete.length;\n                        console.log(\"[Stripe Cancel] Deleted video notes:\", videoNotesToDelete.length);\n                        return {\n                            type: \"video\",\n                            count: videoNotesToDelete.length,\n                            error: null\n                        };\n                    }\n                }));\n            }\n            if (uploadVideoNotesToDelete.length > 0) {\n                deletionPromises.push(userSupabase.from(\"video_upload_notes\").delete().in(\"id\", uploadVideoNotesToDelete).then((result)=>{\n                    if (result.error) {\n                        console.error(\"[Stripe Cancel] Error deleting video upload notes:\", result.error);\n                        return {\n                            type: \"video_upload\",\n                            count: 0,\n                            error: result.error\n                        };\n                    } else {\n                        notesDeleted.video_upload = uploadVideoNotesToDelete.length;\n                        console.log(\"[Stripe Cancel] Deleted video upload notes:\", uploadVideoNotesToDelete.length);\n                        return {\n                            type: \"video_upload\",\n                            count: uploadVideoNotesToDelete.length,\n                            error: null\n                        };\n                    }\n                }));\n            }\n            // Wait for all deletions to complete\n            try {\n                const deletionResults = await Promise.all(deletionPromises);\n                console.log(\"[Stripe Cancel] Deletion results:\", deletionResults);\n                // Update counts based on actual deletion results\n                deletionResults.forEach((result)=>{\n                    if (!result.error) {\n                        if (result.type === \"text\") {\n                            notesDeleted.text = result.count;\n                        } else if (result.type === \"file\") {\n                            notesDeleted.file = result.count;\n                        } else if (result.type === \"video\") {\n                            notesDeleted.video = result.count;\n                        } else if (result.type === \"video_upload\") {\n                            notesDeleted.video_upload = result.count;\n                        }\n                    }\n                });\n                notesDeleted.total = notesDeleted.text + notesDeleted.file + notesDeleted.video + notesDeleted.video_upload;\n                console.log(\"[Stripe Cancel] Final deletion statistics:\", notesDeleted);\n            } catch (deleteError) {\n                console.error(\"[Stripe Cancel] Error during note deletion:\", deleteError);\n            // Continue with cancellation even if note deletion fails\n            }\n        }\n        // Cancel the subscription in Stripe\n        const stripe = (0,_lib_stripe__WEBPACK_IMPORTED_MODULE_1__.getServerStripe)();\n        if (!stripe) {\n            console.error(\"[Stripe Cancel] Failed to initialize Stripe\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Stripe configuration error\"\n            }, {\n                status: 500\n            });\n        }\n        let cancelledSubscription = null;\n        let stripeError = null;\n        // Try to retrieve and cancel the subscription in Stripe\n        try {\n            console.log(\"[Stripe Cancel] Attempting to retrieve subscription from Stripe...\");\n            const subscription = await stripe.subscriptions.retrieve(subscriptionId);\n            console.log(\"[Stripe Cancel] Retrieved subscription:\", subscription.id, \"status:\", subscription.status);\n            // Check if subscription belongs to user (if metadata exists)\n            if (subscription.metadata?.userId && subscription.metadata.userId !== user.id) {\n                console.error(\"[Stripe Cancel] Subscription does not belong to user\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Unauthorized subscription access\"\n                }, {\n                    status: 403\n                });\n            }\n            // Cancel the subscription immediately (not at period end)\n            cancelledSubscription = await stripe.subscriptions.cancel(subscriptionId);\n            console.log(\"[Stripe Cancel] Subscription cancelled in Stripe:\", {\n                id: cancelledSubscription.id,\n                status: cancelledSubscription.status\n            });\n        } catch (error) {\n            stripeError = error;\n            console.warn(\"[Stripe Cancel] Could not cancel subscription in Stripe:\", error.message);\n            // Check if subscription doesn't exist (404) or is already cancelled\n            if (error.code === \"resource_missing\" || error.statusCode === 404) {\n                console.log(\"[Stripe Cancel] Subscription not found in Stripe, proceeding with database cleanup only\");\n            } else if (error.message?.includes(\"already canceled\")) {\n                console.log(\"[Stripe Cancel] Subscription already cancelled in Stripe, proceeding with database cleanup\");\n            } else {\n                // For other Stripe errors, we still try to proceed with database cleanup\n                console.warn(\"[Stripe Cancel] Stripe error occurred, but proceeding with database cleanup:\", error.message);\n            }\n        }\n        // Update user subscription to free plan in the database (always do this)\n        console.log(\"[Stripe Cancel] Updating user subscription to free plan...\");\n        const { error: updateError } = await userSupabase.from(\"user_subscriptions\").update({\n            plan_id: \"free\",\n            status: \"cancelled\",\n            cancel_at_period_end: false,\n            cancelled_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        }).eq(\"user_id\", user.id).eq(\"stripe_subscription_id\", subscriptionId);\n        if (updateError) {\n            console.error(\"[Stripe Cancel] Error updating subscription in database:\", updateError);\n            // If we couldn't update the database and also failed in Stripe, return error\n            if (stripeError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to cancel subscription both in Stripe and database\",\n                    details: `Stripe: ${stripeError.message}, Database: ${updateError.message}`\n                }, {\n                    status: 500\n                });\n            }\n        } else {\n            console.log(\"[Stripe Cancel] Successfully updated subscription to free plan in database\");\n        }\n        // Update the saved notes count in usage table\n        try {\n            const remainingNotesCount = Math.min(totalNotes, 3);\n            const currentMonth = new Date().toISOString().slice(0, 7);\n            const { error: usageError } = await userSupabase.from(\"user_usage\").upsert({\n                user_id: user.id,\n                month_year: currentMonth,\n                total_saved_notes: remainingNotesCount,\n                updated_at: new Date().toISOString()\n            }, {\n                onConflict: \"user_id,month_year\"\n            });\n            if (usageError) {\n                console.error(\"[Stripe Cancel] Error updating usage count:\", usageError);\n            } else {\n                console.log(\"[Stripe Cancel] Updated saved notes count to:\", remainingNotesCount);\n            }\n        } catch (usageUpdateError) {\n            console.error(\"[Stripe Cancel] Error updating usage:\", usageUpdateError);\n        }\n        // Prepare response\n        const responseData = {\n            success: true,\n            message: \"Subscription cancelled and downgraded to free plan successfully\",\n            subscription: {\n                id: cancelledSubscription?.id || subscriptionId,\n                status: cancelledSubscription?.status || \"cancelled\",\n                newPlan: \"free\"\n            },\n            notesDeleted: notesDeleted,\n            remainingNotes: Math.min(totalNotes, 3)\n        };\n        // Add warning if Stripe cancellation failed but database was updated\n        if (stripeError && !updateError) {\n            responseData.warning = \"Subscription cancelled in database, but Stripe operation had issues. Your subscription should still be inactive.\";\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(responseData);\n    } catch (error) {\n        console.error(\"[Stripe Cancel] Unexpected error cancelling subscription:\", error);\n        // Check if it's a Stripe error\n        if (error.type) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Stripe error: \" + error.message,\n                type: error.type\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to cancel subscription\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zdHJpcGUvY2FuY2VsLXN1YnNjcmlwdGlvbi9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVEO0FBQ1Q7QUFDTTtBQUc3QyxlQUFlRyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQztRQUVaLHVDQUF1QztRQUN2QyxNQUFNQyxjQUFjQywwQ0FBb0M7UUFDeEQsTUFBTUcsa0JBQWtCSCxrTkFBeUM7UUFFakUsSUFBSSxDQUFDRCxlQUFlLENBQUNJLGlCQUFpQjtZQUNwQ04sUUFBUVEsS0FBSyxDQUFDLDJEQUEyRDtnQkFDdkVOLGFBQWEsQ0FBQyxDQUFDQTtnQkFDZkksaUJBQWlCLENBQUMsQ0FBQ0E7WUFDckI7WUFDQSxPQUFPWCxxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtnQkFBRUQsT0FBTztZQUE0RCxHQUNyRTtnQkFBRUUsUUFBUTtZQUFJO1FBRWxCO1FBRUEsd0NBQXdDO1FBQ3hDLE1BQU1DLGFBQWFaLFFBQVFhLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBQ3ZDLElBQUksQ0FBQ0YsY0FBYyxDQUFDQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtZQUNwRGQsUUFBUVEsS0FBSyxDQUFDO1lBQ2QsT0FBT2IscURBQVlBLENBQUNjLElBQUksQ0FDdEI7Z0JBQUVELE9BQU87WUFBMEIsR0FDbkM7Z0JBQUVFLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU1LLFFBQVFKLFdBQVdLLFNBQVMsQ0FBQztRQUVuQyw0QkFBNEI7UUFDNUIsTUFBTUMsV0FBV3BCLG1FQUFZQSxDQUFDSyxhQUFhSTtRQUUzQyxNQUFNLEVBQUVZLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQUVYLE9BQU9ZLFNBQVMsRUFBRSxHQUFHLE1BQU1ILFNBQVNJLElBQUksQ0FBQ0MsT0FBTyxDQUFDUDtRQUV6RSxJQUFJSyxhQUFhLENBQUNELE1BQU07WUFDdEJuQixRQUFRUSxLQUFLLENBQUMsdUNBQXVDWTtZQUNyRCxPQUFP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bC1zdWJzY3JpcHRpb24vcm91dGUudHM/ZGQwYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTdHJpcGUgfSBmcm9tICdAL2xpYi9zdHJpcGUnXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5pbXBvcnQgU3RyaXBlIGZyb20gJ3N0cmlwZSdcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFByb2Nlc3Npbmcgc3Vic2NyaXB0aW9uIGNhbmNlbGxhdGlvbi4uLicpXG4gICAgXG4gICAgLy8gVmFsaWRhdGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZpcnN0XG4gICAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkxcbiAgICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWVxuICAgIFxuICAgIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlQW5vbktleSkge1xuICAgICAgY29uc29sZS5lcnJvcignW1N0cmlwZSBDYW5jZWxdIE1pc3NpbmcgU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzOicsIHtcbiAgICAgICAgc3VwYWJhc2VVcmw6ICEhc3VwYWJhc2VVcmwsXG4gICAgICAgIHN1cGFiYXNlQW5vbktleTogISFzdXBhYmFzZUFub25LZXlcbiAgICAgIH0pXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTZXJ2ZXIgY29uZmlndXJhdGlvbiBlcnJvciAtIG1pc3NpbmcgU3VwYWJhc2UgY3JlZGVudGlhbHMnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBhdXRoZW50aWNhdGlvbiB2aWEgQmVhcmVyIHRva2VuXG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKVxuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBBdXRoZW50aWNhdGlvbiBtaXNzaW5nJylcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpXG4gICAgXG4gICAgLy8gVmVyaWZ5IHVzZXIgd2l0aCBTdXBhYmFzZVxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpXG4gICAgXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKHRva2VuKVxuICAgIFxuICAgIGlmICh1c2VyRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBJbnZhbGlkIHVzZXIgdG9rZW46JywgdXNlckVycm9yKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBhdXRoZW50aWNhdGlvbicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgeyBzdWJzY3JpcHRpb25JZCB9ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcblxuICAgIGlmICghc3Vic2NyaXB0aW9uSWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1N1YnNjcmlwdGlvbiBJRCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTdHJpcGUgQ2FuY2VsXSBDYW5jZWxsaW5nIHN1YnNjcmlwdGlvbiBmb3IgdXNlcjonLCB1c2VyLmlkLCAnc3Vic2NyaXB0aW9uOicsIHN1YnNjcmlwdGlvbklkKVxuXG4gICAgLy8gQ3JlYXRlIHVzZXItYXV0aGVudGljYXRlZCBTdXBhYmFzZSBjbGllbnRcbiAgICBjb25zdCB1c2VyU3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gICAgICBzdXBhYmFzZVVybCxcbiAgICAgIHN1cGFiYXNlQW5vbktleSxcbiAgICAgIHtcbiAgICAgICAgZ2xvYmFsOiB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApXG5cbiAgICAvLyBDb3VudCB0b3RhbCBub3RlcyBhY3Jvc3MgQUxMIHRhYmxlcyAoaW5jbHVkaW5nIHZpZGVvX3VwbG9hZF9ub3RlcylcbiAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIENvdW50aW5nIHVzZXIgbm90ZXMgZnJvbSBhbGwgdGFibGVzLi4uJylcbiAgICBjb25zdCBbdGV4dE5vdGVzUmVzdWx0LCBmaWxlTm90ZXNSZXN1bHQsIHZpZGVvTm90ZXNSZXN1bHQsIHVwbG9hZFZpZGVvTm90ZXNSZXN1bHRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgdXNlclN1cGFiYXNlLmZyb20oJ3RleHRfbm90ZXMnKS5zZWxlY3QoJ2lkLCBjcmVhdGVkX2F0JywgeyBjb3VudDogJ2V4YWN0JyB9KS5lcSgndXNlcl9pZCcsIHVzZXIuaWQpLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IHRydWUgfSksXG4gICAgICB1c2VyU3VwYWJhc2UuZnJvbSgnZmlsZV9ub3RlcycpLnNlbGVjdCgnaWQsIGNyZWF0ZWRfYXQnLCB7IGNvdW50OiAnZXhhY3QnIH0pLmVxKCd1c2VyX2lkJywgdXNlci5pZCkub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KSxcbiAgICAgIHVzZXJTdXBhYmFzZS5mcm9tKCd2aWRlb19ub3RlcycpLnNlbGVjdCgnaWQsIGNyZWF0ZWRfYXQnLCB7IGNvdW50OiAnZXhhY3QnIH0pLmVxKCd1c2VyX2lkJywgdXNlci5pZCkub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KSxcbiAgICAgIC8vIEFkZCB2aWRlbyB1cGxvYWQgbm90ZXMgc3VwcG9ydFxuICAgICAgdXNlclN1cGFiYXNlLmZyb20oJ3ZpZGVvX3VwbG9hZF9ub3RlcycpLnNlbGVjdCgnaWQsIGNyZWF0ZWRfYXQnLCB7IGNvdW50OiAnZXhhY3QnIH0pLmVxKCd1c2VyX2lkJywgdXNlci5pZCkub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KS50aGVuKFxuICAgICAgICByZXN1bHQgPT4gcmVzdWx0LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdbU3RyaXBlIENhbmNlbF0gdmlkZW9fdXBsb2FkX25vdGVzIHRhYmxlIG1pZ2h0IG5vdCBleGlzdCwgc2tpcHBpbmc6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgICByZXR1cm4geyBkYXRhOiBbXSwgY291bnQ6IDAgfVxuICAgICAgICB9XG4gICAgICApXG4gICAgXSlcblxuICAgIGNvbnN0IHRleHROb3RlcyA9IHRleHROb3Rlc1Jlc3VsdC5kYXRhIHx8IFtdXG4gICAgY29uc3QgZmlsZU5vdGVzID0gZmlsZU5vdGVzUmVzdWx0LmRhdGEgfHwgW11cbiAgICBjb25zdCB2aWRlb05vdGVzID0gdmlkZW9Ob3Rlc1Jlc3VsdC5kYXRhIHx8IFtdXG4gICAgY29uc3QgdXBsb2FkVmlkZW9Ob3RlcyA9IHVwbG9hZFZpZGVvTm90ZXNSZXN1bHQuZGF0YSB8fCBbXVxuICAgIFxuICAgIGNvbnN0IGFsbE5vdGVzID0gW1xuICAgICAgLi4udGV4dE5vdGVzLm1hcChub3RlID0+ICh7IC4uLm5vdGUsIHR5cGU6ICd0ZXh0JyB9KSksXG4gICAgICAuLi5maWxlTm90ZXMubWFwKG5vdGUgPT4gKHsgLi4ubm90ZSwgdHlwZTogJ2ZpbGUnIH0pKSxcbiAgICAgIC4uLnZpZGVvTm90ZXMubWFwKG5vdGUgPT4gKHsgLi4ubm90ZSwgdHlwZTogJ3ZpZGVvJyB9KSksXG4gICAgICAuLi51cGxvYWRWaWRlb05vdGVzLm1hcChub3RlID0+ICh7IC4uLm5vdGUsIHR5cGU6ICd2aWRlb191cGxvYWQnIH0pKVxuICAgIF0uc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5jcmVhdGVkX2F0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSlcblxuICAgIGNvbnN0IHRvdGFsTm90ZXMgPSBhbGxOb3Rlcy5sZW5ndGhcbiAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFRvdGFsIG5vdGVzIGZvdW5kOicsIHtcbiAgICAgIHRleHQ6IHRleHROb3Rlcy5sZW5ndGgsXG4gICAgICBmaWxlOiBmaWxlTm90ZXMubGVuZ3RoLFxuICAgICAgdmlkZW86IHZpZGVvTm90ZXMubGVuZ3RoLFxuICAgICAgdmlkZW9fdXBsb2FkOiB1cGxvYWRWaWRlb05vdGVzLmxlbmd0aCxcbiAgICAgIHRvdGFsOiB0b3RhbE5vdGVzXG4gICAgfSlcblxuICAgIC8vIFByZXBhcmUgbm90ZSBkZWxldGlvbiBzdGF0aXN0aWNzXG4gICAgbGV0IG5vdGVzRGVsZXRlZCA9IHtcbiAgICAgIHRleHQ6IDAsXG4gICAgICBmaWxlOiAwLFxuICAgICAgdmlkZW86IDAsXG4gICAgICB2aWRlb191cGxvYWQ6IDAsXG4gICAgICB0b3RhbDogMFxuICAgIH1cblxuICAgIC8vIElmIHVzZXIgaGFzIG1vcmUgdGhhbiAzIG5vdGVzLCBkZWxldGUgdGhlIGV4Y2VzcyAoa2VlcCB0aGUgMyBvbGRlc3QpXG4gICAgaWYgKHRvdGFsTm90ZXMgPiAzKSB7XG4gICAgICBjb25zdCBub3Rlc1RvRGVsZXRlID0gYWxsTm90ZXMuc2xpY2UoMykgLy8gUmVtb3ZlIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0IDMgKG9sZGVzdClcbiAgICAgIGNvbnNvbGUubG9nKCdbU3RyaXBlIENhbmNlbF0gTm90ZXMgdG8gZGVsZXRlOicsIG5vdGVzVG9EZWxldGUubGVuZ3RoKVxuXG4gICAgICAvLyBHcm91cCBub3RlcyB0byBkZWxldGUgYnkgdHlwZSBmb3IgYmF0Y2ggZGVsZXRpb25cbiAgICAgIGNvbnN0IHRleHROb3Rlc1RvRGVsZXRlID0gbm90ZXNUb0RlbGV0ZS5maWx0ZXIobm90ZSA9PiBub3RlLnR5cGUgPT09ICd0ZXh0JykubWFwKG5vdGUgPT4gbm90ZS5pZClcbiAgICAgIGNvbnN0IGZpbGVOb3Rlc1RvRGVsZXRlID0gbm90ZXNUb0RlbGV0ZS5maWx0ZXIobm90ZSA9PiBub3RlLnR5cGUgPT09ICdmaWxlJykubWFwKG5vdGUgPT4gbm90ZS5pZClcbiAgICAgIGNvbnN0IHZpZGVvTm90ZXNUb0RlbGV0ZSA9IG5vdGVzVG9EZWxldGUuZmlsdGVyKG5vdGUgPT4gbm90ZS50eXBlID09PSAndmlkZW8nKS5tYXAobm90ZSA9PiBub3RlLmlkKVxuICAgICAgY29uc3QgdXBsb2FkVmlkZW9Ob3Rlc1RvRGVsZXRlID0gbm90ZXNUb0RlbGV0ZS5maWx0ZXIobm90ZSA9PiBub3RlLnR5cGUgPT09ICd2aWRlb191cGxvYWQnKS5tYXAobm90ZSA9PiBub3RlLmlkKVxuXG4gICAgICAvLyBEZWxldGUgbm90ZXMgaW4gYmF0Y2hlcyBieSB0eXBlXG4gICAgICBjb25zdCBkZWxldGlvblByb21pc2VzID0gW11cblxuICAgICAgaWYgKHRleHROb3Rlc1RvRGVsZXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZGVsZXRpb25Qcm9taXNlcy5wdXNoKFxuICAgICAgICAgIHVzZXJTdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3RleHRfbm90ZXMnKVxuICAgICAgICAgICAgLmRlbGV0ZSgpXG4gICAgICAgICAgICAuaW4oJ2lkJywgdGV4dE5vdGVzVG9EZWxldGUpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1N0cmlwZSBDYW5jZWxdIEVycm9yIGRlbGV0aW5nIHRleHQgbm90ZXM6JywgcmVzdWx0LmVycm9yKVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICd0ZXh0JywgY291bnQ6IDAsIGVycm9yOiByZXN1bHQuZXJyb3IgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vdGVzRGVsZXRlZC50ZXh0ID0gdGV4dE5vdGVzVG9EZWxldGUubGVuZ3RoXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tTdHJpcGUgQ2FuY2VsXSBEZWxldGVkIHRleHQgbm90ZXM6JywgdGV4dE5vdGVzVG9EZWxldGUubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICd0ZXh0JywgY291bnQ6IHRleHROb3Rlc1RvRGVsZXRlLmxlbmd0aCwgZXJyb3I6IG51bGwgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICB9XG5cbiAgICAgIGlmIChmaWxlTm90ZXNUb0RlbGV0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRlbGV0aW9uUHJvbWlzZXMucHVzaChcbiAgICAgICAgICB1c2VyU3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCdmaWxlX25vdGVzJylcbiAgICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgICAgLmluKCdpZCcsIGZpbGVOb3Rlc1RvRGVsZXRlKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBFcnJvciBkZWxldGluZyBmaWxlIG5vdGVzOicsIHJlc3VsdC5lcnJvcilcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0eXBlOiAnZmlsZScsIGNvdW50OiAwLCBlcnJvcjogcmVzdWx0LmVycm9yIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3Rlc0RlbGV0ZWQuZmlsZSA9IGZpbGVOb3Rlc1RvRGVsZXRlLmxlbmd0aFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU3RyaXBlIENhbmNlbF0gRGVsZXRlZCBmaWxlIG5vdGVzOicsIGZpbGVOb3Rlc1RvRGVsZXRlLmxlbmd0aClcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0eXBlOiAnZmlsZScsIGNvdW50OiBmaWxlTm90ZXNUb0RlbGV0ZS5sZW5ndGgsIGVycm9yOiBudWxsIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAodmlkZW9Ob3Rlc1RvRGVsZXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZGVsZXRpb25Qcm9taXNlcy5wdXNoKFxuICAgICAgICAgIHVzZXJTdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3ZpZGVvX25vdGVzJylcbiAgICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgICAgLmluKCdpZCcsIHZpZGVvTm90ZXNUb0RlbGV0ZSlcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbU3RyaXBlIENhbmNlbF0gRXJyb3IgZGVsZXRpbmcgdmlkZW8gbm90ZXM6JywgcmVzdWx0LmVycm9yKVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICd2aWRlbycsIGNvdW50OiAwLCBlcnJvcjogcmVzdWx0LmVycm9yIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3Rlc0RlbGV0ZWQudmlkZW8gPSB2aWRlb05vdGVzVG9EZWxldGUubGVuZ3RoXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tTdHJpcGUgQ2FuY2VsXSBEZWxldGVkIHZpZGVvIG5vdGVzOicsIHZpZGVvTm90ZXNUb0RlbGV0ZS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ3ZpZGVvJywgY291bnQ6IHZpZGVvTm90ZXNUb0RlbGV0ZS5sZW5ndGgsIGVycm9yOiBudWxsIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAodXBsb2FkVmlkZW9Ob3Rlc1RvRGVsZXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZGVsZXRpb25Qcm9taXNlcy5wdXNoKFxuICAgICAgICAgIHVzZXJTdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3ZpZGVvX3VwbG9hZF9ub3RlcycpXG4gICAgICAgICAgICAuZGVsZXRlKClcbiAgICAgICAgICAgIC5pbignaWQnLCB1cGxvYWRWaWRlb05vdGVzVG9EZWxldGUpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1N0cmlwZSBDYW5jZWxdIEVycm9yIGRlbGV0aW5nIHZpZGVvIHVwbG9hZCBub3RlczonLCByZXN1bHQuZXJyb3IpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ3ZpZGVvX3VwbG9hZCcsIGNvdW50OiAwLCBlcnJvcjogcmVzdWx0LmVycm9yIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3Rlc0RlbGV0ZWQudmlkZW9fdXBsb2FkID0gdXBsb2FkVmlkZW9Ob3Rlc1RvRGVsZXRlLmxlbmd0aFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU3RyaXBlIENhbmNlbF0gRGVsZXRlZCB2aWRlbyB1cGxvYWQgbm90ZXM6JywgdXBsb2FkVmlkZW9Ob3Rlc1RvRGVsZXRlLmxlbmd0aClcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0eXBlOiAndmlkZW9fdXBsb2FkJywgY291bnQ6IHVwbG9hZFZpZGVvTm90ZXNUb0RlbGV0ZS5sZW5ndGgsIGVycm9yOiBudWxsIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICAvLyBXYWl0IGZvciBhbGwgZGVsZXRpb25zIHRvIGNvbXBsZXRlXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkZWxldGlvblJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChkZWxldGlvblByb21pc2VzKVxuICAgICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIERlbGV0aW9uIHJlc3VsdHM6JywgZGVsZXRpb25SZXN1bHRzKVxuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIGNvdW50cyBiYXNlZCBvbiBhY3R1YWwgZGVsZXRpb24gcmVzdWx0c1xuICAgICAgICBkZWxldGlvblJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgICAgICAgICBub3Rlc0RlbGV0ZWQudGV4dCA9IHJlc3VsdC5jb3VudFxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQudHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgICAgICAgICAgIG5vdGVzRGVsZXRlZC5maWxlID0gcmVzdWx0LmNvdW50XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC50eXBlID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICAgIG5vdGVzRGVsZXRlZC52aWRlbyA9IHJlc3VsdC5jb3VudFxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQudHlwZSA9PT0gJ3ZpZGVvX3VwbG9hZCcpIHtcbiAgICAgICAgICAgICAgbm90ZXNEZWxldGVkLnZpZGVvX3VwbG9hZCA9IHJlc3VsdC5jb3VudFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBub3Rlc0RlbGV0ZWQudG90YWwgPSBub3Rlc0RlbGV0ZWQudGV4dCArIG5vdGVzRGVsZXRlZC5maWxlICsgbm90ZXNEZWxldGVkLnZpZGVvICsgbm90ZXNEZWxldGVkLnZpZGVvX3VwbG9hZFxuICAgICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIEZpbmFsIGRlbGV0aW9uIHN0YXRpc3RpY3M6Jywgbm90ZXNEZWxldGVkKVxuXG4gICAgICB9IGNhdGNoIChkZWxldGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3RyaXBlIENhbmNlbF0gRXJyb3IgZHVyaW5nIG5vdGUgZGVsZXRpb246JywgZGVsZXRlRXJyb3IpXG4gICAgICAgIC8vIENvbnRpbnVlIHdpdGggY2FuY2VsbGF0aW9uIGV2ZW4gaWYgbm90ZSBkZWxldGlvbiBmYWlsc1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbmNlbCB0aGUgc3Vic2NyaXB0aW9uIGluIFN0cmlwZVxuICAgIGNvbnN0IHN0cmlwZSA9IGdldFNlcnZlclN0cmlwZSgpXG4gICAgXG4gICAgaWYgKCFzdHJpcGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBTdHJpcGUnKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU3RyaXBlIGNvbmZpZ3VyYXRpb24gZXJyb3InIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICBsZXQgY2FuY2VsbGVkU3Vic2NyaXB0aW9uID0gbnVsbFxuICAgIGxldCBzdHJpcGVFcnJvciA9IG51bGxcbiAgICBcbiAgICAvLyBUcnkgdG8gcmV0cmlldmUgYW5kIGNhbmNlbCB0aGUgc3Vic2NyaXB0aW9uIGluIFN0cmlwZVxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIEF0dGVtcHRpbmcgdG8gcmV0cmlldmUgc3Vic2NyaXB0aW9uIGZyb20gU3RyaXBlLi4uJylcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHN0cmlwZS5zdWJzY3JpcHRpb25zLnJldHJpZXZlKHN1YnNjcmlwdGlvbklkKVxuICAgICAgY29uc29sZS5sb2coJ1tTdHJpcGUgQ2FuY2VsXSBSZXRyaWV2ZWQgc3Vic2NyaXB0aW9uOicsIHN1YnNjcmlwdGlvbi5pZCwgJ3N0YXR1czonLCBzdWJzY3JpcHRpb24uc3RhdHVzKVxuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiBzdWJzY3JpcHRpb24gYmVsb25ncyB0byB1c2VyIChpZiBtZXRhZGF0YSBleGlzdHMpXG4gICAgICBpZiAoc3Vic2NyaXB0aW9uLm1ldGFkYXRhPy51c2VySWQgJiYgc3Vic2NyaXB0aW9uLm1ldGFkYXRhLnVzZXJJZCAhPT0gdXNlci5pZCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3RyaXBlIENhbmNlbF0gU3Vic2NyaXB0aW9uIGRvZXMgbm90IGJlbG9uZyB0byB1c2VyJylcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQgc3Vic2NyaXB0aW9uIGFjY2VzcycgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICAvLyBDYW5jZWwgdGhlIHN1YnNjcmlwdGlvbiBpbW1lZGlhdGVseSAobm90IGF0IHBlcmlvZCBlbmQpXG4gICAgICBjYW5jZWxsZWRTdWJzY3JpcHRpb24gPSBhd2FpdCBzdHJpcGUuc3Vic2NyaXB0aW9ucy5jYW5jZWwoc3Vic2NyaXB0aW9uSWQpXG4gICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFN1YnNjcmlwdGlvbiBjYW5jZWxsZWQgaW4gU3RyaXBlOicsIHtcbiAgICAgICAgaWQ6IGNhbmNlbGxlZFN1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgc3RhdHVzOiBjYW5jZWxsZWRTdWJzY3JpcHRpb24uc3RhdHVzXG4gICAgICB9KVxuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgc3RyaXBlRXJyb3IgPSBlcnJvclxuICAgICAgY29uc29sZS53YXJuKCdbU3RyaXBlIENhbmNlbF0gQ291bGQgbm90IGNhbmNlbCBzdWJzY3JpcHRpb24gaW4gU3RyaXBlOicsIGVycm9yLm1lc3NhZ2UpXG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHN1YnNjcmlwdGlvbiBkb2Vzbid0IGV4aXN0ICg0MDQpIG9yIGlzIGFscmVhZHkgY2FuY2VsbGVkXG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ3Jlc291cmNlX21pc3NpbmcnIHx8IGVycm9yLnN0YXR1c0NvZGUgPT09IDQwNCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFN1YnNjcmlwdGlvbiBub3QgZm91bmQgaW4gU3RyaXBlLCBwcm9jZWVkaW5nIHdpdGggZGF0YWJhc2UgY2xlYW51cCBvbmx5JylcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2FscmVhZHkgY2FuY2VsZWQnKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFN1YnNjcmlwdGlvbiBhbHJlYWR5IGNhbmNlbGxlZCBpbiBTdHJpcGUsIHByb2NlZWRpbmcgd2l0aCBkYXRhYmFzZSBjbGVhbnVwJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciBvdGhlciBTdHJpcGUgZXJyb3JzLCB3ZSBzdGlsbCB0cnkgdG8gcHJvY2VlZCB3aXRoIGRhdGFiYXNlIGNsZWFudXBcbiAgICAgICAgY29uc29sZS53YXJuKCdbU3RyaXBlIENhbmNlbF0gU3RyaXBlIGVycm9yIG9jY3VycmVkLCBidXQgcHJvY2VlZGluZyB3aXRoIGRhdGFiYXNlIGNsZWFudXA6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdXNlciBzdWJzY3JpcHRpb24gdG8gZnJlZSBwbGFuIGluIHRoZSBkYXRhYmFzZSAoYWx3YXlzIGRvIHRoaXMpXG4gICAgY29uc29sZS5sb2coJ1tTdHJpcGUgQ2FuY2VsXSBVcGRhdGluZyB1c2VyIHN1YnNjcmlwdGlvbiB0byBmcmVlIHBsYW4uLi4nKVxuICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCB1c2VyU3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3N1YnNjcmlwdGlvbnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHBsYW5faWQ6ICdmcmVlJyxcbiAgICAgICAgc3RhdHVzOiAnY2FuY2VsbGVkJyxcbiAgICAgICAgY2FuY2VsX2F0X3BlcmlvZF9lbmQ6IGZhbHNlLFxuICAgICAgICBjYW5jZWxsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZClcbiAgICAgIC5lcSgnc3RyaXBlX3N1YnNjcmlwdGlvbl9pZCcsIHN1YnNjcmlwdGlvbklkKVxuXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3RyaXBlIENhbmNlbF0gRXJyb3IgdXBkYXRpbmcgc3Vic2NyaXB0aW9uIGluIGRhdGFiYXNlOicsIHVwZGF0ZUVycm9yKVxuICAgICAgXG4gICAgICAvLyBJZiB3ZSBjb3VsZG4ndCB1cGRhdGUgdGhlIGRhdGFiYXNlIGFuZCBhbHNvIGZhaWxlZCBpbiBTdHJpcGUsIHJldHVybiBlcnJvclxuICAgICAgaWYgKHN0cmlwZUVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IFxuICAgICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY2FuY2VsIHN1YnNjcmlwdGlvbiBib3RoIGluIFN0cmlwZSBhbmQgZGF0YWJhc2UnLFxuICAgICAgICAgICAgZGV0YWlsczogYFN0cmlwZTogJHtzdHJpcGVFcnJvci5tZXNzYWdlfSwgRGF0YWJhc2U6ICR7dXBkYXRlRXJyb3IubWVzc2FnZX1gXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnW1N0cmlwZSBDYW5jZWxdIFN1Y2Nlc3NmdWxseSB1cGRhdGVkIHN1YnNjcmlwdGlvbiB0byBmcmVlIHBsYW4gaW4gZGF0YWJhc2UnKVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgc2F2ZWQgbm90ZXMgY291bnQgaW4gdXNhZ2UgdGFibGVcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVtYWluaW5nTm90ZXNDb3VudCA9IE1hdGgubWluKHRvdGFsTm90ZXMsIDMpXG4gICAgICBjb25zdCBjdXJyZW50TW9udGggPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgNylcbiAgICAgIFxuICAgICAgY29uc3QgeyBlcnJvcjogdXNhZ2VFcnJvciB9ID0gYXdhaXQgdXNlclN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgICAgLnVwc2VydCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGgsXG4gICAgICAgICAgdG90YWxfc2F2ZWRfbm90ZXM6IHJlbWFpbmluZ05vdGVzQ291bnQsXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBvbkNvbmZsaWN0OiAndXNlcl9pZCxtb250aF95ZWFyJ1xuICAgICAgICB9KVxuXG4gICAgICBpZiAodXNhZ2VFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3RyaXBlIENhbmNlbF0gRXJyb3IgdXBkYXRpbmcgdXNhZ2UgY291bnQ6JywgdXNhZ2VFcnJvcilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbU3RyaXBlIENhbmNlbF0gVXBkYXRlZCBzYXZlZCBub3RlcyBjb3VudCB0bzonLCByZW1haW5pbmdOb3Rlc0NvdW50KVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKHVzYWdlVXBkYXRlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBFcnJvciB1cGRhdGluZyB1c2FnZTonLCB1c2FnZVVwZGF0ZUVycm9yKVxuICAgIH1cblxuICAgIC8vIFByZXBhcmUgcmVzcG9uc2VcbiAgICBjb25zdCByZXNwb25zZURhdGE6IGFueSA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnU3Vic2NyaXB0aW9uIGNhbmNlbGxlZCBhbmQgZG93bmdyYWRlZCB0byBmcmVlIHBsYW4gc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICBpZDogY2FuY2VsbGVkU3Vic2NyaXB0aW9uPy5pZCB8fCBzdWJzY3JpcHRpb25JZCxcbiAgICAgICAgc3RhdHVzOiBjYW5jZWxsZWRTdWJzY3JpcHRpb24/LnN0YXR1cyB8fCAnY2FuY2VsbGVkJyxcbiAgICAgICAgbmV3UGxhbjogJ2ZyZWUnXG4gICAgICB9LFxuICAgICAgbm90ZXNEZWxldGVkOiBub3Rlc0RlbGV0ZWQsXG4gICAgICByZW1haW5pbmdOb3RlczogTWF0aC5taW4odG90YWxOb3RlcywgMylcbiAgICB9XG5cbiAgICAvLyBBZGQgd2FybmluZyBpZiBTdHJpcGUgY2FuY2VsbGF0aW9uIGZhaWxlZCBidXQgZGF0YWJhc2Ugd2FzIHVwZGF0ZWRcbiAgICBpZiAoc3RyaXBlRXJyb3IgJiYgIXVwZGF0ZUVycm9yKSB7XG4gICAgICByZXNwb25zZURhdGEud2FybmluZyA9ICdTdWJzY3JpcHRpb24gY2FuY2VsbGVkIGluIGRhdGFiYXNlLCBidXQgU3RyaXBlIG9wZXJhdGlvbiBoYWQgaXNzdWVzLiBZb3VyIHN1YnNjcmlwdGlvbiBzaG91bGQgc3RpbGwgYmUgaW5hY3RpdmUuJ1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZURhdGEpXG5cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdHJpcGUgQ2FuY2VsXSBVbmV4cGVjdGVkIGVycm9yIGNhbmNlbGxpbmcgc3Vic2NyaXB0aW9uOicsIGVycm9yKVxuICAgIFxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSBTdHJpcGUgZXJyb3JcbiAgICBpZiAoZXJyb3IudHlwZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnU3RyaXBlIGVycm9yOiAnICsgZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICB0eXBlOiBlcnJvci50eXBlXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjYW5jZWwgc3Vic2NyaXB0aW9uJyxcbiAgICAgICAgZGV0YWlsczogZXJyb3IubWVzc2FnZVxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U2VydmVyU3RyaXBlIiwiY3JlYXRlQ2xpZW50IiwiUE9TVCIsInJlcXVlc3QiLCJjb25zb2xlIiwibG9nIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJlcnJvciIsImpzb24iLCJzdGF0dXMiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJ0b2tlbiIsInN1YnN0cmluZyIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJ1c2VyRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsInN1YnNjcmlwdGlvbklkIiwiaWQiLCJ1c2VyU3VwYWJhc2UiLCJnbG9iYWwiLCJBdXRob3JpemF0aW9uIiwidGV4dE5vdGVzUmVzdWx0IiwiZmlsZU5vdGVzUmVzdWx0IiwidmlkZW9Ob3Rlc1Jlc3VsdCIsInVwbG9hZFZpZGVvTm90ZXNSZXN1bHQiLCJQcm9taXNlIiwiYWxsIiwiZnJvbSIsInNlbGVjdCIsImNvdW50IiwiZXEiLCJvcmRlciIsImFzY2VuZGluZyIsInRoZW4iLCJyZXN1bHQiLCJ3YXJuIiwibWVzc2FnZSIsInRleHROb3RlcyIsImZpbGVOb3RlcyIsInZpZGVvTm90ZXMiLCJ1cGxvYWRWaWRlb05vdGVzIiwiYWxsTm90ZXMiLCJtYXAiLCJub3RlIiwidHlwZSIsInNvcnQiLCJhIiwiYiIsIkRhdGUiLCJjcmVhdGVkX2F0IiwiZ2V0VGltZSIsInRvdGFsTm90ZXMiLCJsZW5ndGgiLCJ0ZXh0IiwiZmlsZSIsInZpZGVvIiwidmlkZW9fdXBsb2FkIiwidG90YWwiLCJub3Rlc0RlbGV0ZWQiLCJub3Rlc1RvRGVsZXRlIiwic2xpY2UiLCJ0ZXh0Tm90ZXNUb0RlbGV0ZSIsImZpbHRlciIsImZpbGVOb3Rlc1RvRGVsZXRlIiwidmlkZW9Ob3Rlc1RvRGVsZXRlIiwidXBsb2FkVmlkZW9Ob3Rlc1RvRGVsZXRlIiwiZGVsZXRpb25Qcm9taXNlcyIsInB1c2giLCJkZWxldGUiLCJpbiIsImRlbGV0aW9uUmVzdWx0cyIsImZvckVhY2giLCJkZWxldGVFcnJvciIsInN0cmlwZSIsImNhbmNlbGxlZFN1YnNjcmlwdGlvbiIsInN0cmlwZUVycm9yIiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaXB0aW9ucyIsInJldHJpZXZlIiwibWV0YWRhdGEiLCJ1c2VySWQiLCJjYW5jZWwiLCJjb2RlIiwic3RhdHVzQ29kZSIsImluY2x1ZGVzIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJwbGFuX2lkIiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJjYW5jZWxsZWRfYXQiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRfYXQiLCJkZXRhaWxzIiwicmVtYWluaW5nTm90ZXNDb3VudCIsIk1hdGgiLCJtaW4iLCJjdXJyZW50TW9udGgiLCJ1c2FnZUVycm9yIiwidXBzZXJ0IiwidXNlcl9pZCIsIm1vbnRoX3llYXIiLCJ0b3RhbF9zYXZlZF9ub3RlcyIsIm9uQ29uZmxpY3QiLCJ1c2FnZVVwZGF0ZUVycm9yIiwicmVzcG9uc2VEYXRhIiwic3VjY2VzcyIsIm5ld1BsYW4iLCJyZW1haW5pbmdOb3RlcyIsIndhcm5pbmciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/stripe/cancel-subscription/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/stripe.ts":
/*!***************************!*\
  !*** ./src/lib/stripe.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PLAN_PRICING: () => (/* binding */ PLAN_PRICING),\n/* harmony export */   STRIPE_PRICE_IDS: () => (/* binding */ STRIPE_PRICE_IDS),\n/* harmony export */   getServerStripe: () => (/* binding */ getServerStripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n\nlet stripe;\n// Initialize Stripe with proper configuration\nconst getServerStripe = ()=>{\n    if (!stripe) {\n        const stripeSecretKey = process.env.STRIPE_SECRET_KEY;\n        if (!stripeSecretKey) {\n            throw new Error(\"STRIPE_SECRET_KEY is not defined in environment variables\");\n        }\n        stripe = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](stripeSecretKey, {\n            apiVersion: \"2025-05-28.basil\",\n            appInfo: {\n                name: \"EduScribe\",\n                version: \"1.0.0\"\n            }\n        });\n    }\n    return stripe;\n};\n// Plan pricing (for display purposes) - safe for client-side\nconst PLAN_PRICING = {\n    free: {\n        monthly: 0,\n        yearly: 0\n    },\n    student: {\n        monthly: 24.99,\n        yearly: 224.99\n    },\n    pro: {\n        monthly: 49.99,\n        yearly: 449.99\n    }\n};\n// Stripe Price IDs - these should match your Stripe dashboard\nconst STRIPE_PRICE_IDS = {\n    student: {\n        monthly: process.env.STRIPE_STUDENT_MONTHLY_PRICE_ID || \"price_student_monthly\",\n        yearly: process.env.STRIPE_STUDENT_YEARLY_PRICE_ID || \"price_student_yearly\"\n    },\n    pro: {\n        monthly: process.env.STRIPE_PRO_MONTHLY_PRICE_ID || \"price_pro_monthly\",\n        yearly: process.env.STRIPE_PRO_YEARLY_PRICE_ID || \"price_pro_yearly\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N0cmlwZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTJCO0FBRTNCLElBQUlDO0FBRUosOENBQThDO0FBQ3ZDLE1BQU1DLGtCQUFrQjtJQUM3QixJQUFJLENBQUNELFFBQVE7UUFDWCxNQUFNRSxrQkFBa0JDLFFBQVFDLEdBQUcsQ0FBQ0MsaUJBQWlCO1FBQ3JELElBQUksQ0FBQ0gsaUJBQWlCO1lBQ3BCLE1BQU0sSUFBSUksTUFBTTtRQUNsQjtRQUNBTixTQUFTLElBQUlELDhDQUFNQSxDQUFDRyxpQkFBaUI7WUFDbkNLLFlBQVk7WUFDWkMsU0FBUztnQkFDUEMsTUFBTTtnQkFDTkMsU0FBUztZQUNYO1FBQ0Y7SUFDRjtJQUNBLE9BQU9WO0FBQ1QsRUFBQztBQUVELDZEQUE2RDtBQUN0RCxNQUFNVyxlQUFlO0lBQzFCQyxNQUFNO1FBQ0pDLFNBQVM7UUFDVEMsUUFBUTtJQUNWO0lBQ0FDLFNBQVM7UUFDUEYsU0FBUztRQUNUQyxRQUFRO0lBQ1Y7SUFDQUUsS0FBSztRQUNISCxTQUFTO1FBQ1RDLFFBQVE7SUFDVjtBQUNGLEVBQVU7QUFFViw4REFBOEQ7QUFDdkQsTUFBTUcsbUJBQW1CO0lBQzlCRixTQUFTO1FBQ1BGLFNBQVNWLFFBQVFDLEdBQUcsQ0FBQ2MsK0JBQStCLElBQUk7UUFDeERKLFFBQVFYLFFBQVFDLEdBQUcsQ0FBQ2UsOEJBQThCLElBQUk7SUFDeEQ7SUFDQUgsS0FBSztRQUNISCxTQUFTVixRQUFRQyxHQUFHLENBQUNnQiwyQkFBMkIsSUFBSTtRQUNwRE4sUUFBUVgsUUFBUUMsR0FBRyxDQUFDaUIsMEJBQTBCLElBQUk7SUFDcEQ7QUFDRixFQUFVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1c2NyaWJlLy4vc3JjL2xpYi9zdHJpcGUudHM/Nzk4YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyaXBlIGZyb20gJ3N0cmlwZSdcblxubGV0IHN0cmlwZTogU3RyaXBlXG5cbi8vIEluaXRpYWxpemUgU3RyaXBlIHdpdGggcHJvcGVyIGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBjb25zdCBnZXRTZXJ2ZXJTdHJpcGUgPSAoKSA9PiB7XG4gIGlmICghc3RyaXBlKSB7XG4gICAgY29uc3Qgc3RyaXBlU2VjcmV0S2V5ID0gcHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVlcbiAgICBpZiAoIXN0cmlwZVNlY3JldEtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTVFJJUEVfU0VDUkVUX0tFWSBpcyBub3QgZGVmaW5lZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKVxuICAgIH1cbiAgICBzdHJpcGUgPSBuZXcgU3RyaXBlKHN0cmlwZVNlY3JldEtleSwge1xuICAgICAgYXBpVmVyc2lvbjogJzIwMjUtMDUtMjguYmFzaWwnLFxuICAgICAgYXBwSW5mbzoge1xuICAgICAgICBuYW1lOiAnRWR1U2NyaWJlJyxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgIH0sXG4gICAgfSlcbiAgfVxuICByZXR1cm4gc3RyaXBlXG59XG5cbi8vIFBsYW4gcHJpY2luZyAoZm9yIGRpc3BsYXkgcHVycG9zZXMpIC0gc2FmZSBmb3IgY2xpZW50LXNpZGVcbmV4cG9ydCBjb25zdCBQTEFOX1BSSUNJTkcgPSB7XG4gIGZyZWU6IHtcbiAgICBtb250aGx5OiAwLFxuICAgIHllYXJseTogMCxcbiAgfSxcbiAgc3R1ZGVudDoge1xuICAgIG1vbnRobHk6IDI0Ljk5LFxuICAgIHllYXJseTogMjI0Ljk5LFxuICB9LFxuICBwcm86IHtcbiAgICBtb250aGx5OiA0OS45OSxcbiAgICB5ZWFybHk6IDQ0OS45OSxcbiAgfSxcbn0gYXMgY29uc3RcblxuLy8gU3RyaXBlIFByaWNlIElEcyAtIHRoZXNlIHNob3VsZCBtYXRjaCB5b3VyIFN0cmlwZSBkYXNoYm9hcmRcbmV4cG9ydCBjb25zdCBTVFJJUEVfUFJJQ0VfSURTID0ge1xuICBzdHVkZW50OiB7XG4gICAgbW9udGhseTogcHJvY2Vzcy5lbnYuU1RSSVBFX1NUVURFTlRfTU9OVEhMWV9QUklDRV9JRCB8fCAncHJpY2Vfc3R1ZGVudF9tb250aGx5JyxcbiAgICB5ZWFybHk6IHByb2Nlc3MuZW52LlNUUklQRV9TVFVERU5UX1lFQVJMWV9QUklDRV9JRCB8fCAncHJpY2Vfc3R1ZGVudF95ZWFybHknLFxuICB9LFxuICBwcm86IHtcbiAgICBtb250aGx5OiBwcm9jZXNzLmVudi5TVFJJUEVfUFJPX01PTlRITFlfUFJJQ0VfSUQgfHwgJ3ByaWNlX3Byb19tb250aGx5JyxcbiAgICB5ZWFybHk6IHByb2Nlc3MuZW52LlNUUklQRV9QUk9fWUVBUkxZX1BSSUNFX0lEIHx8ICdwcmljZV9wcm9feWVhcmx5JyxcbiAgfSxcbn0gYXMgY29uc3RcblxuZXhwb3J0IHR5cGUgUGxhbklkID0gJ2ZyZWUnIHwgJ3N0dWRlbnQnIHwgJ3BybydcbmV4cG9ydCB0eXBlIEJpbGxpbmdDeWNsZSA9ICdtb250aGx5JyB8ICd5ZWFybHknICJdLCJuYW1lcyI6WyJTdHJpcGUiLCJzdHJpcGUiLCJnZXRTZXJ2ZXJTdHJpcGUiLCJzdHJpcGVTZWNyZXRLZXkiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX1NFQ1JFVF9LRVkiLCJFcnJvciIsImFwaVZlcnNpb24iLCJhcHBJbmZvIiwibmFtZSIsInZlcnNpb24iLCJQTEFOX1BSSUNJTkciLCJmcmVlIiwibW9udGhseSIsInllYXJseSIsInN0dWRlbnQiLCJwcm8iLCJTVFJJUEVfUFJJQ0VfSURTIiwiU1RSSVBFX1NUVURFTlRfTU9OVEhMWV9QUklDRV9JRCIsIlNUUklQRV9TVFVERU5UX1lFQVJMWV9QUklDRV9JRCIsIlNUUklQRV9QUk9fTU9OVEhMWV9QUklDRV9JRCIsIlNUUklQRV9QUk9fWUVBUkxZX1BSSUNFX0lEIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/stripe.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/stripe","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&page=%2Fapi%2Fstripe%2Fcancel-subscription%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcancel-subscription%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();