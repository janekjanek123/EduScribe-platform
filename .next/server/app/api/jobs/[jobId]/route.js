(()=>{var e={};e.id=9650,e.ids=[9650],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},48779:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>j,serverHooks:()=>h,staticGenerationAsyncStorage:()=>J});var s={};t.r(s),t.d(s,{DELETE:()=>d,GET:()=>b,PATCH:()=>p});var o=t(49303),n=t(88716),u=t(60670),a=t(87070),i=t(20344),c=t(71615),l=t(30281);async function b(e,{params:r}){try{let e;let t=(0,i.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:s},error:o}=await t.auth.getUser();if(o||!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{jobId:n}=r;if(!n)return a.NextResponse.json({error:"Job ID is required"},{status:400});let u=await l.h.getJob(n);if(!u)return a.NextResponse.json({error:"Job not found"},{status:404});if(u.user_id!==s.id)return a.NextResponse.json({error:"Access denied"},{status:403});return"queued"===u.status&&(e=await l.h.getQueuePosition(n)),a.NextResponse.json({success:!0,job:{...u,queuePosition:e}})}catch(e){return console.error("[Jobs API] Error getting job:",e),a.NextResponse.json({success:!1,error:"Failed to get job",details:e.message},{status:500})}}async function p(e,{params:r}){try{let t=(0,i.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:s},error:o}=await t.auth.getUser();if(o||!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{jobId:n}=r,{action:u}=await e.json();if(!n)return a.NextResponse.json({error:"Job ID is required"},{status:400});if(!u)return a.NextResponse.json({error:"Action is required"},{status:400});let b=await l.h.getJob(n);if(!b)return a.NextResponse.json({error:"Job not found"},{status:404});if(b.user_id!==s.id)return a.NextResponse.json({error:"Access denied"},{status:403});let p=!1,d="";switch(u){case"cancel":if("queued"!==b.status)return a.NextResponse.json({error:"Only queued jobs can be cancelled"},{status:400});d=(p=await l.h.cancelJob(n))?"Job cancelled successfully":"Failed to cancel job";break;case"retry":if("failed"!==b.status)return a.NextResponse.json({error:"Only failed jobs can be retried"},{status:400});d=(p=await l.h.retryJob(n))?"Job retried successfully":"Failed to retry job";break;default:return a.NextResponse.json({error:`Unknown action: ${u}`},{status:400})}if(!p)return a.NextResponse.json({success:!1,error:d},{status:500});return a.NextResponse.json({success:!0,message:d})}catch(e){return console.error("[Jobs API] Error updating job:",e),a.NextResponse.json({success:!1,error:"Failed to update job",details:e.message},{status:500})}}async function d(e,{params:r}){try{let e=(0,i.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:t},error:s}=await e.auth.getUser();if(s||!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{jobId:o}=r;if(!o)return a.NextResponse.json({error:"Job ID is required"},{status:400});let n=await l.h.getJob(o);if(!n)return a.NextResponse.json({error:"Job not found"},{status:404});if(n.user_id!==t.id)return a.NextResponse.json({error:"Access denied"},{status:403});if(!["completed","failed","cancelled"].includes(n.status))return a.NextResponse.json({error:"Only completed, failed, or cancelled jobs can be deleted"},{status:400});let u=await l.h.cancelJob(o);return a.NextResponse.json({success:u,message:u?"Job deleted successfully":"Failed to delete job"})}catch(e){return console.error("[Jobs API] Error deleting job:",e),a.NextResponse.json({success:!1,error:"Failed to delete job",details:e.message},{status:500})}}let j=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/jobs/[jobId]/route",pathname:"/api/jobs/[jobId]",filename:"route",bundlePath:"app/api/jobs/[jobId]/route"},resolvedPagePath:"/Users/janjedrach/Cursor/eduscribe/src/app/api/jobs/[jobId]/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:J,serverHooks:h}=j,_="/api/jobs/[jobId]/route";function x(){return(0,u.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:J})}},30281:(e,r,t)=>{"use strict";t.d(r,{h:()=>n});var s=t(23517);class o{constructor(){let e="https://xhljckmlzdshxibnqsbj.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("NEXT_PUBLIC_SUPABASE_URL is required");let t=r||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA";if(!t)throw Error("Either SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY is required");this.supabase=(0,s.eI)(e,t)}async enqueueJob(e,r,t,s){try{console.log(`[JobQueue] Enqueueing ${r} job for user ${e}`);let{data:o,error:n}=await this.supabase.rpc("enqueue_job",{p_user_id:e,p_job_type:r,p_input_data:t,p_estimated_duration_seconds:s});if(n)throw console.error("[JobQueue] Error enqueueing job:",n),Error(`Failed to enqueue job: ${n.message}`);let u=await this.getQueuePosition(o);return console.log(`[JobQueue] Job ${o} enqueued at position ${u}`),{jobId:o,position:u}}catch(e){throw console.error("[JobQueue] Error in enqueueJob:",e),e}}async getNextJob(e){try{let{data:r,error:t}=await this.supabase.rpc("get_next_job",{p_worker_id:e});if(t)return console.error("[JobQueue] Error getting next job:",t),null;if(!r||!Array.isArray(r)||0===r.length)return null;let s=r[0];return console.log(`[JobQueue] Retrieved job ${s.job_id} for processing`),{id:s.job_id,user_id:s.user_id,job_type:s.job_type,priority:s.priority,input_data:s.input_data,created_at:s.created_at,status:"processing",progress:0,retry_count:0,max_retries:3,updated_at:new Date().toISOString()}}catch(e){return console.error("[JobQueue] Error in getNextJob:",e),null}}async updateJobProgress(e,r,t){try{let{data:s,error:o}=await this.supabase.rpc("update_job_progress",{p_job_id:e,p_progress:r,p_status:t});if(o)return console.error("[JobQueue] Error updating job progress:",o),!1;return console.log(`[JobQueue] Updated job ${e} progress to ${r}%`),!!s}catch(e){return console.error("[JobQueue] Error in updateJobProgress:",e),!1}}async completeJob(e,r,t=!0,s,o){try{let{data:n,error:u}=await this.supabase.rpc("complete_job",{p_job_id:e,p_output_data:r,p_success:t,p_error_message:s,p_error_details:o});if(u)return console.error("[JobQueue] Error completing job:",u),!1;return console.log(`[JobQueue] Job ${e} completed with status: ${t?"success":"failure"}`),!!n}catch(e){return console.error("[JobQueue] Error in completeJob:",e),!1}}async retryJob(e){try{let{data:r,error:t}=await this.supabase.rpc("retry_job",{p_job_id:e});if(t)return console.error("[JobQueue] Error retrying job:",t),!1;return console.log(`[JobQueue] Job ${e} retried`),!!r}catch(e){return console.error("[JobQueue] Error in retryJob:",e),!1}}async getJob(e){try{let{data:r,error:t}=await this.supabase.from("jobs").select("*").eq("id",e).single();if(t)return console.error("[JobQueue] Error getting job:",t),null;return r}catch(e){return console.error("[JobQueue] Error in getJob:",e),null}}async getUserJobs(e,r=1,t=10,s){try{let o=this.supabase.from("jobs").select("*",{count:"exact"}).eq("user_id",e).order("created_at",{ascending:!1});s&&(o=o.eq("status",s));let{data:n,error:u,count:a}=await o.range((r-1)*t,r*t-1);if(u)return console.error("[JobQueue] Error getting user jobs:",u),{jobs:[],total:0,hasMore:!1};let i=a||0;return{jobs:n||[],total:i,hasMore:r*t<i}}catch(e){return console.error("[JobQueue] Error in getUserJobs:",e),{jobs:[],total:0,hasMore:!1}}}async getQueuePosition(e){try{let{data:r}=await this.supabase.from("jobs").select("priority, created_at").eq("id",e).single();if(!r)return -1;let{count:t}=await this.supabase.from("jobs").select("*",{count:"exact",head:!0}).eq("status","queued").or(`priority.gt.${r.priority},and(priority.eq.${r.priority},created_at.lt.${r.created_at})`);return(t||0)+1}catch(e){return console.error("[JobQueue] Error getting queue position:",e),-1}}async getJobStats(e){try{let{data:r,error:t}=await this.supabase.rpc("get_job_stats",{p_user_id:e});if(t)return console.error("[JobQueue] Error getting job stats:",t),null;if(!r||!Array.isArray(r)||0===r.length)return null;return r[0]}catch(e){return console.error("[JobQueue] Error in getJobStats:",e),null}}async cancelJob(e){try{let{error:r}=await this.supabase.from("jobs").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("id",e).in("status",["queued"]);if(r)return console.error("[JobQueue] Error cancelling job:",r),!1;return console.log(`[JobQueue] Job ${e} cancelled`),!0}catch(e){return console.error("[JobQueue] Error in cancelJob:",e),!1}}subscribeToJobUpdates(e,r){return this.supabase.channel("job_updates").on("postgres_changes",{event:"*",schema:"public",table:"jobs",filter:`user_id=eq.${e}`},r).subscribe()}async cleanupOldJobs(e=30){try{let r=new Date;r.setDate(r.getDate()-e);let{data:t,error:s}=await this.supabase.from("jobs").delete().in("status",["completed","failed","cancelled"]).lt("completed_at",r.toISOString());if(s)return console.error("[JobQueue] Error cleaning up old jobs:",s),0;let o=t?.length||0;return console.log(`[JobQueue] Cleaned up ${o} old jobs`),o}catch(e){return console.error("[JobQueue] Error in cleanupOldJobs:",e),0}}}let n=new o}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,3517,958],()=>t(48779));module.exports=s})();