"use strict";(()=>{var e={};e.id=3634,e.ids=[3634],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},95346:e=>{e.exports=require("timers")},21764:e=>{e.exports=require("util")},41520:e=>{e.exports=require("vm")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},76402:e=>{e.exports=require("node:stream/promises")},76915:e=>{e.exports=require("node:string_decoder")},99397:e=>{e.exports=require("node:timers/promises")},25997:e=>{e.exports=require("node:tty")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},83858:e=>{e.exports=require("node:v8")},47636:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>N,patchFetch:()=>T,requestAsyncStorage:()=>U,routeModule:()=>R,serverHooks:()=>P,staticGenerationAsyncStorage:()=>$});var s={};t.r(s),t.d(s,{GET:()=>w,POST:()=>v,dynamic:()=>j});var o=t(49303),i=t(88716),a=t(60670),u=t(87070),n=t(73185),p=t(23534),l=t(2365),d=t(92048),c=t.n(d),x=t(55315),m=t.n(x),q=t(21764),h=t(84770);let f=(0,q.promisify)(c().readFile);(0,q.promisify)(c().writeFile);let b=(0,q.promisify)(c().unlink),g=(0,q.promisify)(c().mkdir),y=(0,q.promisify)(c().exists);async function w(e){try{let r=e.nextUrl.searchParams.get("url");if(!r)return u.NextResponse.json({success:!1,error:"Missing URL",message:'Please provide a YouTube URL in the "url" query parameter'},{status:400});let t=(0,n.jx)(r);if(!t||!(0,n.cc)(t))return u.NextResponse.json({success:!1,error:"Invalid YouTube URL",message:"Could not extract a valid YouTube video ID from the provided URL"},{status:400});try{await (0,p.cF)("yt-dlp --version",{shell:!0})}catch(e){return u.NextResponse.json({success:!1,error:"yt-dlp_not_installed",message:"yt-dlp is required to extract YouTube subtitles. Please install yt-dlp:\n• macOS: brew install yt-dlp\n• Linux/macOS: pip install yt-dlp\n• Windows: pip install yt-dlp or choco install yt-dlp"},{status:422})}let s=m().join(process.cwd(),"temp");await y(s)||await g(s,{recursive:!0});let o=(0,h.randomUUID)(),i=m().join(s,`${o}-%(id)s.%(ext)s`),a="pl,en";try{await (0,p.cF)(`yt-dlp --write-sub --sub-lang ${a} --skip-download --output "${i}" https://www.youtube.com/watch?v=${t}`,{shell:!0});let e=null,r=[".vtt",".srt"];for(let i of r){let r=m().join(s,`${o}-${t}${i}`);if(await y(r)){e=r;break}}if(!e)for(let u of(await (0,p.cF)(`yt-dlp --write-auto-sub --sub-lang ${a} --skip-download --output "${i}" https://www.youtube.com/watch?v=${t}`,{shell:!0}),r)){let r=m().join(s,`${o}-${t}${u}`);if(await y(r)){e=r;break}}if(!e)return u.NextResponse.json({success:!1,error:"No subtitles available",message:"This YouTube video does not have available subtitles or captions."},{status:404});let n=await f(e,"utf8"),d=m().extname(e).toLowerCase(),c="";if(".vtt"===d||".srt"===d)c=l.qg(n).map(e=>e.text||"").filter(Boolean).join(" ");else throw Error(`Unsupported subtitle format: ${d}`);c=c.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim();try{await b(e)}catch(e){console.warn("Error deleting temporary file:",e)}return u.NextResponse.json({success:!0,data:{text:c,videoId:t,language:"auto",length:c.length}})}catch(e){return console.error("Error extracting subtitles:",e),u.NextResponse.json({success:!1,error:"Subtitle extraction failed",message:e.message||"Failed to extract subtitles from this video"},{status:500})}}catch(e){return console.error("Unhandled error:",e),u.NextResponse.json({success:!1,error:"Server error",message:e.message||"An unexpected error occurred"},{status:500})}}async function v(e){try{let{url:r}=await e.json();if(!r)return u.NextResponse.json({success:!1,error:"Missing URL",message:"Please provide a YouTube URL in the request body"},{status:400});let t=new URL(e.url);t.searchParams.set("url",r);let s=new u.NextRequest(t,e);return w(s)}catch(e){return u.NextResponse.json({success:!1,error:"Invalid request",message:e.message||"Failed to parse request body"},{status:400})}}let j="force-dynamic",R=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/subtitles/route",pathname:"/api/subtitles",filename:"route",bundlePath:"app/api/subtitles/route"},resolvedPagePath:"/Users/janjedrach/Cursor/eduscribe/src/app/api/subtitles/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:U,staticGenerationAsyncStorage:$,serverHooks:P}=R,N="/api/subtitles/route";function T(){return(0,a.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:$})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,4769,5074,5288,2086],()=>t(47636));module.exports=s})();