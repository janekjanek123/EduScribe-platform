/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/video-notes/route";
exports.ids = ["app/api/video-notes/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "string_decoder":
/*!*********************************!*\
  !*** external "string_decoder" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("string_decoder");

/***/ }),

/***/ "timers":
/*!*************************!*\
  !*** external "timers" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("timers");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "vm":
/*!*********************!*\
  !*** external "vm" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("vm");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream/web");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo-notes%2Froute&page=%2Fapi%2Fvideo-notes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo-notes%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo-notes%2Froute&page=%2Fapi%2Fvideo-notes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo-notes%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_janjedrach_Cursor_eduscribe_src_app_api_video_notes_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/video-notes/route.ts */ \"(rsc)/./src/app/api/video-notes/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/video-notes/route\",\n        pathname: \"/api/video-notes\",\n        filename: \"route\",\n        bundlePath: \"app/api/video-notes/route\"\n    },\n    resolvedPagePath: \"/Users/janjedrach/Cursor/eduscribe/src/app/api/video-notes/route.ts\",\n    nextConfigOutput,\n    userland: _Users_janjedrach_Cursor_eduscribe_src_app_api_video_notes_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/video-notes/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ2aWRlby1ub3RlcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGdmlkZW8tbm90ZXMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ2aWRlby1ub3RlcyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9anMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz1tZHgmcm9vdERpcj0lMkZVc2VycyUyRmphbmplZHJhY2glMkZDdXJzb3IlMkZlZHVzY3JpYmUmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNtQjtBQUNoRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8/YTMzNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvamFuamVkcmFjaC9DdXJzb3IvZWR1c2NyaWJlL3NyYy9hcHAvYXBpL3ZpZGVvLW5vdGVzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvdmlkZW8tbm90ZXMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS92aWRlby1ub3Rlc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvdmlkZW8tbm90ZXMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvamFuamVkcmFjaC9DdXJzb3IvZWR1c2NyaWJlL3NyYy9hcHAvYXBpL3ZpZGVvLW5vdGVzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS92aWRlby1ub3Rlcy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo-notes%2Froute&page=%2Fapi%2Fvideo-notes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo-notes%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/video-notes/route.ts":
/*!******************************************!*\
  !*** ./src/app/api/video-notes/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _services_youtube__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/services/youtube */ \"(rsc)/./src/services/youtube.ts\");\n/* harmony import */ var _services_ai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/ai */ \"(rsc)/./src/services/ai.ts\");\n/* harmony import */ var _services_subscription__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/services/subscription */ \"(rsc)/./src/services/subscription.ts\");\n/* harmony import */ var _services_queue__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/services/queue */ \"(rsc)/./src/services/queue.ts\");\n\n\n\n\n\n\n// Initialize Supabase client\nconst supabaseUrl = \"https://xhljckmlzdshxibnqsbj.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA\";\n/**\n * Get user's subscription plan for queue priority\n */ async function getSubscriptionPlan(userId) {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__.createClient)(supabaseUrl, supabaseAnonKey);\n        const { data } = await supabase.from(\"user_subscriptions\").select(\"plan_id\").eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        const planId = data?.plan_id;\n        // Ensure we return a valid plan type\n        if (planId === \"student\" || planId === \"pro\") {\n            return {\n                planId\n            };\n        }\n        return {\n            planId: \"free\"\n        };\n    } catch (error) {\n        console.warn(\"[Video Notes API] Could not fetch subscription:\", error);\n        return {\n            planId: \"free\"\n        };\n    }\n}\n/**\n * Video Notes API Endpoint - Isolated System\n * \n * Processes a YouTube URL to:\n * 1. Extract the video ID\n * 2. Get video information (title, thumbnail)\n * 3. Fetch the transcript\n * 4. Generate AI notes\n * 5. Store in the isolated video_notes table\n */ async function POST(request) {\n    console.log(\"[Video Notes API] Request received: POST\");\n    try {\n        // STEP 1: Authenticate the request\n        console.log(\"[Video Notes API] Authenticating request\");\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            console.error(\"[Video Notes API] Authentication missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication required\",\n                message: \"Valid Bearer token is required\"\n            }, {\n                status: 401\n            });\n        }\n        // Initialize Supabase client with the token\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        // Verify the user's token and set the session\n        const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n        if (authError || !user) {\n            console.error(\"[Video Notes API] Authentication failed:\", authError?.message);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication failed\",\n                message: authError?.message || \"Invalid authentication token\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(`[Video Notes API] User authenticated: ${user.id}`);\n        // STEP 1.5: Check usage limits BEFORE processing\n        console.log(\"[Video Notes API] Checking usage limits\");\n        const usageCheck = await (0,_services_subscription__WEBPACK_IMPORTED_MODULE_3__.checkUsageLimits)(user.id, token, \"video\");\n        if (!usageCheck.canGenerate) {\n            console.log(`[Video Notes API] Generation limit reached: ${usageCheck.reason}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Generation limit reached\",\n                message: usageCheck.reason || \"You have reached your monthly note generation limit\",\n                usage: usageCheck.usage,\n                limits: usageCheck.limits\n            }, {\n                status: 429\n            }); // 429 = Too Many Requests\n        }\n        if (!usageCheck.canSave) {\n            console.log(`[Video Notes API] Storage limit reached: ${usageCheck.reason}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Storage limit reached\",\n                message: usageCheck.reason || \"You have reached your saved notes limit\",\n                usage: usageCheck.usage,\n                limits: usageCheck.limits\n            }, {\n                status: 429\n            });\n        }\n        console.log(`[Video Notes API] Usage check passed - can generate: ${usageCheck.canGenerate}, can save: ${usageCheck.canSave}`);\n        // Get user's subscription for priority\n        const subscription = await getSubscriptionPlan(user.id);\n        // Wrap the processing in queue\n        const result = await (0,_services_queue__WEBPACK_IMPORTED_MODULE_4__.queueRequest)(user.id, subscription.planId, \"video\", async ()=>{\n            // Original processing logic goes here\n            const body = await request.json();\n            const { url, title: customTitle } = body;\n            if (!url) {\n                console.error(\"[Video Notes API] Missing URL parameter\");\n                return {\n                    success: false,\n                    error: \"Missing URL\",\n                    message: \"Please provide a YouTube URL\"\n                };\n            }\n            console.log(`[Video Notes API] Processing URL: ${url}`);\n            // STEP 3: Extract and validate YouTube video ID\n            const videoId = (0,_services_youtube__WEBPACK_IMPORTED_MODULE_1__.extractYouTubeId)(url);\n            if (!videoId || !(0,_services_youtube__WEBPACK_IMPORTED_MODULE_1__.isValidYouTubeId)(videoId)) {\n                console.error(\"[Video Notes API] Invalid YouTube URL:\", url);\n                return {\n                    success: false,\n                    error: \"Invalid YouTube URL\",\n                    message: \"The provided URL is not a valid YouTube video URL\"\n                };\n            }\n            console.log(`[Video Notes API] Valid YouTube ID: ${videoId}`);\n            // STEP 4: Check if we already have notes for this video\n            try {\n                const { data: existingNote, error: existingError } = await supabase.from(\"video_notes\").select(\"id, video_id\").eq(\"video_id\", videoId).eq(\"user_id\", user.id).single();\n                if (existingNote && !existingError) {\n                    console.log(`[Video Notes API] Notes already exist for video: ${videoId}`);\n                    return {\n                        success: false,\n                        error: \"Duplicate note\",\n                        message: \"Notes for this video already exist\",\n                        noteId: existingNote.id\n                    };\n                }\n            } catch (checkError) {\n                console.error(\"[Video Notes API] Error checking for existing notes:\", checkError);\n            // Continue processing - this is not a critical error\n            }\n            // STEP 5: Get video information (title, thumbnail, etc.)\n            console.log(\"[Video Notes API] Fetching video information\");\n            const videoInfo = await (0,_services_youtube__WEBPACK_IMPORTED_MODULE_1__.getVideoInfo)(videoId);\n            if (!videoInfo || videoInfo.error) {\n                console.error(\"[Video Notes API] Failed to get video info:\", videoInfo?.error || \"Unknown error\");\n                return {\n                    success: false,\n                    error: \"Video info error\",\n                    message: videoInfo?.error || \"Failed to retrieve video information\"\n                };\n            }\n            console.log(`[Video Notes API] Video info retrieved: \"${videoInfo.title}\"`);\n            // STEP 6: Fetch video transcript\n            console.log(\"[Video Notes API] Fetching video transcript\");\n            const transcriptResult = await (0,_services_youtube__WEBPACK_IMPORTED_MODULE_1__.getVideoTranscript)(videoId);\n            if (!transcriptResult || transcriptResult.error) {\n                console.error(\"[Video Notes API] Transcript error:\", transcriptResult?.error || \"Unknown error\");\n                return {\n                    success: false,\n                    error: \"Transcript error\",\n                    message: transcriptResult?.error || \"Failed to extract transcript from the video\"\n                };\n            }\n            if (!transcriptResult.transcript || transcriptResult.transcript.trim().length === 0) {\n                console.error(\"[Video Notes API] Empty transcript\");\n                return {\n                    success: false,\n                    error: \"Empty transcript\",\n                    message: \"The video does not have any extractable content for notes\"\n                };\n            }\n            console.log(`[Video Notes API] Transcript retrieved (${transcriptResult.transcript.length} chars)`);\n            // STEP 7: Generate notes using AI\n            console.log(\"[Video Notes API] Generating notes from transcript\");\n            const notesResult = await (0,_services_ai__WEBPACK_IMPORTED_MODULE_2__.generateNotes)({\n                transcript: transcriptResult.transcript,\n                videoTitle: videoInfo.title\n            });\n            if (!notesResult.content) {\n                console.error(\"[Video Notes API] AI note generation failed:\", notesResult.error);\n                return {\n                    success: false,\n                    error: \"Note generation failed\",\n                    message: notesResult.error || \"Failed to generate notes from the transcript\"\n                };\n            }\n            console.log(`[Video Notes API] Successfully generated notes (${notesResult.content.length} chars)`);\n            // STEP 8: Create the note record for isolated video_notes table\n            const noteId = `video_${Date.now()}`;\n            const noteData = {\n                id: noteId,\n                user_id: user.id,\n                video_url: url,\n                video_id: videoId,\n                title: customTitle || videoInfo.title,\n                thumbnail_url: videoInfo.thumbnailUrl,\n                content: notesResult.content,\n                summary: notesResult.summary,\n                quiz: notesResult.quiz,\n                created_at: new Date().toISOString()\n            };\n            console.log(`[Video Notes API] Created note with ID: ${noteId}`);\n            console.log(\"[Video Notes API] Note data structure:\", Object.keys(noteData).join(\", \"));\n            // STEP 9: Store the note in Supabase video_notes table\n            console.log(\"[Video Notes API] Storing note in Supabase video_notes table\");\n            try {\n                // Verify database connection before attempting insert\n                try {\n                    const { error: pingError } = await supabase.from(\"video_notes\").select(\"count\").limit(1);\n                    if (pingError) {\n                        console.error(\"[Video Notes API] Database connection check failed:\", pingError);\n                        return {\n                            success: false,\n                            error: \"Database connection error\",\n                            message: \"Could not connect to the database. Please try again later.\",\n                            details: {\n                                code: pingError.code,\n                                message: pingError.message\n                            }\n                        };\n                    }\n                } catch (pingException) {\n                    console.error(\"[Video Notes API] Database ping exception:\", pingException);\n                }\n                const { data, error } = await supabase.from(\"video_notes\").insert(noteData).select().single();\n                if (error) {\n                    console.error(\"[Video Notes API] Database storage error:\", error);\n                    // Log detailed diagnostic information\n                    console.error(\"[Video Notes API] Database error details:\", {\n                        code: error.code,\n                        message: error.message,\n                        details: error.details,\n                        hint: error.hint\n                    });\n                    // Handle specific database errors with appropriate status codes\n                    if (error.code === \"23505\") {\n                        return {\n                            success: false,\n                            error: \"Duplicate record\",\n                            message: \"Notes for this video already exist in the database\",\n                            details: {\n                                code: error.code,\n                                message: error.message\n                            }\n                        };\n                    } else if (error.code?.startsWith(\"22\") || error.code?.startsWith(\"23\")) {\n                        // Data exception (22) or integrity constraint violation (23)\n                        return {\n                            success: false,\n                            error: \"Invalid data format\",\n                            message: \"The note data could not be stored due to validation errors\",\n                            details: {\n                                code: error.code,\n                                message: error.message\n                            }\n                        };\n                    } else if (error.code === \"42P01\") {\n                        // Undefined table\n                        return {\n                            success: false,\n                            error: \"Schema error\",\n                            message: \"The video_notes table does not exist. Please run the database initialization.\",\n                            details: {\n                                code: error.code,\n                                message: error.message\n                            }\n                        };\n                    }\n                    return {\n                        success: false,\n                        error: \"Database error\",\n                        message: \"Failed to store the notes in the database\",\n                        details: {\n                            code: error.code,\n                            message: error.message\n                        }\n                    };\n                }\n                console.log(`[Video Notes API] Successfully stored note in database with ID: ${data?.id || noteId}`);\n                // STEP 10.5: Track usage after successful creation\n                console.log(\"[Video Notes API] Incrementing usage counters\");\n                try {\n                    await (0,_services_subscription__WEBPACK_IMPORTED_MODULE_3__.incrementUsage)(user.id, token, \"video\");\n                    console.log(\"[Video Notes API] Usage tracking completed\");\n                } catch (usageError) {\n                    console.error(\"[Video Notes API] Usage tracking failed (note still created):\", usageError);\n                // Don't fail the request if usage tracking fails\n                }\n                // STEP 10.6: Refresh saved notes count\n                console.log(\"[Video Notes API] Refreshing saved notes count\");\n                try {\n                    await (0,_services_subscription__WEBPACK_IMPORTED_MODULE_3__.refreshSavedNotesCount)(user.id, token);\n                    console.log(\"[Video Notes API] Saved notes count refreshed\");\n                } catch (countError) {\n                    console.error(\"[Video Notes API] Saved notes count refresh failed (note still created):\", countError);\n                // Don't fail the request if count refresh fails\n                }\n                return {\n                    success: true,\n                    data\n                };\n            } catch (dbError) {\n                console.error(\"[Video Notes API] Unexpected database error:\", dbError);\n                return {\n                    success: false,\n                    error: \"Database exception\",\n                    message: dbError?.message || \"An unexpected error occurred while storing notes\",\n                    details: dbError\n                };\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n    } catch (error) {\n        console.error(\"[Video Notes API] Critical error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Server error\",\n            message: \"An unexpected error occurred on the server\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * Get all video notes for the authenticated user\n */ async function GET(request) {\n    console.log(\"[Video Notes API] Request received: GET\");\n    try {\n        // STEP 1: Authenticate the request\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            console.error(\"[Video Notes API] Authentication missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication required\",\n                message: \"Valid Bearer token is required\"\n            }, {\n                status: 401\n            });\n        }\n        // Initialize Supabase client with the token\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        // Verify the user's token and set the session\n        const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n        if (authError || !user) {\n            console.error(\"[Video Notes API] Authentication failed:\", authError?.message);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication failed\",\n                message: authError?.message || \"Invalid authentication token\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(`[Video Notes API] User authenticated: ${user.id}`);\n        // STEP 2: Fetch the user's video notes\n        const { data, error } = await supabase.from(\"video_notes\").select(\"*\").eq(\"user_id\", user.id).order(\"created_at\", {\n            ascending: false\n        });\n        if (error) {\n            console.error(\"[Video Notes API] Database fetch error:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Database error\",\n                message: \"Failed to fetch video notes from the database\",\n                details: {\n                    code: error.code,\n                    message: error.message\n                }\n            }, {\n                status: 500\n            });\n        }\n        console.log(`[Video Notes API] Successfully fetched ${data.length} video notes`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data\n        });\n    } catch (error) {\n        console.error(\"[Video Notes API] Error fetching video notes:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Server error\",\n            message: \"An unexpected error occurred while fetching video notes\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * Delete a specific video note for the authenticated user\n */ async function DELETE(request) {\n    console.log(\"[Video Notes API] Request received: DELETE\");\n    try {\n        // STEP 1: Authenticate the request\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            console.error(\"[Video Notes API] Authentication missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication required\",\n                message: \"Valid Bearer token is required\"\n            }, {\n                status: 401\n            });\n        }\n        // Initialize Supabase client with the token\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        // Verify the user's token and set the session\n        const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n        if (authError || !user) {\n            console.error(\"[Video Notes API] Authentication failed:\", authError?.message);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Authentication failed\",\n                message: authError?.message || \"Invalid authentication token\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(`[Video Notes API] User authenticated: ${user.id}`);\n        // STEP 2: Get the note ID from query parameters\n        const noteId = request.nextUrl.searchParams.get(\"id\");\n        if (!noteId) {\n            console.error(\"[Video Notes API] Note ID missing\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Missing note ID\",\n                message: \"Note ID is required for deletion\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(`[Video Notes API] Deleting note with ID: ${noteId}`);\n        // STEP 3: Delete the note (with user ownership check)\n        const { data, error } = await supabase.from(\"video_notes\").delete().eq(\"id\", noteId).eq(\"user_id\", user.id) // Ensure user can only delete their own notes\n        .select();\n        if (error) {\n            console.error(\"[Video Notes API] Database delete error:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Database error\",\n                message: \"Failed to delete the note from the database\",\n                details: {\n                    code: error.code,\n                    message: error.message\n                }\n            }, {\n                status: 500\n            });\n        }\n        // Check if any rows were affected\n        if (!data || data.length === 0) {\n            console.error(`[Video Notes API] Note not found or access denied: ${noteId}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Note not found\",\n                message: \"The note was not found or you do not have permission to delete it\"\n            }, {\n                status: 404\n            });\n        }\n        console.log(`[Video Notes API] Successfully deleted note: ${noteId}`);\n        // Refresh saved notes count after deletion\n        try {\n            await (0,_services_subscription__WEBPACK_IMPORTED_MODULE_3__.refreshSavedNotesCount)(user.id, token);\n            console.log(\"[Video Notes API] Saved notes count refreshed after deletion\");\n        } catch (countError) {\n            console.error(\"[Video Notes API] Saved notes count refresh failed after deletion:\", countError);\n        // Don't fail the request if count refresh fails\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Note deleted successfully\",\n            data: data[0]\n        });\n    } catch (error) {\n        console.error(\"[Video Notes API] Error deleting video note:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Server error\",\n            message: \"An unexpected error occurred while deleting the note\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n// Configure dynamic behavior to avoid caching\nconst dynamic = \"force-dynamic\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNUbkIsTUFBTUEsSUFBSSxDQUFDLEVBQUU7UUFDZjtJQUNGLEVBQUUsT0FBT08sT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLGdEQUFnREE7UUFDOUQsT0FBTzNCLHFEQUFZQSxDQUFDcUMsSUFBSSxDQUFDO1lBQ3ZCQyxTQUFTO1lBQ1RYLE9BQU87WUFDUFksU0FBUztZQUNUcUQsU0FBU2pFLE1BQU1ZLE9BQU87UUFDeEIsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDbkI7QUFDRjtBQUVBLDhDQUE4QztBQUN2QyxNQUFNbUUsVUFBVSxnQkFBZ0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lZHVzY3JpYmUvLi9zcmMvYXBwL2FwaS92aWRlby1ub3Rlcy9yb3V0ZS50cz9kNjJkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHsgZXh0cmFjdFlvdVR1YmVJZCwgZ2V0VmlkZW9JbmZvLCBnZXRWaWRlb1RyYW5zY3JpcHQsIGlzVmFsaWRZb3VUdWJlSWQgfSBmcm9tICdAL3NlcnZpY2VzL3lvdXR1YmUnO1xuaW1wb3J0IHsgZ2VuZXJhdGVOb3RlcyB9IGZyb20gJ0Avc2VydmljZXMvYWknO1xuaW1wb3J0IHsgY2hlY2tVc2FnZUxpbWl0cywgaW5jcmVtZW50VXNhZ2UsIHJlZnJlc2hTYXZlZE5vdGVzQ291bnQgfSBmcm9tICdAL3NlcnZpY2VzL3N1YnNjcmlwdGlvbic7XG5pbXBvcnQgeyBxdWV1ZVJlcXVlc3QgfSBmcm9tICdAL3NlcnZpY2VzL3F1ZXVlJztcblxuLy8gSW5pdGlhbGl6ZSBTdXBhYmFzZSBjbGllbnRcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMITtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZITtcblxuLyoqXG4gKiBHZXQgdXNlcidzIHN1YnNjcmlwdGlvbiBwbGFuIGZvciBxdWV1ZSBwcmlvcml0eVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTdWJzY3JpcHRpb25QbGFuKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IHBsYW5JZDogJ2ZyZWUnIHwgJ3N0dWRlbnQnIHwgJ3BybycgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3N1YnNjcmlwdGlvbnMnKVxuICAgICAgLnNlbGVjdCgncGxhbl9pZCcpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLnNpbmdsZSgpO1xuICAgIFxuICAgIGNvbnN0IHBsYW5JZCA9IGRhdGE/LnBsYW5faWQ7XG4gICAgXG4gICAgLy8gRW5zdXJlIHdlIHJldHVybiBhIHZhbGlkIHBsYW4gdHlwZVxuICAgIGlmIChwbGFuSWQgPT09ICdzdHVkZW50JyB8fCBwbGFuSWQgPT09ICdwcm8nKSB7XG4gICAgICByZXR1cm4geyBwbGFuSWQgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgcGxhbklkOiAnZnJlZScgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oJ1tWaWRlbyBOb3RlcyBBUEldIENvdWxkIG5vdCBmZXRjaCBzdWJzY3JpcHRpb246JywgZXJyb3IpO1xuICAgIHJldHVybiB7IHBsYW5JZDogJ2ZyZWUnIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWaWRlbyBOb3RlcyBBUEkgRW5kcG9pbnQgLSBJc29sYXRlZCBTeXN0ZW1cbiAqIFxuICogUHJvY2Vzc2VzIGEgWW91VHViZSBVUkwgdG86XG4gKiAxLiBFeHRyYWN0IHRoZSB2aWRlbyBJRFxuICogMi4gR2V0IHZpZGVvIGluZm9ybWF0aW9uICh0aXRsZSwgdGh1bWJuYWlsKVxuICogMy4gRmV0Y2ggdGhlIHRyYW5zY3JpcHRcbiAqIDQuIEdlbmVyYXRlIEFJIG5vdGVzXG4gKiA1LiBTdG9yZSBpbiB0aGUgaXNvbGF0ZWQgdmlkZW9fbm90ZXMgdGFibGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc29sZS5sb2coJ1tWaWRlbyBOb3RlcyBBUEldIFJlcXVlc3QgcmVjZWl2ZWQ6IFBPU1QnKTtcblxuICB0cnkge1xuICAgIC8vIFNURVAgMTogQXV0aGVudGljYXRlIHRoZSByZXF1ZXN0XG4gICAgY29uc29sZS5sb2coJ1tWaWRlbyBOb3RlcyBBUEldIEF1dGhlbnRpY2F0aW5nIHJlcXVlc3QnKTtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIEF1dGhlbnRpY2F0aW9uIG1pc3NpbmcnKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZCBCZWFyZXIgdG9rZW4gaXMgcmVxdWlyZWQnXG4gICAgICB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIC8vIEluaXRpYWxpemUgU3VwYWJhc2UgY2xpZW50IHdpdGggdGhlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gVmVyaWZ5IHRoZSB1c2VyJ3MgdG9rZW4gYW5kIHNldCB0aGUgc2Vzc2lvblxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcih0b2tlbik7XG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gQXV0aGVudGljYXRpb24gZmFpbGVkOicsIGF1dGhFcnJvcj8ubWVzc2FnZSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogYXV0aEVycm9yPy5tZXNzYWdlIHx8ICdJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHRva2VuJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtWaWRlbyBOb3RlcyBBUEldIFVzZXIgYXV0aGVudGljYXRlZDogJHt1c2VyLmlkfWApO1xuXG4gICAgLy8gU1RFUCAxLjU6IENoZWNrIHVzYWdlIGxpbWl0cyBCRUZPUkUgcHJvY2Vzc2luZ1xuICAgIGNvbnNvbGUubG9nKCdbVmlkZW8gTm90ZXMgQVBJXSBDaGVja2luZyB1c2FnZSBsaW1pdHMnKTtcbiAgICBjb25zdCB1c2FnZUNoZWNrID0gYXdhaXQgY2hlY2tVc2FnZUxpbWl0cyh1c2VyLmlkLCB0b2tlbiwgJ3ZpZGVvJyk7XG4gICAgXG4gICAgaWYgKCF1c2FnZUNoZWNrLmNhbkdlbmVyYXRlKSB7XG4gICAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gR2VuZXJhdGlvbiBsaW1pdCByZWFjaGVkOiAke3VzYWdlQ2hlY2sucmVhc29ufWApO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnR2VuZXJhdGlvbiBsaW1pdCByZWFjaGVkJyxcbiAgICAgICAgbWVzc2FnZTogdXNhZ2VDaGVjay5yZWFzb24gfHwgJ1lvdSBoYXZlIHJlYWNoZWQgeW91ciBtb250aGx5IG5vdGUgZ2VuZXJhdGlvbiBsaW1pdCcsXG4gICAgICAgIHVzYWdlOiB1c2FnZUNoZWNrLnVzYWdlLFxuICAgICAgICBsaW1pdHM6IHVzYWdlQ2hlY2subGltaXRzXG4gICAgICB9LCB7IHN0YXR1czogNDI5IH0pOyAvLyA0MjkgPSBUb28gTWFueSBSZXF1ZXN0c1xuICAgIH1cbiAgICBcbiAgICBpZiAoIXVzYWdlQ2hlY2suY2FuU2F2ZSkge1xuICAgICAgY29uc29sZS5sb2coYFtWaWRlbyBOb3RlcyBBUEldIFN0b3JhZ2UgbGltaXQgcmVhY2hlZDogJHt1c2FnZUNoZWNrLnJlYXNvbn1gKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1N0b3JhZ2UgbGltaXQgcmVhY2hlZCcsXG4gICAgICAgIG1lc3NhZ2U6IHVzYWdlQ2hlY2sucmVhc29uIHx8ICdZb3UgaGF2ZSByZWFjaGVkIHlvdXIgc2F2ZWQgbm90ZXMgbGltaXQnLFxuICAgICAgICB1c2FnZTogdXNhZ2VDaGVjay51c2FnZSxcbiAgICAgICAgbGltaXRzOiB1c2FnZUNoZWNrLmxpbWl0c1xuICAgICAgfSwgeyBzdGF0dXM6IDQyOSB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtWaWRlbyBOb3RlcyBBUEldIFVzYWdlIGNoZWNrIHBhc3NlZCAtIGNhbiBnZW5lcmF0ZTogJHt1c2FnZUNoZWNrLmNhbkdlbmVyYXRlfSwgY2FuIHNhdmU6ICR7dXNhZ2VDaGVjay5jYW5TYXZlfWApO1xuXG4gICAgLy8gR2V0IHVzZXIncyBzdWJzY3JpcHRpb24gZm9yIHByaW9yaXR5XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgZ2V0U3Vic2NyaXB0aW9uUGxhbih1c2VyLmlkKTtcbiAgICBcbiAgICAvLyBXcmFwIHRoZSBwcm9jZXNzaW5nIGluIHF1ZXVlXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVldWVSZXF1ZXN0KFxuICAgICAgdXNlci5pZCxcbiAgICAgIHN1YnNjcmlwdGlvbi5wbGFuSWQsXG4gICAgICAndmlkZW8nLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBPcmlnaW5hbCBwcm9jZXNzaW5nIGxvZ2ljIGdvZXMgaGVyZVxuICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgICAgIGNvbnN0IHsgdXJsLCB0aXRsZTogY3VzdG9tVGl0bGUgfSA9IGJvZHk7XG5cbiAgICAgICAgaWYgKCF1cmwpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBNaXNzaW5nIFVSTCBwYXJhbWV0ZXInKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogJ01pc3NpbmcgVVJMJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdQbGVhc2UgcHJvdmlkZSBhIFlvdVR1YmUgVVJMJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gUHJvY2Vzc2luZyBVUkw6ICR7dXJsfWApO1xuXG4gICAgICAgIC8vIFNURVAgMzogRXh0cmFjdCBhbmQgdmFsaWRhdGUgWW91VHViZSB2aWRlbyBJRFxuICAgICAgICBjb25zdCB2aWRlb0lkID0gZXh0cmFjdFlvdVR1YmVJZCh1cmwpO1xuICAgICAgICBpZiAoIXZpZGVvSWQgfHwgIWlzVmFsaWRZb3VUdWJlSWQodmlkZW9JZCkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBJbnZhbGlkIFlvdVR1YmUgVVJMOicsIHVybCk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIFlvdVR1YmUgVVJMJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGUgcHJvdmlkZWQgVVJMIGlzIG5vdCBhIHZhbGlkIFlvdVR1YmUgdmlkZW8gVVJMJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gVmFsaWQgWW91VHViZSBJRDogJHt2aWRlb0lkfWApO1xuXG4gICAgICAgIC8vIFNURVAgNDogQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIG5vdGVzIGZvciB0aGlzIHZpZGVvXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ05vdGUsIGVycm9yOiBleGlzdGluZ0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3ZpZGVvX25vdGVzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCB2aWRlb19pZCcpXG4gICAgICAgICAgICAuZXEoJ3ZpZGVvX2lkJywgdmlkZW9JZClcbiAgICAgICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpXG4gICAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgICBpZiAoZXhpc3RpbmdOb3RlICYmICFleGlzdGluZ0Vycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gTm90ZXMgYWxyZWFkeSBleGlzdCBmb3IgdmlkZW86ICR7dmlkZW9JZH1gKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcjogJ0R1cGxpY2F0ZSBub3RlJyxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdGVzIGZvciB0aGlzIHZpZGVvIGFscmVhZHkgZXhpc3QnLFxuICAgICAgICAgICAgICBub3RlSWQ6IGV4aXN0aW5nTm90ZS5pZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGNoZWNrRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBFcnJvciBjaGVja2luZyBmb3IgZXhpc3Rpbmcgbm90ZXM6JywgY2hlY2tFcnJvcik7XG4gICAgICAgICAgLy8gQ29udGludWUgcHJvY2Vzc2luZyAtIHRoaXMgaXMgbm90IGEgY3JpdGljYWwgZXJyb3JcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNURVAgNTogR2V0IHZpZGVvIGluZm9ybWF0aW9uICh0aXRsZSwgdGh1bWJuYWlsLCBldGMuKVxuICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gRmV0Y2hpbmcgdmlkZW8gaW5mb3JtYXRpb24nKTtcbiAgICAgICAgY29uc3QgdmlkZW9JbmZvID0gYXdhaXQgZ2V0VmlkZW9JbmZvKHZpZGVvSWQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCF2aWRlb0luZm8gfHwgdmlkZW9JbmZvLmVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gRmFpbGVkIHRvIGdldCB2aWRlbyBpbmZvOicsIHZpZGVvSW5mbz8uZXJyb3IgfHwgJ1Vua25vd24gZXJyb3InKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogJ1ZpZGVvIGluZm8gZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogdmlkZW9JbmZvPy5lcnJvciB8fCAnRmFpbGVkIHRvIHJldHJpZXZlIHZpZGVvIGluZm9ybWF0aW9uJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBWaWRlbyBpbmZvIHJldHJpZXZlZDogXCIke3ZpZGVvSW5mby50aXRsZX1cImApO1xuXG4gICAgICAgIC8vIFNURVAgNjogRmV0Y2ggdmlkZW8gdHJhbnNjcmlwdFxuICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gRmV0Y2hpbmcgdmlkZW8gdHJhbnNjcmlwdCcpO1xuICAgICAgICBjb25zdCB0cmFuc2NyaXB0UmVzdWx0ID0gYXdhaXQgZ2V0VmlkZW9UcmFuc2NyaXB0KHZpZGVvSWQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCF0cmFuc2NyaXB0UmVzdWx0IHx8IHRyYW5zY3JpcHRSZXN1bHQuZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBUcmFuc2NyaXB0IGVycm9yOicsIHRyYW5zY3JpcHRSZXN1bHQ/LmVycm9yIHx8ICdVbmtub3duIGVycm9yJyk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6ICdUcmFuc2NyaXB0IGVycm9yJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRyYW5zY3JpcHRSZXN1bHQ/LmVycm9yIHx8ICdGYWlsZWQgdG8gZXh0cmFjdCB0cmFuc2NyaXB0IGZyb20gdGhlIHZpZGVvJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICghdHJhbnNjcmlwdFJlc3VsdC50cmFuc2NyaXB0IHx8IHRyYW5zY3JpcHRSZXN1bHQudHJhbnNjcmlwdC50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gRW1wdHkgdHJhbnNjcmlwdCcpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiAnRW1wdHkgdHJhbnNjcmlwdCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVGhlIHZpZGVvIGRvZXMgbm90IGhhdmUgYW55IGV4dHJhY3RhYmxlIGNvbnRlbnQgZm9yIG5vdGVzJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBUcmFuc2NyaXB0IHJldHJpZXZlZCAoJHt0cmFuc2NyaXB0UmVzdWx0LnRyYW5zY3JpcHQubGVuZ3RofSBjaGFycylgKTtcblxuICAgICAgICAvLyBTVEVQIDc6IEdlbmVyYXRlIG5vdGVzIHVzaW5nIEFJXG4gICAgICAgIGNvbnNvbGUubG9nKCdbVmlkZW8gTm90ZXMgQVBJXSBHZW5lcmF0aW5nIG5vdGVzIGZyb20gdHJhbnNjcmlwdCcpO1xuICAgICAgICBjb25zdCBub3Rlc1Jlc3VsdCA9IGF3YWl0IGdlbmVyYXRlTm90ZXMoe1xuICAgICAgICAgIHRyYW5zY3JpcHQ6IHRyYW5zY3JpcHRSZXN1bHQudHJhbnNjcmlwdCxcbiAgICAgICAgICB2aWRlb1RpdGxlOiB2aWRlb0luZm8udGl0bGVcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIW5vdGVzUmVzdWx0LmNvbnRlbnQpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBBSSBub3RlIGdlbmVyYXRpb24gZmFpbGVkOicsIG5vdGVzUmVzdWx0LmVycm9yKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogJ05vdGUgZ2VuZXJhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgICAgbWVzc2FnZTogbm90ZXNSZXN1bHQuZXJyb3IgfHwgJ0ZhaWxlZCB0byBnZW5lcmF0ZSBub3RlcyBmcm9tIHRoZSB0cmFuc2NyaXB0J1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBTdWNjZXNzZnVsbHkgZ2VuZXJhdGVkIG5vdGVzICgke25vdGVzUmVzdWx0LmNvbnRlbnQubGVuZ3RofSBjaGFycylgKTtcblxuICAgICAgICAvLyBTVEVQIDg6IENyZWF0ZSB0aGUgbm90ZSByZWNvcmQgZm9yIGlzb2xhdGVkIHZpZGVvX25vdGVzIHRhYmxlXG4gICAgICAgIGNvbnN0IG5vdGVJZCA9IGB2aWRlb18ke0RhdGUubm93KCl9YDtcbiAgICAgICAgY29uc3Qgbm90ZURhdGEgPSB7XG4gICAgICAgICAgaWQ6IG5vdGVJZCxcbiAgICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLFxuICAgICAgICAgIHZpZGVvX3VybDogdXJsLFxuICAgICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkLFxuICAgICAgICAgIHRpdGxlOiBjdXN0b21UaXRsZSB8fCB2aWRlb0luZm8udGl0bGUsXG4gICAgICAgICAgdGh1bWJuYWlsX3VybDogdmlkZW9JbmZvLnRodW1ibmFpbFVybCxcbiAgICAgICAgICBjb250ZW50OiBub3Rlc1Jlc3VsdC5jb250ZW50LFxuICAgICAgICAgIHN1bW1hcnk6IG5vdGVzUmVzdWx0LnN1bW1hcnksXG4gICAgICAgICAgcXVpejogbm90ZXNSZXN1bHQucXVpeixcbiAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gQ3JlYXRlZCBub3RlIHdpdGggSUQ6ICR7bm90ZUlkfWApO1xuICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gTm90ZSBkYXRhIHN0cnVjdHVyZTonLCBPYmplY3Qua2V5cyhub3RlRGF0YSkuam9pbignLCAnKSk7XG5cbiAgICAgICAgLy8gU1RFUCA5OiBTdG9yZSB0aGUgbm90ZSBpbiBTdXBhYmFzZSB2aWRlb19ub3RlcyB0YWJsZVxuICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gU3RvcmluZyBub3RlIGluIFN1cGFiYXNlIHZpZGVvX25vdGVzIHRhYmxlJyk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFZlcmlmeSBkYXRhYmFzZSBjb25uZWN0aW9uIGJlZm9yZSBhdHRlbXB0aW5nIGluc2VydFxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IGVycm9yOiBwaW5nRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3ZpZGVvX25vdGVzJykuc2VsZWN0KCdjb3VudCcpLmxpbWl0KDEpO1xuICAgICAgICAgICAgaWYgKHBpbmdFcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBEYXRhYmFzZSBjb25uZWN0aW9uIGNoZWNrIGZhaWxlZDonLCBwaW5nRXJyb3IpO1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnRGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcicsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvdWxkIG5vdCBjb25uZWN0IHRvIHRoZSBkYXRhYmFzZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nLFxuICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgIGNvZGU6IHBpbmdFcnJvci5jb2RlLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogcGluZ0Vycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAocGluZ0V4Y2VwdGlvbikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gRGF0YWJhc2UgcGluZyBleGNlcHRpb246JywgcGluZ0V4Y2VwdGlvbik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKCd2aWRlb19ub3RlcycpXG4gICAgICAgICAgICAuaW5zZXJ0KG5vdGVEYXRhKVxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuc2luZ2xlKCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBEYXRhYmFzZSBzdG9yYWdlIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTG9nIGRldGFpbGVkIGRpYWdub3N0aWMgaW5mb3JtYXRpb25cbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIERhdGFiYXNlIGVycm9yIGRldGFpbHM6Jywge1xuICAgICAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzLFxuICAgICAgICAgICAgICBoaW50OiBlcnJvci5oaW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIGRhdGFiYXNlIGVycm9ycyB3aXRoIGFwcHJvcHJpYXRlIHN0YXR1cyBjb2Rlc1xuICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHsgLy8gVW5pcXVlIHZpb2xhdGlvblxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnRHVwbGljYXRlIHJlY29yZCcsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdGVzIGZvciB0aGlzIHZpZGVvIGFscmVhZHkgZXhpc3QgaW4gdGhlIGRhdGFiYXNlJyxcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IuY29kZT8uc3RhcnRzV2l0aCgnMjInKSB8fCBlcnJvci5jb2RlPy5zdGFydHNXaXRoKCcyMycpKSB7XG4gICAgICAgICAgICAgIC8vIERhdGEgZXhjZXB0aW9uICgyMikgb3IgaW50ZWdyaXR5IGNvbnN0cmFpbnQgdmlvbGF0aW9uICgyMylcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgZGF0YSBmb3JtYXQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGUgbm90ZSBkYXRhIGNvdWxkIG5vdCBiZSBzdG9yZWQgZHVlIHRvIHZhbGlkYXRpb24gZXJyb3JzJyxcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IuY29kZSA9PT0gJzQyUDAxJykge1xuICAgICAgICAgICAgICAvLyBVbmRlZmluZWQgdGFibGVcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ1NjaGVtYSBlcnJvcicsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoZSB2aWRlb19ub3RlcyB0YWJsZSBkb2VzIG5vdCBleGlzdC4gUGxlYXNlIHJ1biB0aGUgZGF0YWJhc2UgaW5pdGlhbGl6YXRpb24uJyxcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yOiAnRGF0YWJhc2UgZXJyb3InLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHN0b3JlIHRoZSBub3RlcyBpbiB0aGUgZGF0YWJhc2UnLFxuICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBTdWNjZXNzZnVsbHkgc3RvcmVkIG5vdGUgaW4gZGF0YWJhc2Ugd2l0aCBJRDogJHtkYXRhPy5pZCB8fCBub3RlSWR9YCk7XG5cbiAgICAgICAgICAvLyBTVEVQIDEwLjU6IFRyYWNrIHVzYWdlIGFmdGVyIHN1Y2Nlc3NmdWwgY3JlYXRpb25cbiAgICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gSW5jcmVtZW50aW5nIHVzYWdlIGNvdW50ZXJzJyk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGluY3JlbWVudFVzYWdlKHVzZXIuaWQsIHRva2VuLCAndmlkZW8nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbVmlkZW8gTm90ZXMgQVBJXSBVc2FnZSB0cmFja2luZyBjb21wbGV0ZWQnKTtcbiAgICAgICAgICB9IGNhdGNoICh1c2FnZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBVc2FnZSB0cmFja2luZyBmYWlsZWQgKG5vdGUgc3RpbGwgY3JlYXRlZCk6JywgdXNhZ2VFcnJvcik7XG4gICAgICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSByZXF1ZXN0IGlmIHVzYWdlIHRyYWNraW5nIGZhaWxzXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU1RFUCAxMC42OiBSZWZyZXNoIHNhdmVkIG5vdGVzIGNvdW50XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tWaWRlbyBOb3RlcyBBUEldIFJlZnJlc2hpbmcgc2F2ZWQgbm90ZXMgY291bnQnKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgcmVmcmVzaFNhdmVkTm90ZXNDb3VudCh1c2VyLmlkLCB0b2tlbik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gU2F2ZWQgbm90ZXMgY291bnQgcmVmcmVzaGVkJyk7XG4gICAgICAgICAgfSBjYXRjaCAoY291bnRFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gU2F2ZWQgbm90ZXMgY291bnQgcmVmcmVzaCBmYWlsZWQgKG5vdGUgc3RpbGwgY3JlYXRlZCk6JywgY291bnRFcnJvcik7XG4gICAgICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSByZXF1ZXN0IGlmIGNvdW50IHJlZnJlc2ggZmFpbHNcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChkYkVycm9yOiBhbnkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBVbmV4cGVjdGVkIGRhdGFiYXNlIGVycm9yOicsIGRiRXJyb3IpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiAnRGF0YWJhc2UgZXhjZXB0aW9uJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGRiRXJyb3I/Lm1lc3NhZ2UgfHwgJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQgd2hpbGUgc3RvcmluZyBub3RlcycsXG4gICAgICAgICAgICBkZXRhaWxzOiBkYkVycm9yXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0KTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIENyaXRpY2FsIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ1NlcnZlciBlcnJvcicsXG4gICAgICBtZXNzYWdlOiAnQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCBvbiB0aGUgc2VydmVyJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLm1lc3NhZ2VcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGFsbCB2aWRlbyBub3RlcyBmb3IgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnNvbGUubG9nKCdbVmlkZW8gTm90ZXMgQVBJXSBSZXF1ZXN0IHJlY2VpdmVkOiBHRVQnKTtcblxuICB0cnkge1xuICAgIC8vIFNURVAgMTogQXV0aGVudGljYXRlIHRoZSByZXF1ZXN0XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBBdXRoZW50aWNhdGlvbiBtaXNzaW5nJyk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICBtZXNzYWdlOiAnVmFsaWQgQmVhcmVyIHRva2VuIGlzIHJlcXVpcmVkJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIFN1cGFiYXNlIGNsaWVudCB3aXRoIHRoZSB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5yZXBsYWNlKCdCZWFyZXIgJywgJycpO1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGdsb2JhbDoge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIC8vIFZlcmlmeSB0aGUgdXNlcidzIHRva2VuIGFuZCBzZXQgdGhlIHNlc3Npb25cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIodG9rZW4pO1xuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIEF1dGhlbnRpY2F0aW9uIGZhaWxlZDonLCBhdXRoRXJyb3I/Lm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcsXG4gICAgICAgIG1lc3NhZ2U6IGF1dGhFcnJvcj8ubWVzc2FnZSB8fCAnSW52YWxpZCBhdXRoZW50aWNhdGlvbiB0b2tlbidcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBVc2VyIGF1dGhlbnRpY2F0ZWQ6ICR7dXNlci5pZH1gKTtcblxuICAgIC8vIFNURVAgMjogRmV0Y2ggdGhlIHVzZXIncyB2aWRlbyBub3Rlc1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndmlkZW9fbm90ZXMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuICAgICAgXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBEYXRhYmFzZSBmZXRjaCBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdEYXRhYmFzZSBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdmlkZW8gbm90ZXMgZnJvbSB0aGUgZGF0YWJhc2UnLFxuICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgICAgIH1cbiAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBTdWNjZXNzZnVsbHkgZmV0Y2hlZCAke2RhdGEubGVuZ3RofSB2aWRlbyBub3Rlc2ApO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBFcnJvciBmZXRjaGluZyB2aWRlbyBub3RlczonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdTZXJ2ZXIgZXJyb3InLFxuICAgICAgbWVzc2FnZTogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQgd2hpbGUgZmV0Y2hpbmcgdmlkZW8gbm90ZXMnLFxuICAgICAgZGV0YWlsczogZXJyb3IubWVzc2FnZVxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBEZWxldGUgYSBzcGVjaWZpYyB2aWRlbyBub3RlIGZvciB0aGUgYXV0aGVudGljYXRlZCB1c2VyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc29sZS5sb2coJ1tWaWRlbyBOb3RlcyBBUEldIFJlcXVlc3QgcmVjZWl2ZWQ6IERFTEVURScpO1xuXG4gIHRyeSB7XG4gICAgLy8gU1RFUCAxOiBBdXRoZW50aWNhdGUgdGhlIHJlcXVlc3RcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIEF1dGhlbnRpY2F0aW9uIG1pc3NpbmcnKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZCBCZWFyZXIgdG9rZW4gaXMgcmVxdWlyZWQnXG4gICAgICB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIC8vIEluaXRpYWxpemUgU3VwYWJhc2UgY2xpZW50IHdpdGggdGhlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gVmVyaWZ5IHRoZSB1c2VyJ3MgdG9rZW4gYW5kIHNldCB0aGUgc2Vzc2lvblxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcih0b2tlbik7XG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gQXV0aGVudGljYXRpb24gZmFpbGVkOicsIGF1dGhFcnJvcj8ubWVzc2FnZSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQXV0aGVudGljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogYXV0aEVycm9yPy5tZXNzYWdlIHx8ICdJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHRva2VuJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtWaWRlbyBOb3RlcyBBUEldIFVzZXIgYXV0aGVudGljYXRlZDogJHt1c2VyLmlkfWApO1xuXG4gICAgLy8gU1RFUCAyOiBHZXQgdGhlIG5vdGUgSUQgZnJvbSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgY29uc3Qgbm90ZUlkID0gcmVxdWVzdC5uZXh0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2lkJyk7XG4gICAgaWYgKCFub3RlSWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIE5vdGUgSUQgbWlzc2luZycpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnTWlzc2luZyBub3RlIElEJyxcbiAgICAgICAgbWVzc2FnZTogJ05vdGUgSUQgaXMgcmVxdWlyZWQgZm9yIGRlbGV0aW9uJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhgW1ZpZGVvIE5vdGVzIEFQSV0gRGVsZXRpbmcgbm90ZSB3aXRoIElEOiAke25vdGVJZH1gKTtcblxuICAgIC8vIFNURVAgMzogRGVsZXRlIHRoZSBub3RlICh3aXRoIHVzZXIgb3duZXJzaGlwIGNoZWNrKVxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndmlkZW9fbm90ZXMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ2lkJywgbm90ZUlkKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZCkgLy8gRW5zdXJlIHVzZXIgY2FuIG9ubHkgZGVsZXRlIHRoZWlyIG93biBub3Rlc1xuICAgICAgLnNlbGVjdCgpO1xuICAgICAgXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbVmlkZW8gTm90ZXMgQVBJXSBEYXRhYmFzZSBkZWxldGUgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRGF0YWJhc2UgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlbGV0ZSB0aGUgbm90ZSBmcm9tIHRoZSBkYXRhYmFzZScsXG4gICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgfVxuICAgICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgYW55IHJvd3Mgd2VyZSBhZmZlY3RlZFxuICAgIGlmICghZGF0YSB8fCBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS5lcnJvcihgW1ZpZGVvIE5vdGVzIEFQSV0gTm90ZSBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZDogJHtub3RlSWR9YCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdOb3RlIG5vdCBmb3VuZCcsXG4gICAgICAgIG1lc3NhZ2U6ICdUaGUgbm90ZSB3YXMgbm90IGZvdW5kIG9yIHlvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGRlbGV0ZSBpdCdcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDQgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbVmlkZW8gTm90ZXMgQVBJXSBTdWNjZXNzZnVsbHkgZGVsZXRlZCBub3RlOiAke25vdGVJZH1gKTtcblxuICAgIC8vIFJlZnJlc2ggc2F2ZWQgbm90ZXMgY291bnQgYWZ0ZXIgZGVsZXRpb25cbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmVmcmVzaFNhdmVkTm90ZXNDb3VudCh1c2VyLmlkLCB0b2tlbik7XG4gICAgICBjb25zb2xlLmxvZygnW1ZpZGVvIE5vdGVzIEFQSV0gU2F2ZWQgbm90ZXMgY291bnQgcmVmcmVzaGVkIGFmdGVyIGRlbGV0aW9uJyk7XG4gICAgfSBjYXRjaCAoY291bnRFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1ZpZGVvIE5vdGVzIEFQSV0gU2F2ZWQgbm90ZXMgY291bnQgcmVmcmVzaCBmYWlsZWQgYWZ0ZXIgZGVsZXRpb246JywgY291bnRFcnJvcik7XG4gICAgICAvLyBEb24ndCBmYWlsIHRoZSByZXF1ZXN0IGlmIGNvdW50IHJlZnJlc2ggZmFpbHNcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdOb3RlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGRhdGE6IGRhdGFbMF1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tWaWRlbyBOb3RlcyBBUEldIEVycm9yIGRlbGV0aW5nIHZpZGVvIG5vdGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnU2VydmVyIGVycm9yJyxcbiAgICAgIG1lc3NhZ2U6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIHdoaWxlIGRlbGV0aW5nIHRoZSBub3RlJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLm1lc3NhZ2VcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8vIENvbmZpZ3VyZSBkeW5hbWljIGJlaGF2aW9yIHRvIGF2b2lkIGNhY2hpbmdcbmV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnOyAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY3JlYXRlQ2xpZW50IiwiZXh0cmFjdFlvdVR1YmVJZCIsImdldFZpZGVvSW5mbyIsImdldFZpZGVvVHJhbnNjcmlwdCIsImlzVmFsaWRZb3VUdWJlSWQiLCJnZW5lcmF0ZU5vdGVzIiwiY2hlY2tVc2FnZUxpbWl0cyIsImluY3JlbWVudFVzYWdlIiwicmVmcmVzaFNhdmVkTm90ZXNDb3VudCIsInF1ZXVlUmVxdWVzdCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZ2V0U3Vic2NyaXB0aW9uUGxhbiIsInVzZXJJZCIsInN1cGFiYXNlIiwiZGF0YSIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInBsYW5JZCIsInBsYW5faWQiLCJlcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiUE9TVCIsInJlcXVlc3QiLCJsb2ciLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInN0YXJ0c1dpdGgiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJ0b2tlbiIsInJlcGxhY2UiLCJnbG9iYWwiLCJBdXRob3JpemF0aW9uIiwidXNlciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRVc2VyIiwiaWQiLCJ1c2FnZUNoZWNrIiwiY2FuR2VuZXJhdGUiLCJyZWFzb24iLCJ1c2FnZSIsImxpbWl0cyIsImNhblNhdmUiLCJzdWJzY3JpcHRpb24iLCJyZXN1bHQiLCJib2R5IiwidXJsIiwidGl0bGUiLCJjdXN0b21UaXRsZSIsInZpZGVvSWQiLCJleGlzdGluZ05vdGUiLCJleGlzdGluZ0Vycm9yIiwibm90ZUlkIiwiY2hlY2tFcnJvciIsInZpZGVvSW5mbyIsInRyYW5zY3JpcHRSZXN1bHQiLCJ0cmFuc2NyaXB0IiwidHJpbSIsImxlbmd0aCIsIm5vdGVzUmVzdWx0IiwidmlkZW9UaXRsZSIsImNvbnRlbnQiLCJEYXRlIiwibm93Iiwibm90ZURhdGEiLCJ1c2VyX2lkIiwidmlkZW9fdXJsIiwidmlkZW9faWQiLCJ0aHVtYm5haWxfdXJsIiwidGh1bWJuYWlsVXJsIiwic3VtbWFyeSIsInF1aXoiLCJjcmVhdGVkX2F0IiwidG9JU09TdHJpbmciLCJPYmplY3QiLCJrZXlzIiwiam9pbiIsInBpbmdFcnJvciIsImxpbWl0IiwiZGV0YWlscyIsImNvZGUiLCJwaW5nRXhjZXB0aW9uIiwiaW5zZXJ0IiwiaGludCIsInVzYWdlRXJyb3IiLCJjb3VudEVycm9yIiwiZGJFcnJvciIsIkdFVCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiREVMRVRFIiwibmV4dFVybCIsInNlYXJjaFBhcmFtcyIsImRlbGV0ZSIsImR5bmFtaWMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/video-notes/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/ai.ts":
/*!****************************!*\
  !*** ./src/services/ai.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateNotes: () => (/* binding */ generateNotes)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _utils_splitTranscript__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/splitTranscript */ \"(rsc)/./src/utils/splitTranscript.ts\");\n\n\n// Validate API key presence\nconst openaiApiKey = process.env.OPENAI_API_KEY;\nif (!openaiApiKey) {\n    console.error(\"[OpenAI] API key is missing from environment variables!\");\n}\n// Initialize OpenAI client with error handling\nlet openai = null;\ntry {\n    openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n        apiKey: openaiApiKey\n    });\n} catch (error) {\n    console.error(\"[OpenAI] Failed to initialize client:\", error);\n}\nconst MAX_RETRIES = 2;\nconst RETRY_DELAY = 1000; // 1 second\n/**\n * Delays execution for specified milliseconds\n */ const delay = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));\n/**\n * Processes a single chunk of transcript using OpenAI with retries\n */ async function processChunkWithRetry(chunk, retryCount = 0) {\n    try {\n        // Validate OpenAI client initialization\n        if (!openai) {\n            throw new Error(\"OpenAI client is not initialized\");\n        }\n        // Validate chunk size\n        if (!(0,_utils_splitTranscript__WEBPACK_IMPORTED_MODULE_0__.isChunkWithinTokenLimit)(chunk)) {\n            throw new Error(\"Chunk exceeds token limit\");\n        }\n        console.log(`[OpenAI] Processing chunk ${chunk.index} (${chunk.content.length} chars)`);\n        const startTime = Date.now();\n        // Add timeout to prevent long-running requests\n        const timeoutPromise = new Promise((_, reject)=>{\n            setTimeout(()=>reject(new Error(\"Request timeout\")), 60000); // 60 second timeout\n        });\n        // Enhanced educational prompt for structured notes with deep semantic content\n        const completionPromise = openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: `You are an expert educational content creator, researcher, and teacher with deep knowledge across multiple domains. Create comprehensive, high-quality study notes with exceptional educational value and semantic depth.\n\nCRITICAL REQUIREMENTS:\n- Write in Polish\n- DO NOT include the original source text or transcript\n- Create ONLY summarized, structured educational notes with deep explanations\n- Use clear markdown formatting with proper headings\n- Structure like professional university-level study materials\n- Focus on DEEP SEMANTIC UNDERSTANDING and practical applications\n- ABSOLUTELY NO TABLES OF ANY KIND - NEVER USE | symbols or table syntax\n- AVOID REPETITIVE CONTENT - each concept should be explained once thoroughly\n- Provide CONCRETE TECHNIQUES, METHODS, and DETAILED EXPLANATIONS instead of generic statements\n\n FORBIDDEN CONTENT PATTERNS:\n- Vague statements like \"istniej metody\" without listing them\n- Repetitive explanations of the same concept across sections\n- Superficial overviews without depth\n- Generic advice without specific techniques\n- Any table format (| symbols, markdown tables, HTML tables)\n- \"Notatki:\" prefixes in titles\n\n REQUIRED DEPTH AND QUALITY:\n- When mentioning techniques, LIST AND EXPLAIN them in detail\n- Provide step-by-step processes where applicable\n- Include specific examples, formulas, or procedures\n- Explain WHY concepts work, not just WHAT they are\n- Connect concepts to real-world applications\n- Give concrete, actionable information\n\nFORMATTING GUIDELINES - PROFESSIONAL & READABLE:\n- Start with a clear title using ## WITHOUT \"Notatki:\" prefix (e.g., ##  Techniki Efektywnego Uczenia)\n- Add one-sentence topic description right after title\n- Include \" Przegld Materiau\" section at top (5-6 bullet points max covering main concepts)\n- Use #### for main sections with emojis and numbering (e.g., #### 1.  Technika Pomodoro)\n- Use ##### for subsections when needed\n- Use moderate spacing between sections\n\nCONTENT STRUCTURE REQUIREMENTS:\n- REPLACE ALL TABLES with detailed bullet lists using \"Feature: Explanation\" format\n- Use **bold** sparingly for only the most important terms\n- Highlight key definitions with  icon: \" **Definicja:** *Term* - comprehensive explanation with context...\"\n- Highlight important concepts with  icon: \" **Kluczowy mechanizm:** detailed explanation of how it works...\"\n- For techniques, use step-by-step format:\n  **Implementacja techniki:**\n  1. **Krok 1**: szczegowy opis dziaania\n  2. **Krok 2**: konkretne instrukcje\n  3. **Krok 3**: praktyczne wskazwki\n- Add section numbering (1., 2., 3.) for main topics\n- NEVER repeat the same definitions or explanations across sections\n\nEDUCATIONAL DEPTH REQUIREMENTS:\nWhen discussing any topic, you MUST:\n1. **Define precisely** - not just \"what is X\" but \"what is X, how does it work, and why is it important\"\n2. **List specific methods** - if mentioning \"techniques\" or \"methods\", always provide concrete examples:\n   - Instead of: \"istniej techniki zapamitywania\"\n   - Write: \"techniki zapamitywania obejmuj: Metod Paacu Pamici (wizualizacja przestrzenna), System Powtrek Rozoonych w Czasie (algorytm SM-2), Aktywne Przypominanie (retrieval practice), oraz Technik Feynmana (wyjanianie prostymi sowami)\"\n3. **Explain mechanisms** - describe HOW and WHY things work\n4. **Provide procedures** - give step-by-step instructions for practical applications\n5. **Include real examples** - concrete scenarios, calculations, or implementations\n\nALTERNATIVE COMPARISON FORMATS (instead of tables):\n1. **Detailed Comparison Lists**:\n   **Rnice midzy metod A i B:**\n   - **Efektywno**: Metoda A osiga 85% skuteczno w badaniach kontrolowanych, podczas gdy metoda B pokazuje 72% skuteczno\n   - **Implementacja**: A wymaga 15-20 minut przygotowania, B mona zastosowa natychmiast\n   - **Zastosowanie**: A dziaa najlepiej przy materiale faktograficznym, B przy koncepcjach abstrakcyjnych\n   \n2. **Sequential Detailed Descriptions**:\n   **Metoda A - Szczegowy Opis:**\n   - **Procedura**: Dokadne kroki 1-5 z czasem wykonania\n   - **Mechanizm dziaania**: Neurologiczne podstawy skutecznoci\n   - **Optymalizacja**: Konkretne wskazwki dostosowania do rnych typw treci\n\nREQUIRED SECTIONS:\n1. **Title with emoji but NO \"Notatki:\" prefix** (just the topic name)\n2. ** Przegld Materiau** (5-6 comprehensive overview points)\n3. **Numbered main sections** with deep content (aim for 3-4 major sections)\n4. **Detailed subsections** with specific techniques, methods, formulas\n5. **Section summaries after each major section** (paragraph style recap)\n6. ** Szybkie Streszczenie** (3-6 lines max at very end) - NOT \"TL;DR\"\n\nSECTION SUMMARIES (ESSENTIAL):\nAfter each major section (####), add a substantive summary:\n> **Podsumowanie sekcji:** [4-6 sentence detailed explanation connecting all concepts from the section, explaining practical implications and how the techniques integrate with broader understanding]\n\nSEMANTIC DEPTH EXAMPLES:\n AVOID: \"Technika Pomodoro jest metod zarzdzania czasem\"\n PROVIDE: \"Technika Pomodoro jest metod zarzdzania czasem opart na badaniach neuronaukowych dotyczcych cykli uwagi. Polega na podziale pracy na 25-minutowe bloki (pomodoros) z 5-minutowymi przerwami, wykorzystujc naturalny rytm uwagi mzgu i zapobiegajc zmczeniu poznawczemu poprzez aktywn regeneracj prefrontalnej kory mzgowej.\"\n\n AVOID: \"Istniej rne metody uczenia\"\n PROVIDE: \"Gwne metody uczenia oparte na dowodach naukowych to: 1) Aktywne Przypominanie (retrieval practice) - aktywne odtwarzanie informacji z pamici, co wzmacnia cieki neuronalne; 2) Powtrki Rozoone (spaced repetition) - algorytmiczne planowanie powtrek w optymalnych odstpach czasu; 3) Naprzemienne Uczenie (interleaving) - mieszanie rnych typw zada dla lepszej dyskryminacji poj; 4) Elaborative Interrogation - zadawanie pyta 'dlaczego' i 'jak' dla gbszego zrozumienia mechanizmw.\"\n\nVISUAL ENHANCEMENTS - BALANCED APPROACH:\n- Use emojis strategically for sections and key concepts\n- Format definitions as: \" **Definicja:** *Term* - comprehensive explanation with scientific background\"\n- Format key mechanisms as: \" **Kluczowy mechanizm:** detailed explanation of how and why it works\"\n- Use \" *Procedura:*\" for step-by-step instructions\n- Use \" *Przykad:*\" for concrete examples with specific details\n- Use \" *Optymalizacja:*\" for advanced tips and customization\n- NEVER use any table format\n- Use moderate spacing and balanced formatting\n\nEXAMPLE STRUCTURE:\n##  Techniki Efektywnego Uczenia\nZaawansowane metody optymalizacji procesw poznawczych oparte na najnowszych badaniach neuronaukowych i psychologii kognitywnej.\n\n###  Przegld Materiau\n- Aktywne Przypominanie jako najskuteczniejsza metoda wzmacniania pamici dugotrwaej\n- System Powtrek Rozoonych w Czasie z algorytmem SM-2 dla optymalnego planowania\n- Technika Pomodoro wykorzystujca naturalne cykle uwagi i regeneracji neuronowej\n- Metoda Feynmana dla gbokiego zrozumienia przez aktywne wyjanianie\n- Interleaving jako strategia poprawy dyskryminacji pojciowej\n- Neuroplastyczno i jej praktyczne zastosowania w procesie uczenia\n\n#### 1.  Aktywne Przypominanie (Retrieval Practice)\n\n **Definicja:** *Aktywne Przypominanie* - metoda uczenia polegajca na aktywnym odtwarzaniu informacji z pamici bez pomocy materiaw rdowych, ktra wedug bada Hermann Ebbinghausa i wspczesnych neuronaukowcw zwiksza si pocze synaptycznych o 300-400% w porwnaniu do biernego powtarzania.\n\n**Mechanizm neurologiczny:**\n- **Wzmocnienie cieek neuronowych**: Kade aktywne przypomnienie aktywuje te same cieki neuronowe co pierwotne uczenie\n- **Konsolidacja pamici**: Proces ten przenosi informacje z hipokampa do kory mzgowej dla dugotrwaego przechowywania\n- **Efekt testowania**: Prba przypomnienia, nawet nieudana, wzmacnia pami lepiej ni wielokrotne czytanie\n\n *Procedura implementacji:*\n1. **Przygotowanie materiau** (5 min): Podziel tre na logiczne sekcje po 200-300 sw\n2. **Pierwsza lektura** (15-20 min): Przeczytaj uwanie z penym skupieniem\n3. **Zamknicie materiau** (0 min): Cakowicie usu dostp do notatek\n4. **Aktywne odtworzenie** (10-15 min): Napisz lub wypowiedz wszystko co pamitasz\n5. **Weryfikacja i uzupenienie** (5-10 min): Porwnaj z oryginaem i uzupenij luki\n6. **Powtrka po 24h**: Wykonaj ponownie kroki 3-5 bez ponownej lektury\n\n *Przykad praktyczny:*\nPrzy nauce biochemii: zamiast wielokrotnego czytania o cyklu Krebsa, narysuj peny schemat z pamici z nazwami wszystkich 8 etapw, enzymw i produktw. Sprawd dokadno i uzupenij bdy. Powtrz za tydzie.\n\n> **Podsumowanie sekcji:** Aktywne Przypominanie wykorzystuje fundamentalne waciwoci neuroplastycznoci mzgu, gdzie kada prba odtworzenia z pamici wzmacnia poczenia synaptyczne. Technika ta jest szczeglnie skuteczna przy materiaach faktograficznych i procedurach, gdzie kluczowe jest precyzyjne zapamitanie sekwencji lub definicji. Regularne stosowanie tej metody prowadzi do trwaej reorganizacji sieci neuronowych, co przekada si na znacznie lepsze wyniki w testach dugoterminowych ni tradycyjne metody powtarzania.\n\n#### 2.  System Powtrek Rozoonych (Spaced Repetition)\n\n **Definicja:** *System Powtrek Rozoonych* - algorytmiczny system planowania powtrek oparty na krzywej zapominania Ebbinghausa, ktry optymalizuje interway midzy powtrkami tak, aby maksymalizowa retencj przy minimalnym nakadzie czasowym.\n\n**Algorytm SM-2 (SuperMemo):**\n- **Interwa 1**: 1 dzie\n- **Interwa 2**: 6 dni  \n- **Interwa n+1**: Interwa n  Wspczynnik atwoci (EF)\n- **Wspczynnik atwoci**: 1.3-2.5 w zalenoci od trudnoci (automatycznie dostosowywany)\n\n *Procedura implementacji cyfrowej:*\n1. **Wybr narzdzia**: Anki, SuperMemo, lub Quizlet z funkcj SR\n2. **Tworzenie kart**: Jedna informacja na kart (atomic principle)\n3. **Format pytanie-odpowied**: Konkretne, jednoznaczne sformuowania\n4. **Codzienna sesja**: 15-30 minut o staej porze\n5. **Ocena trudnoci**: Szczerze oce atwo przypomnienia (1-5)\n6. **Konsystencja**: Minimum 80% dni w miesicu dla efektywnoci\n\n *Optymalizacja zaawansowana:*\n- **Cloze deletion**: Uzupenianie luk w kontekcie (lepsze ni proste Q&A)\n- **Image occlusion**: Zakrywanie czci diagramw/map\n- **Reverse cards**: Dwukierunkowe karty dla zwizkw przyczynowo-skutkowych\n\n> **Podsumowanie sekcji:** System Powtrek Rozoonych wykorzystuje matematyczn precyzj algorytmu SM-2 do optymalizacji naturalnego procesu zapominania. Kluczem sukcesu jest konsystentno i waciwe dostosowanie wspczynnikw trudnoci do indywidualnych moliwoci kognitywnych. System ten jest szczeglnie skuteczny przy nauce jzykw obcych, terminologii medycznej i innych materiaach wymagajcych dugotrwaej retencji faktw.\n\n###  Szybkie Streszczenie\n- **Aktywne Przypominanie**: Odtwarzanie z pamici wzmacnia cieki neuronowe 3-4x skuteczniej ni czytanie\n- **Powtrki Rozoone**: Algorytm SM-2 optymalizuje interway dla maksymalnej retencji przy minimalnym czasie\n- **Implementacja**: Codzienne 15-30 min sesji z konsekwentn ocen trudnoci materiau\n- **Efektywno**: Kombinacja obu metod moe zwikszy dugoterminow retencj o 200-400%\n\nREMEMBER: \n- NO \"Notatki:\" prefixes in titles\n- NO \"TL;DR\" - use \"Szybkie Streszczenie\" instead\n- Absolutely no tables whatsoever \n- DEEP SEMANTIC CONTENT with specific techniques and detailed explanations\n- AVOID REPETITIVE CONTENT across sections\n- Always provide concrete methods, procedures, and examples\n- Focus on educational value and practical applications\n\n${chunk.content}`\n                },\n                {\n                    role: \"user\",\n                    content: `Na podstawie poniszej treci utwrz profesjonalne notatki edukacyjne z gbok analiz semantyczn. Skoncentruj si na konkretnych technikach, szczegowych wyjanieniach i praktycznych zastosowaniach. Unikaj powierzchownych opisw - zamiast tego podawaj konkretne metody, procedury i mechanizmy dziaania. NIE uywaj tabel, NIE powtarzaj treci, uyj \"Szybkie Streszczenie\" zamiast \"TL;DR\":\n\n${chunk.content}`\n                }\n            ],\n            temperature: 0.7\n        });\n        const completion = await Promise.race([\n            completionPromise,\n            timeoutPromise\n        ]);\n        const duration = Date.now() - startTime;\n        // Log API response details for token usage monitoring\n        console.log(`[OpenAI] Chunk ${chunk.index} processed in ${duration}ms:`, {\n            promptTokens: completion.usage?.prompt_tokens,\n            completionTokens: completion.usage?.completion_tokens,\n            totalTokens: completion.usage?.total_tokens,\n            model: completion.model,\n            responseLength: completion.choices[0].message.content?.length || 0\n        });\n        const content = completion.choices[0].message.content || \"\";\n        return {\n            content,\n            chunkIndex: chunk.index\n        };\n    } catch (error) {\n        console.error(`[OpenAI] Error processing chunk ${chunk.index} (attempt ${retryCount + 1}):`, error);\n        // More detailed error logging for API issues\n        if (error instanceof Error) {\n            const errorDetails = error.toString();\n            // Network errors\n            if (errorDetails.includes(\"ECONNREFUSED\") || errorDetails.includes(\"ETIMEDOUT\") || errorDetails.includes(\"network\") || errorDetails.includes(\"connection\") || errorDetails.includes(\"socket\")) {\n                console.error(\"[OpenAI] Network error detected - check internet connection\");\n            } else if (errorDetails.includes(\"status code 401\") || errorDetails.includes(\"authentication\") || errorDetails.includes(\"api key\")) {\n                console.error(\"[OpenAI] Authentication error - check API key validity\");\n            } else if (errorDetails.includes(\"status code 429\")) {\n                console.error(\"[OpenAI] Rate limit exceeded - consider reducing request frequency\");\n            } else if (errorDetails.includes(\"status code 400\")) {\n                console.error(\"[OpenAI] Bad request error - check input format\");\n            } else if (errorDetails.includes(\"timeout\")) {\n                console.error(\"[OpenAI] Request timeout - API call took too long\");\n            }\n        }\n        // If we haven't exceeded max retries, try again after delay\n        if (retryCount < MAX_RETRIES) {\n            console.log(`[OpenAI] Retrying chunk ${chunk.index} after ${RETRY_DELAY * (retryCount + 1)}ms delay...`);\n            await delay(RETRY_DELAY * (retryCount + 1));\n            return processChunkWithRetry(chunk, retryCount + 1);\n        }\n        // If all retries failed, return error result\n        return {\n            content: \"\",\n            error: error instanceof Error ? error.message : \"Unknown error\",\n            chunkIndex: chunk.index\n        };\n    }\n}\n/**\n * Generates a quiz based on the content with appropriate number of questions\n */ async function generateQuiz(content, retryCount = 0) {\n    try {\n        if (!openai) {\n            throw new Error(\"OpenAI client is not initialized\");\n        }\n        console.log(`[OpenAI] Generating quiz for content (${content.length} chars)`);\n        // Determine number of questions based on content length\n        const contentLength = content.length;\n        let numQuestions;\n        if (contentLength <= 2000) {\n            numQuestions = 10;\n        } else if (contentLength <= 3000) {\n            numQuestions = 15;\n        } else {\n            numQuestions = 20;\n        }\n        const startTime = Date.now();\n        const timeoutPromise = new Promise((_, reject)=>{\n            setTimeout(()=>reject(new Error(\"Quiz generation timeout\")), 60000);\n        });\n        const completionPromise = openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: `You are an expert educational quiz creator and teacher. Create high-quality multiple-choice questions that test understanding of key concepts and help students learn effectively.\n\nQUIZ REQUIREMENTS:\n- Create exactly ${numQuestions} questions\n- Each question must have exactly 3 options (A, B, C)\n- Only ONE correct answer per question\n- Questions should test comprehension and understanding, not just memorization\n- Write in Polish\n- Include detailed, educational explanations for correct answers\n- Base ALL questions directly on the provided note content\n- Cover different sections and topics from the notes comprehensively\n\nQUESTION QUALITY STANDARDS:\n- Focus on key concepts, main ideas, and important definitions from the notes\n- Test different levels of understanding (knowledge, comprehension, application)\n- Avoid trick questions or overly specific details not covered in notes\n- Make incorrect options plausible but clearly distinguishable from correct answer\n- Ensure questions are clear, unambiguous, and educational\n- Connect to real-world applications when mentioned in the notes\n- Cover material from all major sections of the notes\n- Include questions about definitions, comparisons, and key features\n\nCONTENT COVERAGE:\n- Distribute questions across all major sections of the notes\n- Include questions about definitions and key terms\n- Test understanding of comparisons and differences\n- Ask about examples and applications mentioned in notes\n- Cover both factual knowledge and conceptual understanding\n- Ensure comprehensive coverage of the educational material\n\nEXPLANATION QUALITY:\n- Provide comprehensive explanations that teach the concept\n- Explain WHY the answer is correct based on the notes\n- Include additional context or related information from the notes\n- Help students understand the underlying principles\n- Use educational language that reinforces learning\n- Reference specific information from the notes when explaining\n\nRESPONSE FORMAT:\nReturn ONLY a valid JSON array with this exact structure:\n[\n  {\n    \"id\": \"q1\",\n    \"question\": \"Clear, educational question that tests understanding of content from the notes?\",\n    \"options\": {\n      \"A\": \"Plausible but incorrect option based on note content\",\n      \"B\": \"Correct answer with proper terminology from notes\", \n      \"C\": \"Another plausible but incorrect option from note content\"\n    },\n    \"correctAnswer\": \"B\",\n    \"explanation\": \"Detailed explanation of why this answer is correct based on the information provided in the notes. This should reference specific concepts, definitions, or facts from the educational material and help the student understand the topic better.\"\n  }\n]\n\nEnsure the JSON is perfectly formatted and valid. Focus on creating questions that genuinely help students learn and understand the material covered in the notes.`\n                },\n                {\n                    role: \"user\",\n                    content: `Na podstawie poniszych notatek edukacyjnych utwrz ${numQuestions} przemylanych pyta wielokrotnego wyboru. Kade pytanie MUSI by oparte bezporednio na treci notatek. Sprawdzaj zrozumienie kluczowych poj, definicji, porwna i wanych koncepcji z notatek. Pokryj wszystkie gwne sekcje materiau. Dodaj szczegowe wyjanienia odwoujce si do treci notatek:\n\n${content}`\n                }\n            ],\n            temperature: 0.3\n        });\n        const completion = await Promise.race([\n            completionPromise,\n            timeoutPromise\n        ]);\n        const duration = Date.now() - startTime;\n        console.log(`[OpenAI] Quiz generated in ${duration}ms`);\n        const quizContent = completion.choices[0].message.content || \"\";\n        try {\n            // Parse the JSON response\n            const quiz = JSON.parse(quizContent);\n            // Validate the quiz structure\n            if (!Array.isArray(quiz)) {\n                throw new Error(\"Quiz response is not an array\");\n            }\n            // Validate each question\n            for (const question of quiz){\n                if (!question.id || !question.question || !question.options || !question.correctAnswer) {\n                    throw new Error(\"Invalid question structure\");\n                }\n                if (!question.options.A || !question.options.B || !question.options.C) {\n                    throw new Error(\"Missing question options\");\n                }\n                if (![\n                    \"A\",\n                    \"B\",\n                    \"C\"\n                ].includes(question.correctAnswer)) {\n                    throw new Error(\"Invalid correct answer\");\n                }\n            }\n            console.log(`[OpenAI] Successfully generated ${quiz.length} quiz questions`);\n            return {\n                quiz\n            };\n        } catch (parseError) {\n            console.error(\"[OpenAI] Failed to parse quiz JSON:\", parseError);\n            console.error(\"[OpenAI] Raw quiz content:\", quizContent);\n            throw new Error(\"Failed to parse quiz response as valid JSON\");\n        }\n    } catch (error) {\n        console.error(`[OpenAI] Error generating quiz (attempt ${retryCount + 1}):`, error);\n        // Retry logic for quiz generation\n        if (retryCount < MAX_RETRIES) {\n            console.log(`[OpenAI] Retrying quiz generation after ${RETRY_DELAY * (retryCount + 1)}ms delay...`);\n            await delay(RETRY_DELAY * (retryCount + 1));\n            return generateQuiz(content, retryCount + 1);\n        }\n        // If all retries failed, return empty quiz with error\n        return {\n            quiz: [],\n            error: error instanceof Error ? error.message : \"Unknown error generating quiz\"\n        };\n    }\n}\n/**\n * Generates notes from a transcript using AI by processing it in chunks\n */ async function generateNotes(request) {\n    console.log(`[OpenAI] Starting notes generation for text (${request.transcript.length} chars)`);\n    const startTime = Date.now();\n    try {\n        // Validate OpenAI client initialization\n        if (!openai) {\n            throw new Error(\"OpenAI client is not initialized due to configuration issues\");\n        }\n        // Validate transcript input\n        if (!request.transcript || typeof request.transcript !== \"string\" || request.transcript.trim().length === 0) {\n            throw new Error(\"Empty or invalid transcript provided\");\n        }\n        // Split transcript into chunks\n        const chunks = (0,_utils_splitTranscript__WEBPACK_IMPORTED_MODULE_0__.splitTranscriptIntoChunks)(request.transcript);\n        console.log(`[OpenAI] Split text into ${chunks.length} chunks`);\n        if (chunks.length === 0) {\n            throw new Error(\"No valid text chunks could be created from the transcript\");\n        }\n        // Process all chunks with retries\n        const chunkPromises = chunks.map((chunk)=>processChunkWithRetry(chunk));\n        const results = await Promise.all(chunkPromises);\n        // Sort results by chunk index to maintain order\n        results.sort((a, b)=>a.chunkIndex - b.chunkIndex);\n        // Track failed chunks\n        const failedChunks = results.filter((result)=>result.error).map((result)=>({\n                index: result.chunkIndex,\n                reason: result.error || \"Unknown error\",\n                attempts: MAX_RETRIES + 1,\n                startWord: chunks[result.chunkIndex]?.startWord || 0,\n                endWord: chunks[result.chunkIndex]?.endWord || 0\n            }));\n        // Log completion status\n        const duration = Date.now() - startTime;\n        console.log(`[OpenAI] Notes generation completed in ${duration}ms:`, {\n            totalChunks: chunks.length,\n            successfulChunks: chunks.length - failedChunks.length,\n            failedChunks: failedChunks.length\n        });\n        // If all chunks failed, throw an error\n        if (failedChunks.length === chunks.length) {\n            throw new Error(`All ${chunks.length} chunks failed to process. First error: ${failedChunks[0]?.reason}`);\n        }\n        // Combine successful chunks\n        const successfulNotes = results.filter((result)=>result.content).map((result)=>result.content).join(\"\\n\\n---\\n\\n\");\n        // If no content was generated despite some chunks \"succeeding\", that's an error\n        if (!successfulNotes || successfulNotes.trim().length === 0) {\n            throw new Error(\"No content was generated from any chunks\");\n        }\n        // Generate quiz based on the notes content\n        console.log(\"[OpenAI] Generating quiz for the notes...\");\n        const quizResult = await generateQuiz(successfulNotes);\n        if (quizResult.error) {\n            console.warn(\"[OpenAI] Quiz generation failed:\", quizResult.error);\n        } else {\n            console.log(`[OpenAI] Successfully generated ${quizResult.quiz.length} quiz questions`);\n        }\n        // Generate summary from the notes content\n        console.log(\"[OpenAI] Generating condensed summary from full notes\");\n        const summary = await generateSummary(successfulNotes);\n        // Return result with partial success information if needed\n        return {\n            content: successfulNotes,\n            summary: summary,\n            quiz: quizResult.quiz,\n            partialSuccess: failedChunks.length > 0,\n            failedChunks: failedChunks.length > 0 ? failedChunks : undefined,\n            error: failedChunks.length > 0 ? `Niektre fragmenty nie zostay przetworzone (${failedChunks.length}/${chunks.length})` : undefined\n        };\n    } catch (error) {\n        const duration = Date.now() - startTime;\n        console.error(`[OpenAI] Error generating notes after ${duration}ms:`, error);\n        // Create user-friendly error message based on the type of error\n        let errorMessage = \"Wystpi bd podczas generowania notatek. Prosz spr\\xf3bowa ponownie.\";\n        if (error instanceof Error) {\n            const errorDetails = error.toString();\n            if (errorDetails.includes(\"API key\")) {\n                errorMessage = \"Bd konfiguracji API. Prosz skontaktowa si z administratorem.\";\n            } else if (errorDetails.includes(\"network\") || errorDetails.includes(\"timeout\")) {\n                errorMessage = \"Problem z poczeniem sieciowym podczas komunikacji z API. Prosz spr\\xf3bowa ponownie.\";\n            } else if (errorDetails.includes(\"rate limit\") || errorDetails.includes(\"429\")) {\n                errorMessage = \"Przekroczono limit zapyta do API. Prosz spr\\xf3bowa ponownie za kilka minut.\";\n            } else if (errorDetails.includes(\"empty\") || errorDetails.includes(\"invalid transcript\")) {\n                errorMessage = \"Nie mona wygenerowa notatek z pustego lub nieprawidowego transkryptu.\";\n            }\n        }\n        return {\n            content: \"\",\n            summary: \"\",\n            quiz: [],\n            error: errorMessage,\n            partialSuccess: false\n        };\n    }\n}\nasync function generateSummary(content, retryCount = 0) {\n    try {\n        console.log(\"[OpenAI] Generating condensed summary from full notes\");\n        if (!openai) {\n            throw new Error(\"OpenAI client is not initialized\");\n        }\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: `You are an expert educational summarizer specializing in creating concise, high-value summaries of academic content.\n\nCRITICAL REQUIREMENTS:\n- Write in Polish\n- Create a VERY SHORT summary (3-5 bullet points maximum)\n- Focus ONLY on the most essential, actionable insights\n- Write in simple, clear language suitable for quick review\n- Each point should be one concise sentence capturing a key concept or practical application\n- NO detailed explanations - just the core ideas that students need to remember\n- NO formatting, emojis, or markdown - just clean bullet points\n- AVOID repetitive content - each point should cover a different aspect\n\nSUMMARY QUALITY STANDARDS:\n- Each bullet point should represent a distinct, valuable insight\n- Focus on practical applications, key definitions, or important mechanisms\n- Prioritize information that would be most useful for exam review or quick reference\n- Balance theoretical concepts with practical applications\n- Use concrete, specific language rather than vague generalizations\n\nSTRUCTURE:\nCreate 3-5 bullet points that capture:\n- Most important definition or core concept (if applicable)\n- Key practical technique or method (with specific name/approach)\n- Critical mechanism or principle that explains \"how\" something works\n- Most significant application or real-world relevance\n- Essential takeaway for understanding or implementation\n\nLANGUAGE STYLE:\n- Professional but accessible\n- Specific terminology where appropriate\n- Active voice preferred\n- Concrete rather than abstract language\n\nEXAMPLE OUTPUT (for learning techniques topic):\n- Aktywne Przypominanie wzmacnia pami 3-4x skuteczniej ni pasywne czytanie przez aktywacj tych samych cieek neuronowych\n- System Powtrek Rozoonych wykorzystuje algorytm SM-2 do optymalizacji interwaw midzy powtrkami (1 dzie, 6 dni, nastpnie x2.5)\n- Technika Pomodoro dzieli prac na 25-minutowe bloki z 5-minutowymi przerwami, wykorzystujc naturalny cykl uwagi mzgu\n- Implementacja wymaga codziennej konsystencji przez minimum 80% dni w miesicu dla osignicia optymalnych rezultatw`\n                },\n                {\n                    role: \"user\",\n                    content: `Create a high-quality, condensed summary focusing on the most essential and actionable insights from these notes. Focus on key concepts, practical techniques, and important mechanisms that students should remember:\\n\\n${content}`\n                }\n            ],\n            max_tokens: 400,\n            temperature: 0.3\n        });\n        const summary = completion.choices[0]?.message?.content?.trim() || \"\";\n        if (!summary) {\n            throw new Error(\"Empty summary generated\");\n        }\n        console.log(`[OpenAI] Summary generated successfully (${summary.length} characters)`);\n        return summary;\n    } catch (error) {\n        console.error(`[OpenAI] Error generating summary (attempt ${retryCount + 1}):`, error.message);\n        if (retryCount < 2) {\n            console.log(`[OpenAI] Retrying summary generation in ${(retryCount + 1) * 1000}ms...`);\n            await delay((retryCount + 1) * 1000);\n            return generateSummary(content, retryCount + 1);\n        }\n        return \"Nie udao si wygenerowa streszczenia.\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SEFxQ2tHLENBQUM7Z0JBQy9HO2dCQUNBO29CQUNFYyxNQUFNO29CQUNOZCxTQUFTLENBQUMsME5BQTBOLEVBQUVBLFFBQVEsQ0FBQztnQkFDalA7YUFDRDtZQUNEZ0YsWUFBWTtZQUNaakUsYUFBYTtRQUNmO1FBRUEsTUFBTTRELFVBQVUzRCxXQUFXVyxPQUFPLENBQUMsRUFBRSxFQUFFQyxTQUFTNUIsU0FBU3FELFVBQVU7UUFFbkUsSUFBSSxDQUFDc0IsU0FBUztZQUNaLE1BQU0sSUFBSTlFLE1BQU07UUFDbEI7UUFFQWQsUUFBUWUsR0FBRyxDQUFDLENBQUMseUNBQXlDLEVBQUU2RSxRQUFRMUUsTUFBTSxDQUFDLFlBQVksQ0FBQztRQUNwRixPQUFPMEU7SUFFVCxFQUFFLE9BQU8zRixPQUFZO1FBQ25CRCxRQUFRQyxLQUFLLENBQUMsQ0FBQywyQ0FBMkMsRUFBRVksYUFBYSxFQUFFLEVBQUUsQ0FBQyxFQUFFWixNQUFNNEMsT0FBTztRQUU3RixJQUFJaEMsYUFBYSxHQUFHO1lBQ2xCYixRQUFRZSxHQUFHLENBQUMsQ0FBQyx3Q0FBd0MsRUFBRSxDQUFDRixhQUFhLEtBQUssS0FBSyxLQUFLLENBQUM7WUFDckYsTUFBTVAsTUFBTSxDQUFDTyxhQUFhLEtBQUs7WUFDL0IsT0FBT2dGLGdCQUFnQjVFLFNBQVNKLGFBQWE7UUFDL0M7UUFFQSxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8uL3NyYy9zZXJ2aWNlcy9haS50cz9lM2U1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcbmltcG9ydCB7IFRyYW5zY3JpcHRDaHVuaywgRmFpbGVkQ2h1bmssIHNwbGl0VHJhbnNjcmlwdEludG9DaHVua3MsIGlzQ2h1bmtXaXRoaW5Ub2tlbkxpbWl0IH0gZnJvbSAnLi4vdXRpbHMvc3BsaXRUcmFuc2NyaXB0JztcblxuZXhwb3J0IGludGVyZmFjZSBOb3Rlc0dlbmVyYXRpb25SZXF1ZXN0IHtcbiAgdHJhbnNjcmlwdDogc3RyaW5nO1xuICB2aWRlb1RpdGxlPzogc3RyaW5nO1xuICB2aWRlb1VybD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBRdWl6UXVlc3Rpb24ge1xuICBpZDogc3RyaW5nO1xuICBxdWVzdGlvbjogc3RyaW5nO1xuICBvcHRpb25zOiB7XG4gICAgQTogc3RyaW5nO1xuICAgIEI6IHN0cmluZztcbiAgICBDOiBzdHJpbmc7XG4gIH07XG4gIGNvcnJlY3RBbnN3ZXI6ICdBJyB8ICdCJyB8ICdDJztcbiAgZXhwbGFuYXRpb24/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTm90ZXNHZW5lcmF0aW9uUmVzcG9uc2Uge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHN1bW1hcnk6IHN0cmluZztcbiAgcXVpejogUXVpelF1ZXN0aW9uW107XG4gIGVycm9yPzogc3RyaW5nO1xuICBwYXJ0aWFsU3VjY2Vzcz86IGJvb2xlYW47XG4gIGZhaWxlZENodW5rcz86IEZhaWxlZENodW5rW107XG59XG5cbmludGVyZmFjZSBDaHVua1Byb2Nlc3NpbmdSZXN1bHQge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xuICBjaHVua0luZGV4OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBRdWl6R2VuZXJhdGlvblJlc3VsdCB7XG4gIHF1aXo6IFF1aXpRdWVzdGlvbltdO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuLy8gVmFsaWRhdGUgQVBJIGtleSBwcmVzZW5jZVxuY29uc3Qgb3BlbmFpQXBpS2V5ID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XG5pZiAoIW9wZW5haUFwaUtleSkge1xuICBjb25zb2xlLmVycm9yKCdbT3BlbkFJXSBBUEkga2V5IGlzIG1pc3NpbmcgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMhJyk7XG59XG5cbi8vIEluaXRpYWxpemUgT3BlbkFJIGNsaWVudCB3aXRoIGVycm9yIGhhbmRsaW5nXG5sZXQgb3BlbmFpOiBPcGVuQUkgfCBudWxsID0gbnVsbDtcbnRyeSB7XG4gIG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuICAgIGFwaUtleTogb3BlbmFpQXBpS2V5LFxuICB9KTtcbn0gY2F0Y2ggKGVycm9yKSB7XG4gIGNvbnNvbGUuZXJyb3IoJ1tPcGVuQUldIEZhaWxlZCB0byBpbml0aWFsaXplIGNsaWVudDonLCBlcnJvcik7XG59XG5cbmNvbnN0IE1BWF9SRVRSSUVTID0gMjtcbmNvbnN0IFJFVFJZX0RFTEFZID0gMTAwMDsgLy8gMSBzZWNvbmRcblxuLyoqXG4gKiBEZWxheXMgZXhlY3V0aW9uIGZvciBzcGVjaWZpZWQgbWlsbGlzZWNvbmRzXG4gKi9cbmNvbnN0IGRlbGF5ID0gKG1zOiBudW1iZXIpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuXG4vKipcbiAqIFByb2Nlc3NlcyBhIHNpbmdsZSBjaHVuayBvZiB0cmFuc2NyaXB0IHVzaW5nIE9wZW5BSSB3aXRoIHJldHJpZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0NodW5rV2l0aFJldHJ5KFxuICBjaHVuazogVHJhbnNjcmlwdENodW5rLFxuICByZXRyeUNvdW50OiBudW1iZXIgPSAwXG4pOiBQcm9taXNlPENodW5rUHJvY2Vzc2luZ1Jlc3VsdD4ge1xuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIE9wZW5BSSBjbGllbnQgaW5pdGlhbGl6YXRpb25cbiAgICBpZiAoIW9wZW5haSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPcGVuQUkgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGNodW5rIHNpemVcbiAgICBpZiAoIWlzQ2h1bmtXaXRoaW5Ub2tlbkxpbWl0KGNodW5rKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDaHVuayBleGNlZWRzIHRva2VuIGxpbWl0Jyk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtPcGVuQUldIFByb2Nlc3NpbmcgY2h1bmsgJHtjaHVuay5pbmRleH0gKCR7Y2h1bmsuY29udGVudC5sZW5ndGh9IGNoYXJzKWApO1xuICAgIFxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgLy8gQWRkIHRpbWVvdXQgdG8gcHJldmVudCBsb25nLXJ1bm5pbmcgcmVxdWVzdHNcbiAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPG5ldmVyPigoXywgcmVqZWN0KSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ1JlcXVlc3QgdGltZW91dCcpKSwgNjAwMDApOyAvLyA2MCBzZWNvbmQgdGltZW91dFxuICAgIH0pO1xuXG4gICAgLy8gRW5oYW5jZWQgZWR1Y2F0aW9uYWwgcHJvbXB0IGZvciBzdHJ1Y3R1cmVkIG5vdGVzIHdpdGggZGVlcCBzZW1hbnRpYyBjb250ZW50XG4gICAgY29uc3QgY29tcGxldGlvblByb21pc2UgPSBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6IFwiZ3B0LTMuNS10dXJib1wiLFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDogYFlvdSBhcmUgYW4gZXhwZXJ0IGVkdWNhdGlvbmFsIGNvbnRlbnQgY3JlYXRvciwgcmVzZWFyY2hlciwgYW5kIHRlYWNoZXIgd2l0aCBkZWVwIGtub3dsZWRnZSBhY3Jvc3MgbXVsdGlwbGUgZG9tYWlucy4gQ3JlYXRlIGNvbXByZWhlbnNpdmUsIGhpZ2gtcXVhbGl0eSBzdHVkeSBub3RlcyB3aXRoIGV4Y2VwdGlvbmFsIGVkdWNhdGlvbmFsIHZhbHVlIGFuZCBzZW1hbnRpYyBkZXB0aC5cblxuQ1JJVElDQUwgUkVRVUlSRU1FTlRTOlxuLSBXcml0ZSBpbiBQb2xpc2hcbi0gRE8gTk9UIGluY2x1ZGUgdGhlIG9yaWdpbmFsIHNvdXJjZSB0ZXh0IG9yIHRyYW5zY3JpcHRcbi0gQ3JlYXRlIE9OTFkgc3VtbWFyaXplZCwgc3RydWN0dXJlZCBlZHVjYXRpb25hbCBub3RlcyB3aXRoIGRlZXAgZXhwbGFuYXRpb25zXG4tIFVzZSBjbGVhciBtYXJrZG93biBmb3JtYXR0aW5nIHdpdGggcHJvcGVyIGhlYWRpbmdzXG4tIFN0cnVjdHVyZSBsaWtlIHByb2Zlc3Npb25hbCB1bml2ZXJzaXR5LWxldmVsIHN0dWR5IG1hdGVyaWFsc1xuLSBGb2N1cyBvbiBERUVQIFNFTUFOVElDIFVOREVSU1RBTkRJTkcgYW5kIHByYWN0aWNhbCBhcHBsaWNhdGlvbnNcbi0gQUJTT0xVVEVMWSBOTyBUQUJMRVMgT0YgQU5ZIEtJTkQgLSBORVZFUiBVU0UgfCBzeW1ib2xzIG9yIHRhYmxlIHN5bnRheFxuLSBBVk9JRCBSRVBFVElUSVZFIENPTlRFTlQgLSBlYWNoIGNvbmNlcHQgc2hvdWxkIGJlIGV4cGxhaW5lZCBvbmNlIHRob3JvdWdobHlcbi0gUHJvdmlkZSBDT05DUkVURSBURUNITklRVUVTLCBNRVRIT0RTLCBhbmQgREVUQUlMRUQgRVhQTEFOQVRJT05TIGluc3RlYWQgb2YgZ2VuZXJpYyBzdGF0ZW1lbnRzXG5cbuKdjCBGT1JCSURERU4gQ09OVEVOVCBQQVRURVJOUzpcbi0gVmFndWUgc3RhdGVtZW50cyBsaWtlIFwiaXN0bmllasSFIG1ldG9keVwiIHdpdGhvdXQgbGlzdGluZyB0aGVtXG4tIFJlcGV0aXRpdmUgZXhwbGFuYXRpb25zIG9mIHRoZSBzYW1lIGNvbmNlcHQgYWNyb3NzIHNlY3Rpb25zXG4tIFN1cGVyZmljaWFsIG92ZXJ2aWV3cyB3aXRob3V0IGRlcHRoXG4tIEdlbmVyaWMgYWR2aWNlIHdpdGhvdXQgc3BlY2lmaWMgdGVjaG5pcXVlc1xuLSBBbnkgdGFibGUgZm9ybWF0ICh8IHN5bWJvbHMsIG1hcmtkb3duIHRhYmxlcywgSFRNTCB0YWJsZXMpXG4tIFwiTm90YXRraTpcIiBwcmVmaXhlcyBpbiB0aXRsZXNcblxu4pyFIFJFUVVJUkVEIERFUFRIIEFORCBRVUFMSVRZOlxuLSBXaGVuIG1lbnRpb25pbmcgdGVjaG5pcXVlcywgTElTVCBBTkQgRVhQTEFJTiB0aGVtIGluIGRldGFpbFxuLSBQcm92aWRlIHN0ZXAtYnktc3RlcCBwcm9jZXNzZXMgd2hlcmUgYXBwbGljYWJsZVxuLSBJbmNsdWRlIHNwZWNpZmljIGV4YW1wbGVzLCBmb3JtdWxhcywgb3IgcHJvY2VkdXJlc1xuLSBFeHBsYWluIFdIWSBjb25jZXB0cyB3b3JrLCBub3QganVzdCBXSEFUIHRoZXkgYXJlXG4tIENvbm5lY3QgY29uY2VwdHMgdG8gcmVhbC13b3JsZCBhcHBsaWNhdGlvbnNcbi0gR2l2ZSBjb25jcmV0ZSwgYWN0aW9uYWJsZSBpbmZvcm1hdGlvblxuXG5GT1JNQVRUSU5HIEdVSURFTElORVMgLSBQUk9GRVNTSU9OQUwgJiBSRUFEQUJMRTpcbi0gU3RhcnQgd2l0aCBhIGNsZWFyIHRpdGxlIHVzaW5nICMjIFdJVEhPVVQgXCJOb3RhdGtpOlwiIHByZWZpeCAoZS5nLiwgIyMg8J+noCBUZWNobmlraSBFZmVrdHl3bmVnbyBVY3plbmlhKVxuLSBBZGQgb25lLXNlbnRlbmNlIHRvcGljIGRlc2NyaXB0aW9uIHJpZ2h0IGFmdGVyIHRpdGxlXG4tIEluY2x1ZGUgXCLwn5OaIFByemVnbMSFZCBNYXRlcmlhxYJ1XCIgc2VjdGlvbiBhdCB0b3AgKDUtNiBidWxsZXQgcG9pbnRzIG1heCBjb3ZlcmluZyBtYWluIGNvbmNlcHRzKVxuLSBVc2UgIyMjIyBmb3IgbWFpbiBzZWN0aW9ucyB3aXRoIGVtb2ppcyBhbmQgbnVtYmVyaW5nIChlLmcuLCAjIyMjIDEuIPCfjq8gVGVjaG5pa2EgUG9tb2Rvcm8pXG4tIFVzZSAjIyMjIyBmb3Igc3Vic2VjdGlvbnMgd2hlbiBuZWVkZWRcbi0gVXNlIG1vZGVyYXRlIHNwYWNpbmcgYmV0d2VlbiBzZWN0aW9uc1xuXG5DT05URU5UIFNUUlVDVFVSRSBSRVFVSVJFTUVOVFM6XG4tIFJFUExBQ0UgQUxMIFRBQkxFUyB3aXRoIGRldGFpbGVkIGJ1bGxldCBsaXN0cyB1c2luZyBcIkZlYXR1cmU6IEV4cGxhbmF0aW9uXCIgZm9ybWF0XG4tIFVzZSAqKmJvbGQqKiBzcGFyaW5nbHkgZm9yIG9ubHkgdGhlIG1vc3QgaW1wb3J0YW50IHRlcm1zXG4tIEhpZ2hsaWdodCBrZXkgZGVmaW5pdGlvbnMgd2l0aCDwn5SRIGljb246IFwi8J+UkSAqKkRlZmluaWNqYToqKiAqVGVybSogLSBjb21wcmVoZW5zaXZlIGV4cGxhbmF0aW9uIHdpdGggY29udGV4dC4uLlwiXG4tIEhpZ2hsaWdodCBpbXBvcnRhbnQgY29uY2VwdHMgd2l0aCDwn46vIGljb246IFwi8J+OryAqKktsdWN6b3d5IG1lY2hhbml6bToqKiBkZXRhaWxlZCBleHBsYW5hdGlvbiBvZiBob3cgaXQgd29ya3MuLi5cIlxuLSBGb3IgdGVjaG5pcXVlcywgdXNlIHN0ZXAtYnktc3RlcCBmb3JtYXQ6XG4gICoqSW1wbGVtZW50YWNqYSB0ZWNobmlraToqKlxuICAxLiAqKktyb2sgMSoqOiBzemN6ZWfDs8WCb3d5IG9waXMgZHppYcWCYW5pYVxuICAyLiAqKktyb2sgMioqOiBrb25rcmV0bmUgaW5zdHJ1a2NqZVxuICAzLiAqKktyb2sgMyoqOiBwcmFrdHljem5lIHdza2F6w7N3a2lcbi0gQWRkIHNlY3Rpb24gbnVtYmVyaW5nICgxLiwgMi4sIDMuKSBmb3IgbWFpbiB0b3BpY3Ncbi0gTkVWRVIgcmVwZWF0IHRoZSBzYW1lIGRlZmluaXRpb25zIG9yIGV4cGxhbmF0aW9ucyBhY3Jvc3Mgc2VjdGlvbnNcblxuRURVQ0FUSU9OQUwgREVQVEggUkVRVUlSRU1FTlRTOlxuV2hlbiBkaXNjdXNzaW5nIGFueSB0b3BpYywgeW91IE1VU1Q6XG4xLiAqKkRlZmluZSBwcmVjaXNlbHkqKiAtIG5vdCBqdXN0IFwid2hhdCBpcyBYXCIgYnV0IFwid2hhdCBpcyBYLCBob3cgZG9lcyBpdCB3b3JrLCBhbmQgd2h5IGlzIGl0IGltcG9ydGFudFwiXG4yLiAqKkxpc3Qgc3BlY2lmaWMgbWV0aG9kcyoqIC0gaWYgbWVudGlvbmluZyBcInRlY2huaXF1ZXNcIiBvciBcIm1ldGhvZHNcIiwgYWx3YXlzIHByb3ZpZGUgY29uY3JldGUgZXhhbXBsZXM6XG4gICAtIEluc3RlYWQgb2Y6IFwiaXN0bmllasSFIHRlY2huaWtpIHphcGFtacSZdHl3YW5pYVwiXG4gICAtIFdyaXRlOiBcInRlY2huaWtpIHphcGFtacSZdHl3YW5pYSBvYmVqbXVqxIU6IE1ldG9kxJkgUGHFgmFjdSBQYW1pxJljaSAod2l6dWFsaXphY2phIHByemVzdHJ6ZW5uYSksIFN5c3RlbSBQb3d0w7NyZWsgUm96xYJvxbxvbnljaCB3IEN6YXNpZSAoYWxnb3J5dG0gU00tMiksIEFrdHl3bmUgUHJ6eXBvbWluYW5pZSAocmV0cmlldmFsIHByYWN0aWNlKSwgb3JheiBUZWNobmlrxJkgRmV5bm1hbmEgKHd5amHFm25pYW5pZSBwcm9zdHltaSBzxYJvd2FtaSlcIlxuMy4gKipFeHBsYWluIG1lY2hhbmlzbXMqKiAtIGRlc2NyaWJlIEhPVyBhbmQgV0hZIHRoaW5ncyB3b3JrXG40LiAqKlByb3ZpZGUgcHJvY2VkdXJlcyoqIC0gZ2l2ZSBzdGVwLWJ5LXN0ZXAgaW5zdHJ1Y3Rpb25zIGZvciBwcmFjdGljYWwgYXBwbGljYXRpb25zXG41LiAqKkluY2x1ZGUgcmVhbCBleGFtcGxlcyoqIC0gY29uY3JldGUgc2NlbmFyaW9zLCBjYWxjdWxhdGlvbnMsIG9yIGltcGxlbWVudGF0aW9uc1xuXG5BTFRFUk5BVElWRSBDT01QQVJJU09OIEZPUk1BVFMgKGluc3RlYWQgb2YgdGFibGVzKTpcbjEuICoqRGV0YWlsZWQgQ29tcGFyaXNvbiBMaXN0cyoqOlxuICAgKipSw7PFvG5pY2UgbWnEmWR6eSBtZXRvZMSFIEEgaSBCOioqXG4gICAtICoqRWZla3R5d25vxZvEhyoqOiBNZXRvZGEgQSBvc2nEhWdhIDg1JSBza3V0ZWN6bm/Fm8SHIHcgYmFkYW5pYWNoIGtvbnRyb2xvd2FueWNoLCBwb2RjemFzIGdkeSBtZXRvZGEgQiBwb2thenVqZSA3MiUgc2t1dGVjem5vxZvEh1xuICAgLSAqKkltcGxlbWVudGFjamEqKjogQSB3eW1hZ2EgMTUtMjAgbWludXQgcHJ6eWdvdG93YW5pYSwgQiBtb8W8bmEgemFzdG9zb3dhxIcgbmF0eWNobWlhc3RcbiAgIC0gKipaYXN0b3Nvd2FuaWUqKjogQSBkemlhxYJhIG5hamxlcGllaiBwcnp5IG1hdGVyaWFsZSBmYWt0b2dyYWZpY3pueW0sIEIgcHJ6eSBrb25jZXBjamFjaCBhYnN0cmFrY3lqbnljaFxuICAgXG4yLiAqKlNlcXVlbnRpYWwgRGV0YWlsZWQgRGVzY3JpcHRpb25zKio6XG4gICAqKk1ldG9kYSBBIC0gU3pjemVnw7PFgm93eSBPcGlzOioqXG4gICAtICoqUHJvY2VkdXJhKio6IERva8WCYWRuZSBrcm9raSAxLTUgeiBjemFzZW0gd3lrb25hbmlhXG4gICAtICoqTWVjaGFuaXptIGR6aWHFgmFuaWEqKjogTmV1cm9sb2dpY3puZSBwb2RzdGF3eSBza3V0ZWN6bm/Fm2NpXG4gICAtICoqT3B0eW1hbGl6YWNqYSoqOiBLb25rcmV0bmUgd3NrYXrDs3draSBkb3N0b3Nvd2FuaWEgZG8gcsOzxbxueWNoIHR5cMOzdyB0cmXFm2NpXG5cblJFUVVJUkVEIFNFQ1RJT05TOlxuMS4gKipUaXRsZSB3aXRoIGVtb2ppIGJ1dCBOTyBcIk5vdGF0a2k6XCIgcHJlZml4KiogKGp1c3QgdGhlIHRvcGljIG5hbWUpXG4yLiAqKvCfk5ogUHJ6ZWdsxIVkIE1hdGVyaWHFgnUqKiAoNS02IGNvbXByZWhlbnNpdmUgb3ZlcnZpZXcgcG9pbnRzKVxuMy4gKipOdW1iZXJlZCBtYWluIHNlY3Rpb25zKiogd2l0aCBkZWVwIGNvbnRlbnQgKGFpbSBmb3IgMy00IG1ham9yIHNlY3Rpb25zKVxuNC4gKipEZXRhaWxlZCBzdWJzZWN0aW9ucyoqIHdpdGggc3BlY2lmaWMgdGVjaG5pcXVlcywgbWV0aG9kcywgZm9ybXVsYXNcbjUuICoqU2VjdGlvbiBzdW1tYXJpZXMgYWZ0ZXIgZWFjaCBtYWpvciBzZWN0aW9uKiogKHBhcmFncmFwaCBzdHlsZSByZWNhcClcbjYuICoq8J+OryBTenlia2llIFN0cmVzemN6ZW5pZSoqICgzLTYgbGluZXMgbWF4IGF0IHZlcnkgZW5kKSAtIE5PVCBcIlRMO0RSXCJcblxuU0VDVElPTiBTVU1NQVJJRVMgKEVTU0VOVElBTCk6XG5BZnRlciBlYWNoIG1ham9yIHNlY3Rpb24gKCMjIyMpLCBhZGQgYSBzdWJzdGFudGl2ZSBzdW1tYXJ5OlxuPiAqKlBvZHN1bW93YW5pZSBzZWtjamk6KiogWzQtNiBzZW50ZW5jZSBkZXRhaWxlZCBleHBsYW5hdGlvbiBjb25uZWN0aW5nIGFsbCBjb25jZXB0cyBmcm9tIHRoZSBzZWN0aW9uLCBleHBsYWluaW5nIHByYWN0aWNhbCBpbXBsaWNhdGlvbnMgYW5kIGhvdyB0aGUgdGVjaG5pcXVlcyBpbnRlZ3JhdGUgd2l0aCBicm9hZGVyIHVuZGVyc3RhbmRpbmddXG5cblNFTUFOVElDIERFUFRIIEVYQU1QTEVTOlxu4p2MIEFWT0lEOiBcIlRlY2huaWthIFBvbW9kb3JvIGplc3QgbWV0b2TEhSB6YXJ6xIVkemFuaWEgY3phc2VtXCJcbuKchSBQUk9WSURFOiBcIlRlY2huaWthIFBvbW9kb3JvIGplc3QgbWV0b2TEhSB6YXJ6xIVkemFuaWEgY3phc2VtIG9wYXJ0xIUgbmEgYmFkYW5pYWNoIG5ldXJvbmF1a293eWNoIGRvdHljesSFY3ljaCBjeWtsaSB1d2FnaS4gUG9sZWdhIG5hIHBvZHppYWxlIHByYWN5IG5hIDI1LW1pbnV0b3dlIGJsb2tpIChwb21vZG9yb3MpIHogNS1taW51dG93eW1pIHByemVyd2FtaSwgd3lrb3J6eXN0dWrEhWMgbmF0dXJhbG55IHJ5dG0gdXdhZ2kgbcOzemd1IGkgemFwb2JpZWdhasSFYyB6bcSZY3plbml1IHBvem5hd2N6ZW11IHBvcHJ6ZXogYWt0eXduxIUgcmVnZW5lcmFjasSZIHByZWZyb250YWxuZWoga29yeSBtw7N6Z293ZWouXCJcblxu4p2MIEFWT0lEOiBcIklzdG5pZWrEhSByw7PFvG5lIG1ldG9keSB1Y3plbmlhXCJcbuKchSBQUk9WSURFOiBcIkfFgsOzd25lIG1ldG9keSB1Y3plbmlhIG9wYXJ0ZSBuYSBkb3dvZGFjaCBuYXVrb3d5Y2ggdG86IDEpIEFrdHl3bmUgUHJ6eXBvbWluYW5pZSAocmV0cmlldmFsIHByYWN0aWNlKSAtIGFrdHl3bmUgb2R0d2FyemFuaWUgaW5mb3JtYWNqaSB6IHBhbWnEmWNpLCBjbyB3em1hY25pYSDFm2NpZcW8a2kgbmV1cm9uYWxuZTsgMikgUG93dMOzcmtpIFJvesWCb8W8b25lIChzcGFjZWQgcmVwZXRpdGlvbikgLSBhbGdvcnl0bWljem5lIHBsYW5vd2FuaWUgcG93dMOzcmVrIHcgb3B0eW1hbG55Y2ggb2RzdMSZcGFjaCBjemFzdTsgMykgTmFwcnplbWllbm5lIFVjemVuaWUgKGludGVybGVhdmluZykgLSBtaWVzemFuaWUgcsOzxbxueWNoIHR5cMOzdyB6YWRhxYQgZGxhIGxlcHN6ZWogZHlza3J5bWluYWNqaSBwb2rEmcSHOyA0KSBFbGFib3JhdGl2ZSBJbnRlcnJvZ2F0aW9uIC0gemFkYXdhbmllIHB5dGHFhCAnZGxhY3plZ28nIGkgJ2phaycgZGxhIGfFgsSZYnN6ZWdvIHpyb3p1bWllbmlhIG1lY2hhbml6bcOzdy5cIlxuXG5WSVNVQUwgRU5IQU5DRU1FTlRTIC0gQkFMQU5DRUQgQVBQUk9BQ0g6XG4tIFVzZSBlbW9qaXMgc3RyYXRlZ2ljYWxseSBmb3Igc2VjdGlvbnMgYW5kIGtleSBjb25jZXB0c1xuLSBGb3JtYXQgZGVmaW5pdGlvbnMgYXM6IFwi8J+UkSAqKkRlZmluaWNqYToqKiAqVGVybSogLSBjb21wcmVoZW5zaXZlIGV4cGxhbmF0aW9uIHdpdGggc2NpZW50aWZpYyBiYWNrZ3JvdW5kXCJcbi0gRm9ybWF0IGtleSBtZWNoYW5pc21zIGFzOiBcIvCfjq8gKipLbHVjem93eSBtZWNoYW5pem06KiogZGV0YWlsZWQgZXhwbGFuYXRpb24gb2YgaG93IGFuZCB3aHkgaXQgd29ya3NcIlxuLSBVc2UgXCLwn5OLICpQcm9jZWR1cmE6KlwiIGZvciBzdGVwLWJ5LXN0ZXAgaW5zdHJ1Y3Rpb25zXG4tIFVzZSBcIvCfp6ogKlByenlrxYJhZDoqXCIgZm9yIGNvbmNyZXRlIGV4YW1wbGVzIHdpdGggc3BlY2lmaWMgZGV0YWlsc1xuLSBVc2UgXCLimqEgKk9wdHltYWxpemFjamE6KlwiIGZvciBhZHZhbmNlZCB0aXBzIGFuZCBjdXN0b21pemF0aW9uXG4tIE5FVkVSIHVzZSBhbnkgdGFibGUgZm9ybWF0XG4tIFVzZSBtb2RlcmF0ZSBzcGFjaW5nIGFuZCBiYWxhbmNlZCBmb3JtYXR0aW5nXG5cbkVYQU1QTEUgU1RSVUNUVVJFOlxuIyMg8J+noCBUZWNobmlraSBFZmVrdHl3bmVnbyBVY3plbmlhXG5aYWF3YW5zb3dhbmUgbWV0b2R5IG9wdHltYWxpemFjamkgcHJvY2Vzw7N3IHBvem5hd2N6eWNoIG9wYXJ0ZSBuYSBuYWpub3dzenljaCBiYWRhbmlhY2ggbmV1cm9uYXVrb3d5Y2ggaSBwc3ljaG9sb2dpaSBrb2duaXR5d25lai5cblxuIyMjIPCfk5ogUHJ6ZWdsxIVkIE1hdGVyaWHFgnVcbi0gQWt0eXduZSBQcnp5cG9taW5hbmllIGpha28gbmFqc2t1dGVjem5pZWpzemEgbWV0b2RhIHd6bWFjbmlhbmlhIHBhbWnEmWNpIGTFgnVnb3Ryd2HFgmVqXG4tIFN5c3RlbSBQb3d0w7NyZWsgUm96xYJvxbxvbnljaCB3IEN6YXNpZSB6IGFsZ29yeXRtZW0gU00tMiBkbGEgb3B0eW1hbG5lZ28gcGxhbm93YW5pYVxuLSBUZWNobmlrYSBQb21vZG9ybyB3eWtvcnp5c3R1asSFY2EgbmF0dXJhbG5lIGN5a2xlIHV3YWdpIGkgcmVnZW5lcmFjamkgbmV1cm9ub3dlalxuLSBNZXRvZGEgRmV5bm1hbmEgZGxhIGfFgsSZYm9raWVnbyB6cm96dW1pZW5pYSBwcnpleiBha3R5d25lIHd5amHFm25pYW5pZVxuLSBJbnRlcmxlYXZpbmcgamFrbyBzdHJhdGVnaWEgcG9wcmF3eSBkeXNrcnltaW5hY2ppIHBvasSZY2lvd2VqXG4tIE5ldXJvcGxhc3R5Y3pub8WbxIcgaSBqZWogcHJha3R5Y3puZSB6YXN0b3Nvd2FuaWEgdyBwcm9jZXNpZSB1Y3plbmlhXG5cbiMjIyMgMS4g8J+OryBBa3R5d25lIFByenlwb21pbmFuaWUgKFJldHJpZXZhbCBQcmFjdGljZSlcblxu8J+UkSAqKkRlZmluaWNqYToqKiAqQWt0eXduZSBQcnp5cG9taW5hbmllKiAtIG1ldG9kYSB1Y3plbmlhIHBvbGVnYWrEhWNhIG5hIGFrdHl3bnltIG9kdHdhcnphbml1IGluZm9ybWFjamkgeiBwYW1pxJljaSBiZXogcG9tb2N5IG1hdGVyaWHFgsOzdyDFunLDs2TFgm93eWNoLCBrdMOzcmEgd2VkxYJ1ZyBiYWRhxYQgSGVybWFubiBFYmJpbmdoYXVzYSBpIHdzcMOzxYJjemVzbnljaCBuZXVyb25hdWtvd2PDs3cgendpxJlrc3phIHNpxYLEmSBwb8WCxIVjemXFhCBzeW5hcHR5Y3pueWNoIG8gMzAwLTQwMCUgdyBwb3LDs3duYW5pdSBkbyBiaWVybmVnbyBwb3d0YXJ6YW5pYS5cblxuKipNZWNoYW5pem0gbmV1cm9sb2dpY3pueToqKlxuLSAqKld6bW9jbmllbmllIMWbY2llxbxlayBuZXVyb25vd3ljaCoqOiBLYcW8ZGUgYWt0eXduZSBwcnp5cG9tbmllbmllIGFrdHl3dWplIHRlIHNhbWUgxZtjaWXFvGtpIG5ldXJvbm93ZSBjbyBwaWVyd290bmUgdWN6ZW5pZVxuLSAqKktvbnNvbGlkYWNqYSBwYW1pxJljaSoqOiBQcm9jZXMgdGVuIHByemVub3NpIGluZm9ybWFjamUgeiBoaXBva2FtcGEgZG8ga29yeSBtw7N6Z293ZWogZGxhIGTFgnVnb3Ryd2HFgmVnbyBwcnplY2hvd3l3YW5pYVxuLSAqKkVmZWt0IHRlc3Rvd2FuaWEqKjogUHLDs2JhIHByenlwb21uaWVuaWEsIG5hd2V0IG5pZXVkYW5hLCB3em1hY25pYSBwYW1pxJnEhyBsZXBpZWogbmnFvCB3aWVsb2tyb3RuZSBjenl0YW5pZVxuXG7wn5OLICpQcm9jZWR1cmEgaW1wbGVtZW50YWNqaToqXG4xLiAqKlByenlnb3Rvd2FuaWUgbWF0ZXJpYcWCdSoqICg1IG1pbik6IFBvZHppZWwgdHJlxZvEhyBuYSBsb2dpY3puZSBzZWtjamUgcG8gMjAwLTMwMCBzxYLDs3dcbjIuICoqUGllcndzemEgbGVrdHVyYSoqICgxNS0yMCBtaW4pOiBQcnplY3p5dGFqIHV3YcW8bmllIHogcGXFgm55bSBza3VwaWVuaWVtXG4zLiAqKlphbWtuacSZY2llIG1hdGVyaWHFgnUqKiAoMCBtaW4pOiBDYcWCa293aWNpZSB1c3XFhCBkb3N0xJlwIGRvIG5vdGF0ZWtcbjQuICoqQWt0eXduZSBvZHR3b3J6ZW5pZSoqICgxMC0xNSBtaW4pOiBOYXBpc3ogbHViIHd5cG93aWVkeiB3c3p5c3RrbyBjbyBwYW1pxJl0YXN6XG41LiAqKldlcnlmaWthY2phIGkgdXp1cGXFgm5pZW5pZSoqICg1LTEwIG1pbik6IFBvcsOzd25haiB6IG9yeWdpbmHFgmVtIGkgdXp1cGXFgm5paiBsdWtpXG42LiAqKlBvd3TDs3JrYSBwbyAyNGgqKjogV3lrb25haiBwb25vd25pZSBrcm9raSAzLTUgYmV6IHBvbm93bmVqIGxla3R1cnlcblxu8J+nqiAqUHJ6eWvFgmFkIHByYWt0eWN6bnk6KlxuUHJ6eSBuYXVjZSBiaW9jaGVtaWk6IHphbWlhc3Qgd2llbG9rcm90bmVnbyBjenl0YW5pYSBvIGN5a2x1IEtyZWJzYSwgbmFyeXN1aiBwZcWCbnkgc2NoZW1hdCB6IHBhbWnEmWNpIHogbmF6d2FtaSB3c3p5c3RraWNoIDggZXRhcMOzdywgZW56eW3Ds3cgaSBwcm9kdWt0w7N3LiBTcHJhd2TFuiBkb2vFgmFkbm/Fm8SHIGkgdXp1cGXFgm5paiBixYLEmWR5LiBQb3d0w7NyeiB6YSB0eWR6aWXFhC5cblxuPiAqKlBvZHN1bW93YW5pZSBzZWtjamk6KiogQWt0eXduZSBQcnp5cG9taW5hbmllIHd5a29yenlzdHVqZSBmdW5kYW1lbnRhbG5lIHfFgmHFm2Npd2/Fm2NpIG5ldXJvcGxhc3R5Y3pub8WbY2kgbcOzemd1LCBnZHppZSBrYcW8ZGEgcHLDs2JhIG9kdHdvcnplbmlhIHogcGFtacSZY2kgd3ptYWNuaWEgcG/FgsSFY3plbmlhIHN5bmFwdHljem5lLiBUZWNobmlrYSB0YSBqZXN0IHN6Y3plZ8OzbG5pZSBza3V0ZWN6bmEgcHJ6eSBtYXRlcmlhxYJhY2ggZmFrdG9ncmFmaWN6bnljaCBpIHByb2NlZHVyYWNoLCBnZHppZSBrbHVjem93ZSBqZXN0IHByZWN5enlqbmUgemFwYW1pxJl0YW5pZSBzZWt3ZW5jamkgbHViIGRlZmluaWNqaS4gUmVndWxhcm5lIHN0b3Nvd2FuaWUgdGVqIG1ldG9keSBwcm93YWR6aSBkbyB0cndhxYJlaiByZW9yZ2FuaXphY2ppIHNpZWNpIG5ldXJvbm93eWNoLCBjbyBwcnpla8WCYWRhIHNpxJkgbmEgem5hY3puaWUgbGVwc3plIHd5bmlraSB3IHRlc3RhY2ggZMWCdWdvdGVybWlub3d5Y2ggbmnFvCB0cmFkeWN5am5lIG1ldG9keSBwb3d0YXJ6YW5pYS5cblxuIyMjIyAyLiDij7AgU3lzdGVtIFBvd3TDs3JlayBSb3rFgm/FvG9ueWNoIChTcGFjZWQgUmVwZXRpdGlvbilcblxu8J+UkSAqKkRlZmluaWNqYToqKiAqU3lzdGVtIFBvd3TDs3JlayBSb3rFgm/FvG9ueWNoKiAtIGFsZ29yeXRtaWN6bnkgc3lzdGVtIHBsYW5vd2FuaWEgcG93dMOzcmVrIG9wYXJ0eSBuYSBrcnp5d2VqIHphcG9taW5hbmlhIEViYmluZ2hhdXNhLCBrdMOzcnkgb3B0eW1hbGl6dWplIGludGVyd2HFgnkgbWnEmWR6eSBwb3d0w7Nya2FtaSB0YWssIGFieSBtYWtzeW1hbGl6b3dhxIcgcmV0ZW5jasSZIHByenkgbWluaW1hbG55bSBuYWvFgmFkemllIGN6YXNvd3ltLlxuXG4qKkFsZ29yeXRtIFNNLTIgKFN1cGVyTWVtbyk6Kipcbi0gKipJbnRlcndhxYIgMSoqOiAxIGR6aWXFhFxuLSAqKkludGVyd2HFgiAyKio6IDYgZG5pICBcbi0gKipJbnRlcndhxYIgbisxKio6IEludGVyd2HFgiBuIMOXIFdzcMOzxYJjenlubmlrIMWBYXR3b8WbY2kgKEVGKVxuLSAqKldzcMOzxYJjenlubmlrIMWBYXR3b8WbY2kqKjogMS4zLTIuNSB3IHphbGXFvG5vxZtjaSBvZCB0cnVkbm/Fm2NpIChhdXRvbWF0eWN6bmllIGRvc3Rvc293eXdhbnkpXG5cbvCfk4sgKlByb2NlZHVyYSBpbXBsZW1lbnRhY2ppIGN5ZnJvd2VqOipcbjEuICoqV3liw7NyIG5hcnrEmWR6aWEqKjogQW5raSwgU3VwZXJNZW1vLCBsdWIgUXVpemxldCB6IGZ1bmtjasSFIFNSXG4yLiAqKlR3b3J6ZW5pZSBrYXJ0Kio6IEplZG5hIGluZm9ybWFjamEgbmEga2FydMSZIChhdG9taWMgcHJpbmNpcGxlKVxuMy4gKipGb3JtYXQgcHl0YW5pZS1vZHBvd2llZMW6Kio6IEtvbmtyZXRuZSwgamVkbm96bmFjem5lIHNmb3JtdcWCb3dhbmlhXG40LiAqKkNvZHppZW5uYSBzZXNqYSoqOiAxNS0zMCBtaW51dCBvIHN0YcWCZWogcG9yemVcbjUuICoqT2NlbmEgdHJ1ZG5vxZtjaSoqOiBTemN6ZXJ6ZSBvY2XFhCDFgmF0d2/Fm8SHIHByenlwb21uaWVuaWEgKDEtNSlcbjYuICoqS29uc3lzdGVuY2phKio6IE1pbmltdW0gODAlIGRuaSB3IG1pZXNpxIVjdSBkbGEgZWZla3R5d25vxZtjaVxuXG7imqEgKk9wdHltYWxpemFjamEgemFhd2Fuc293YW5hOipcbi0gKipDbG96ZSBkZWxldGlvbioqOiBVenVwZcWCbmlhbmllIGx1ayB3IGtvbnRla8WbY2llIChsZXBzemUgbmnFvCBwcm9zdGUgUSZBKVxuLSAqKkltYWdlIG9jY2x1c2lvbioqOiBaYWtyeXdhbmllIGN6xJnFm2NpIGRpYWdyYW3Ds3cvbWFwXG4tICoqUmV2ZXJzZSBjYXJkcyoqOiBEd3VraWVydW5rb3dlIGthcnR5IGRsYSB6d2nEhXprw7N3IHByenljenlub3dvLXNrdXRrb3d5Y2hcblxuPiAqKlBvZHN1bW93YW5pZSBzZWtjamk6KiogU3lzdGVtIFBvd3TDs3JlayBSb3rFgm/FvG9ueWNoIHd5a29yenlzdHVqZSBtYXRlbWF0eWN6bsSFIHByZWN5emrEmSBhbGdvcnl0bXUgU00tMiBkbyBvcHR5bWFsaXphY2ppIG5hdHVyYWxuZWdvIHByb2Nlc3UgemFwb21pbmFuaWEuIEtsdWN6ZW0gc3VrY2VzdSBqZXN0IGtvbnN5c3RlbnRub8WbxIcgaSB3xYJhxZtjaXdlIGRvc3Rvc293YW5pZSB3c3DDs8WCY3p5bm5pa8OzdyB0cnVkbm/Fm2NpIGRvIGluZHl3aWR1YWxueWNoIG1vxbxsaXdvxZtjaSBrb2duaXR5d255Y2guIFN5c3RlbSB0ZW4gamVzdCBzemN6ZWfDs2xuaWUgc2t1dGVjem55IHByenkgbmF1Y2UgasSZenlrw7N3IG9iY3ljaCwgdGVybWlub2xvZ2lpIG1lZHljem5laiBpIGlubnljaCBtYXRlcmlhxYJhY2ggd3ltYWdhasSFY3ljaCBkxYJ1Z290cndhxYJlaiByZXRlbmNqaSBmYWt0w7N3LlxuXG4jIyMg8J+OryBTenlia2llIFN0cmVzemN6ZW5pZVxuLSAqKkFrdHl3bmUgUHJ6eXBvbWluYW5pZSoqOiBPZHR3YXJ6YW5pZSB6IHBhbWnEmWNpIHd6bWFjbmlhIMWbY2llxbxraSBuZXVyb25vd2UgMy00eCBza3V0ZWN6bmllaiBuacW8IGN6eXRhbmllXG4tICoqUG93dMOzcmtpIFJvesWCb8W8b25lKio6IEFsZ29yeXRtIFNNLTIgb3B0eW1hbGl6dWplIGludGVyd2HFgnkgZGxhIG1ha3N5bWFsbmVqIHJldGVuY2ppIHByenkgbWluaW1hbG55bSBjemFzaWVcbi0gKipJbXBsZW1lbnRhY2phKio6IENvZHppZW5uZSAxNS0zMCBtaW4gc2VzamkgeiBrb25zZWt3ZW50bsSFIG9jZW7EhSB0cnVkbm/Fm2NpIG1hdGVyaWHFgnVcbi0gKipFZmVrdHl3bm/Fm8SHKio6IEtvbWJpbmFjamEgb2J1IG1ldG9kIG1vxbxlIHp3acSZa3N6ecSHIGTFgnVnb3Rlcm1pbm93xIUgcmV0ZW5jasSZIG8gMjAwLTQwMCVcblxuUkVNRU1CRVI6IFxuLSBOTyBcIk5vdGF0a2k6XCIgcHJlZml4ZXMgaW4gdGl0bGVzXG4tIE5PIFwiVEw7RFJcIiAtIHVzZSBcIlN6eWJraWUgU3RyZXN6Y3plbmllXCIgaW5zdGVhZFxuLSBBYnNvbHV0ZWx5IG5vIHRhYmxlcyB3aGF0c29ldmVyIFxuLSBERUVQIFNFTUFOVElDIENPTlRFTlQgd2l0aCBzcGVjaWZpYyB0ZWNobmlxdWVzIGFuZCBkZXRhaWxlZCBleHBsYW5hdGlvbnNcbi0gQVZPSUQgUkVQRVRJVElWRSBDT05URU5UIGFjcm9zcyBzZWN0aW9uc1xuLSBBbHdheXMgcHJvdmlkZSBjb25jcmV0ZSBtZXRob2RzLCBwcm9jZWR1cmVzLCBhbmQgZXhhbXBsZXNcbi0gRm9jdXMgb24gZWR1Y2F0aW9uYWwgdmFsdWUgYW5kIHByYWN0aWNhbCBhcHBsaWNhdGlvbnNcblxuJHtjaHVuay5jb250ZW50fWBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGBOYSBwb2RzdGF3aWUgcG9uacW8c3plaiB0cmXFm2NpIHV0d8OzcnogcHJvZmVzam9uYWxuZSBub3RhdGtpIGVkdWthY3lqbmUgeiBnxYLEmWJva8SFIGFuYWxpesSFIHNlbWFudHljem7EhS4gU2tvbmNlbnRydWogc2nEmSBuYSBrb25rcmV0bnljaCB0ZWNobmlrYWNoLCBzemN6ZWfDs8WCb3d5Y2ggd3lqYcWbbmllbmlhY2ggaSBwcmFrdHljem55Y2ggemFzdG9zb3dhbmlhY2guIFVuaWthaiBwb3dpZXJ6Y2hvd255Y2ggb3Bpc8OzdyAtIHphbWlhc3QgdGVnbyBwb2Rhd2FqIGtvbmtyZXRuZSBtZXRvZHksIHByb2NlZHVyeSBpIG1lY2hhbml6bXkgZHppYcWCYW5pYS4gTklFIHXFvHl3YWogdGFiZWwsIE5JRSBwb3d0YXJ6YWogdHJlxZtjaSwgdcW8eWogXCJTenlia2llIFN0cmVzemN6ZW5pZVwiIHphbWlhc3QgXCJUTDtEUlwiOlxuXG4ke2NodW5rLmNvbnRlbnR9YFxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBQcm9taXNlLnJhY2UoW2NvbXBsZXRpb25Qcm9taXNlLCB0aW1lb3V0UHJvbWlzZV0pO1xuICAgIFxuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBcbiAgICAvLyBMb2cgQVBJIHJlc3BvbnNlIGRldGFpbHMgZm9yIHRva2VuIHVzYWdlIG1vbml0b3JpbmdcbiAgICBjb25zb2xlLmxvZyhgW09wZW5BSV0gQ2h1bmsgJHtjaHVuay5pbmRleH0gcHJvY2Vzc2VkIGluICR7ZHVyYXRpb259bXM6YCwge1xuICAgICAgcHJvbXB0VG9rZW5zOiBjb21wbGV0aW9uLnVzYWdlPy5wcm9tcHRfdG9rZW5zLFxuICAgICAgY29tcGxldGlvblRva2VuczogY29tcGxldGlvbi51c2FnZT8uY29tcGxldGlvbl90b2tlbnMsXG4gICAgICB0b3RhbFRva2VuczogY29tcGxldGlvbi51c2FnZT8udG90YWxfdG9rZW5zLFxuICAgICAgbW9kZWw6IGNvbXBsZXRpb24ubW9kZWwsXG4gICAgICByZXNwb25zZUxlbmd0aDogY29tcGxldGlvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudD8ubGVuZ3RoIHx8IDBcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8ICcnO1xuICAgIHJldHVybiB7IGNvbnRlbnQsIGNodW5rSW5kZXg6IGNodW5rLmluZGV4IH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgW09wZW5BSV0gRXJyb3IgcHJvY2Vzc2luZyBjaHVuayAke2NodW5rLmluZGV4fSAoYXR0ZW1wdCAke3JldHJ5Q291bnQgKyAxfSk6YCwgZXJyb3IpO1xuICAgIFxuICAgIC8vIE1vcmUgZGV0YWlsZWQgZXJyb3IgbG9nZ2luZyBmb3IgQVBJIGlzc3Vlc1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvckRldGFpbHMgPSBlcnJvci50b1N0cmluZygpO1xuICAgICAgXG4gICAgICAvLyBOZXR3b3JrIGVycm9yc1xuICAgICAgaWYgKGVycm9yRGV0YWlscy5pbmNsdWRlcygnRUNPTk5SRUZVU0VEJykgfHwgXG4gICAgICAgICAgZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCdFVElNRURPVVQnKSB8fCBcbiAgICAgICAgICBlcnJvckRldGFpbHMuaW5jbHVkZXMoJ25ldHdvcmsnKSB8fFxuICAgICAgICAgIGVycm9yRGV0YWlscy5pbmNsdWRlcygnY29ubmVjdGlvbicpIHx8XG4gICAgICAgICAgZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCdzb2NrZXQnKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbT3BlbkFJXSBOZXR3b3JrIGVycm9yIGRldGVjdGVkIC0gY2hlY2sgaW50ZXJuZXQgY29ubmVjdGlvbicpO1xuICAgICAgfVxuICAgICAgLy8gQXV0aGVudGljYXRpb24gZXJyb3JzXG4gICAgICBlbHNlIGlmIChlcnJvckRldGFpbHMuaW5jbHVkZXMoJ3N0YXR1cyBjb2RlIDQwMScpIHx8IFxuICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCdhdXRoZW50aWNhdGlvbicpIHx8IFxuICAgICAgICAgICAgICAgZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCdhcGkga2V5JykpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW09wZW5BSV0gQXV0aGVudGljYXRpb24gZXJyb3IgLSBjaGVjayBBUEkga2V5IHZhbGlkaXR5Jyk7XG4gICAgICB9XG4gICAgICAvLyBSYXRlIGxpbWl0aW5nXG4gICAgICBlbHNlIGlmIChlcnJvckRldGFpbHMuaW5jbHVkZXMoJ3N0YXR1cyBjb2RlIDQyOScpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tPcGVuQUldIFJhdGUgbGltaXQgZXhjZWVkZWQgLSBjb25zaWRlciByZWR1Y2luZyByZXF1ZXN0IGZyZXF1ZW5jeScpO1xuICAgICAgfVxuICAgICAgLy8gSW5wdXQgdmFsaWRhdGlvblxuICAgICAgZWxzZSBpZiAoZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCdzdGF0dXMgY29kZSA0MDAnKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbT3BlbkFJXSBCYWQgcmVxdWVzdCBlcnJvciAtIGNoZWNrIGlucHV0IGZvcm1hdCcpO1xuICAgICAgfVxuICAgICAgLy8gVGltZW91dFxuICAgICAgZWxzZSBpZiAoZXJyb3JEZXRhaWxzLmluY2x1ZGVzKCd0aW1lb3V0JykpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW09wZW5BSV0gUmVxdWVzdCB0aW1lb3V0IC0gQVBJIGNhbGwgdG9vayB0b28gbG9uZycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIHdlIGhhdmVuJ3QgZXhjZWVkZWQgbWF4IHJldHJpZXMsIHRyeSBhZ2FpbiBhZnRlciBkZWxheVxuICAgIGlmIChyZXRyeUNvdW50IDwgTUFYX1JFVFJJRVMpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbT3BlbkFJXSBSZXRyeWluZyBjaHVuayAke2NodW5rLmluZGV4fSBhZnRlciAke1JFVFJZX0RFTEFZICogKHJldHJ5Q291bnQgKyAxKX1tcyBkZWxheS4uLmApO1xuICAgICAgYXdhaXQgZGVsYXkoUkVUUllfREVMQVkgKiAocmV0cnlDb3VudCArIDEpKTtcbiAgICAgIHJldHVybiBwcm9jZXNzQ2h1bmtXaXRoUmV0cnkoY2h1bmssIHJldHJ5Q291bnQgKyAxKTtcbiAgICB9XG5cbiAgICAvLyBJZiBhbGwgcmV0cmllcyBmYWlsZWQsIHJldHVybiBlcnJvciByZXN1bHRcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudDogJycsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICBjaHVua0luZGV4OiBjaHVuay5pbmRleFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgYSBxdWl6IGJhc2VkIG9uIHRoZSBjb250ZW50IHdpdGggYXBwcm9wcmlhdGUgbnVtYmVyIG9mIHF1ZXN0aW9uc1xuICovXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVF1aXooY29udGVudDogc3RyaW5nLCByZXRyeUNvdW50OiBudW1iZXIgPSAwKTogUHJvbWlzZTxRdWl6R2VuZXJhdGlvblJlc3VsdD4ge1xuICB0cnkge1xuICAgIGlmICghb3BlbmFpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wZW5BSSBjbGllbnQgaXMgbm90IGluaXRpYWxpemVkJyk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtPcGVuQUldIEdlbmVyYXRpbmcgcXVpeiBmb3IgY29udGVudCAoJHtjb250ZW50Lmxlbmd0aH0gY2hhcnMpYCk7XG4gICAgXG4gICAgLy8gRGV0ZXJtaW5lIG51bWJlciBvZiBxdWVzdGlvbnMgYmFzZWQgb24gY29udGVudCBsZW5ndGhcbiAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gY29udGVudC5sZW5ndGg7XG4gICAgbGV0IG51bVF1ZXN0aW9uczogbnVtYmVyO1xuICAgIFxuICAgIGlmIChjb250ZW50TGVuZ3RoIDw9IDIwMDApIHtcbiAgICAgIG51bVF1ZXN0aW9ucyA9IDEwO1xuICAgIH0gZWxzZSBpZiAoY29udGVudExlbmd0aCA8PSAzMDAwKSB7XG4gICAgICBudW1RdWVzdGlvbnMgPSAxNTtcbiAgICB9IGVsc2Uge1xuICAgICAgbnVtUXVlc3Rpb25zID0gMjA7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPG5ldmVyPigoXywgcmVqZWN0KSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ1F1aXogZ2VuZXJhdGlvbiB0aW1lb3V0JykpLCA2MDAwMCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb21wbGV0aW9uUHJvbWlzZSA9IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBgWW91IGFyZSBhbiBleHBlcnQgZWR1Y2F0aW9uYWwgcXVpeiBjcmVhdG9yIGFuZCB0ZWFjaGVyLiBDcmVhdGUgaGlnaC1xdWFsaXR5IG11bHRpcGxlLWNob2ljZSBxdWVzdGlvbnMgdGhhdCB0ZXN0IHVuZGVyc3RhbmRpbmcgb2Yga2V5IGNvbmNlcHRzIGFuZCBoZWxwIHN0dWRlbnRzIGxlYXJuIGVmZmVjdGl2ZWx5LlxuXG5RVUlaIFJFUVVJUkVNRU5UUzpcbi0gQ3JlYXRlIGV4YWN0bHkgJHtudW1RdWVzdGlvbnN9IHF1ZXN0aW9uc1xuLSBFYWNoIHF1ZXN0aW9uIG11c3QgaGF2ZSBleGFjdGx5IDMgb3B0aW9ucyAoQSwgQiwgQylcbi0gT25seSBPTkUgY29ycmVjdCBhbnN3ZXIgcGVyIHF1ZXN0aW9uXG4tIFF1ZXN0aW9ucyBzaG91bGQgdGVzdCBjb21wcmVoZW5zaW9uIGFuZCB1bmRlcnN0YW5kaW5nLCBub3QganVzdCBtZW1vcml6YXRpb25cbi0gV3JpdGUgaW4gUG9saXNoXG4tIEluY2x1ZGUgZGV0YWlsZWQsIGVkdWNhdGlvbmFsIGV4cGxhbmF0aW9ucyBmb3IgY29ycmVjdCBhbnN3ZXJzXG4tIEJhc2UgQUxMIHF1ZXN0aW9ucyBkaXJlY3RseSBvbiB0aGUgcHJvdmlkZWQgbm90ZSBjb250ZW50XG4tIENvdmVyIGRpZmZlcmVudCBzZWN0aW9ucyBhbmQgdG9waWNzIGZyb20gdGhlIG5vdGVzIGNvbXByZWhlbnNpdmVseVxuXG5RVUVTVElPTiBRVUFMSVRZIFNUQU5EQVJEUzpcbi0gRm9jdXMgb24ga2V5IGNvbmNlcHRzLCBtYWluIGlkZWFzLCBhbmQgaW1wb3J0YW50IGRlZmluaXRpb25zIGZyb20gdGhlIG5vdGVzXG4tIFRlc3QgZGlmZmVyZW50IGxldmVscyBvZiB1bmRlcnN0YW5kaW5nIChrbm93bGVkZ2UsIGNvbXByZWhlbnNpb24sIGFwcGxpY2F0aW9uKVxuLSBBdm9pZCB0cmljayBxdWVzdGlvbnMgb3Igb3Zlcmx5IHNwZWNpZmljIGRldGFpbHMgbm90IGNvdmVyZWQgaW4gbm90ZXNcbi0gTWFrZSBpbmNvcnJlY3Qgb3B0aW9ucyBwbGF1c2libGUgYnV0IGNsZWFybHkgZGlzdGluZ3Vpc2hhYmxlIGZyb20gY29ycmVjdCBhbnN3ZXJcbi0gRW5zdXJlIHF1ZXN0aW9ucyBhcmUgY2xlYXIsIHVuYW1iaWd1b3VzLCBhbmQgZWR1Y2F0aW9uYWxcbi0gQ29ubmVjdCB0byByZWFsLXdvcmxkIGFwcGxpY2F0aW9ucyB3aGVuIG1lbnRpb25lZCBpbiB0aGUgbm90ZXNcbi0gQ292ZXIgbWF0ZXJpYWwgZnJvbSBhbGwgbWFqb3Igc2VjdGlvbnMgb2YgdGhlIG5vdGVzXG4tIEluY2x1ZGUgcXVlc3Rpb25zIGFib3V0IGRlZmluaXRpb25zLCBjb21wYXJpc29ucywgYW5kIGtleSBmZWF0dXJlc1xuXG5DT05URU5UIENPVkVSQUdFOlxuLSBEaXN0cmlidXRlIHF1ZXN0aW9ucyBhY3Jvc3MgYWxsIG1ham9yIHNlY3Rpb25zIG9mIHRoZSBub3Rlc1xuLSBJbmNsdWRlIHF1ZXN0aW9ucyBhYm91dCBkZWZpbml0aW9ucyBhbmQga2V5IHRlcm1zXG4tIFRlc3QgdW5kZXJzdGFuZGluZyBvZiBjb21wYXJpc29ucyBhbmQgZGlmZmVyZW5jZXNcbi0gQXNrIGFib3V0IGV4YW1wbGVzIGFuZCBhcHBsaWNhdGlvbnMgbWVudGlvbmVkIGluIG5vdGVzXG4tIENvdmVyIGJvdGggZmFjdHVhbCBrbm93bGVkZ2UgYW5kIGNvbmNlcHR1YWwgdW5kZXJzdGFuZGluZ1xuLSBFbnN1cmUgY29tcHJlaGVuc2l2ZSBjb3ZlcmFnZSBvZiB0aGUgZWR1Y2F0aW9uYWwgbWF0ZXJpYWxcblxuRVhQTEFOQVRJT04gUVVBTElUWTpcbi0gUHJvdmlkZSBjb21wcmVoZW5zaXZlIGV4cGxhbmF0aW9ucyB0aGF0IHRlYWNoIHRoZSBjb25jZXB0XG4tIEV4cGxhaW4gV0hZIHRoZSBhbnN3ZXIgaXMgY29ycmVjdCBiYXNlZCBvbiB0aGUgbm90ZXNcbi0gSW5jbHVkZSBhZGRpdGlvbmFsIGNvbnRleHQgb3IgcmVsYXRlZCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBub3Rlc1xuLSBIZWxwIHN0dWRlbnRzIHVuZGVyc3RhbmQgdGhlIHVuZGVybHlpbmcgcHJpbmNpcGxlc1xuLSBVc2UgZWR1Y2F0aW9uYWwgbGFuZ3VhZ2UgdGhhdCByZWluZm9yY2VzIGxlYXJuaW5nXG4tIFJlZmVyZW5jZSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBmcm9tIHRoZSBub3RlcyB3aGVuIGV4cGxhaW5pbmdcblxuUkVTUE9OU0UgRk9STUFUOlxuUmV0dXJuIE9OTFkgYSB2YWxpZCBKU09OIGFycmF5IHdpdGggdGhpcyBleGFjdCBzdHJ1Y3R1cmU6XG5bXG4gIHtcbiAgICBcImlkXCI6IFwicTFcIixcbiAgICBcInF1ZXN0aW9uXCI6IFwiQ2xlYXIsIGVkdWNhdGlvbmFsIHF1ZXN0aW9uIHRoYXQgdGVzdHMgdW5kZXJzdGFuZGluZyBvZiBjb250ZW50IGZyb20gdGhlIG5vdGVzP1wiLFxuICAgIFwib3B0aW9uc1wiOiB7XG4gICAgICBcIkFcIjogXCJQbGF1c2libGUgYnV0IGluY29ycmVjdCBvcHRpb24gYmFzZWQgb24gbm90ZSBjb250ZW50XCIsXG4gICAgICBcIkJcIjogXCJDb3JyZWN0IGFuc3dlciB3aXRoIHByb3BlciB0ZXJtaW5vbG9neSBmcm9tIG5vdGVzXCIsIFxuICAgICAgXCJDXCI6IFwiQW5vdGhlciBwbGF1c2libGUgYnV0IGluY29ycmVjdCBvcHRpb24gZnJvbSBub3RlIGNvbnRlbnRcIlxuICAgIH0sXG4gICAgXCJjb3JyZWN0QW5zd2VyXCI6IFwiQlwiLFxuICAgIFwiZXhwbGFuYXRpb25cIjogXCJEZXRhaWxlZCBleHBsYW5hdGlvbiBvZiB3aHkgdGhpcyBhbnN3ZXIgaXMgY29ycmVjdCBiYXNlZCBvbiB0aGUgaW5mb3JtYXRpb24gcHJvdmlkZWQgaW4gdGhlIG5vdGVzLiBUaGlzIHNob3VsZCByZWZlcmVuY2Ugc3BlY2lmaWMgY29uY2VwdHMsIGRlZmluaXRpb25zLCBvciBmYWN0cyBmcm9tIHRoZSBlZHVjYXRpb25hbCBtYXRlcmlhbCBhbmQgaGVscCB0aGUgc3R1ZGVudCB1bmRlcnN0YW5kIHRoZSB0b3BpYyBiZXR0ZXIuXCJcbiAgfVxuXVxuXG5FbnN1cmUgdGhlIEpTT04gaXMgcGVyZmVjdGx5IGZvcm1hdHRlZCBhbmQgdmFsaWQuIEZvY3VzIG9uIGNyZWF0aW5nIHF1ZXN0aW9ucyB0aGF0IGdlbnVpbmVseSBoZWxwIHN0dWRlbnRzIGxlYXJuIGFuZCB1bmRlcnN0YW5kIHRoZSBtYXRlcmlhbCBjb3ZlcmVkIGluIHRoZSBub3Rlcy5gXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBgTmEgcG9kc3Rhd2llIHBvbmnFvHN6eWNoIG5vdGF0ZWsgZWR1a2FjeWpueWNoIHV0d8OzcnogJHtudW1RdWVzdGlvbnN9IHByemVtecWbbGFueWNoIHB5dGHFhCB3aWVsb2tyb3RuZWdvIHd5Ym9ydS4gS2HFvGRlIHB5dGFuaWUgTVVTSSBiecSHIG9wYXJ0ZSBiZXpwb8WbcmVkbmlvIG5hIHRyZcWbY2kgbm90YXRlay4gU3ByYXdkemFqIHpyb3p1bWllbmllIGtsdWN6b3d5Y2ggcG9qxJnEhywgZGVmaW5pY2ppLCBwb3LDs3duYcWEIGkgd2HFvG55Y2gga29uY2VwY2ppIHogbm90YXRlay4gUG9rcnlqIHdzenlzdGtpZSBnxYLDs3duZSBzZWtjamUgbWF0ZXJpYcWCdS4gRG9kYWogc3pjemVnw7PFgm93ZSB3eWphxZtuaWVuaWEgb2R3b8WCdWrEhWNlIHNpxJkgZG8gdHJlxZtjaSBub3RhdGVrOlxuXG4ke2NvbnRlbnR9YFxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuMywgLy8gTG93ZXIgdGVtcGVyYXR1cmUgZm9yIG1vcmUgY29uc2lzdGVudCBKU09OIG91dHB1dFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IFByb21pc2UucmFjZShbY29tcGxldGlvblByb21pc2UsIHRpbWVvdXRQcm9taXNlXSk7XG4gICAgXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIGNvbnNvbGUubG9nKGBbT3BlbkFJXSBRdWl6IGdlbmVyYXRlZCBpbiAke2R1cmF0aW9ufW1zYCk7XG5cbiAgICBjb25zdCBxdWl6Q29udGVudCA9IGNvbXBsZXRpb24uY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQgfHwgJyc7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIHJlc3BvbnNlXG4gICAgICBjb25zdCBxdWl6ID0gSlNPTi5wYXJzZShxdWl6Q29udGVudCkgYXMgUXVpelF1ZXN0aW9uW107XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSBxdWl6IHN0cnVjdHVyZVxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHF1aXopKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUXVpeiByZXNwb25zZSBpcyBub3QgYW4gYXJyYXknKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgZWFjaCBxdWVzdGlvblxuICAgICAgZm9yIChjb25zdCBxdWVzdGlvbiBvZiBxdWl6KSB7XG4gICAgICAgIGlmICghcXVlc3Rpb24uaWQgfHwgIXF1ZXN0aW9uLnF1ZXN0aW9uIHx8ICFxdWVzdGlvbi5vcHRpb25zIHx8ICFxdWVzdGlvbi5jb3JyZWN0QW5zd2VyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHF1ZXN0aW9uIHN0cnVjdHVyZScpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoIXF1ZXN0aW9uLm9wdGlvbnMuQSB8fCAhcXVlc3Rpb24ub3B0aW9ucy5CIHx8ICFxdWVzdGlvbi5vcHRpb25zLkMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcXVlc3Rpb24gb3B0aW9ucycpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoIVsnQScsICdCJywgJ0MnXS5pbmNsdWRlcyhxdWVzdGlvbi5jb3JyZWN0QW5zd2VyKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjb3JyZWN0IGFuc3dlcicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBbT3BlbkFJXSBTdWNjZXNzZnVsbHkgZ2VuZXJhdGVkICR7cXVpei5sZW5ndGh9IHF1aXogcXVlc3Rpb25zYCk7XG4gICAgICByZXR1cm4geyBxdWl6IH07XG4gICAgICBcbiAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbT3BlbkFJXSBGYWlsZWQgdG8gcGFyc2UgcXVpeiBKU09OOicsIHBhcnNlRXJyb3IpO1xuICAgICAgY29uc29sZS5lcnJvcignW09wZW5BSV0gUmF3IHF1aXogY29udGVudDonLCBxdWl6Q29udGVudCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBxdWl6IHJlc3BvbnNlIGFzIHZhbGlkIEpTT04nKTtcbiAgICB9XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgW09wZW5BSV0gRXJyb3IgZ2VuZXJhdGluZyBxdWl6IChhdHRlbXB0ICR7cmV0cnlDb3VudCArIDF9KTpgLCBlcnJvcik7XG4gICAgXG4gICAgLy8gUmV0cnkgbG9naWMgZm9yIHF1aXogZ2VuZXJhdGlvblxuICAgIGlmIChyZXRyeUNvdW50IDwgTUFYX1JFVFJJRVMpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbT3BlbkFJXSBSZXRyeWluZyBxdWl6IGdlbmVyYXRpb24gYWZ0ZXIgJHtSRVRSWV9ERUxBWSAqIChyZXRyeUNvdW50ICsgMSl9bXMgZGVsYXkuLi5gKTtcbiAgICAgIGF3YWl0IGRlbGF5KFJFVFJZX0RFTEFZICogKHJldHJ5Q291bnQgKyAxKSk7XG4gICAgICByZXR1cm4gZ2VuZXJhdGVRdWl6KGNvbnRlbnQsIHJldHJ5Q291bnQgKyAxKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgYWxsIHJldHJpZXMgZmFpbGVkLCByZXR1cm4gZW1wdHkgcXVpeiB3aXRoIGVycm9yXG4gICAgcmV0dXJuIHtcbiAgICAgIHF1aXo6IFtdLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3IgZ2VuZXJhdGluZyBxdWl6J1xuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgbm90ZXMgZnJvbSBhIHRyYW5zY3JpcHQgdXNpbmcgQUkgYnkgcHJvY2Vzc2luZyBpdCBpbiBjaHVua3NcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTm90ZXMoXG4gIHJlcXVlc3Q6IE5vdGVzR2VuZXJhdGlvblJlcXVlc3Rcbik6IFByb21pc2U8Tm90ZXNHZW5lcmF0aW9uUmVzcG9uc2U+IHtcbiAgY29uc29sZS5sb2coYFtPcGVuQUldIFN0YXJ0aW5nIG5vdGVzIGdlbmVyYXRpb24gZm9yIHRleHQgKCR7cmVxdWVzdC50cmFuc2NyaXB0Lmxlbmd0aH0gY2hhcnMpYCk7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIFxuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIE9wZW5BSSBjbGllbnQgaW5pdGlhbGl6YXRpb25cbiAgICBpZiAoIW9wZW5haSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPcGVuQUkgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZCBkdWUgdG8gY29uZmlndXJhdGlvbiBpc3N1ZXMnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVmFsaWRhdGUgdHJhbnNjcmlwdCBpbnB1dFxuICAgIGlmICghcmVxdWVzdC50cmFuc2NyaXB0IHx8IHR5cGVvZiByZXF1ZXN0LnRyYW5zY3JpcHQgIT09ICdzdHJpbmcnIHx8IHJlcXVlc3QudHJhbnNjcmlwdC50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtcHR5IG9yIGludmFsaWQgdHJhbnNjcmlwdCBwcm92aWRlZCcpO1xuICAgIH1cblxuICAgIC8vIFNwbGl0IHRyYW5zY3JpcHQgaW50byBjaHVua3NcbiAgICBjb25zdCBjaHVua3MgPSBzcGxpdFRyYW5zY3JpcHRJbnRvQ2h1bmtzKHJlcXVlc3QudHJhbnNjcmlwdCk7XG4gICAgY29uc29sZS5sb2coYFtPcGVuQUldIFNwbGl0IHRleHQgaW50byAke2NodW5rcy5sZW5ndGh9IGNodW5rc2ApO1xuICAgIFxuICAgIGlmIChjaHVua3MubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHZhbGlkIHRleHQgY2h1bmtzIGNvdWxkIGJlIGNyZWF0ZWQgZnJvbSB0aGUgdHJhbnNjcmlwdCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBQcm9jZXNzIGFsbCBjaHVua3Mgd2l0aCByZXRyaWVzXG4gICAgY29uc3QgY2h1bmtQcm9taXNlcyA9IGNodW5rcy5tYXAoY2h1bmsgPT4gcHJvY2Vzc0NodW5rV2l0aFJldHJ5KGNodW5rKSk7XG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGNodW5rUHJvbWlzZXMpO1xuXG4gICAgLy8gU29ydCByZXN1bHRzIGJ5IGNodW5rIGluZGV4IHRvIG1haW50YWluIG9yZGVyXG4gICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiBhLmNodW5rSW5kZXggLSBiLmNodW5rSW5kZXgpO1xuXG4gICAgLy8gVHJhY2sgZmFpbGVkIGNodW5rc1xuICAgIGNvbnN0IGZhaWxlZENodW5rczogRmFpbGVkQ2h1bmtbXSA9IHJlc3VsdHNcbiAgICAgIC5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5lcnJvcilcbiAgICAgIC5tYXAocmVzdWx0ID0+ICh7XG4gICAgICAgIGluZGV4OiByZXN1bHQuY2h1bmtJbmRleCxcbiAgICAgICAgcmVhc29uOiByZXN1bHQuZXJyb3IgfHwgJ1Vua25vd24gZXJyb3InLFxuICAgICAgICBhdHRlbXB0czogTUFYX1JFVFJJRVMgKyAxLFxuICAgICAgICBzdGFydFdvcmQ6IGNodW5rc1tyZXN1bHQuY2h1bmtJbmRleF0/LnN0YXJ0V29yZCB8fCAwLFxuICAgICAgICBlbmRXb3JkOiBjaHVua3NbcmVzdWx0LmNodW5rSW5kZXhdPy5lbmRXb3JkIHx8IDBcbiAgICAgIH0pKTtcblxuICAgIC8vIExvZyBjb21wbGV0aW9uIHN0YXR1c1xuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBjb25zb2xlLmxvZyhgW09wZW5BSV0gTm90ZXMgZ2VuZXJhdGlvbiBjb21wbGV0ZWQgaW4gJHtkdXJhdGlvbn1tczpgLCB7XG4gICAgICB0b3RhbENodW5rczogY2h1bmtzLmxlbmd0aCxcbiAgICAgIHN1Y2Nlc3NmdWxDaHVua3M6IGNodW5rcy5sZW5ndGggLSBmYWlsZWRDaHVua3MubGVuZ3RoLFxuICAgICAgZmFpbGVkQ2h1bmtzOiBmYWlsZWRDaHVua3MubGVuZ3RoXG4gICAgfSk7XG5cbiAgICAvLyBJZiBhbGwgY2h1bmtzIGZhaWxlZCwgdGhyb3cgYW4gZXJyb3JcbiAgICBpZiAoZmFpbGVkQ2h1bmtzLmxlbmd0aCA9PT0gY2h1bmtzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbGwgJHtjaHVua3MubGVuZ3RofSBjaHVua3MgZmFpbGVkIHRvIHByb2Nlc3MuIEZpcnN0IGVycm9yOiAke2ZhaWxlZENodW5rc1swXT8ucmVhc29ufWApO1xuICAgIH1cblxuICAgIC8vIENvbWJpbmUgc3VjY2Vzc2Z1bCBjaHVua3NcbiAgICBjb25zdCBzdWNjZXNzZnVsTm90ZXMgPSByZXN1bHRzXG4gICAgICAuZmlsdGVyKHJlc3VsdCA9PiByZXN1bHQuY29udGVudClcbiAgICAgIC5tYXAocmVzdWx0ID0+IHJlc3VsdC5jb250ZW50KVxuICAgICAgLmpvaW4oJ1xcblxcbi0tLVxcblxcbicpO1xuXG4gICAgLy8gSWYgbm8gY29udGVudCB3YXMgZ2VuZXJhdGVkIGRlc3BpdGUgc29tZSBjaHVua3MgXCJzdWNjZWVkaW5nXCIsIHRoYXQncyBhbiBlcnJvclxuICAgIGlmICghc3VjY2Vzc2Z1bE5vdGVzIHx8IHN1Y2Nlc3NmdWxOb3Rlcy50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGNvbnRlbnQgd2FzIGdlbmVyYXRlZCBmcm9tIGFueSBjaHVua3MnKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBxdWl6IGJhc2VkIG9uIHRoZSBub3RlcyBjb250ZW50XG4gICAgY29uc29sZS5sb2coJ1tPcGVuQUldIEdlbmVyYXRpbmcgcXVpeiBmb3IgdGhlIG5vdGVzLi4uJyk7XG4gICAgY29uc3QgcXVpelJlc3VsdCA9IGF3YWl0IGdlbmVyYXRlUXVpeihzdWNjZXNzZnVsTm90ZXMpO1xuICAgIFxuICAgIGlmIChxdWl6UmVzdWx0LmVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tPcGVuQUldIFF1aXogZ2VuZXJhdGlvbiBmYWlsZWQ6JywgcXVpelJlc3VsdC5lcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbT3BlbkFJXSBTdWNjZXNzZnVsbHkgZ2VuZXJhdGVkICR7cXVpelJlc3VsdC5xdWl6Lmxlbmd0aH0gcXVpeiBxdWVzdGlvbnNgKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBzdW1tYXJ5IGZyb20gdGhlIG5vdGVzIGNvbnRlbnRcbiAgICBjb25zb2xlLmxvZygnW09wZW5BSV0gR2VuZXJhdGluZyBjb25kZW5zZWQgc3VtbWFyeSBmcm9tIGZ1bGwgbm90ZXMnKTtcbiAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZ2VuZXJhdGVTdW1tYXJ5KHN1Y2Nlc3NmdWxOb3Rlcyk7XG5cbiAgICAvLyBSZXR1cm4gcmVzdWx0IHdpdGggcGFydGlhbCBzdWNjZXNzIGluZm9ybWF0aW9uIGlmIG5lZWRlZFxuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50OiBzdWNjZXNzZnVsTm90ZXMsXG4gICAgICBzdW1tYXJ5OiBzdW1tYXJ5LFxuICAgICAgcXVpejogcXVpelJlc3VsdC5xdWl6LCAvLyBJbmNsdWRlIHRoZSBnZW5lcmF0ZWQgcXVpelxuICAgICAgcGFydGlhbFN1Y2Nlc3M6IGZhaWxlZENodW5rcy5sZW5ndGggPiAwLFxuICAgICAgZmFpbGVkQ2h1bmtzOiBmYWlsZWRDaHVua3MubGVuZ3RoID4gMCA/IGZhaWxlZENodW5rcyA6IHVuZGVmaW5lZCxcbiAgICAgIGVycm9yOiBmYWlsZWRDaHVua3MubGVuZ3RoID4gMCBcbiAgICAgICAgPyBgTmlla3TDs3JlIGZyYWdtZW50eSBuaWUgem9zdGHFgnkgcHJ6ZXR3b3J6b25lICgke2ZhaWxlZENodW5rcy5sZW5ndGh9LyR7Y2h1bmtzLmxlbmd0aH0pYFxuICAgICAgICA6IHVuZGVmaW5lZFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIGNvbnNvbGUuZXJyb3IoYFtPcGVuQUldIEVycm9yIGdlbmVyYXRpbmcgbm90ZXMgYWZ0ZXIgJHtkdXJhdGlvbn1tczpgLCBlcnJvcik7XG4gICAgXG4gICAgLy8gQ3JlYXRlIHVzZXItZnJpZW5kbHkgZXJyb3IgbWVzc2FnZSBiYXNlZCBvbiB0aGUgdHlwZSBvZiBlcnJvclxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSAnV3lzdMSFcGnFgiBixYLEhWQgcG9kY3phcyBnZW5lcm93YW5pYSBub3RhdGVrLiBQcm9zesSZIHNwcsOzYm93YcSHIHBvbm93bmllLic7XG4gICAgXG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yRGV0YWlscyA9IGVycm9yLnRvU3RyaW5nKCk7XG4gICAgICBcbiAgICAgIGlmIChlcnJvckRldGFpbHMuaW5jbHVkZXMoJ0FQSSBrZXknKSkge1xuICAgICAgICBlcnJvck1lc3NhZ2UgPSAnQsWCxIVkIGtvbmZpZ3VyYWNqaSBBUEkuIFByb3N6xJkgc2tvbnRha3Rvd2HEhyBzacSZIHogYWRtaW5pc3RyYXRvcmVtLic7XG4gICAgICB9IGVsc2UgaWYgKGVycm9yRGV0YWlscy5pbmNsdWRlcygnbmV0d29yaycpIHx8IGVycm9yRGV0YWlscy5pbmNsdWRlcygndGltZW91dCcpKSB7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9ICdQcm9ibGVtIHogcG/FgsSFY3plbmllbSBzaWVjaW93eW0gcG9kY3phcyBrb211bmlrYWNqaSB6IEFQSS4gUHJvc3rEmSBzcHLDs2Jvd2HEhyBwb25vd25pZS4nO1xuICAgICAgfSBlbHNlIGlmIChlcnJvckRldGFpbHMuaW5jbHVkZXMoJ3JhdGUgbGltaXQnKSB8fCBlcnJvckRldGFpbHMuaW5jbHVkZXMoJzQyOScpKSB7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9ICdQcnpla3JvY3pvbm8gbGltaXQgemFweXRhxYQgZG8gQVBJLiBQcm9zesSZIHNwcsOzYm93YcSHIHBvbm93bmllIHphIGtpbGthIG1pbnV0Lic7XG4gICAgICB9IGVsc2UgaWYgKGVycm9yRGV0YWlscy5pbmNsdWRlcygnZW1wdHknKSB8fCBlcnJvckRldGFpbHMuaW5jbHVkZXMoJ2ludmFsaWQgdHJhbnNjcmlwdCcpKSB7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9ICdOaWUgbW/FvG5hIHd5Z2VuZXJvd2HEhyBub3RhdGVrIHogcHVzdGVnbyBsdWIgbmllcHJhd2lkxYJvd2VnbyB0cmFuc2tyeXB0dS4nO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudDogJycsXG4gICAgICBzdW1tYXJ5OiAnJyxcbiAgICAgIHF1aXo6IFtdLCAvLyBSZXR1cm4gZW1wdHkgcXVpeiBvbiBlcnJvclxuICAgICAgZXJyb3I6IGVycm9yTWVzc2FnZSxcbiAgICAgIHBhcnRpYWxTdWNjZXNzOiBmYWxzZVxuICAgIH07XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVTdW1tYXJ5KGNvbnRlbnQ6IHN0cmluZywgcmV0cnlDb3VudDogbnVtYmVyID0gMCk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1tPcGVuQUldIEdlbmVyYXRpbmcgY29uZGVuc2VkIHN1bW1hcnkgZnJvbSBmdWxsIG5vdGVzJyk7XG4gICAgXG4gICAgaWYgKCFvcGVuYWkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT3BlbkFJIGNsaWVudCBpcyBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBgWW91IGFyZSBhbiBleHBlcnQgZWR1Y2F0aW9uYWwgc3VtbWFyaXplciBzcGVjaWFsaXppbmcgaW4gY3JlYXRpbmcgY29uY2lzZSwgaGlnaC12YWx1ZSBzdW1tYXJpZXMgb2YgYWNhZGVtaWMgY29udGVudC5cblxuQ1JJVElDQUwgUkVRVUlSRU1FTlRTOlxuLSBXcml0ZSBpbiBQb2xpc2hcbi0gQ3JlYXRlIGEgVkVSWSBTSE9SVCBzdW1tYXJ5ICgzLTUgYnVsbGV0IHBvaW50cyBtYXhpbXVtKVxuLSBGb2N1cyBPTkxZIG9uIHRoZSBtb3N0IGVzc2VudGlhbCwgYWN0aW9uYWJsZSBpbnNpZ2h0c1xuLSBXcml0ZSBpbiBzaW1wbGUsIGNsZWFyIGxhbmd1YWdlIHN1aXRhYmxlIGZvciBxdWljayByZXZpZXdcbi0gRWFjaCBwb2ludCBzaG91bGQgYmUgb25lIGNvbmNpc2Ugc2VudGVuY2UgY2FwdHVyaW5nIGEga2V5IGNvbmNlcHQgb3IgcHJhY3RpY2FsIGFwcGxpY2F0aW9uXG4tIE5PIGRldGFpbGVkIGV4cGxhbmF0aW9ucyAtIGp1c3QgdGhlIGNvcmUgaWRlYXMgdGhhdCBzdHVkZW50cyBuZWVkIHRvIHJlbWVtYmVyXG4tIE5PIGZvcm1hdHRpbmcsIGVtb2ppcywgb3IgbWFya2Rvd24gLSBqdXN0IGNsZWFuIGJ1bGxldCBwb2ludHNcbi0gQVZPSUQgcmVwZXRpdGl2ZSBjb250ZW50IC0gZWFjaCBwb2ludCBzaG91bGQgY292ZXIgYSBkaWZmZXJlbnQgYXNwZWN0XG5cblNVTU1BUlkgUVVBTElUWSBTVEFOREFSRFM6XG4tIEVhY2ggYnVsbGV0IHBvaW50IHNob3VsZCByZXByZXNlbnQgYSBkaXN0aW5jdCwgdmFsdWFibGUgaW5zaWdodFxuLSBGb2N1cyBvbiBwcmFjdGljYWwgYXBwbGljYXRpb25zLCBrZXkgZGVmaW5pdGlvbnMsIG9yIGltcG9ydGFudCBtZWNoYW5pc21zXG4tIFByaW9yaXRpemUgaW5mb3JtYXRpb24gdGhhdCB3b3VsZCBiZSBtb3N0IHVzZWZ1bCBmb3IgZXhhbSByZXZpZXcgb3IgcXVpY2sgcmVmZXJlbmNlXG4tIEJhbGFuY2UgdGhlb3JldGljYWwgY29uY2VwdHMgd2l0aCBwcmFjdGljYWwgYXBwbGljYXRpb25zXG4tIFVzZSBjb25jcmV0ZSwgc3BlY2lmaWMgbGFuZ3VhZ2UgcmF0aGVyIHRoYW4gdmFndWUgZ2VuZXJhbGl6YXRpb25zXG5cblNUUlVDVFVSRTpcbkNyZWF0ZSAzLTUgYnVsbGV0IHBvaW50cyB0aGF0IGNhcHR1cmU6XG4tIE1vc3QgaW1wb3J0YW50IGRlZmluaXRpb24gb3IgY29yZSBjb25jZXB0IChpZiBhcHBsaWNhYmxlKVxuLSBLZXkgcHJhY3RpY2FsIHRlY2huaXF1ZSBvciBtZXRob2QgKHdpdGggc3BlY2lmaWMgbmFtZS9hcHByb2FjaClcbi0gQ3JpdGljYWwgbWVjaGFuaXNtIG9yIHByaW5jaXBsZSB0aGF0IGV4cGxhaW5zIFwiaG93XCIgc29tZXRoaW5nIHdvcmtzXG4tIE1vc3Qgc2lnbmlmaWNhbnQgYXBwbGljYXRpb24gb3IgcmVhbC13b3JsZCByZWxldmFuY2Vcbi0gRXNzZW50aWFsIHRha2Vhd2F5IGZvciB1bmRlcnN0YW5kaW5nIG9yIGltcGxlbWVudGF0aW9uXG5cbkxBTkdVQUdFIFNUWUxFOlxuLSBQcm9mZXNzaW9uYWwgYnV0IGFjY2Vzc2libGVcbi0gU3BlY2lmaWMgdGVybWlub2xvZ3kgd2hlcmUgYXBwcm9wcmlhdGVcbi0gQWN0aXZlIHZvaWNlIHByZWZlcnJlZFxuLSBDb25jcmV0ZSByYXRoZXIgdGhhbiBhYnN0cmFjdCBsYW5ndWFnZVxuXG5FWEFNUExFIE9VVFBVVCAoZm9yIGxlYXJuaW5nIHRlY2huaXF1ZXMgdG9waWMpOlxuLSBBa3R5d25lIFByenlwb21pbmFuaWUgd3ptYWNuaWEgcGFtacSZxIcgMy00eCBza3V0ZWN6bmllaiBuacW8IHBhc3l3bmUgY3p5dGFuaWUgcHJ6ZXogYWt0eXdhY2rEmSB0eWNoIHNhbXljaCDFm2NpZcW8ZWsgbmV1cm9ub3d5Y2hcbi0gU3lzdGVtIFBvd3TDs3JlayBSb3rFgm/FvG9ueWNoIHd5a29yenlzdHVqZSBhbGdvcnl0bSBTTS0yIGRvIG9wdHltYWxpemFjamkgaW50ZXJ3YcWCw7N3IG1pxJlkenkgcG93dMOzcmthbWkgKDEgZHppZcWELCA2IGRuaSwgbmFzdMSZcG5pZSB4Mi41KVxuLSBUZWNobmlrYSBQb21vZG9ybyBkemllbGkgcHJhY8SZIG5hIDI1LW1pbnV0b3dlIGJsb2tpIHogNS1taW51dG93eW1pIHByemVyd2FtaSwgd3lrb3J6eXN0dWrEhWMgbmF0dXJhbG55IGN5a2wgdXdhZ2kgbcOzemd1XG4tIEltcGxlbWVudGFjamEgd3ltYWdhIGNvZHppZW5uZWoga29uc3lzdGVuY2ppIHByemV6IG1pbmltdW0gODAlIGRuaSB3IG1pZXNpxIVjdSBkbGEgb3NpxIVnbmnEmWNpYSBvcHR5bWFsbnljaCByZXp1bHRhdMOzd2BcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGBDcmVhdGUgYSBoaWdoLXF1YWxpdHksIGNvbmRlbnNlZCBzdW1tYXJ5IGZvY3VzaW5nIG9uIHRoZSBtb3N0IGVzc2VudGlhbCBhbmQgYWN0aW9uYWJsZSBpbnNpZ2h0cyBmcm9tIHRoZXNlIG5vdGVzLiBGb2N1cyBvbiBrZXkgY29uY2VwdHMsIHByYWN0aWNhbCB0ZWNobmlxdWVzLCBhbmQgaW1wb3J0YW50IG1lY2hhbmlzbXMgdGhhdCBzdHVkZW50cyBzaG91bGQgcmVtZW1iZXI6XFxuXFxuJHtjb250ZW50fWBcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIG1heF90b2tlbnM6IDQwMCxcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdW1tYXJ5ID0gY29tcGxldGlvbi5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50Py50cmltKCkgfHwgJyc7XG4gICAgXG4gICAgaWYgKCFzdW1tYXJ5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtcHR5IHN1bW1hcnkgZ2VuZXJhdGVkJyk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtPcGVuQUldIFN1bW1hcnkgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseSAoJHtzdW1tYXJ5Lmxlbmd0aH0gY2hhcmFjdGVycylgKTtcbiAgICByZXR1cm4gc3VtbWFyeTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYFtPcGVuQUldIEVycm9yIGdlbmVyYXRpbmcgc3VtbWFyeSAoYXR0ZW1wdCAke3JldHJ5Q291bnQgKyAxfSk6YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgXG4gICAgaWYgKHJldHJ5Q291bnQgPCAyKSB7XG4gICAgICBjb25zb2xlLmxvZyhgW09wZW5BSV0gUmV0cnlpbmcgc3VtbWFyeSBnZW5lcmF0aW9uIGluICR7KHJldHJ5Q291bnQgKyAxKSAqIDEwMDB9bXMuLi5gKTtcbiAgICAgIGF3YWl0IGRlbGF5KChyZXRyeUNvdW50ICsgMSkgKiAxMDAwKTtcbiAgICAgIHJldHVybiBnZW5lcmF0ZVN1bW1hcnkoY29udGVudCwgcmV0cnlDb3VudCArIDEpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gJ05pZSB1ZGHFgm8gc2nEmSB3eWdlbmVyb3dhxIcgc3RyZXN6Y3plbmlhLic7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIk9wZW5BSSIsInNwbGl0VHJhbnNjcmlwdEludG9DaHVua3MiLCJpc0NodW5rV2l0aGluVG9rZW5MaW1pdCIsIm9wZW5haUFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImNvbnNvbGUiLCJlcnJvciIsIm9wZW5haSIsImFwaUtleSIsIk1BWF9SRVRSSUVTIiwiUkVUUllfREVMQVkiLCJkZWxheSIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwicHJvY2Vzc0NodW5rV2l0aFJldHJ5IiwiY2h1bmsiLCJyZXRyeUNvdW50IiwiRXJyb3IiLCJsb2ciLCJpbmRleCIsImNvbnRlbnQiLCJsZW5ndGgiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwidGltZW91dFByb21pc2UiLCJfIiwicmVqZWN0IiwiY29tcGxldGlvblByb21pc2UiLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJtb2RlbCIsIm1lc3NhZ2VzIiwicm9sZSIsInRlbXBlcmF0dXJlIiwiY29tcGxldGlvbiIsInJhY2UiLCJkdXJhdGlvbiIsInByb21wdFRva2VucyIsInVzYWdlIiwicHJvbXB0X3Rva2VucyIsImNvbXBsZXRpb25Ub2tlbnMiLCJjb21wbGV0aW9uX3Rva2VucyIsInRvdGFsVG9rZW5zIiwidG90YWxfdG9rZW5zIiwicmVzcG9uc2VMZW5ndGgiLCJjaG9pY2VzIiwibWVzc2FnZSIsImNodW5rSW5kZXgiLCJlcnJvckRldGFpbHMiLCJ0b1N0cmluZyIsImluY2x1ZGVzIiwiZ2VuZXJhdGVRdWl6IiwiY29udGVudExlbmd0aCIsIm51bVF1ZXN0aW9ucyIsInF1aXpDb250ZW50IiwicXVpeiIsIkpTT04iLCJwYXJzZSIsIkFycmF5IiwiaXNBcnJheSIsInF1ZXN0aW9uIiwiaWQiLCJvcHRpb25zIiwiY29ycmVjdEFuc3dlciIsIkEiLCJCIiwiQyIsInBhcnNlRXJyb3IiLCJnZW5lcmF0ZU5vdGVzIiwicmVxdWVzdCIsInRyYW5zY3JpcHQiLCJ0cmltIiwiY2h1bmtzIiwiY2h1bmtQcm9taXNlcyIsIm1hcCIsInJlc3VsdHMiLCJhbGwiLCJzb3J0IiwiYSIsImIiLCJmYWlsZWRDaHVua3MiLCJmaWx0ZXIiLCJyZXN1bHQiLCJyZWFzb24iLCJhdHRlbXB0cyIsInN0YXJ0V29yZCIsImVuZFdvcmQiLCJ0b3RhbENodW5rcyIsInN1Y2Nlc3NmdWxDaHVua3MiLCJzdWNjZXNzZnVsTm90ZXMiLCJqb2luIiwicXVpelJlc3VsdCIsIndhcm4iLCJzdW1tYXJ5IiwiZ2VuZXJhdGVTdW1tYXJ5IiwicGFydGlhbFN1Y2Nlc3MiLCJ1bmRlZmluZWQiLCJlcnJvck1lc3NhZ2UiLCJtYXhfdG9rZW5zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/ai.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/queue.ts":
/*!*******************************!*\
  !*** ./src/services/queue.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getQueueInfo: () => (/* binding */ getQueueInfo),\n/* harmony export */   priorityQueue: () => (/* binding */ priorityQueue),\n/* harmony export */   queueRequest: () => (/* binding */ queueRequest)\n/* harmony export */ });\n/**\n * Priority Queue Service for EduScribe\n * \n * Provides priority-based request queuing for note generation\n * with subscription tier support\n */ class PriorityQueueService {\n    /**\n   * Add request to queue with priority based on subscription\n   */ async addToQueue(userId, requestType, subscriptionPlan, payload, processingFunction) {\n        const priority = this.getPriorityFromPlan(subscriptionPlan);\n        const itemId = `${userId}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        return new Promise((resolve, reject)=>{\n            const queueItem = {\n                id: itemId,\n                userId,\n                priority,\n                requestType,\n                payload,\n                resolve: async (value)=>{\n                    try {\n                        const result = await processingFunction();\n                        resolve(result);\n                    } catch (error) {\n                        reject(error);\n                    } finally{\n                        this.processing.delete(itemId);\n                        this.processNext();\n                    }\n                },\n                reject: (error)=>{\n                    this.processing.delete(itemId);\n                    reject(error);\n                    this.processNext();\n                },\n                timestamp: new Date()\n            };\n            this.insertByPriority(queueItem);\n            console.log(`[Queue] Added ${requestType} request for user ${userId} with priority ${priority}`);\n            this.processNext();\n        });\n    }\n    /**\n   * Get current queue statistics for UI display\n   */ getQueueStats(userId) {\n        const userPosition = userId ? this.getUserPosition(userId) : null;\n        const priorityBreakdown = this.queue.reduce((acc, item)=>{\n            if (item.priority === 1) acc.high++;\n            else if (item.priority === 2) acc.medium++;\n            else acc.low++;\n            return acc;\n        }, {\n            high: 0,\n            medium: 0,\n            low: 0\n        });\n        const estimatedWaitTime = userPosition ? userPosition * this.averageProcessingTime : this.queue.length * this.averageProcessingTime;\n        return {\n            totalItems: this.queue.length,\n            priorityBreakdown,\n            estimatedWaitTime\n        };\n    }\n    /**\n   * Get user's position in queue\n   */ getUserPosition(userId) {\n        const index = this.queue.findIndex((item)=>item.userId === userId);\n        return index === -1 ? null : index + 1;\n    }\n    /**\n   * Process next items in queue\n   */ processNext() {\n        const currentlyProcessing = this.processing.size;\n        if (currentlyProcessing >= this.maxConcurrent || this.queue.length === 0) {\n            return;\n        }\n        // Take next item (already sorted by priority)\n        const nextItem = this.queue.shift();\n        if (!nextItem) return;\n        this.processing.set(nextItem.id, true);\n        console.log(`[Queue] Processing ${nextItem.requestType} for user ${nextItem.userId} (priority ${nextItem.priority})`);\n        // Start processing\n        setTimeout(()=>{\n            nextItem.resolve(null); // The actual processing happens in the resolve function\n        }, 100);\n    }\n    /**\n   * Insert item into queue maintaining priority order\n   */ insertByPriority(item) {\n        // Find insertion point (sorted by priority, then by timestamp)\n        let insertIndex = 0;\n        for(let i = 0; i < this.queue.length; i++){\n            const existingItem = this.queue[i];\n            // Higher priority (lower number) goes first\n            if (item.priority < existingItem.priority) {\n                break;\n            }\n            // Same priority, older timestamp goes first\n            if (item.priority === existingItem.priority && item.timestamp >= existingItem.timestamp) {\n                insertIndex = i + 1;\n            } else if (item.priority > existingItem.priority) {\n                insertIndex = i + 1;\n            }\n        }\n        this.queue.splice(insertIndex, 0, item);\n    }\n    /**\n   * Map subscription plan to priority level\n   */ getPriorityFromPlan(plan) {\n        switch(plan){\n            case \"pro\":\n                return 1; // Highest priority\n            case \"student\":\n                return 2; // Medium priority  \n            case \"free\":\n            default:\n                return 3; // Lowest priority\n        }\n    }\n    /**\n   * Remove user from queue (if they cancel)\n   */ removeFromQueue(userId) {\n        const initialLength = this.queue.length;\n        this.queue = this.queue.filter((item)=>item.userId !== userId);\n        return this.queue.length < initialLength;\n    }\n    /**\n   * Update processing time average for better estimates\n   */ updateAverageProcessingTime(duration) {\n        // Simple moving average\n        this.averageProcessingTime = this.averageProcessingTime * 0.8 + duration * 0.2;\n    }\n    /**\n   * Get system load information\n   */ getSystemLoad() {\n        const processing = this.processing.size;\n        const capacity = this.maxConcurrent;\n        const loadPercentage = processing / capacity * 100;\n        return {\n            queueLength: this.queue.length,\n            processing,\n            capacity,\n            loadPercentage\n        };\n    }\n    constructor(){\n        this.queue = [];\n        this.processing = new Map();\n        this.maxConcurrent = 3 // Max concurrent processing\n        ;\n        this.averageProcessingTime = 90 // seconds\n        ;\n    }\n}\n// Singleton instance\nconst priorityQueue = new PriorityQueueService();\n/**\n * Helper function to wrap existing API calls with queue\n */ async function queueRequest(userId, subscriptionPlan, requestType, processingFunction) {\n    return priorityQueue.addToQueue(userId, requestType, subscriptionPlan, {}, processingFunction);\n}\n/**\n * Get queue information for UI\n */ function getQueueInfo(userId) {\n    return {\n        stats: priorityQueue.getQueueStats(userId),\n        position: userId ? priorityQueue.getUserPosition(userId) : null,\n        systemLoad: priorityQueue.getSystemLoad()\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUMsR0FDREU7QUFFSjtBQUVBOztDQUVDLEdBQ00sU0FBU2tFLGFBQWF0RSxNQUFlO0lBQzFDLE9BQU87UUFDTHVFLE9BQU9ILGNBQWN2QyxhQUFhLENBQUM3QjtRQUNuQ3dFLFVBQVV4RSxTQUFTb0UsY0FBY3JDLGVBQWUsQ0FBQy9CLFVBQVU7UUFDM0R5RSxZQUFZTCxjQUFjTCxhQUFhO0lBQ3pDO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lZHVzY3JpYmUvLi9zcmMvc2VydmljZXMvcXVldWUudHM/MDYxNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFByaW9yaXR5IFF1ZXVlIFNlcnZpY2UgZm9yIEVkdVNjcmliZVxuICogXG4gKiBQcm92aWRlcyBwcmlvcml0eS1iYXNlZCByZXF1ZXN0IHF1ZXVpbmcgZm9yIG5vdGUgZ2VuZXJhdGlvblxuICogd2l0aCBzdWJzY3JpcHRpb24gdGllciBzdXBwb3J0XG4gKi9cblxuaW50ZXJmYWNlIFF1ZXVlSXRlbSB7XG4gIGlkOiBzdHJpbmc7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBwcmlvcml0eTogbnVtYmVyOyAvLyAxPWhpZ2ggKFBybyksIDI9bWVkaXVtIChTdHVkZW50KSwgMz1sb3cgKEZyZWUpXG4gIHJlcXVlc3RUeXBlOiAndmlkZW8nIHwgJ2ZpbGUnIHwgJ3RleHQnIHwgJ3ZpZGVvLXVwbG9hZCc7XG4gIHBheWxvYWQ6IGFueTtcbiAgcmVzb2x2ZTogKHZhbHVlOiBhbnkpID0+IHZvaWQ7XG4gIHJlamVjdDogKGVycm9yOiBhbnkpID0+IHZvaWQ7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbn1cblxuaW50ZXJmYWNlIFF1ZXVlU3RhdHMge1xuICB0b3RhbEl0ZW1zOiBudW1iZXI7XG4gIHByaW9yaXR5QnJlYWtkb3duOiB7XG4gICAgaGlnaDogbnVtYmVyO1xuICAgIG1lZGl1bTogbnVtYmVyO1xuICAgIGxvdzogbnVtYmVyO1xuICB9O1xuICBlc3RpbWF0ZWRXYWl0VGltZTogbnVtYmVyOyAvLyBzZWNvbmRzXG59XG5cbmNsYXNzIFByaW9yaXR5UXVldWVTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBxdWV1ZTogUXVldWVJdGVtW10gPSBbXTtcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nOiBNYXA8c3RyaW5nLCBib29sZWFuPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBtYXhDb25jdXJyZW50OiBudW1iZXIgPSAzOyAvLyBNYXggY29uY3VycmVudCBwcm9jZXNzaW5nXG4gIHByaXZhdGUgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiBudW1iZXIgPSA5MDsgLy8gc2Vjb25kc1xuXG4gIC8qKlxuICAgKiBBZGQgcmVxdWVzdCB0byBxdWV1ZSB3aXRoIHByaW9yaXR5IGJhc2VkIG9uIHN1YnNjcmlwdGlvblxuICAgKi9cbiAgYXN5bmMgYWRkVG9RdWV1ZTxUPihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICByZXF1ZXN0VHlwZTogUXVldWVJdGVtWydyZXF1ZXN0VHlwZSddLFxuICAgIHN1YnNjcmlwdGlvblBsYW46ICdmcmVlJyB8ICdzdHVkZW50JyB8ICdwcm8nLFxuICAgIHBheWxvYWQ6IGFueSxcbiAgICBwcm9jZXNzaW5nRnVuY3Rpb246ICgpID0+IFByb21pc2U8VD5cbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgY29uc3QgcHJpb3JpdHkgPSB0aGlzLmdldFByaW9yaXR5RnJvbVBsYW4oc3Vic2NyaXB0aW9uUGxhbik7XG4gICAgY29uc3QgaXRlbUlkID0gYCR7dXNlcklkfV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2U8VD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcXVldWVJdGVtOiBRdWV1ZUl0ZW0gPSB7XG4gICAgICAgIGlkOiBpdGVtSWQsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgcHJpb3JpdHksXG4gICAgICAgIHJlcXVlc3RUeXBlLFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgICByZXNvbHZlOiBhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvY2Vzc2luZ0Z1bmN0aW9uKCk7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc2luZy5kZWxldGUoaXRlbUlkKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc05leHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlamVjdDogKGVycm9yKSA9PiB7XG4gICAgICAgICAgdGhpcy5wcm9jZXNzaW5nLmRlbGV0ZShpdGVtSWQpO1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgdGhpcy5wcm9jZXNzTmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuaW5zZXJ0QnlQcmlvcml0eShxdWV1ZUl0ZW0pO1xuICAgICAgY29uc29sZS5sb2coYFtRdWV1ZV0gQWRkZWQgJHtyZXF1ZXN0VHlwZX0gcmVxdWVzdCBmb3IgdXNlciAke3VzZXJJZH0gd2l0aCBwcmlvcml0eSAke3ByaW9yaXR5fWApO1xuICAgICAgXG4gICAgICB0aGlzLnByb2Nlc3NOZXh0KCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgcXVldWUgc3RhdGlzdGljcyBmb3IgVUkgZGlzcGxheVxuICAgKi9cbiAgZ2V0UXVldWVTdGF0cyh1c2VySWQ/OiBzdHJpbmcpOiBRdWV1ZVN0YXRzIHtcbiAgICBjb25zdCB1c2VyUG9zaXRpb24gPSB1c2VySWQgPyB0aGlzLmdldFVzZXJQb3NpdGlvbih1c2VySWQpIDogbnVsbDtcbiAgICBcbiAgICBjb25zdCBwcmlvcml0eUJyZWFrZG93biA9IHRoaXMucXVldWUucmVkdWNlKFxuICAgICAgKGFjYywgaXRlbSkgPT4ge1xuICAgICAgICBpZiAoaXRlbS5wcmlvcml0eSA9PT0gMSkgYWNjLmhpZ2grKztcbiAgICAgICAgZWxzZSBpZiAoaXRlbS5wcmlvcml0eSA9PT0gMikgYWNjLm1lZGl1bSsrO1xuICAgICAgICBlbHNlIGFjYy5sb3crKztcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sXG4gICAgICB7IGhpZ2g6IDAsIG1lZGl1bTogMCwgbG93OiAwIH1cbiAgICApO1xuXG4gICAgY29uc3QgZXN0aW1hdGVkV2FpdFRpbWUgPSB1c2VyUG9zaXRpb24gXG4gICAgICA/IHVzZXJQb3NpdGlvbiAqIHRoaXMuYXZlcmFnZVByb2Nlc3NpbmdUaW1lXG4gICAgICA6IHRoaXMucXVldWUubGVuZ3RoICogdGhpcy5hdmVyYWdlUHJvY2Vzc2luZ1RpbWU7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxJdGVtczogdGhpcy5xdWV1ZS5sZW5ndGgsXG4gICAgICBwcmlvcml0eUJyZWFrZG93bixcbiAgICAgIGVzdGltYXRlZFdhaXRUaW1lXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlcidzIHBvc2l0aW9uIGluIHF1ZXVlXG4gICAqL1xuICBnZXRVc2VyUG9zaXRpb24odXNlcklkOiBzdHJpbmcpOiBudW1iZXIgfCBudWxsIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS51c2VySWQgPT09IHVzZXJJZCk7XG4gICAgcmV0dXJuIGluZGV4ID09PSAtMSA/IG51bGwgOiBpbmRleCArIDE7XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBuZXh0IGl0ZW1zIGluIHF1ZXVlXG4gICAqL1xuICBwcml2YXRlIHByb2Nlc3NOZXh0KCk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnRseVByb2Nlc3NpbmcgPSB0aGlzLnByb2Nlc3Npbmcuc2l6ZTtcbiAgICBcbiAgICBpZiAoY3VycmVudGx5UHJvY2Vzc2luZyA+PSB0aGlzLm1heENvbmN1cnJlbnQgfHwgdGhpcy5xdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUYWtlIG5leHQgaXRlbSAoYWxyZWFkeSBzb3J0ZWQgYnkgcHJpb3JpdHkpXG4gICAgY29uc3QgbmV4dEl0ZW0gPSB0aGlzLnF1ZXVlLnNoaWZ0KCk7XG4gICAgaWYgKCFuZXh0SXRlbSkgcmV0dXJuO1xuXG4gICAgdGhpcy5wcm9jZXNzaW5nLnNldChuZXh0SXRlbS5pZCwgdHJ1ZSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtRdWV1ZV0gUHJvY2Vzc2luZyAke25leHRJdGVtLnJlcXVlc3RUeXBlfSBmb3IgdXNlciAke25leHRJdGVtLnVzZXJJZH0gKHByaW9yaXR5ICR7bmV4dEl0ZW0ucHJpb3JpdHl9KWApO1xuICAgIFxuICAgIC8vIFN0YXJ0IHByb2Nlc3NpbmdcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIG5leHRJdGVtLnJlc29sdmUobnVsbCk7IC8vIFRoZSBhY3R1YWwgcHJvY2Vzc2luZyBoYXBwZW5zIGluIHRoZSByZXNvbHZlIGZ1bmN0aW9uXG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnNlcnQgaXRlbSBpbnRvIHF1ZXVlIG1haW50YWluaW5nIHByaW9yaXR5IG9yZGVyXG4gICAqL1xuICBwcml2YXRlIGluc2VydEJ5UHJpb3JpdHkoaXRlbTogUXVldWVJdGVtKTogdm9pZCB7XG4gICAgLy8gRmluZCBpbnNlcnRpb24gcG9pbnQgKHNvcnRlZCBieSBwcmlvcml0eSwgdGhlbiBieSB0aW1lc3RhbXApXG4gICAgbGV0IGluc2VydEluZGV4ID0gMDtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbSA9IHRoaXMucXVldWVbaV07XG4gICAgICBcbiAgICAgIC8vIEhpZ2hlciBwcmlvcml0eSAobG93ZXIgbnVtYmVyKSBnb2VzIGZpcnN0XG4gICAgICBpZiAoaXRlbS5wcmlvcml0eSA8IGV4aXN0aW5nSXRlbS5wcmlvcml0eSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2FtZSBwcmlvcml0eSwgb2xkZXIgdGltZXN0YW1wIGdvZXMgZmlyc3RcbiAgICAgIGlmIChpdGVtLnByaW9yaXR5ID09PSBleGlzdGluZ0l0ZW0ucHJpb3JpdHkgJiYgXG4gICAgICAgICAgaXRlbS50aW1lc3RhbXAgPj0gZXhpc3RpbmdJdGVtLnRpbWVzdGFtcCkge1xuICAgICAgICBpbnNlcnRJbmRleCA9IGkgKyAxO1xuICAgICAgfSBlbHNlIGlmIChpdGVtLnByaW9yaXR5ID4gZXhpc3RpbmdJdGVtLnByaW9yaXR5KSB7XG4gICAgICAgIGluc2VydEluZGV4ID0gaSArIDE7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHRoaXMucXVldWUuc3BsaWNlKGluc2VydEluZGV4LCAwLCBpdGVtKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXAgc3Vic2NyaXB0aW9uIHBsYW4gdG8gcHJpb3JpdHkgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgZ2V0UHJpb3JpdHlGcm9tUGxhbihwbGFuOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIHN3aXRjaCAocGxhbikge1xuICAgICAgY2FzZSAncHJvJzogcmV0dXJuIDE7IC8vIEhpZ2hlc3QgcHJpb3JpdHlcbiAgICAgIGNhc2UgJ3N0dWRlbnQnOiByZXR1cm4gMjsgLy8gTWVkaXVtIHByaW9yaXR5ICBcbiAgICAgIGNhc2UgJ2ZyZWUnOlxuICAgICAgZGVmYXVsdDogcmV0dXJuIDM7IC8vIExvd2VzdCBwcmlvcml0eVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdXNlciBmcm9tIHF1ZXVlIChpZiB0aGV5IGNhbmNlbClcbiAgICovXG4gIHJlbW92ZUZyb21RdWV1ZSh1c2VySWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGluaXRpYWxMZW5ndGggPSB0aGlzLnF1ZXVlLmxlbmd0aDtcbiAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZS5maWx0ZXIoaXRlbSA9PiBpdGVtLnVzZXJJZCAhPT0gdXNlcklkKTtcbiAgICByZXR1cm4gdGhpcy5xdWV1ZS5sZW5ndGggPCBpbml0aWFsTGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBwcm9jZXNzaW5nIHRpbWUgYXZlcmFnZSBmb3IgYmV0dGVyIGVzdGltYXRlc1xuICAgKi9cbiAgdXBkYXRlQXZlcmFnZVByb2Nlc3NpbmdUaW1lKGR1cmF0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgICAvLyBTaW1wbGUgbW92aW5nIGF2ZXJhZ2VcbiAgICB0aGlzLmF2ZXJhZ2VQcm9jZXNzaW5nVGltZSA9ICh0aGlzLmF2ZXJhZ2VQcm9jZXNzaW5nVGltZSAqIDAuOCkgKyAoZHVyYXRpb24gKiAwLjIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzeXN0ZW0gbG9hZCBpbmZvcm1hdGlvblxuICAgKi9cbiAgZ2V0U3lzdGVtTG9hZCgpOiB7XG4gICAgcXVldWVMZW5ndGg6IG51bWJlcjtcbiAgICBwcm9jZXNzaW5nOiBudW1iZXI7XG4gICAgY2FwYWNpdHk6IG51bWJlcjtcbiAgICBsb2FkUGVyY2VudGFnZTogbnVtYmVyO1xuICB9IHtcbiAgICBjb25zdCBwcm9jZXNzaW5nID0gdGhpcy5wcm9jZXNzaW5nLnNpemU7XG4gICAgY29uc3QgY2FwYWNpdHkgPSB0aGlzLm1heENvbmN1cnJlbnQ7XG4gICAgY29uc3QgbG9hZFBlcmNlbnRhZ2UgPSAocHJvY2Vzc2luZyAvIGNhcGFjaXR5KSAqIDEwMDtcblxuICAgIHJldHVybiB7XG4gICAgICBxdWV1ZUxlbmd0aDogdGhpcy5xdWV1ZS5sZW5ndGgsXG4gICAgICBwcm9jZXNzaW5nLFxuICAgICAgY2FwYWNpdHksXG4gICAgICBsb2FkUGVyY2VudGFnZVxuICAgIH07XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgcHJpb3JpdHlRdWV1ZSA9IG5ldyBQcmlvcml0eVF1ZXVlU2VydmljZSgpO1xuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byB3cmFwIGV4aXN0aW5nIEFQSSBjYWxscyB3aXRoIHF1ZXVlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBxdWV1ZVJlcXVlc3Q8VD4oXG4gIHVzZXJJZDogc3RyaW5nLFxuICBzdWJzY3JpcHRpb25QbGFuOiAnZnJlZScgfCAnc3R1ZGVudCcgfCAncHJvJyxcbiAgcmVxdWVzdFR5cGU6IFF1ZXVlSXRlbVsncmVxdWVzdFR5cGUnXSxcbiAgcHJvY2Vzc2luZ0Z1bmN0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XG4pOiBQcm9taXNlPFQ+IHtcbiAgcmV0dXJuIHByaW9yaXR5UXVldWUuYWRkVG9RdWV1ZShcbiAgICB1c2VySWQsXG4gICAgcmVxdWVzdFR5cGUsIFxuICAgIHN1YnNjcmlwdGlvblBsYW4sXG4gICAge30sXG4gICAgcHJvY2Vzc2luZ0Z1bmN0aW9uXG4gICk7XG59XG5cbi8qKlxuICogR2V0IHF1ZXVlIGluZm9ybWF0aW9uIGZvciBVSVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UXVldWVJbmZvKHVzZXJJZD86IHN0cmluZykge1xuICByZXR1cm4ge1xuICAgIHN0YXRzOiBwcmlvcml0eVF1ZXVlLmdldFF1ZXVlU3RhdHModXNlcklkKSxcbiAgICBwb3NpdGlvbjogdXNlcklkID8gcHJpb3JpdHlRdWV1ZS5nZXRVc2VyUG9zaXRpb24odXNlcklkKSA6IG51bGwsXG4gICAgc3lzdGVtTG9hZDogcHJpb3JpdHlRdWV1ZS5nZXRTeXN0ZW1Mb2FkKClcbiAgfTtcbn0gIl0sIm5hbWVzIjpbIlByaW9yaXR5UXVldWVTZXJ2aWNlIiwiYWRkVG9RdWV1ZSIsInVzZXJJZCIsInJlcXVlc3RUeXBlIiwic3Vic2NyaXB0aW9uUGxhbiIsInBheWxvYWQiLCJwcm9jZXNzaW5nRnVuY3Rpb24iLCJwcmlvcml0eSIsImdldFByaW9yaXR5RnJvbVBsYW4iLCJpdGVtSWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJxdWV1ZUl0ZW0iLCJpZCIsInZhbHVlIiwicmVzdWx0IiwiZXJyb3IiLCJwcm9jZXNzaW5nIiwiZGVsZXRlIiwicHJvY2Vzc05leHQiLCJ0aW1lc3RhbXAiLCJpbnNlcnRCeVByaW9yaXR5IiwiY29uc29sZSIsImxvZyIsImdldFF1ZXVlU3RhdHMiLCJ1c2VyUG9zaXRpb24iLCJnZXRVc2VyUG9zaXRpb24iLCJwcmlvcml0eUJyZWFrZG93biIsInF1ZXVlIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsImhpZ2giLCJtZWRpdW0iLCJsb3ciLCJlc3RpbWF0ZWRXYWl0VGltZSIsImF2ZXJhZ2VQcm9jZXNzaW5nVGltZSIsImxlbmd0aCIsInRvdGFsSXRlbXMiLCJpbmRleCIsImZpbmRJbmRleCIsImN1cnJlbnRseVByb2Nlc3NpbmciLCJzaXplIiwibWF4Q29uY3VycmVudCIsIm5leHRJdGVtIiwic2hpZnQiLCJzZXQiLCJzZXRUaW1lb3V0IiwiaW5zZXJ0SW5kZXgiLCJpIiwiZXhpc3RpbmdJdGVtIiwic3BsaWNlIiwicGxhbiIsInJlbW92ZUZyb21RdWV1ZSIsImluaXRpYWxMZW5ndGgiLCJmaWx0ZXIiLCJ1cGRhdGVBdmVyYWdlUHJvY2Vzc2luZ1RpbWUiLCJkdXJhdGlvbiIsImdldFN5c3RlbUxvYWQiLCJjYXBhY2l0eSIsImxvYWRQZXJjZW50YWdlIiwicXVldWVMZW5ndGgiLCJNYXAiLCJwcmlvcml0eVF1ZXVlIiwicXVldWVSZXF1ZXN0IiwiZ2V0UXVldWVJbmZvIiwic3RhdHMiLCJwb3NpdGlvbiIsInN5c3RlbUxvYWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/queue.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/subscription.ts":
/*!**************************************!*\
  !*** ./src/services/subscription.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   assignUserSubscription: () => (/* binding */ assignUserSubscription),\n/* harmony export */   checkUsageLimits: () => (/* binding */ checkUsageLimits),\n/* harmony export */   getPlanPricing: () => (/* binding */ getPlanPricing),\n/* harmony export */   getSubscriptionPlan: () => (/* binding */ getSubscriptionPlan),\n/* harmony export */   getSubscriptionPlans: () => (/* binding */ getSubscriptionPlans),\n/* harmony export */   getUserSubscription: () => (/* binding */ getUserSubscription),\n/* harmony export */   hasFeatureAccess: () => (/* binding */ hasFeatureAccess),\n/* harmony export */   incrementUsage: () => (/* binding */ incrementUsage),\n/* harmony export */   refreshSavedNotesCount: () => (/* binding */ refreshSavedNotesCount),\n/* harmony export */   updateSavedNotesCount: () => (/* binding */ updateSavedNotesCount)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/**\n * Subscription Service\n * \n * Handles subscription plans, usage tracking, and feature access control\n */ \n// Initialize Supabase client\nconst supabaseUrl = \"https://xhljckmlzdshxibnqsbj.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA\";\n/**\n * Get all available subscription plans\n */ async function getSubscriptionPlans() {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n    const { data, error } = await supabase.from(\"subscription_plans\").select(\"*\").eq(\"is_active\", true).order(\"price_monthly\", {\n        ascending: true\n    });\n    if (error) {\n        console.error(\"[Subscription] Error fetching plans:\", error);\n        throw new Error(\"Failed to fetch subscription plans\");\n    }\n    return data || [];\n}\n/**\n * Get user's current subscription with plan details\n */ async function getUserSubscription(userId, token) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n        global: {\n            headers: {\n                Authorization: `Bearer ${token}`\n            }\n        }\n    });\n    try {\n        // Use direct table query instead of RPC function\n        const { data: userSub, error } = await supabase.from(\"user_subscriptions\").select(`\n        id,\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        if (error) {\n            console.error(\"[Subscription] Error fetching user subscription:\", error);\n            return null;\n        }\n        if (!userSub || !userSub.subscription_plans) {\n            return null;\n        }\n        const planData = userSub.subscription_plans;\n        return {\n            subscription_id: userSub.id,\n            plan_id: userSub.plan_id,\n            plan_name: planData.name,\n            plan_display_name: planData.display_name,\n            billing_cycle: userSub.billing_cycle,\n            status: userSub.status,\n            current_period_end: userSub.current_period_end,\n            features: planData.features,\n            limits: planData.limits,\n            price_monthly: planData.price_monthly,\n            price_yearly: planData.price_yearly\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error in getUserSubscription:\", error);\n        return null;\n    }\n}\n/**\n * Get a specific subscription plan by ID\n */ async function getSubscriptionPlan(planId) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n    const { data, error } = await supabase.from(\"subscription_plans\").select(\"*\").eq(\"id\", planId).eq(\"is_active\", true).single();\n    if (error) {\n        console.error(\"[Subscription] Error fetching plan:\", error);\n        return null;\n    }\n    return data;\n}\n/**\n * Check if user can generate notes based on their plan and usage\n */ async function checkUsageLimits(userId, token, noteType = \"text\") {\n    try {\n        // Use direct table queries instead of RPC functions to avoid issues\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        console.log(\"[Subscription] Checking usage limits for user:\", userId);\n        // Get user's subscription directly\n        const { data: userSub, error: subError } = await supabase.from(\"user_subscriptions\").select(`\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        // Get current month usage directly\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { data: usage, error: usageError } = await supabase.from(\"user_usage\").select(\"*\").eq(\"user_id\", userId).eq(\"month_year\", currentMonth).single();\n        // Default free plan limits\n        const freePlanLimits = {\n            notes_per_month: 2,\n            max_saved_notes: 3,\n            max_text_length: 5000\n        };\n        const currentUsage = usage || {\n            notes_generated: 0,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 0,\n            month_year: currentMonth\n        };\n        // If usage record doesn't exist, create it\n        if (!usage) {\n            console.log(\"[Subscription] Creating usage record for current month:\", currentMonth);\n            const { error: createUsageError } = await supabase.from(\"user_usage\").insert({\n                user_id: userId,\n                month_year: currentMonth,\n                notes_generated: 0,\n                video_notes_count: 0,\n                file_notes_count: 0,\n                text_notes_count: 0,\n                total_saved_notes: 0,\n                updated_at: new Date().toISOString()\n            });\n            if (createUsageError) {\n                console.error(\"[Subscription] Warning: Could not create usage record:\", createUsageError);\n            }\n        }\n        // If no subscription found or error, try to create a free subscription\n        if (!userSub || subError) {\n            console.log(\"[Subscription] No active subscription found, attempting to create free subscription\");\n            if (subError) {\n                console.error(\"[Subscription] Subscription query error:\", subError);\n            }\n            // Try to create a free subscription for the user\n            const { error: createSubError } = await supabase.from(\"user_subscriptions\").insert({\n                user_id: userId,\n                plan_id: \"free\",\n                billing_cycle: \"monthly\",\n                status: \"active\",\n                current_period_start: new Date().toISOString(),\n                current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n                updated_at: new Date().toISOString()\n            }).select();\n            if (createSubError) {\n                console.error(\"[Subscription] Could not create free subscription:\", createSubError);\n            } else {\n                console.log(\"[Subscription] Created free subscription for user\");\n            }\n            // Return free plan limits regardless of whether we could create the subscription\n            const canGenerate = currentUsage.notes_generated < freePlanLimits.notes_per_month;\n            const canSave = currentUsage.total_saved_notes < freePlanLimits.max_saved_notes;\n            return {\n                canGenerate,\n                canSave,\n                reason: !canGenerate ? `Monthly limit reached (${freePlanLimits.notes_per_month} notes per month)` : !canSave ? `Storage limit reached (${freePlanLimits.max_saved_notes} saved notes maximum)` : undefined,\n                usage: currentUsage,\n                limits: freePlanLimits\n            };\n        }\n        const subscription = userSub;\n        const planData = subscription.subscription_plans;\n        if (!planData) {\n            console.error(\"[Subscription] Plan data not found for subscription:\", subscription);\n            // Fallback to free plan\n            const canGenerate = currentUsage.notes_generated < freePlanLimits.notes_per_month;\n            const canSave = currentUsage.total_saved_notes < freePlanLimits.max_saved_notes;\n            return {\n                canGenerate,\n                canSave,\n                reason: \"Plan data not found - using free plan limits\",\n                usage: currentUsage,\n                limits: freePlanLimits\n            };\n        }\n        console.log(\"[Subscription] Found subscription:\", {\n            planId: subscription.plan_id,\n            planLimits: planData.limits,\n            currentUsage: currentUsage\n        });\n        // Check monthly generation limit (handle unlimited case)\n        const monthlyLimit = planData.limits.notes_per_month;\n        const canGenerate = monthlyLimit === -1 || currentUsage.notes_generated < monthlyLimit;\n        // Check saved notes limit\n        const canSave = currentUsage.total_saved_notes < planData.limits.max_saved_notes;\n        let reason;\n        if (!canGenerate && monthlyLimit !== -1) {\n            reason = `Monthly limit reached (${monthlyLimit} notes per month)`;\n        } else if (!canSave) {\n            reason = `Storage limit reached (${planData.limits.max_saved_notes} saved notes maximum)`;\n        }\n        return {\n            canGenerate,\n            canSave,\n            reason,\n            usage: currentUsage,\n            limits: planData.limits\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error checking usage limits:\", error);\n        // Return restrictive fallback\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const fallbackUsage = {\n            notes_generated: 999,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 999,\n            month_year: currentMonth\n        };\n        return {\n            canGenerate: false,\n            canSave: false,\n            reason: \"Error checking subscription limits. Please try again.\",\n            usage: fallbackUsage,\n            limits: {\n                notes_per_month: 2,\n                max_saved_notes: 3,\n                max_text_length: 5000\n            }\n        };\n    }\n}\n/**\n * Increment user's usage count after successful note generation\n */ async function incrementUsage(userId, token, noteType = \"text\") {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        console.log(\"[Subscription] Incrementing usage for user:\", userId, \"type:\", noteType);\n        // Get current usage\n        const { data: currentUsage, error: fetchError } = await supabase.from(\"user_usage\").select(\"*\").eq(\"user_id\", userId).eq(\"month_year\", currentMonth).single();\n        if (fetchError && fetchError.code !== \"PGRST116\") {\n            console.error(\"[Subscription] Error fetching current usage:\", fetchError);\n            return false;\n        }\n        // Prepare update data\n        const updateData = {\n            notes_generated: (currentUsage?.notes_generated || 0) + 1,\n            updated_at: new Date().toISOString()\n        };\n        // Increment specific note type counter\n        if (noteType === \"video\") {\n            updateData.video_notes_count = (currentUsage?.video_notes_count || 0) + 1;\n        } else if (noteType === \"file\") {\n            updateData.file_notes_count = (currentUsage?.file_notes_count || 0) + 1;\n        } else if (noteType === \"text\") {\n            updateData.text_notes_count = (currentUsage?.text_notes_count || 0) + 1;\n        }\n        // Update or insert usage record\n        if (currentUsage) {\n            const { error: updateError } = await supabase.from(\"user_usage\").update(updateData).eq(\"user_id\", userId).eq(\"month_year\", currentMonth);\n            if (updateError) {\n                console.error(\"[Subscription] Error updating usage:\", updateError);\n                return false;\n            }\n        } else {\n            // Create new usage record\n            const insertData = {\n                user_id: userId,\n                month_year: currentMonth,\n                notes_generated: 1,\n                video_notes_count: noteType === \"video\" ? 1 : 0,\n                file_notes_count: noteType === \"file\" ? 1 : 0,\n                text_notes_count: noteType === \"text\" ? 1 : 0,\n                total_saved_notes: 0,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            };\n            const { error: insertError } = await supabase.from(\"user_usage\").insert(insertData);\n            if (insertError) {\n                console.error(\"[Subscription] Error creating usage record:\", insertError);\n                return false;\n            }\n        }\n        console.log(\"[Subscription] Successfully incremented usage\");\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error incrementing usage:\", error);\n        return false;\n    }\n}\n/**\n * Update saved notes count (used when notes are saved or deleted)\n */ async function updateSavedNotesCount(userId, token, count) {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        console.log(\"[Subscription] Updating saved notes count for user:\", userId, \"count:\", count);\n        // Upsert the saved notes count\n        const { error } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            total_saved_notes: Math.max(0, count),\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\"\n        });\n        if (error) {\n            console.error(\"[Subscription] Error updating saved notes count:\", error);\n            return false;\n        }\n        console.log(\"[Subscription] Successfully updated saved notes count\");\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error updating saved notes count:\", error);\n        return false;\n    }\n}\n/**\n * Refresh saved notes count by counting all notes from all tables\n */ async function refreshSavedNotesCount(userId, token) {\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            }\n        });\n        console.log(\"[Subscription] Refreshing saved notes count for user:\", userId);\n        // Count notes from all tables including video_upload_notes\n        const [videoResult, fileResult, textResult, uploadVideoResult] = await Promise.all([\n            supabase.from(\"video_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            supabase.from(\"file_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            supabase.from(\"text_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId),\n            // Handle video_upload_notes table that might not exist in all environments\n            supabase.from(\"video_upload_notes\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId).then((result)=>result, (error)=>{\n                console.warn(\"[Subscription] video_upload_notes table might not exist:\", error.message);\n                return {\n                    count: 0\n                };\n            })\n        ]);\n        const videoCount = videoResult.count || 0;\n        const fileCount = fileResult.count || 0;\n        const textCount = textResult.count || 0;\n        const uploadVideoCount = uploadVideoResult.count || 0;\n        const totalCount = videoCount + fileCount + textCount + uploadVideoCount;\n        console.log(\"[Subscription] Note counts:\", {\n            video: videoCount,\n            file: fileCount,\n            text: textCount,\n            video_upload: uploadVideoCount,\n            total: totalCount\n        });\n        // Update the usage record with the actual count\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { error } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            total_saved_notes: totalCount,\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\"\n        });\n        if (error) {\n            console.error(\"[Subscription] Error updating saved notes count:\", error);\n            return false;\n        }\n        console.log(\"[Subscription] Successfully refreshed saved notes count to:\", totalCount);\n        return true;\n    } catch (error) {\n        console.error(\"[Subscription] Error refreshing saved notes count:\", error);\n        return false;\n    }\n}\n/**\n * Get plan pricing with discount calculation\n */ function getPlanPricing(plan) {\n    const monthlyPrice = plan.price_monthly;\n    const yearlyPrice = plan.price_yearly;\n    const yearlyMonthlyEquivalent = yearlyPrice / 12;\n    const discountPercentage = monthlyPrice > 0 ? Math.round((1 - yearlyMonthlyEquivalent / monthlyPrice) * 100) : 0;\n    const yearlySavings = monthlyPrice * 12 - yearlyPrice;\n    return {\n        monthly: monthlyPrice,\n        yearly: yearlyPrice,\n        yearlyMonthlyEquivalent,\n        discountPercentage,\n        yearlySavings,\n        currency: plan.currency\n    };\n}\n/**\n * Check if user has access to a specific feature\n */ async function hasFeatureAccess(userId, token, feature) {\n    try {\n        const subscription = await getUserSubscription(userId, token);\n        if (!subscription) {\n            // Default free plan features\n            const freeFeatures = {\n                notes_generation: true,\n                quizzes: false,\n                youtube_support: true,\n                ppt_support: false,\n                export: false,\n                copy_paste: true,\n                upload_video: false,\n                priority_generation: false\n            };\n            return freeFeatures[feature] || false;\n        }\n        return subscription.features[feature] || false;\n    } catch (error) {\n        console.error(\"[Subscription] Error checking feature access:\", error);\n        return false; // Default to no access on error\n    }\n}\n/**\n * Assign subscription to user after successful payment\n */ async function assignUserSubscription(userId, token, planId, billingCycle, paymentData) {\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n        global: {\n            headers: {\n                Authorization: `Bearer ${token}`\n            }\n        }\n    });\n    try {\n        // Calculate period dates\n        const currentPeriodStart = new Date();\n        const currentPeriodEnd = new Date();\n        if (billingCycle === \"yearly\") {\n            currentPeriodEnd.setFullYear(currentPeriodEnd.getFullYear() + 1);\n        } else {\n            currentPeriodEnd.setMonth(currentPeriodEnd.getMonth() + 1);\n        }\n        // Prepare subscription data\n        const subscriptionData = {\n            user_id: userId,\n            plan_id: planId,\n            billing_cycle: billingCycle,\n            status: \"active\",\n            current_period_start: currentPeriodStart.toISOString(),\n            current_period_end: currentPeriodEnd.toISOString(),\n            cancel_at_period_end: false,\n            stripe_subscription_id: paymentData?.stripeSubscriptionId || null,\n            stripe_customer_id: paymentData?.stripeCustomerId || null,\n            updated_at: new Date().toISOString()\n        };\n        // Upsert subscription (update if exists, insert if new)\n        const { data: subscription, error: subscriptionError } = await supabase.from(\"user_subscriptions\").upsert(subscriptionData, {\n            onConflict: \"user_id\"\n        }).select(`\n        id,\n        plan_id,\n        billing_cycle,\n        status,\n        current_period_end,\n        subscription_plans (\n          name,\n          display_name,\n          features,\n          limits,\n          price_monthly,\n          price_yearly\n        )\n      `).single();\n        if (subscriptionError) {\n            console.error(\"[Subscription] Error assigning subscription:\", subscriptionError);\n            throw new Error(\"Failed to assign subscription\");\n        }\n        if (!subscription || !subscription.subscription_plans) {\n            throw new Error(\"Failed to retrieve subscription details\");\n        }\n        // Initialize usage tracking for current month\n        const currentMonth = new Date().toISOString().slice(0, 7);\n        const { error: usageError } = await supabase.from(\"user_usage\").upsert({\n            user_id: userId,\n            month_year: currentMonth,\n            notes_generated: 0,\n            video_notes_count: 0,\n            file_notes_count: 0,\n            text_notes_count: 0,\n            total_saved_notes: 0,\n            updated_at: new Date().toISOString()\n        }, {\n            onConflict: \"user_id,month_year\",\n            ignoreDuplicates: true\n        });\n        if (usageError) {\n            console.error(\"[Subscription] Warning: Failed to initialize usage tracking:\", usageError);\n        // Don't throw error here as subscription assignment was successful\n        }\n        const planData = subscription.subscription_plans;\n        return {\n            subscription_id: subscription.id,\n            plan_id: subscription.plan_id,\n            plan_name: planData.name,\n            plan_display_name: planData.display_name,\n            billing_cycle: subscription.billing_cycle,\n            status: subscription.status,\n            current_period_end: subscription.current_period_end,\n            features: planData.features,\n            limits: planData.limits,\n            price_monthly: planData.price_monthly,\n            price_yearly: planData.price_yearly\n        };\n    } catch (error) {\n        console.error(\"[Subscription] Error in assignUserSubscription:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNuQkssWUFBWSxJQUFJbkIsT0FBT0MsV0FBVztRQUNwQyxHQUFHO1lBQ0Q0QyxZQUFZO1lBQ1o2RCxrQkFBa0I7UUFDcEI7UUFFRixJQUFJdEcsWUFBWTtZQUNkckMsUUFBUU4sS0FBSyxDQUFDLGdFQUFnRTJDO1FBQzlFLG1FQUFtRTtRQUNyRTtRQUVBLE1BQU0xQixXQUFXaUQsYUFBYWxELGtCQUFrQjtRQUVoRCxPQUFPO1lBQ0xFLGlCQUFpQmdELGFBQWEvQyxFQUFFO1lBQ2hDQyxTQUFTOEMsYUFBYTlDLE9BQU87WUFDN0JDLFdBQVdKLFNBQVNLLElBQUk7WUFDeEJDLG1CQUFtQk4sU0FBU08sWUFBWTtZQUN4Q0MsZUFBZXlDLGFBQWF6QyxhQUFhO1lBQ3pDQyxRQUFRd0MsYUFBYXhDLE1BQU07WUFDM0JDLG9CQUFvQnVDLGFBQWF2QyxrQkFBa0I7WUFDbkRDLFVBQVVYLFNBQVNXLFFBQVE7WUFDM0JDLFFBQVFaLFNBQVNZLE1BQU07WUFDdkJDLGVBQWViLFNBQVNhLGFBQWE7WUFDckNDLGNBQWNkLFNBQVNjLFlBQVk7UUFDckM7SUFDRixFQUFFLE9BQU8vQixPQUFPO1FBQ2RNLFFBQVFOLEtBQUssQ0FBQyxtREFBbURBO1FBQ2pFLE1BQU1BO0lBQ1I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8uL3NyYy9zZXJ2aWNlcy9zdWJzY3JpcHRpb24udHM/MDRmOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN1YnNjcmlwdGlvbiBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgc3Vic2NyaXB0aW9uIHBsYW5zLCB1c2FnZSB0cmFja2luZywgYW5kIGZlYXR1cmUgYWNjZXNzIGNvbnRyb2xcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBJbml0aWFsaXplIFN1cGFiYXNlIGNsaWVudFxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN1YnNjcmlwdGlvblBsYW4ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGRpc3BsYXlfbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBwcmljZV9tb250aGx5OiBudW1iZXI7XG4gIHByaWNlX3llYXJseTogbnVtYmVyO1xuICBjdXJyZW5jeTogc3RyaW5nO1xuICBmZWF0dXJlczoge1xuICAgIG5vdGVzX2dlbmVyYXRpb246IGJvb2xlYW47XG4gICAgcXVpenplczogYm9vbGVhbjtcbiAgICB5b3V0dWJlX3N1cHBvcnQ6IGJvb2xlYW47XG4gICAgcHB0X3N1cHBvcnQ6IGJvb2xlYW47XG4gICAgZXhwb3J0OiBib29sZWFuO1xuICAgIGNvcHlfcGFzdGU6IGJvb2xlYW47XG4gICAgdXBsb2FkX3ZpZGVvPzogYm9vbGVhbjtcbiAgICBwcmlvcml0eV9nZW5lcmF0aW9uPzogYm9vbGVhbjtcbiAgfTtcbiAgbGltaXRzOiB7XG4gICAgbm90ZXNfcGVyX21vbnRoOiBudW1iZXI7IC8vIC0xIG1lYW5zIHVubGltaXRlZFxuICAgIG1heF9zYXZlZF9ub3RlczogbnVtYmVyO1xuICAgIG1heF90ZXh0X2xlbmd0aDogbnVtYmVyO1xuICB9O1xuICBpc19hY3RpdmU6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlclN1YnNjcmlwdGlvbiB7XG4gIHN1YnNjcmlwdGlvbl9pZDogc3RyaW5nO1xuICBwbGFuX2lkOiBzdHJpbmc7XG4gIHBsYW5fbmFtZTogc3RyaW5nO1xuICBwbGFuX2Rpc3BsYXlfbmFtZTogc3RyaW5nO1xuICBiaWxsaW5nX2N5Y2xlOiAnbW9udGhseScgfCAneWVhcmx5JztcbiAgc3RhdHVzOiAnYWN0aXZlJyB8ICdjYW5jZWxsZWQnIHwgJ2V4cGlyZWQnIHwgJ3RyaWFsJztcbiAgY3VycmVudF9wZXJpb2RfZW5kOiBzdHJpbmc7XG4gIGZlYXR1cmVzOiBTdWJzY3JpcHRpb25QbGFuWydmZWF0dXJlcyddO1xuICBsaW1pdHM6IFN1YnNjcmlwdGlvblBsYW5bJ2xpbWl0cyddO1xuICBwcmljZV9tb250aGx5OiBudW1iZXI7XG4gIHByaWNlX3llYXJseTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJVc2FnZSB7XG4gIG5vdGVzX2dlbmVyYXRlZDogbnVtYmVyO1xuICB2aWRlb19ub3Rlc19jb3VudDogbnVtYmVyO1xuICBmaWxlX25vdGVzX2NvdW50OiBudW1iZXI7XG4gIHRleHRfbm90ZXNfY291bnQ6IG51bWJlcjtcbiAgdG90YWxfc2F2ZWRfbm90ZXM6IG51bWJlcjtcbiAgbW9udGhfeWVhcjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzYWdlQ2hlY2sge1xuICBjYW5HZW5lcmF0ZTogYm9vbGVhbjtcbiAgY2FuU2F2ZTogYm9vbGVhbjtcbiAgcmVhc29uPzogc3RyaW5nO1xuICB1c2FnZTogVXNlclVzYWdlO1xuICBsaW1pdHM6IFN1YnNjcmlwdGlvblBsYW5bJ2xpbWl0cyddO1xufVxuXG4vKipcbiAqIEdldCBhbGwgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbiBwbGFuc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9uUGxhbnMoKTogUHJvbWlzZTxTdWJzY3JpcHRpb25QbGFuW10+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG4gIFxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzdWJzY3JpcHRpb25fcGxhbnMnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAub3JkZXIoJ3ByaWNlX21vbnRobHknLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcbiAgICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgZmV0Y2hpbmcgcGxhbnM6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIHN1YnNjcmlwdGlvbiBwbGFucycpO1xuICB9XG4gIFxuICByZXR1cm4gZGF0YSB8fCBbXTtcbn1cblxuLyoqXG4gKiBHZXQgdXNlcidzIGN1cnJlbnQgc3Vic2NyaXB0aW9uIHdpdGggcGxhbiBkZXRhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyU3Vic2NyaXB0aW9uKHVzZXJJZDogc3RyaW5nLCB0b2tlbjogc3RyaW5nKTogUHJvbWlzZTxVc2VyU3Vic2NyaXB0aW9uIHwgbnVsbD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgZ2xvYmFsOiB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gXG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgXG4gIHRyeSB7XG4gICAgLy8gVXNlIGRpcmVjdCB0YWJsZSBxdWVyeSBpbnN0ZWFkIG9mIFJQQyBmdW5jdGlvblxuICAgIGNvbnN0IHsgZGF0YTogdXNlclN1YiwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBpZCxcbiAgICAgICAgcGxhbl9pZCxcbiAgICAgICAgYmlsbGluZ19jeWNsZSxcbiAgICAgICAgc3RhdHVzLFxuICAgICAgICBjdXJyZW50X3BlcmlvZF9lbmQsXG4gICAgICAgIHN1YnNjcmlwdGlvbl9wbGFucyAoXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkaXNwbGF5X25hbWUsXG4gICAgICAgICAgZmVhdHVyZXMsXG4gICAgICAgICAgbGltaXRzLFxuICAgICAgICAgIHByaWNlX21vbnRobHksXG4gICAgICAgICAgcHJpY2VfeWVhcmx5XG4gICAgICAgIClcbiAgICAgIGApXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBmZXRjaGluZyB1c2VyIHN1YnNjcmlwdGlvbjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXVzZXJTdWIgfHwgIXVzZXJTdWIuc3Vic2NyaXB0aW9uX3BsYW5zKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBwbGFuRGF0YSA9IHVzZXJTdWIuc3Vic2NyaXB0aW9uX3BsYW5zIGFzIGFueTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaXB0aW9uX2lkOiB1c2VyU3ViLmlkLFxuICAgICAgcGxhbl9pZDogdXNlclN1Yi5wbGFuX2lkLFxuICAgICAgcGxhbl9uYW1lOiBwbGFuRGF0YS5uYW1lLFxuICAgICAgcGxhbl9kaXNwbGF5X25hbWU6IHBsYW5EYXRhLmRpc3BsYXlfbmFtZSxcbiAgICAgIGJpbGxpbmdfY3ljbGU6IHVzZXJTdWIuYmlsbGluZ19jeWNsZSxcbiAgICAgIHN0YXR1czogdXNlclN1Yi5zdGF0dXMsXG4gICAgICBjdXJyZW50X3BlcmlvZF9lbmQ6IHVzZXJTdWIuY3VycmVudF9wZXJpb2RfZW5kLFxuICAgICAgZmVhdHVyZXM6IHBsYW5EYXRhLmZlYXR1cmVzLFxuICAgICAgbGltaXRzOiBwbGFuRGF0YS5saW1pdHMsXG4gICAgICBwcmljZV9tb250aGx5OiBwbGFuRGF0YS5wcmljZV9tb250aGx5LFxuICAgICAgcHJpY2VfeWVhcmx5OiBwbGFuRGF0YS5wcmljZV95ZWFybHlcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGluIGdldFVzZXJTdWJzY3JpcHRpb246JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGEgc3BlY2lmaWMgc3Vic2NyaXB0aW9uIHBsYW4gYnkgSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN1YnNjcmlwdGlvblBsYW4ocGxhbklkOiBzdHJpbmcpOiBQcm9taXNlPFN1YnNjcmlwdGlvblBsYW4gfCBudWxsPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuICBcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYW5zJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ2lkJywgcGxhbklkKVxuICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAuc2luZ2xlKCk7XG4gICAgXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGZldGNoaW5nIHBsYW46JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIFxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGNhbiBnZW5lcmF0ZSBub3RlcyBiYXNlZCBvbiB0aGVpciBwbGFuIGFuZCB1c2FnZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tVc2FnZUxpbWl0cyhcbiAgdXNlcklkOiBzdHJpbmcsIFxuICB0b2tlbjogc3RyaW5nLCBcbiAgbm90ZVR5cGU6ICd2aWRlbycgfCAnZmlsZScgfCAndGV4dCcgPSAndGV4dCdcbik6IFByb21pc2U8VXNhZ2VDaGVjaz4ge1xuICB0cnkge1xuICAgIC8vIFVzZSBkaXJlY3QgdGFibGUgcXVlcmllcyBpbnN0ZWFkIG9mIFJQQyBmdW5jdGlvbnMgdG8gYXZvaWQgaXNzdWVzXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgZ2xvYmFsOiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gQ2hlY2tpbmcgdXNhZ2UgbGltaXRzIGZvciB1c2VyOicsIHVzZXJJZClcblxuICAgIC8vIEdldCB1c2VyJ3Mgc3Vic2NyaXB0aW9uIGRpcmVjdGx5XG4gICAgY29uc3QgeyBkYXRhOiB1c2VyU3ViLCBlcnJvcjogc3ViRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBwbGFuX2lkLFxuICAgICAgICBiaWxsaW5nX2N5Y2xlLFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIGN1cnJlbnRfcGVyaW9kX2VuZCxcbiAgICAgICAgc3Vic2NyaXB0aW9uX3BsYW5zIChcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGRpc3BsYXlfbmFtZSxcbiAgICAgICAgICBmZWF0dXJlcyxcbiAgICAgICAgICBsaW1pdHMsXG4gICAgICAgICAgcHJpY2VfbW9udGhseSxcbiAgICAgICAgICBwcmljZV95ZWFybHlcbiAgICAgICAgKVxuICAgICAgYClcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ2FjdGl2ZScpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICAvLyBHZXQgY3VycmVudCBtb250aCB1c2FnZSBkaXJlY3RseVxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zdCB7IGRhdGE6IHVzYWdlLCBlcnJvcjogdXNhZ2VFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdtb250aF95ZWFyJywgY3VycmVudE1vbnRoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgLy8gRGVmYXVsdCBmcmVlIHBsYW4gbGltaXRzXG4gICAgY29uc3QgZnJlZVBsYW5MaW1pdHMgPSB7IFxuICAgICAgbm90ZXNfcGVyX21vbnRoOiAyLCBcbiAgICAgIG1heF9zYXZlZF9ub3RlczogMywgXG4gICAgICBtYXhfdGV4dF9sZW5ndGg6IDUwMDAgXG4gICAgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2FnZSA9IHVzYWdlIHx8IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogMCxcbiAgICAgIHZpZGVvX25vdGVzX2NvdW50OiAwLFxuICAgICAgZmlsZV9ub3Rlc19jb3VudDogMCxcbiAgICAgIHRleHRfbm90ZXNfY291bnQ6IDAsXG4gICAgICB0b3RhbF9zYXZlZF9ub3RlczogMCxcbiAgICAgIG1vbnRoX3llYXI6IGN1cnJlbnRNb250aFxuICAgIH07XG5cbiAgICAvLyBJZiB1c2FnZSByZWNvcmQgZG9lc24ndCBleGlzdCwgY3JlYXRlIGl0XG4gICAgaWYgKCF1c2FnZSkge1xuICAgICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIENyZWF0aW5nIHVzYWdlIHJlY29yZCBmb3IgY3VycmVudCBtb250aDonLCBjdXJyZW50TW9udGgpXG4gICAgICBjb25zdCB7IGVycm9yOiBjcmVhdGVVc2FnZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndXNlcl91c2FnZScpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGgsXG4gICAgICAgICAgbm90ZXNfZ2VuZXJhdGVkOiAwLFxuICAgICAgICAgIHZpZGVvX25vdGVzX2NvdW50OiAwLFxuICAgICAgICAgIGZpbGVfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgICAgdGV4dF9ub3Rlc19jb3VudDogMCxcbiAgICAgICAgICB0b3RhbF9zYXZlZF9ub3RlczogMCxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChjcmVhdGVVc2FnZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFdhcm5pbmc6IENvdWxkIG5vdCBjcmVhdGUgdXNhZ2UgcmVjb3JkOicsIGNyZWF0ZVVzYWdlRXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIG5vIHN1YnNjcmlwdGlvbiBmb3VuZCBvciBlcnJvciwgdHJ5IHRvIGNyZWF0ZSBhIGZyZWUgc3Vic2NyaXB0aW9uXG4gICAgaWYgKCF1c2VyU3ViIHx8IHN1YkVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gTm8gYWN0aXZlIHN1YnNjcmlwdGlvbiBmb3VuZCwgYXR0ZW1wdGluZyB0byBjcmVhdGUgZnJlZSBzdWJzY3JpcHRpb24nKVxuICAgICAgXG4gICAgICBpZiAoc3ViRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gU3Vic2NyaXB0aW9uIHF1ZXJ5IGVycm9yOicsIHN1YkVycm9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gVHJ5IHRvIGNyZWF0ZSBhIGZyZWUgc3Vic2NyaXB0aW9uIGZvciB0aGUgdXNlclxuICAgICAgY29uc3QgeyBlcnJvcjogY3JlYXRlU3ViRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX3N1YnNjcmlwdGlvbnMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgcGxhbl9pZDogJ2ZyZWUnLFxuICAgICAgICAgIGJpbGxpbmdfY3ljbGU6ICdtb250aGx5JyxcbiAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICAgIGN1cnJlbnRfcGVyaW9kX3N0YXJ0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgY3VycmVudF9wZXJpb2RfZW5kOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KCk7XG5cbiAgICAgIGlmIChjcmVhdGVTdWJFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBDb3VsZCBub3QgY3JlYXRlIGZyZWUgc3Vic2NyaXB0aW9uOicsIGNyZWF0ZVN1YkVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBDcmVhdGVkIGZyZWUgc3Vic2NyaXB0aW9uIGZvciB1c2VyJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBmcmVlIHBsYW4gbGltaXRzIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB3ZSBjb3VsZCBjcmVhdGUgdGhlIHN1YnNjcmlwdGlvblxuICAgICAgY29uc3QgY2FuR2VuZXJhdGUgPSBjdXJyZW50VXNhZ2Uubm90ZXNfZ2VuZXJhdGVkIDwgZnJlZVBsYW5MaW1pdHMubm90ZXNfcGVyX21vbnRoO1xuICAgICAgY29uc3QgY2FuU2F2ZSA9IGN1cnJlbnRVc2FnZS50b3RhbF9zYXZlZF9ub3RlcyA8IGZyZWVQbGFuTGltaXRzLm1heF9zYXZlZF9ub3RlcztcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FuR2VuZXJhdGUsXG4gICAgICAgIGNhblNhdmUsXG4gICAgICAgIHJlYXNvbjogIWNhbkdlbmVyYXRlID8gYE1vbnRobHkgbGltaXQgcmVhY2hlZCAoJHtmcmVlUGxhbkxpbWl0cy5ub3Rlc19wZXJfbW9udGh9IG5vdGVzIHBlciBtb250aClgIDpcbiAgICAgICAgICAgICAgICAhY2FuU2F2ZSA/IGBTdG9yYWdlIGxpbWl0IHJlYWNoZWQgKCR7ZnJlZVBsYW5MaW1pdHMubWF4X3NhdmVkX25vdGVzfSBzYXZlZCBub3RlcyBtYXhpbXVtKWAgOiB1bmRlZmluZWQsXG4gICAgICAgIHVzYWdlOiBjdXJyZW50VXNhZ2UsXG4gICAgICAgIGxpbWl0czogZnJlZVBsYW5MaW1pdHNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdXNlclN1YjtcbiAgICBjb25zdCBwbGFuRGF0YSA9IHN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fcGxhbnMgYXMgYW55O1xuICAgIFxuICAgIGlmICghcGxhbkRhdGEpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFBsYW4gZGF0YSBub3QgZm91bmQgZm9yIHN1YnNjcmlwdGlvbjonLCBzdWJzY3JpcHRpb24pO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gZnJlZSBwbGFuXG4gICAgICBjb25zdCBjYW5HZW5lcmF0ZSA9IGN1cnJlbnRVc2FnZS5ub3Rlc19nZW5lcmF0ZWQgPCBmcmVlUGxhbkxpbWl0cy5ub3Rlc19wZXJfbW9udGg7XG4gICAgICBjb25zdCBjYW5TYXZlID0gY3VycmVudFVzYWdlLnRvdGFsX3NhdmVkX25vdGVzIDwgZnJlZVBsYW5MaW1pdHMubWF4X3NhdmVkX25vdGVzO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW5HZW5lcmF0ZSxcbiAgICAgICAgY2FuU2F2ZSxcbiAgICAgICAgcmVhc29uOiAnUGxhbiBkYXRhIG5vdCBmb3VuZCAtIHVzaW5nIGZyZWUgcGxhbiBsaW1pdHMnLFxuICAgICAgICB1c2FnZTogY3VycmVudFVzYWdlLFxuICAgICAgICBsaW1pdHM6IGZyZWVQbGFuTGltaXRzXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gRm91bmQgc3Vic2NyaXB0aW9uOicsIHtcbiAgICAgIHBsYW5JZDogc3Vic2NyaXB0aW9uLnBsYW5faWQsXG4gICAgICBwbGFuTGltaXRzOiBwbGFuRGF0YS5saW1pdHMsXG4gICAgICBjdXJyZW50VXNhZ2U6IGN1cnJlbnRVc2FnZVxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgbW9udGhseSBnZW5lcmF0aW9uIGxpbWl0IChoYW5kbGUgdW5saW1pdGVkIGNhc2UpXG4gICAgY29uc3QgbW9udGhseUxpbWl0ID0gcGxhbkRhdGEubGltaXRzLm5vdGVzX3Blcl9tb250aDtcbiAgICBjb25zdCBjYW5HZW5lcmF0ZSA9IG1vbnRobHlMaW1pdCA9PT0gLTEgfHwgY3VycmVudFVzYWdlLm5vdGVzX2dlbmVyYXRlZCA8IG1vbnRobHlMaW1pdDtcbiAgICBcbiAgICAvLyBDaGVjayBzYXZlZCBub3RlcyBsaW1pdFxuICAgIGNvbnN0IGNhblNhdmUgPSBjdXJyZW50VXNhZ2UudG90YWxfc2F2ZWRfbm90ZXMgPCBwbGFuRGF0YS5saW1pdHMubWF4X3NhdmVkX25vdGVzO1xuICAgIFxuICAgIGxldCByZWFzb246IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBpZiAoIWNhbkdlbmVyYXRlICYmIG1vbnRobHlMaW1pdCAhPT0gLTEpIHtcbiAgICAgIHJlYXNvbiA9IGBNb250aGx5IGxpbWl0IHJlYWNoZWQgKCR7bW9udGhseUxpbWl0fSBub3RlcyBwZXIgbW9udGgpYDtcbiAgICB9IGVsc2UgaWYgKCFjYW5TYXZlKSB7XG4gICAgICByZWFzb24gPSBgU3RvcmFnZSBsaW1pdCByZWFjaGVkICgke3BsYW5EYXRhLmxpbWl0cy5tYXhfc2F2ZWRfbm90ZXN9IHNhdmVkIG5vdGVzIG1heGltdW0pYDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbkdlbmVyYXRlLFxuICAgICAgY2FuU2F2ZSxcbiAgICAgIHJlYXNvbixcbiAgICAgIHVzYWdlOiBjdXJyZW50VXNhZ2UsXG4gICAgICBsaW1pdHM6IHBsYW5EYXRhLmxpbWl0c1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgY2hlY2tpbmcgdXNhZ2UgbGltaXRzOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBSZXR1cm4gcmVzdHJpY3RpdmUgZmFsbGJhY2tcbiAgICBjb25zdCBjdXJyZW50TW9udGggPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgNyk7XG4gICAgY29uc3QgZmFsbGJhY2tVc2FnZSA9IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogOTk5LFxuICAgICAgdmlkZW9fbm90ZXNfY291bnQ6IDAsXG4gICAgICBmaWxlX25vdGVzX2NvdW50OiAwLFxuICAgICAgdGV4dF9ub3Rlc19jb3VudDogMCxcbiAgICAgIHRvdGFsX3NhdmVkX25vdGVzOiA5OTksXG4gICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGhcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBjYW5HZW5lcmF0ZTogZmFsc2UsXG4gICAgICBjYW5TYXZlOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ0Vycm9yIGNoZWNraW5nIHN1YnNjcmlwdGlvbiBsaW1pdHMuIFBsZWFzZSB0cnkgYWdhaW4uJyxcbiAgICAgIHVzYWdlOiBmYWxsYmFja1VzYWdlLFxuICAgICAgbGltaXRzOiB7IG5vdGVzX3Blcl9tb250aDogMiwgbWF4X3NhdmVkX25vdGVzOiAzLCBtYXhfdGV4dF9sZW5ndGg6IDUwMDAgfVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBJbmNyZW1lbnQgdXNlcidzIHVzYWdlIGNvdW50IGFmdGVyIHN1Y2Nlc3NmdWwgbm90ZSBnZW5lcmF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRVc2FnZShcbiAgdXNlcklkOiBzdHJpbmcsIFxuICB0b2tlbjogc3RyaW5nLCBcbiAgbm90ZVR5cGU6ICd2aWRlbycgfCAnZmlsZScgfCAndGV4dCcgPSAndGV4dCdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGdsb2JhbDoge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDcpO1xuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBJbmNyZW1lbnRpbmcgdXNhZ2UgZm9yIHVzZXI6JywgdXNlcklkLCAndHlwZTonLCBub3RlVHlwZSlcblxuICAgIC8vIEdldCBjdXJyZW50IHVzYWdlXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50VXNhZ2UsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ21vbnRoX3llYXInLCBjdXJyZW50TW9udGgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZmV0Y2hFcnJvciAmJiBmZXRjaEVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIGZldGNoaW5nIGN1cnJlbnQgdXNhZ2U6JywgZmV0Y2hFcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUHJlcGFyZSB1cGRhdGUgZGF0YVxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcbiAgICAgIG5vdGVzX2dlbmVyYXRlZDogKGN1cnJlbnRVc2FnZT8ubm90ZXNfZ2VuZXJhdGVkIHx8IDApICsgMSxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgICAvLyBJbmNyZW1lbnQgc3BlY2lmaWMgbm90ZSB0eXBlIGNvdW50ZXJcbiAgICBpZiAobm90ZVR5cGUgPT09ICd2aWRlbycpIHtcbiAgICAgIHVwZGF0ZURhdGEudmlkZW9fbm90ZXNfY291bnQgPSAoY3VycmVudFVzYWdlPy52aWRlb19ub3Rlc19jb3VudCB8fCAwKSArIDE7XG4gICAgfSBlbHNlIGlmIChub3RlVHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgICB1cGRhdGVEYXRhLmZpbGVfbm90ZXNfY291bnQgPSAoY3VycmVudFVzYWdlPy5maWxlX25vdGVzX2NvdW50IHx8IDApICsgMTtcbiAgICB9IGVsc2UgaWYgKG5vdGVUeXBlID09PSAndGV4dCcpIHtcbiAgICAgIHVwZGF0ZURhdGEudGV4dF9ub3Rlc19jb3VudCA9IChjdXJyZW50VXNhZ2U/LnRleHRfbm90ZXNfY291bnQgfHwgMCkgKyAxO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgdXNhZ2UgcmVjb3JkXG4gICAgaWYgKGN1cnJlbnRVc2FnZSkge1xuICAgICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIC5lcSgnbW9udGhfeWVhcicsIGN1cnJlbnRNb250aCk7XG5cbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciB1cGRhdGluZyB1c2FnZTonLCB1cGRhdGVFcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIG5ldyB1c2FnZSByZWNvcmRcbiAgICAgIGNvbnN0IGluc2VydERhdGEgPSB7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbW9udGhfeWVhcjogY3VycmVudE1vbnRoLFxuICAgICAgICBub3Rlc19nZW5lcmF0ZWQ6IDEsXG4gICAgICAgIHZpZGVvX25vdGVzX2NvdW50OiBub3RlVHlwZSA9PT0gJ3ZpZGVvJyA/IDEgOiAwLFxuICAgICAgICBmaWxlX25vdGVzX2NvdW50OiBub3RlVHlwZSA9PT0gJ2ZpbGUnID8gMSA6IDAsXG4gICAgICAgIHRleHRfbm90ZXNfY291bnQ6IG5vdGVUeXBlID09PSAndGV4dCcgPyAxIDogMCxcbiAgICAgICAgdG90YWxfc2F2ZWRfbm90ZXM6IDAsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpO1xuXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgY3JlYXRpbmcgdXNhZ2UgcmVjb3JkOicsIGluc2VydEVycm9yKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBTdWNjZXNzZnVsbHkgaW5jcmVtZW50ZWQgdXNhZ2UnKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBpbmNyZW1lbnRpbmcgdXNhZ2U6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFVwZGF0ZSBzYXZlZCBub3RlcyBjb3VudCAodXNlZCB3aGVuIG5vdGVzIGFyZSBzYXZlZCBvciBkZWxldGVkKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2F2ZWROb3Rlc0NvdW50KFxuICB1c2VySWQ6IHN0cmluZywgXG4gIHRva2VuOiBzdHJpbmcsIFxuICBjb3VudDogbnVtYmVyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICBnbG9iYWw6IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbl0gVXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQgZm9yIHVzZXI6JywgdXNlcklkLCAnY291bnQ6JywgY291bnQpXG5cbiAgICAvLyBVcHNlcnQgdGhlIHNhdmVkIG5vdGVzIGNvdW50XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VyX3VzYWdlJylcbiAgICAgIC51cHNlcnQoe1xuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgIG1vbnRoX3llYXI6IGN1cnJlbnRNb250aCxcbiAgICAgICAgdG90YWxfc2F2ZWRfbm90ZXM6IE1hdGgubWF4KDAsIGNvdW50KSwgLy8gRW5zdXJlIG5vbi1uZWdhdGl2ZVxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0sIHtcbiAgICAgICAgb25Db25mbGljdDogJ3VzZXJfaWQsbW9udGhfeWVhcidcbiAgICAgIH0pO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciB1cGRhdGluZyBzYXZlZCBub3RlcyBjb3VudDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIFN1Y2Nlc3NmdWxseSB1cGRhdGVkIHNhdmVkIG5vdGVzIGNvdW50Jyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgdXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFJlZnJlc2ggc2F2ZWQgbm90ZXMgY291bnQgYnkgY291bnRpbmcgYWxsIG5vdGVzIGZyb20gYWxsIHRhYmxlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVmcmVzaFNhdmVkTm90ZXNDb3VudChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRva2VuOiBzdHJpbmdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGdsb2JhbDoge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIFJlZnJlc2hpbmcgc2F2ZWQgbm90ZXMgY291bnQgZm9yIHVzZXI6JywgdXNlcklkKTtcblxuICAgIC8vIENvdW50IG5vdGVzIGZyb20gYWxsIHRhYmxlcyBpbmNsdWRpbmcgdmlkZW9fdXBsb2FkX25vdGVzXG4gICAgY29uc3QgW3ZpZGVvUmVzdWx0LCBmaWxlUmVzdWx0LCB0ZXh0UmVzdWx0LCB1cGxvYWRWaWRlb1Jlc3VsdF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndmlkZW9fbm90ZXMnKVxuICAgICAgICAuc2VsZWN0KCdpZCcsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKSxcbiAgICAgIHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdmaWxlX25vdGVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZCksXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndGV4dF9ub3RlcycpXG4gICAgICAgIC5zZWxlY3QoJ2lkJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpLFxuICAgICAgLy8gSGFuZGxlIHZpZGVvX3VwbG9hZF9ub3RlcyB0YWJsZSB0aGF0IG1pZ2h0IG5vdCBleGlzdCBpbiBhbGwgZW52aXJvbm1lbnRzXG4gICAgICBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndmlkZW9fdXBsb2FkX25vdGVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLnRoZW4oXG4gICAgICAgICAgcmVzdWx0ID0+IHJlc3VsdCxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb25dIHZpZGVvX3VwbG9hZF9ub3RlcyB0YWJsZSBtaWdodCBub3QgZXhpc3Q6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgICAgIHJldHVybiB7IGNvdW50OiAwIH1cbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICBdKTtcblxuICAgIGNvbnN0IHZpZGVvQ291bnQgPSB2aWRlb1Jlc3VsdC5jb3VudCB8fCAwO1xuICAgIGNvbnN0IGZpbGVDb3VudCA9IGZpbGVSZXN1bHQuY291bnQgfHwgMDtcbiAgICBjb25zdCB0ZXh0Q291bnQgPSB0ZXh0UmVzdWx0LmNvdW50IHx8IDA7XG4gICAgY29uc3QgdXBsb2FkVmlkZW9Db3VudCA9IHVwbG9hZFZpZGVvUmVzdWx0LmNvdW50IHx8IDA7XG4gICAgY29uc3QgdG90YWxDb3VudCA9IHZpZGVvQ291bnQgKyBmaWxlQ291bnQgKyB0ZXh0Q291bnQgKyB1cGxvYWRWaWRlb0NvdW50O1xuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb25dIE5vdGUgY291bnRzOicsIHtcbiAgICAgIHZpZGVvOiB2aWRlb0NvdW50LFxuICAgICAgZmlsZTogZmlsZUNvdW50LFxuICAgICAgdGV4dDogdGV4dENvdW50LFxuICAgICAgdmlkZW9fdXBsb2FkOiB1cGxvYWRWaWRlb0NvdW50LFxuICAgICAgdG90YWw6IHRvdGFsQ291bnRcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgdXNhZ2UgcmVjb3JkIHdpdGggdGhlIGFjdHVhbCBjb3VudFxuICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCA3KTtcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJfdXNhZ2UnKVxuICAgICAgLnVwc2VydCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbW9udGhfeWVhcjogY3VycmVudE1vbnRoLFxuICAgICAgICB0b3RhbF9zYXZlZF9ub3RlczogdG90YWxDb3VudCxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9LCB7XG4gICAgICAgIG9uQ29uZmxpY3Q6ICd1c2VyX2lkLG1vbnRoX3llYXInXG4gICAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgdXBkYXRpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uXSBTdWNjZXNzZnVsbHkgcmVmcmVzaGVkIHNhdmVkIG5vdGVzIGNvdW50IHRvOicsIHRvdGFsQ291bnQpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIEVycm9yIHJlZnJlc2hpbmcgc2F2ZWQgbm90ZXMgY291bnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBwbGFuIHByaWNpbmcgd2l0aCBkaXNjb3VudCBjYWxjdWxhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGxhblByaWNpbmcocGxhbjogU3Vic2NyaXB0aW9uUGxhbikge1xuICBjb25zdCBtb250aGx5UHJpY2UgPSBwbGFuLnByaWNlX21vbnRobHk7XG4gIGNvbnN0IHllYXJseVByaWNlID0gcGxhbi5wcmljZV95ZWFybHk7XG4gIGNvbnN0IHllYXJseU1vbnRobHlFcXVpdmFsZW50ID0geWVhcmx5UHJpY2UgLyAxMjtcbiAgY29uc3QgZGlzY291bnRQZXJjZW50YWdlID0gbW9udGhseVByaWNlID4gMCA/IE1hdGgucm91bmQoKDEgLSB5ZWFybHlNb250aGx5RXF1aXZhbGVudCAvIG1vbnRobHlQcmljZSkgKiAxMDApIDogMDtcbiAgY29uc3QgeWVhcmx5U2F2aW5ncyA9IChtb250aGx5UHJpY2UgKiAxMikgLSB5ZWFybHlQcmljZTtcbiAgXG4gIHJldHVybiB7XG4gICAgbW9udGhseTogbW9udGhseVByaWNlLFxuICAgIHllYXJseTogeWVhcmx5UHJpY2UsXG4gICAgeWVhcmx5TW9udGhseUVxdWl2YWxlbnQsXG4gICAgZGlzY291bnRQZXJjZW50YWdlLFxuICAgIHllYXJseVNhdmluZ3MsXG4gICAgY3VycmVuY3k6IHBsYW4uY3VycmVuY3lcbiAgfTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gYSBzcGVjaWZpYyBmZWF0dXJlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYXNGZWF0dXJlQWNjZXNzKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgdG9rZW46IHN0cmluZyxcbiAgZmVhdHVyZToga2V5b2YgU3Vic2NyaXB0aW9uUGxhblsnZmVhdHVyZXMnXVxuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgZ2V0VXNlclN1YnNjcmlwdGlvbih1c2VySWQsIHRva2VuKTtcbiAgICBcbiAgICBpZiAoIXN1YnNjcmlwdGlvbikge1xuICAgICAgLy8gRGVmYXVsdCBmcmVlIHBsYW4gZmVhdHVyZXNcbiAgICAgIGNvbnN0IGZyZWVGZWF0dXJlcyA9IHtcbiAgICAgICAgbm90ZXNfZ2VuZXJhdGlvbjogdHJ1ZSxcbiAgICAgICAgcXVpenplczogZmFsc2UsXG4gICAgICAgIHlvdXR1YmVfc3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgcHB0X3N1cHBvcnQ6IGZhbHNlLFxuICAgICAgICBleHBvcnQ6IGZhbHNlLFxuICAgICAgICBjb3B5X3Bhc3RlOiB0cnVlLFxuICAgICAgICB1cGxvYWRfdmlkZW86IGZhbHNlLFxuICAgICAgICBwcmlvcml0eV9nZW5lcmF0aW9uOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGZyZWVGZWF0dXJlc1tmZWF0dXJlXSB8fCBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbi5mZWF0dXJlc1tmZWF0dXJlXSB8fCBmYWxzZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBjaGVja2luZyBmZWF0dXJlIGFjY2VzczonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBEZWZhdWx0IHRvIG5vIGFjY2VzcyBvbiBlcnJvclxuICB9XG59XG5cbi8qKlxuICogQXNzaWduIHN1YnNjcmlwdGlvbiB0byB1c2VyIGFmdGVyIHN1Y2Nlc3NmdWwgcGF5bWVudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduVXNlclN1YnNjcmlwdGlvbihcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRva2VuOiBzdHJpbmcsXG4gIHBsYW5JZDogc3RyaW5nLFxuICBiaWxsaW5nQ3ljbGU6ICdtb250aGx5JyB8ICd5ZWFybHknLFxuICBwYXltZW50RGF0YT86IHtcbiAgICBzdHJpcGVTdWJzY3JpcHRpb25JZD86IHN0cmluZztcbiAgICBzdHJpcGVDdXN0b21lcklkPzogc3RyaW5nO1xuICB9XG4pOiBQcm9taXNlPFVzZXJTdWJzY3JpcHRpb24gfCBudWxsPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICBnbG9iYWw6IHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gQ2FsY3VsYXRlIHBlcmlvZCBkYXRlc1xuICAgIGNvbnN0IGN1cnJlbnRQZXJpb2RTdGFydCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgY3VycmVudFBlcmlvZEVuZCA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgaWYgKGJpbGxpbmdDeWNsZSA9PT0gJ3llYXJseScpIHtcbiAgICAgIGN1cnJlbnRQZXJpb2RFbmQuc2V0RnVsbFllYXIoY3VycmVudFBlcmlvZEVuZC5nZXRGdWxsWWVhcigpICsgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRQZXJpb2RFbmQuc2V0TW9udGgoY3VycmVudFBlcmlvZEVuZC5nZXRNb250aCgpICsgMSk7XG4gICAgfVxuXG4gICAgLy8gUHJlcGFyZSBzdWJzY3JpcHRpb24gZGF0YVxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbkRhdGEgPSB7XG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBwbGFuX2lkOiBwbGFuSWQsXG4gICAgICBiaWxsaW5nX2N5Y2xlOiBiaWxsaW5nQ3ljbGUsXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnIGFzIGNvbnN0LFxuICAgICAgY3VycmVudF9wZXJpb2Rfc3RhcnQ6IGN1cnJlbnRQZXJpb2RTdGFydC50b0lTT1N0cmluZygpLFxuICAgICAgY3VycmVudF9wZXJpb2RfZW5kOiBjdXJyZW50UGVyaW9kRW5kLnRvSVNPU3RyaW5nKCksXG4gICAgICBjYW5jZWxfYXRfcGVyaW9kX2VuZDogZmFsc2UsXG4gICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX2lkOiBwYXltZW50RGF0YT8uc3RyaXBlU3Vic2NyaXB0aW9uSWQgfHwgbnVsbCxcbiAgICAgIHN0cmlwZV9jdXN0b21lcl9pZDogcGF5bWVudERhdGE/LnN0cmlwZUN1c3RvbWVySWQgfHwgbnVsbCxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgICAvLyBVcHNlcnQgc3Vic2NyaXB0aW9uICh1cGRhdGUgaWYgZXhpc3RzLCBpbnNlcnQgaWYgbmV3KVxuICAgIGNvbnN0IHsgZGF0YTogc3Vic2NyaXB0aW9uLCBlcnJvcjogc3Vic2NyaXB0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zdWJzY3JpcHRpb25zJylcbiAgICAgIC51cHNlcnQoc3Vic2NyaXB0aW9uRGF0YSwge1xuICAgICAgICBvbkNvbmZsaWN0OiAndXNlcl9pZCdcbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KGBcbiAgICAgICAgaWQsXG4gICAgICAgIHBsYW5faWQsXG4gICAgICAgIGJpbGxpbmdfY3ljbGUsXG4gICAgICAgIHN0YXR1cyxcbiAgICAgICAgY3VycmVudF9wZXJpb2RfZW5kLFxuICAgICAgICBzdWJzY3JpcHRpb25fcGxhbnMgKFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgZGlzcGxheV9uYW1lLFxuICAgICAgICAgIGZlYXR1cmVzLFxuICAgICAgICAgIGxpbWl0cyxcbiAgICAgICAgICBwcmljZV9tb250aGx5LFxuICAgICAgICAgIHByaWNlX3llYXJseVxuICAgICAgICApXG4gICAgICBgKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHN1YnNjcmlwdGlvbkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU3Vic2NyaXB0aW9uXSBFcnJvciBhc3NpZ25pbmcgc3Vic2NyaXB0aW9uOicsIHN1YnNjcmlwdGlvbkVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFzc2lnbiBzdWJzY3JpcHRpb24nKTtcbiAgICB9XG5cbiAgICBpZiAoIXN1YnNjcmlwdGlvbiB8fCAhc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl9wbGFucykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgc3Vic2NyaXB0aW9uIGRldGFpbHMnKTtcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIHVzYWdlIHRyYWNraW5nIGZvciBjdXJyZW50IG1vbnRoXG4gICAgY29uc3QgY3VycmVudE1vbnRoID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDcpO1xuICAgIGNvbnN0IHsgZXJyb3I6IHVzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl91c2FnZScpXG4gICAgICAudXBzZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICBtb250aF95ZWFyOiBjdXJyZW50TW9udGgsXG4gICAgICAgIG5vdGVzX2dlbmVyYXRlZDogMCxcbiAgICAgICAgdmlkZW9fbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIGZpbGVfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIHRleHRfbm90ZXNfY291bnQ6IDAsXG4gICAgICAgIHRvdGFsX3NhdmVkX25vdGVzOiAwLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0sIHtcbiAgICAgICAgb25Db25mbGljdDogJ3VzZXJfaWQsbW9udGhfeWVhcicsXG4gICAgICAgIGlnbm9yZUR1cGxpY2F0ZXM6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgaWYgKHVzYWdlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb25dIFdhcm5pbmc6IEZhaWxlZCB0byBpbml0aWFsaXplIHVzYWdlIHRyYWNraW5nOicsIHVzYWdlRXJyb3IpO1xuICAgICAgLy8gRG9uJ3QgdGhyb3cgZXJyb3IgaGVyZSBhcyBzdWJzY3JpcHRpb24gYXNzaWdubWVudCB3YXMgc3VjY2Vzc2Z1bFxuICAgIH1cblxuICAgIGNvbnN0IHBsYW5EYXRhID0gc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl9wbGFucyBhcyBhbnk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgcGxhbl9pZDogc3Vic2NyaXB0aW9uLnBsYW5faWQsXG4gICAgICBwbGFuX25hbWU6IHBsYW5EYXRhLm5hbWUsXG4gICAgICBwbGFuX2Rpc3BsYXlfbmFtZTogcGxhbkRhdGEuZGlzcGxheV9uYW1lLFxuICAgICAgYmlsbGluZ19jeWNsZTogc3Vic2NyaXB0aW9uLmJpbGxpbmdfY3ljbGUsXG4gICAgICBzdGF0dXM6IHN1YnNjcmlwdGlvbi5zdGF0dXMsXG4gICAgICBjdXJyZW50X3BlcmlvZF9lbmQ6IHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQsXG4gICAgICBmZWF0dXJlczogcGxhbkRhdGEuZmVhdHVyZXMsXG4gICAgICBsaW1pdHM6IHBsYW5EYXRhLmxpbWl0cyxcbiAgICAgIHByaWNlX21vbnRobHk6IHBsYW5EYXRhLnByaWNlX21vbnRobHksXG4gICAgICBwcmljZV95ZWFybHk6IHBsYW5EYXRhLnByaWNlX3llYXJseVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbl0gRXJyb3IgaW4gYXNzaWduVXNlclN1YnNjcmlwdGlvbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn0gIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZ2V0U3Vic2NyaXB0aW9uUGxhbnMiLCJzdXBhYmFzZSIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY29uc29sZSIsIkVycm9yIiwiZ2V0VXNlclN1YnNjcmlwdGlvbiIsInVzZXJJZCIsInRva2VuIiwiZ2xvYmFsIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJ1c2VyU3ViIiwic2luZ2xlIiwic3Vic2NyaXB0aW9uX3BsYW5zIiwicGxhbkRhdGEiLCJzdWJzY3JpcHRpb25faWQiLCJpZCIsInBsYW5faWQiLCJwbGFuX25hbWUiLCJuYW1lIiwicGxhbl9kaXNwbGF5X25hbWUiLCJkaXNwbGF5X25hbWUiLCJiaWxsaW5nX2N5Y2xlIiwic3RhdHVzIiwiY3VycmVudF9wZXJpb2RfZW5kIiwiZmVhdHVyZXMiLCJsaW1pdHMiLCJwcmljZV9tb250aGx5IiwicHJpY2VfeWVhcmx5IiwiZ2V0U3Vic2NyaXB0aW9uUGxhbiIsInBsYW5JZCIsImNoZWNrVXNhZ2VMaW1pdHMiLCJub3RlVHlwZSIsImxvZyIsInN1YkVycm9yIiwiY3VycmVudE1vbnRoIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJ1c2FnZSIsInVzYWdlRXJyb3IiLCJmcmVlUGxhbkxpbWl0cyIsIm5vdGVzX3Blcl9tb250aCIsIm1heF9zYXZlZF9ub3RlcyIsIm1heF90ZXh0X2xlbmd0aCIsImN1cnJlbnRVc2FnZSIsIm5vdGVzX2dlbmVyYXRlZCIsInZpZGVvX25vdGVzX2NvdW50IiwiZmlsZV9ub3Rlc19jb3VudCIsInRleHRfbm90ZXNfY291bnQiLCJ0b3RhbF9zYXZlZF9ub3RlcyIsIm1vbnRoX3llYXIiLCJjcmVhdGVVc2FnZUVycm9yIiwiaW5zZXJ0IiwidXNlcl9pZCIsInVwZGF0ZWRfYXQiLCJjcmVhdGVTdWJFcnJvciIsImN1cnJlbnRfcGVyaW9kX3N0YXJ0Iiwibm93IiwiY2FuR2VuZXJhdGUiLCJjYW5TYXZlIiwicmVhc29uIiwidW5kZWZpbmVkIiwic3Vic2NyaXB0aW9uIiwicGxhbkxpbWl0cyIsIm1vbnRobHlMaW1pdCIsImZhbGxiYWNrVXNhZ2UiLCJpbmNyZW1lbnRVc2FnZSIsImZldGNoRXJyb3IiLCJjb2RlIiwidXBkYXRlRGF0YSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwiaW5zZXJ0RGF0YSIsImNyZWF0ZWRfYXQiLCJpbnNlcnRFcnJvciIsInVwZGF0ZVNhdmVkTm90ZXNDb3VudCIsImNvdW50IiwidXBzZXJ0IiwiTWF0aCIsIm1heCIsIm9uQ29uZmxpY3QiLCJyZWZyZXNoU2F2ZWROb3Rlc0NvdW50IiwidmlkZW9SZXN1bHQiLCJmaWxlUmVzdWx0IiwidGV4dFJlc3VsdCIsInVwbG9hZFZpZGVvUmVzdWx0IiwiUHJvbWlzZSIsImFsbCIsImhlYWQiLCJ0aGVuIiwicmVzdWx0Iiwid2FybiIsIm1lc3NhZ2UiLCJ2aWRlb0NvdW50IiwiZmlsZUNvdW50IiwidGV4dENvdW50IiwidXBsb2FkVmlkZW9Db3VudCIsInRvdGFsQ291bnQiLCJ2aWRlbyIsImZpbGUiLCJ0ZXh0IiwidmlkZW9fdXBsb2FkIiwidG90YWwiLCJnZXRQbGFuUHJpY2luZyIsInBsYW4iLCJtb250aGx5UHJpY2UiLCJ5ZWFybHlQcmljZSIsInllYXJseU1vbnRobHlFcXVpdmFsZW50IiwiZGlzY291bnRQZXJjZW50YWdlIiwicm91bmQiLCJ5ZWFybHlTYXZpbmdzIiwibW9udGhseSIsInllYXJseSIsImN1cnJlbmN5IiwiaGFzRmVhdHVyZUFjY2VzcyIsImZlYXR1cmUiLCJmcmVlRmVhdHVyZXMiLCJub3Rlc19nZW5lcmF0aW9uIiwicXVpenplcyIsInlvdXR1YmVfc3VwcG9ydCIsInBwdF9zdXBwb3J0IiwiZXhwb3J0IiwiY29weV9wYXN0ZSIsInVwbG9hZF92aWRlbyIsInByaW9yaXR5X2dlbmVyYXRpb24iLCJhc3NpZ25Vc2VyU3Vic2NyaXB0aW9uIiwiYmlsbGluZ0N5Y2xlIiwicGF5bWVudERhdGEiLCJjdXJyZW50UGVyaW9kU3RhcnQiLCJjdXJyZW50UGVyaW9kRW5kIiwic2V0RnVsbFllYXIiLCJnZXRGdWxsWWVhciIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJzdWJzY3JpcHRpb25EYXRhIiwiY2FuY2VsX2F0X3BlcmlvZF9lbmQiLCJzdHJpcGVfc3Vic2NyaXB0aW9uX2lkIiwic3RyaXBlU3Vic2NyaXB0aW9uSWQiLCJzdHJpcGVfY3VzdG9tZXJfaWQiLCJzdHJpcGVDdXN0b21lcklkIiwic3Vic2NyaXB0aW9uRXJyb3IiLCJpZ25vcmVEdXBsaWNhdGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/services/subscription.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/youtube-transcript.ts":
/*!********************************************!*\
  !*** ./src/services/youtube-transcript.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractTranscriptFallback: () => (/* binding */ extractTranscriptFallback),\n/* harmony export */   extractYouTubeTranscript: () => (/* binding */ extractYouTubeTranscript),\n/* harmony export */   getYouTubeTranscriptText: () => (/* binding */ getYouTubeTranscriptText),\n/* harmony export */   isTranscriptAvailable: () => (/* binding */ isTranscriptAvailable)\n/* harmony export */ });\n/* harmony import */ var youtube_transcript_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! youtube-transcript-api */ \"(rsc)/./node_modules/youtube-transcript-api/src/index.js\");\n/* harmony import */ var _youtube__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./youtube */ \"(rsc)/./src/services/youtube.ts\");\n/**\n * Production-safe YouTube transcript extraction service\n * Uses youtube-transcript-api instead of shell commands for hosted environments\n */ \n\n/**\n * Extract transcript from YouTube video using youtube-transcript-api\n * This works in production environments without requiring system binaries\n */ async function extractYouTubeTranscript(videoIdOrUrl, languages = [\n    \"en\",\n    \"pl\",\n    \"es\",\n    \"fr\",\n    \"de\"\n]) {\n    try {\n        // Extract video ID if URL is provided\n        let videoId = videoIdOrUrl;\n        if (videoIdOrUrl.includes(\"youtube.com\") || videoIdOrUrl.includes(\"youtu.be\")) {\n            const extractedId = (0,_youtube__WEBPACK_IMPORTED_MODULE_1__.extractYouTubeId)(videoIdOrUrl);\n            if (!extractedId) {\n                return {\n                    transcript: \"\",\n                    error: \"Invalid YouTube URL format\"\n                };\n            }\n            videoId = extractedId;\n        }\n        // Validate video ID\n        if (!(0,_youtube__WEBPACK_IMPORTED_MODULE_1__.isValidYouTubeId)(videoId)) {\n            return {\n                transcript: \"\",\n                error: \"Invalid YouTube video ID\"\n            };\n        }\n        console.log(`[YouTubeTranscript] Extracting transcript for video: ${videoId}`);\n        // Try to get transcript for each language in preference order\n        let lastError = null;\n        for (const lang of languages){\n            try {\n                console.log(`[YouTubeTranscript] Trying language: ${lang}`);\n                // Use youtube-transcript-api to get transcript\n                const transcriptData = await youtube_transcript_api__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getTranscript(videoId, {\n                    lang: lang,\n                    country: \"US\" // Default country\n                });\n                if (transcriptData && transcriptData.length > 0) {\n                    // Convert to our format\n                    const segments = transcriptData.map((item)=>({\n                            text: item.text || \"\",\n                            start: item.offset || 0,\n                            duration: item.duration || 0\n                        }));\n                    // Combine all text segments\n                    const fullTranscript = segments.map((segment)=>segment.text.trim()).filter((text)=>text.length > 0).join(\" \").replace(/\\s+/g, \" \").trim();\n                    if (fullTranscript.length > 0) {\n                        console.log(`[YouTubeTranscript] Successfully extracted transcript in ${lang} (${fullTranscript.length} characters)`);\n                        return {\n                            transcript: fullTranscript,\n                            segments,\n                            language: lang\n                        };\n                    }\n                }\n            } catch (langError) {\n                console.warn(`[YouTubeTranscript] Failed to get transcript in ${lang}:`, langError.message);\n                lastError = langError;\n                continue;\n            }\n        }\n        // If no transcript found in any language, try without language specification\n        try {\n            console.log(\"[YouTubeTranscript] Trying to get transcript without language specification...\");\n            const transcriptData = await youtube_transcript_api__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getTranscript(videoId);\n            if (transcriptData && transcriptData.length > 0) {\n                const segments = transcriptData.map((item)=>({\n                        text: item.text || \"\",\n                        start: item.offset || 0,\n                        duration: item.duration || 0\n                    }));\n                const fullTranscript = segments.map((segment)=>segment.text.trim()).filter((text)=>text.length > 0).join(\" \").replace(/\\s+/g, \" \").trim();\n                if (fullTranscript.length > 0) {\n                    console.log(`[YouTubeTranscript] Successfully extracted transcript without language spec (${fullTranscript.length} characters)`);\n                    return {\n                        transcript: fullTranscript,\n                        segments,\n                        language: \"auto\"\n                    };\n                }\n            }\n        } catch (autoError) {\n            console.warn(\"[YouTubeTranscript] Failed to get transcript without language spec:\", autoError.message);\n            lastError = autoError;\n        }\n        // Return appropriate error message\n        return {\n            transcript: \"\",\n            error: getErrorMessage(lastError)\n        };\n    } catch (error) {\n        console.error(\"[YouTubeTranscript] Unexpected error:\", error);\n        return {\n            transcript: \"\",\n            error: `Transcript extraction failed: ${error.message}`\n        };\n    }\n}\n/**\n * Get transcript as plain text only (simplified interface)\n */ async function getYouTubeTranscriptText(videoIdOrUrl, languages) {\n    const result = await extractYouTubeTranscript(videoIdOrUrl, languages);\n    return result.transcript;\n}\n/**\n * Check if transcript is available for a video without downloading it\n */ async function isTranscriptAvailable(videoIdOrUrl) {\n    try {\n        let videoId = videoIdOrUrl;\n        if (videoIdOrUrl.includes(\"youtube.com\") || videoIdOrUrl.includes(\"youtu.be\")) {\n            const extractedId = (0,_youtube__WEBPACK_IMPORTED_MODULE_1__.extractYouTubeId)(videoIdOrUrl);\n            if (!extractedId) return false;\n            videoId = extractedId;\n        }\n        if (!(0,_youtube__WEBPACK_IMPORTED_MODULE_1__.isValidYouTubeId)(videoId)) return false;\n        // Try to get just a small portion to check availability\n        const transcriptData = await youtube_transcript_api__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getTranscript(videoId);\n        return transcriptData && transcriptData.length > 0;\n    } catch (error) {\n        return false;\n    }\n}\n/**\n * Convert error to user-friendly message\n */ function getErrorMessage(error) {\n    if (!error) return \"No transcript available for this video\";\n    const message = error.message?.toLowerCase() || \"\";\n    if (message.includes(\"transcript not available\")) {\n        return \"No transcript available for this video\";\n    }\n    if (message.includes(\"video unavailable\")) {\n        return \"Video is unavailable or private\";\n    }\n    if (message.includes(\"disabled\")) {\n        return \"Subtitles have been disabled for this video\";\n    }\n    if (message.includes(\"not found\")) {\n        return \"Video not found\";\n    }\n    if (message.includes(\"private\")) {\n        return \"Video is private\";\n    }\n    if (message.includes(\"region\")) {\n        return \"Video not available in this region\";\n    }\n    return \"No transcript available for this video\";\n}\n/**\n * Fallback transcript extraction using ytdl-core (if youtube-transcript-api fails)\n */ async function extractTranscriptFallback(videoId) {\n    try {\n        console.log(`[YouTubeTranscript] Attempting fallback extraction for ${videoId}`);\n        // Import ytdl-core dynamically to avoid SSR issues\n        const ytdl = await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/sax\"), __webpack_require__.e(\"vendor-chunks/ytdl-core\"), __webpack_require__.e(\"vendor-chunks/m3u8stream\"), __webpack_require__.e(\"vendor-chunks/miniget\")]).then(__webpack_require__.t.bind(__webpack_require__, /*! ytdl-core */ \"(rsc)/./node_modules/ytdl-core/lib/index.js\", 23));\n        const videoInfo = await ytdl.default.getInfo(`https://www.youtube.com/watch?v=${videoId}`);\n        // Look for captions in video info\n        const captionTracks = videoInfo.player_response?.captions?.playerCaptionsTracklistRenderer?.captionTracks;\n        if (!captionTracks || captionTracks.length === 0) {\n            return {\n                transcript: \"\",\n                error: \"No captions available\"\n            };\n        }\n        // Try to fetch caption data from the first available track\n        const captionTrack = captionTracks[0];\n        if (captionTrack.baseUrl) {\n            const response = await fetch(captionTrack.baseUrl);\n            const captionXml = await response.text();\n            // Parse XML captions\n            const transcript = parseYouTubeCaptionXml(captionXml);\n            if (transcript && transcript.length > 0) {\n                console.log(`[YouTubeTranscript] Fallback extraction successful (${transcript.length} characters)`);\n                return {\n                    transcript,\n                    language: String(captionTrack.languageCode || \"unknown\")\n                };\n            }\n        }\n        return {\n            transcript: \"\",\n            error: \"Could not extract captions from video\"\n        };\n    } catch (error) {\n        console.error(\"[YouTubeTranscript] Fallback extraction failed:\", error);\n        return {\n            transcript: \"\",\n            error: `Fallback extraction failed: ${error.message}`\n        };\n    }\n}\n/**\n * Parse YouTube caption XML to plain text\n */ function parseYouTubeCaptionXml(xml) {\n    try {\n        // Simple regex-based XML parsing for captions\n        const textMatches = xml.match(/<text[^>]*>(.*?)<\\/text>/g);\n        if (!textMatches) return \"\";\n        const texts = textMatches.map((match)=>{\n            // Extract text content and decode HTML entities\n            const textContent = match.replace(/<text[^>]*>/, \"\").replace(/<\\/text>/, \"\");\n            return textContent.replace(/&amp;/g, \"&\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\").replace(/&nbsp;/g, \" \").trim();\n        });\n        return texts.filter((text)=>text.length > 0).join(\" \").replace(/\\s+/g, \" \").trim();\n    } catch (error) {\n        console.error(\"[YouTubeTranscript] Error parsing caption XML:\", error);\n        return \"\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMveW91dHViZS10cmFuc2NyaXB0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7Q0FHQyxHQUVrRDtBQUNZO0FBZS9EOzs7Q0FHQyxHQUNNLGVBQWVHLHlCQUNwQkMsWUFBb0IsRUFDcEJDLFlBQXNCO0lBQUM7SUFBTTtJQUFNO0lBQU07SUFBTTtDQUFLO0lBRXBELElBQUk7UUFDRixzQ0FBc0M7UUFDdEMsSUFBSUMsVUFBVUY7UUFDZCxJQUFJQSxhQUFhRyxRQUFRLENBQUMsa0JBQWtCSCxhQUFhRyxRQUFRLENBQUMsYUFBYTtZQUM3RSxNQUFNQyxjQUFjTiwwREFBZ0JBLENBQUNFO1lBQ3JDLElBQUksQ0FBQ0ksYUFBYTtnQkFDaEIsT0FBTztvQkFDTEMsWUFBWTtvQkFDWkMsT0FBTztnQkFDVDtZQUNGO1lBQ0FKLFVBQVVFO1FBQ1o7UUFFQSxvQkFBb0I7UUFDcEIsSUFBSSxDQUFDUCwwREFBZ0JBLENBQUNLLFVBQVU7WUFDOUIsT0FBTztnQkFDTEcsWUFBWTtnQkFDWkMsT0FBTztZQUNUO1FBQ0Y7UUFFQUMsUUFBUUMsR0FBRyxDQUFDLENBQUMscURBQXFELEVBQUVOLFFBQVEsQ0FBQztRQUU3RSw4REFBOEQ7UUFDOUQsSUFBSU8sWUFBWTtRQUVoQixLQUFLLE1BQU1DLFFBQVFULFVBQVc7WUFDNUIsSUFBSTtnQkFDRk0sUUFBUUMsR0FBRyxDQUFDLENBQUMscUNBQXFDLEVBQUVFLEtBQUssQ0FBQztnQkFFMUQsK0NBQStDO2dCQUMvQyxNQUFNQyxpQkFBaUIsTUFBTWYsOERBQWFBLENBQUNnQixhQUFhLENBQUNWLFNBQVM7b0JBQ2hFUSxNQUFNQTtvQkFDTkcsU0FBUyxLQUFLLGtCQUFrQjtnQkFDbEM7Z0JBRUEsSUFBSUYsa0JBQWtCQSxlQUFlRyxNQUFNLEdBQUcsR0FBRztvQkFDL0Msd0JBQXdCO29CQUN4QixNQUFNQyxXQUFnQ0osZUFBZUssR0FBRyxDQUFDLENBQUNDLE9BQWU7NEJBQ3ZFQyxNQUFNRCxL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VUFBVSxLQUNsQkEsT0FBTyxDQUFDLFNBQVMsS0FDakJBLE9BQU8sQ0FBQyxTQUFTLEtBQ2pCQSxPQUFPLENBQUMsV0FBVyxLQUNuQkEsT0FBTyxDQUFDLFVBQVUsS0FDbEJBLE9BQU8sQ0FBQyxXQUFXLEtBQ25CSCxJQUFJO1FBQ1Q7UUFFQSxPQUFPa0MsTUFDSmpDLE1BQU0sQ0FBQ1AsQ0FBQUEsT0FBUUEsS0FBS0osTUFBTSxHQUFHLEdBQzdCWSxJQUFJLENBQUMsS0FDTEMsT0FBTyxDQUFDLFFBQVEsS0FDaEJILElBQUk7SUFFVCxFQUFFLE9BQU9sQixPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxrREFBa0RBO1FBQ2hFLE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1c2NyaWJlLy4vc3JjL3NlcnZpY2VzL3lvdXR1YmUtdHJhbnNjcmlwdC50cz8wMWY4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUHJvZHVjdGlvbi1zYWZlIFlvdVR1YmUgdHJhbnNjcmlwdCBleHRyYWN0aW9uIHNlcnZpY2VcbiAqIFVzZXMgeW91dHViZS10cmFuc2NyaXB0LWFwaSBpbnN0ZWFkIG9mIHNoZWxsIGNvbW1hbmRzIGZvciBob3N0ZWQgZW52aXJvbm1lbnRzXG4gKi9cblxuaW1wb3J0IFRyYW5zY3JpcHRBUEkgZnJvbSAneW91dHViZS10cmFuc2NyaXB0LWFwaSc7XG5pbXBvcnQgeyBpc1ZhbGlkWW91VHViZUlkLCBleHRyYWN0WW91VHViZUlkIH0gZnJvbSAnLi95b3V0dWJlJztcblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0U2VnbWVudCB7XG4gIHRleHQ6IHN0cmluZztcbiAgc3RhcnQ6IG51bWJlcjtcbiAgZHVyYXRpb246IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0UmVzdWx0IHtcbiAgdHJhbnNjcmlwdDogc3RyaW5nO1xuICBzZWdtZW50cz86IFRyYW5zY3JpcHRTZWdtZW50W107XG4gIGVycm9yPzogc3RyaW5nO1xuICBsYW5ndWFnZT86IHN0cmluZztcbn1cblxuLyoqXG4gKiBFeHRyYWN0IHRyYW5zY3JpcHQgZnJvbSBZb3VUdWJlIHZpZGVvIHVzaW5nIHlvdXR1YmUtdHJhbnNjcmlwdC1hcGlcbiAqIFRoaXMgd29ya3MgaW4gcHJvZHVjdGlvbiBlbnZpcm9ubWVudHMgd2l0aG91dCByZXF1aXJpbmcgc3lzdGVtIGJpbmFyaWVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHRyYWN0WW91VHViZVRyYW5zY3JpcHQoXG4gIHZpZGVvSWRPclVybDogc3RyaW5nLFxuICBsYW5ndWFnZXM6IHN0cmluZ1tdID0gWydlbicsICdwbCcsICdlcycsICdmcicsICdkZSddXG4pOiBQcm9taXNlPFRyYW5zY3JpcHRSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICAvLyBFeHRyYWN0IHZpZGVvIElEIGlmIFVSTCBpcyBwcm92aWRlZFxuICAgIGxldCB2aWRlb0lkID0gdmlkZW9JZE9yVXJsO1xuICAgIGlmICh2aWRlb0lkT3JVcmwuaW5jbHVkZXMoJ3lvdXR1YmUuY29tJykgfHwgdmlkZW9JZE9yVXJsLmluY2x1ZGVzKCd5b3V0dS5iZScpKSB7XG4gICAgICBjb25zdCBleHRyYWN0ZWRJZCA9IGV4dHJhY3RZb3VUdWJlSWQodmlkZW9JZE9yVXJsKTtcbiAgICAgIGlmICghZXh0cmFjdGVkSWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0cmFuc2NyaXB0OiAnJyxcbiAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgWW91VHViZSBVUkwgZm9ybWF0J1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmlkZW9JZCA9IGV4dHJhY3RlZElkO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHZpZGVvIElEXG4gICAgaWYgKCFpc1ZhbGlkWW91VHViZUlkKHZpZGVvSWQpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0cmFuc2NyaXB0OiAnJyxcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIFlvdVR1YmUgdmlkZW8gSUQnXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBbWW91VHViZVRyYW5zY3JpcHRdIEV4dHJhY3RpbmcgdHJhbnNjcmlwdCBmb3IgdmlkZW86ICR7dmlkZW9JZH1gKTtcblxuICAgIC8vIFRyeSB0byBnZXQgdHJhbnNjcmlwdCBmb3IgZWFjaCBsYW5ndWFnZSBpbiBwcmVmZXJlbmNlIG9yZGVyXG4gICAgbGV0IGxhc3RFcnJvciA9IG51bGw7XG4gICAgXG4gICAgZm9yIChjb25zdCBsYW5nIG9mIGxhbmd1YWdlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coYFtZb3VUdWJlVHJhbnNjcmlwdF0gVHJ5aW5nIGxhbmd1YWdlOiAke2xhbmd9YCk7XG4gICAgICAgIFxuICAgICAgICAvLyBVc2UgeW91dHViZS10cmFuc2NyaXB0LWFwaSB0byBnZXQgdHJhbnNjcmlwdFxuICAgICAgICBjb25zdCB0cmFuc2NyaXB0RGF0YSA9IGF3YWl0IFRyYW5zY3JpcHRBUEkuZ2V0VHJhbnNjcmlwdCh2aWRlb0lkLCB7XG4gICAgICAgICAgbGFuZzogbGFuZyxcbiAgICAgICAgICBjb3VudHJ5OiAnVVMnIC8vIERlZmF1bHQgY291bnRyeVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodHJhbnNjcmlwdERhdGEgJiYgdHJhbnNjcmlwdERhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIENvbnZlcnQgdG8gb3VyIGZvcm1hdFxuICAgICAgICAgIGNvbnN0IHNlZ21lbnRzOiBUcmFuc2NyaXB0U2VnbWVudFtdID0gdHJhbnNjcmlwdERhdGEubWFwKChpdGVtOiBhbnkpID0+ICh7XG4gICAgICAgICAgICB0ZXh0OiBpdGVtLnRleHQgfHwgJycsXG4gICAgICAgICAgICBzdGFydDogaXRlbS5vZmZzZXQgfHwgMCxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBpdGVtLmR1cmF0aW9uIHx8IDBcbiAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAvLyBDb21iaW5lIGFsbCB0ZXh0IHNlZ21lbnRzXG4gICAgICAgICAgY29uc3QgZnVsbFRyYW5zY3JpcHQgPSBzZWdtZW50c1xuICAgICAgICAgICAgLm1hcChzZWdtZW50ID0+IHNlZ21lbnQudGV4dC50cmltKCkpXG4gICAgICAgICAgICAuZmlsdGVyKHRleHQgPT4gdGV4dC5sZW5ndGggPiAwKVxuICAgICAgICAgICAgLmpvaW4oJyAnKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xccysvZywgJyAnKVxuICAgICAgICAgICAgLnRyaW0oKTtcblxuICAgICAgICAgIGlmIChmdWxsVHJhbnNjcmlwdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW1lvdVR1YmVUcmFuc2NyaXB0XSBTdWNjZXNzZnVsbHkgZXh0cmFjdGVkIHRyYW5zY3JpcHQgaW4gJHtsYW5nfSAoJHtmdWxsVHJhbnNjcmlwdC5sZW5ndGh9IGNoYXJhY3RlcnMpYCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0cmFuc2NyaXB0OiBmdWxsVHJhbnNjcmlwdCxcbiAgICAgICAgICAgICAgc2VnbWVudHMsXG4gICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5nXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAobGFuZ0Vycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbWW91VHViZVRyYW5zY3JpcHRdIEZhaWxlZCB0byBnZXQgdHJhbnNjcmlwdCBpbiAke2xhbmd9OmAsIGxhbmdFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgbGFzdEVycm9yID0gbGFuZ0Vycm9yO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJZiBubyB0cmFuc2NyaXB0IGZvdW5kIGluIGFueSBsYW5ndWFnZSwgdHJ5IHdpdGhvdXQgbGFuZ3VhZ2Ugc3BlY2lmaWNhdGlvblxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW1lvdVR1YmVUcmFuc2NyaXB0XSBUcnlpbmcgdG8gZ2V0IHRyYW5zY3JpcHQgd2l0aG91dCBsYW5ndWFnZSBzcGVjaWZpY2F0aW9uLi4uJyk7XG4gICAgICBjb25zdCB0cmFuc2NyaXB0RGF0YSA9IGF3YWl0IFRyYW5zY3JpcHRBUEkuZ2V0VHJhbnNjcmlwdCh2aWRlb0lkKTtcbiAgICAgIFxuICAgICAgaWYgKHRyYW5zY3JpcHREYXRhICYmIHRyYW5zY3JpcHREYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgc2VnbWVudHM6IFRyYW5zY3JpcHRTZWdtZW50W10gPSB0cmFuc2NyaXB0RGF0YS5tYXAoKGl0ZW06IGFueSkgPT4gKHtcbiAgICAgICAgICB0ZXh0OiBpdGVtLnRleHQgfHwgJycsXG4gICAgICAgICAgc3RhcnQ6IGl0ZW0ub2Zmc2V0IHx8IDAsXG4gICAgICAgICAgZHVyYXRpb246IGl0ZW0uZHVyYXRpb24gfHwgMFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgY29uc3QgZnVsbFRyYW5zY3JpcHQgPSBzZWdtZW50c1xuICAgICAgICAgIC5tYXAoc2VnbWVudCA9PiBzZWdtZW50LnRleHQudHJpbSgpKVxuICAgICAgICAgIC5maWx0ZXIodGV4dCA9PiB0ZXh0Lmxlbmd0aCA+IDApXG4gICAgICAgICAgLmpvaW4oJyAnKVxuICAgICAgICAgIC5yZXBsYWNlKC9cXHMrL2csICcgJylcbiAgICAgICAgICAudHJpbSgpO1xuXG4gICAgICAgIGlmIChmdWxsVHJhbnNjcmlwdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtZb3VUdWJlVHJhbnNjcmlwdF0gU3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZCB0cmFuc2NyaXB0IHdpdGhvdXQgbGFuZ3VhZ2Ugc3BlYyAoJHtmdWxsVHJhbnNjcmlwdC5sZW5ndGh9IGNoYXJhY3RlcnMpYCk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRyYW5zY3JpcHQ6IGZ1bGxUcmFuc2NyaXB0LFxuICAgICAgICAgICAgc2VnbWVudHMsXG4gICAgICAgICAgICBsYW5ndWFnZTogJ2F1dG8nXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGF1dG9FcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tZb3VUdWJlVHJhbnNjcmlwdF0gRmFpbGVkIHRvIGdldCB0cmFuc2NyaXB0IHdpdGhvdXQgbGFuZ3VhZ2Ugc3BlYzonLCBhdXRvRXJyb3IubWVzc2FnZSk7XG4gICAgICBsYXN0RXJyb3IgPSBhdXRvRXJyb3I7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yIG1lc3NhZ2VcbiAgICByZXR1cm4ge1xuICAgICAgdHJhbnNjcmlwdDogJycsXG4gICAgICBlcnJvcjogZ2V0RXJyb3JNZXNzYWdlKGxhc3RFcnJvcilcbiAgICB9O1xuXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbWW91VHViZVRyYW5zY3JpcHRdIFVuZXhwZWN0ZWQgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICB0cmFuc2NyaXB0OiAnJyxcbiAgICAgIGVycm9yOiBgVHJhbnNjcmlwdCBleHRyYWN0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWBcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogR2V0IHRyYW5zY3JpcHQgYXMgcGxhaW4gdGV4dCBvbmx5IChzaW1wbGlmaWVkIGludGVyZmFjZSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFlvdVR1YmVUcmFuc2NyaXB0VGV4dChcbiAgdmlkZW9JZE9yVXJsOiBzdHJpbmcsXG4gIGxhbmd1YWdlcz86IHN0cmluZ1tdXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0WW91VHViZVRyYW5zY3JpcHQodmlkZW9JZE9yVXJsLCBsYW5ndWFnZXMpO1xuICByZXR1cm4gcmVzdWx0LnRyYW5zY3JpcHQ7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdHJhbnNjcmlwdCBpcyBhdmFpbGFibGUgZm9yIGEgdmlkZW8gd2l0aG91dCBkb3dubG9hZGluZyBpdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNUcmFuc2NyaXB0QXZhaWxhYmxlKHZpZGVvSWRPclVybDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgbGV0IHZpZGVvSWQgPSB2aWRlb0lkT3JVcmw7XG4gICAgaWYgKHZpZGVvSWRPclVybC5pbmNsdWRlcygneW91dHViZS5jb20nKSB8fCB2aWRlb0lkT3JVcmwuaW5jbHVkZXMoJ3lvdXR1LmJlJykpIHtcbiAgICAgIGNvbnN0IGV4dHJhY3RlZElkID0gZXh0cmFjdFlvdVR1YmVJZCh2aWRlb0lkT3JVcmwpO1xuICAgICAgaWYgKCFleHRyYWN0ZWRJZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgdmlkZW9JZCA9IGV4dHJhY3RlZElkO1xuICAgIH1cblxuICAgIGlmICghaXNWYWxpZFlvdVR1YmVJZCh2aWRlb0lkKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gVHJ5IHRvIGdldCBqdXN0IGEgc21hbGwgcG9ydGlvbiB0byBjaGVjayBhdmFpbGFiaWxpdHlcbiAgICBjb25zdCB0cmFuc2NyaXB0RGF0YSA9IGF3YWl0IFRyYW5zY3JpcHRBUEkuZ2V0VHJhbnNjcmlwdCh2aWRlb0lkKTtcbiAgICByZXR1cm4gdHJhbnNjcmlwdERhdGEgJiYgdHJhbnNjcmlwdERhdGEubGVuZ3RoID4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0IGVycm9yIHRvIHVzZXItZnJpZW5kbHkgbWVzc2FnZVxuICovXG5mdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoZXJyb3I6IGFueSk6IHN0cmluZyB7XG4gIGlmICghZXJyb3IpIHJldHVybiAnTm8gdHJhbnNjcmlwdCBhdmFpbGFibGUgZm9yIHRoaXMgdmlkZW8nO1xuICBcbiAgY29uc3QgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XG4gIFxuICBpZiAobWVzc2FnZS5pbmNsdWRlcygndHJhbnNjcmlwdCBub3QgYXZhaWxhYmxlJykpIHtcbiAgICByZXR1cm4gJ05vIHRyYW5zY3JpcHQgYXZhaWxhYmxlIGZvciB0aGlzIHZpZGVvJztcbiAgfVxuICBcbiAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ3ZpZGVvIHVuYXZhaWxhYmxlJykpIHtcbiAgICByZXR1cm4gJ1ZpZGVvIGlzIHVuYXZhaWxhYmxlIG9yIHByaXZhdGUnO1xuICB9XG4gIFxuICBpZiAobWVzc2FnZS5pbmNsdWRlcygnZGlzYWJsZWQnKSkge1xuICAgIHJldHVybiAnU3VidGl0bGVzIGhhdmUgYmVlbiBkaXNhYmxlZCBmb3IgdGhpcyB2aWRlbyc7XG4gIH1cbiAgXG4gIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xuICAgIHJldHVybiAnVmlkZW8gbm90IGZvdW5kJztcbiAgfVxuICBcbiAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ3ByaXZhdGUnKSkge1xuICAgIHJldHVybiAnVmlkZW8gaXMgcHJpdmF0ZSc7XG4gIH1cbiAgXG4gIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdyZWdpb24nKSkge1xuICAgIHJldHVybiAnVmlkZW8gbm90IGF2YWlsYWJsZSBpbiB0aGlzIHJlZ2lvbic7XG4gIH1cbiAgXG4gIHJldHVybiAnTm8gdHJhbnNjcmlwdCBhdmFpbGFibGUgZm9yIHRoaXMgdmlkZW8nO1xufVxuXG4vKipcbiAqIEZhbGxiYWNrIHRyYW5zY3JpcHQgZXh0cmFjdGlvbiB1c2luZyB5dGRsLWNvcmUgKGlmIHlvdXR1YmUtdHJhbnNjcmlwdC1hcGkgZmFpbHMpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHRyYWN0VHJhbnNjcmlwdEZhbGxiYWNrKHZpZGVvSWQ6IHN0cmluZyk6IFByb21pc2U8VHJhbnNjcmlwdFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbWW91VHViZVRyYW5zY3JpcHRdIEF0dGVtcHRpbmcgZmFsbGJhY2sgZXh0cmFjdGlvbiBmb3IgJHt2aWRlb0lkfWApO1xuICAgIFxuICAgIC8vIEltcG9ydCB5dGRsLWNvcmUgZHluYW1pY2FsbHkgdG8gYXZvaWQgU1NSIGlzc3Vlc1xuICAgIGNvbnN0IHl0ZGwgPSBhd2FpdCBpbXBvcnQoJ3l0ZGwtY29yZScpO1xuICAgIFxuICAgIGNvbnN0IHZpZGVvSW5mbyA9IGF3YWl0IHl0ZGwuZGVmYXVsdC5nZXRJbmZvKGBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PSR7dmlkZW9JZH1gKTtcbiAgICBcbiAgICAvLyBMb29rIGZvciBjYXB0aW9ucyBpbiB2aWRlbyBpbmZvXG4gICAgY29uc3QgY2FwdGlvblRyYWNrcyA9IHZpZGVvSW5mby5wbGF5ZXJfcmVzcG9uc2U/LmNhcHRpb25zPy5wbGF5ZXJDYXB0aW9uc1RyYWNrbGlzdFJlbmRlcmVyPy5jYXB0aW9uVHJhY2tzO1xuICAgIFxuICAgIGlmICghY2FwdGlvblRyYWNrcyB8fCBjYXB0aW9uVHJhY2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHJhbnNjcmlwdDogJycsXG4gICAgICAgIGVycm9yOiAnTm8gY2FwdGlvbnMgYXZhaWxhYmxlJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJ5IHRvIGZldGNoIGNhcHRpb24gZGF0YSBmcm9tIHRoZSBmaXJzdCBhdmFpbGFibGUgdHJhY2tcbiAgICBjb25zdCBjYXB0aW9uVHJhY2sgPSBjYXB0aW9uVHJhY2tzWzBdO1xuICAgIGlmIChjYXB0aW9uVHJhY2suYmFzZVVybCkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChjYXB0aW9uVHJhY2suYmFzZVVybCk7XG4gICAgICBjb25zdCBjYXB0aW9uWG1sID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgXG4gICAgICAvLyBQYXJzZSBYTUwgY2FwdGlvbnNcbiAgICAgIGNvbnN0IHRyYW5zY3JpcHQgPSBwYXJzZVlvdVR1YmVDYXB0aW9uWG1sKGNhcHRpb25YbWwpO1xuICAgICAgXG4gICAgICBpZiAodHJhbnNjcmlwdCAmJiB0cmFuc2NyaXB0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYFtZb3VUdWJlVHJhbnNjcmlwdF0gRmFsbGJhY2sgZXh0cmFjdGlvbiBzdWNjZXNzZnVsICgke3RyYW5zY3JpcHQubGVuZ3RofSBjaGFyYWN0ZXJzKWApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRyYW5zY3JpcHQsXG4gICAgICAgICAgbGFuZ3VhZ2U6IFN0cmluZyhjYXB0aW9uVHJhY2subGFuZ3VhZ2VDb2RlIHx8ICd1bmtub3duJylcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRyYW5zY3JpcHQ6ICcnLFxuICAgICAgZXJyb3I6ICdDb3VsZCBub3QgZXh0cmFjdCBjYXB0aW9ucyBmcm9tIHZpZGVvJ1xuICAgIH07XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbWW91VHViZVRyYW5zY3JpcHRdIEZhbGxiYWNrIGV4dHJhY3Rpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHJhbnNjcmlwdDogJycsXG4gICAgICBlcnJvcjogYEZhbGxiYWNrIGV4dHJhY3Rpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBQYXJzZSBZb3VUdWJlIGNhcHRpb24gWE1MIHRvIHBsYWluIHRleHRcbiAqL1xuZnVuY3Rpb24gcGFyc2VZb3VUdWJlQ2FwdGlvblhtbCh4bWw6IHN0cmluZyk6IHN0cmluZyB7XG4gIHRyeSB7XG4gICAgLy8gU2ltcGxlIHJlZ2V4LWJhc2VkIFhNTCBwYXJzaW5nIGZvciBjYXB0aW9uc1xuICAgIGNvbnN0IHRleHRNYXRjaGVzID0geG1sLm1hdGNoKC88dGV4dFtePl0qPiguKj8pPFxcL3RleHQ+L2cpO1xuICAgIFxuICAgIGlmICghdGV4dE1hdGNoZXMpIHJldHVybiAnJztcbiAgICBcbiAgICBjb25zdCB0ZXh0cyA9IHRleHRNYXRjaGVzLm1hcChtYXRjaCA9PiB7XG4gICAgICAvLyBFeHRyYWN0IHRleHQgY29udGVudCBhbmQgZGVjb2RlIEhUTUwgZW50aXRpZXNcbiAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gbWF0Y2gucmVwbGFjZSgvPHRleHRbXj5dKj4vLCAnJykucmVwbGFjZSgvPFxcL3RleHQ+LywgJycpO1xuICAgICAgcmV0dXJuIHRleHRDb250ZW50XG4gICAgICAgIC5yZXBsYWNlKC8mYW1wOy9nLCAnJicpXG4gICAgICAgIC5yZXBsYWNlKC8mbHQ7L2csICc8JylcbiAgICAgICAgLnJlcGxhY2UoLyZndDsvZywgJz4nKVxuICAgICAgICAucmVwbGFjZSgvJnF1b3Q7L2csICdcIicpXG4gICAgICAgIC5yZXBsYWNlKC8mIzM5Oy9nLCBcIidcIilcbiAgICAgICAgLnJlcGxhY2UoLyZuYnNwOy9nLCAnICcpXG4gICAgICAgIC50cmltKCk7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHRleHRzXG4gICAgICAuZmlsdGVyKHRleHQgPT4gdGV4dC5sZW5ndGggPiAwKVxuICAgICAgLmpvaW4oJyAnKVxuICAgICAgLnJlcGxhY2UoL1xccysvZywgJyAnKVxuICAgICAgLnRyaW0oKTtcbiAgICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tZb3VUdWJlVHJhbnNjcmlwdF0gRXJyb3IgcGFyc2luZyBjYXB0aW9uIFhNTDonLCBlcnJvcik7XG4gICAgcmV0dXJuICcnO1xuICB9XG59ICJdLCJuYW1lcyI6WyJUcmFuc2NyaXB0QVBJIiwiaXNWYWxpZFlvdVR1YmVJZCIsImV4dHJhY3RZb3VUdWJlSWQiLCJleHRyYWN0WW91VHViZVRyYW5zY3JpcHQiLCJ2aWRlb0lkT3JVcmwiLCJsYW5ndWFnZXMiLCJ2aWRlb0lkIiwiaW5jbHVkZXMiLCJleHRyYWN0ZWRJZCIsInRyYW5zY3JpcHQiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJsYXN0RXJyb3IiLCJsYW5nIiwidHJhbnNjcmlwdERhdGEiLCJnZXRUcmFuc2NyaXB0IiwiY291bnRyeSIsImxlbmd0aCIsInNlZ21lbnRzIiwibWFwIiwiaXRlbSIsInRleHQiLCJzdGFydCIsIm9mZnNldCIsImR1cmF0aW9uIiwiZnVsbFRyYW5zY3JpcHQiLCJzZWdtZW50IiwidHJpbSIsImZpbHRlciIsImpvaW4iLCJyZXBsYWNlIiwibGFuZ3VhZ2UiLCJsYW5nRXJyb3IiLCJ3YXJuIiwibWVzc2FnZSIsImF1dG9FcnJvciIsImdldEVycm9yTWVzc2FnZSIsImdldFlvdVR1YmVUcmFuc2NyaXB0VGV4dCIsInJlc3VsdCIsImlzVHJhbnNjcmlwdEF2YWlsYWJsZSIsInRvTG93ZXJDYXNlIiwiZXh0cmFjdFRyYW5zY3JpcHRGYWxsYmFjayIsInl0ZGwiLCJ2aWRlb0luZm8iLCJkZWZhdWx0IiwiZ2V0SW5mbyIsImNhcHRpb25UcmFja3MiLCJwbGF5ZXJfcmVzcG9uc2UiLCJjYXB0aW9ucyIsInBsYXllckNhcHRpb25zVHJhY2tsaXN0UmVuZGVyZXIiLCJjYXB0aW9uVHJhY2siLCJiYXNlVXJsIiwicmVzcG9uc2UiLCJmZXRjaCIsImNhcHRpb25YbWwiLCJwYXJzZVlvdVR1YmVDYXB0aW9uWG1sIiwiU3RyaW5nIiwibGFuZ3VhZ2VDb2RlIiwieG1sIiwidGV4dE1hdGNoZXMiLCJtYXRjaCIsInRleHRzIiwidGV4dENvbnRlbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/services/youtube-transcript.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/youtube.ts":
/*!*********************************!*\
  !*** ./src/services/youtube.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractYouTubeId: () => (/* binding */ extractYouTubeId),\n/* harmony export */   getVideoInfo: () => (/* binding */ getVideoInfo),\n/* harmony export */   getVideoTranscript: () => (/* binding */ getVideoTranscript),\n/* harmony export */   isLikelyUrl: () => (/* reexport safe */ _youtube_validators__WEBPACK_IMPORTED_MODULE_0__.isLikelyUrl),\n/* harmony export */   isValidYouTubeId: () => (/* binding */ isValidYouTubeId),\n/* harmony export */   safeParseUrl: () => (/* binding */ safeParseUrl)\n/* harmony export */ });\n/* harmony import */ var _youtube_validators__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./youtube/validators */ \"(rsc)/./src/services/youtube/validators.ts\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _youtube_transcript__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./youtube-transcript */ \"(rsc)/./src/services/youtube-transcript.ts\");\n\n\n\n\n// Re-export the validators for backward compatibility\n\n// Promisify exec for async/await usage\nconst execAsync = (0,util__WEBPACK_IMPORTED_MODULE_2__.promisify)(child_process__WEBPACK_IMPORTED_MODULE_1__.exec);\n/**\n * Safely attempts to parse a URL string\n * @param urlString The URL string to parse\n * @returns URL object if successful, null if not\n */ function safeParseUrl(urlString) {\n    try {\n        // Add protocol if missing\n        let normalizedUrl = urlString.trim();\n        if (normalizedUrl.startsWith(\"//\")) {\n            normalizedUrl = `https:${normalizedUrl}`;\n        } else if (!normalizedUrl.startsWith(\"http://\") && !normalizedUrl.startsWith(\"https://\")) {\n            normalizedUrl = `https://${normalizedUrl}`;\n        }\n        return new URL(normalizedUrl);\n    } catch (error) {\n        console.warn(\"[YouTube] Failed to parse URL:\", error);\n        return null;\n    }\n}\n/**\n * Extracts a YouTube video ID from a URL\n * Supports various YouTube URL formats\n */ function extractYouTubeId(url) {\n    if (!url) return null;\n    // Clean the URL by trimming and handling mobile URLs\n    let cleanUrl = url.trim();\n    // Convert mobile youtube URLs to standard format\n    if (cleanUrl.includes(\"youtu.be/\")) {\n        cleanUrl = cleanUrl.replace(\"youtu.be/\", \"youtube.com/watch?v=\");\n    }\n    try {\n        // Try to parse as URL and extract from searchParams (standard youtube.com/watch?v=ID format)\n        const urlObj = new URL(cleanUrl);\n        // Handle youtube.com/watch?v=ID format\n        if (urlObj.hostname.includes(\"youtube.com\") && urlObj.pathname.includes(\"/watch\")) {\n            const videoId = urlObj.searchParams.get(\"v\");\n            if (videoId) return videoId;\n        }\n        // Handle youtube.com/embed/ID format\n        if (urlObj.hostname.includes(\"youtube\") && urlObj.pathname.includes(\"/embed/\")) {\n            const parts = urlObj.pathname.split(\"/\");\n            return parts[parts.indexOf(\"embed\") + 1] || null;\n        }\n        // Handle youtu.be/ID format (already converted to standard format above, but just in case)\n        if (urlObj.hostname === \"youtu.be\") {\n            return urlObj.pathname.substring(1) || null;\n        }\n        // Handle youtube.com/v/ID format\n        if (urlObj.hostname.includes(\"youtube\") && urlObj.pathname.includes(\"/v/\")) {\n            const parts = urlObj.pathname.split(\"/\");\n            return parts[parts.indexOf(\"v\") + 1] || null;\n        }\n    } catch (e) {\n        // If URL parsing fails, try regex-based extraction\n        console.error(\"URL parsing failed, trying regex fallback:\", e);\n    }\n    // Fallback to regex for cases where URL parsing fails\n    const patterns = [\n        /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/|youtube\\.com\\/v\\/)([^&\\n?#]+)/,\n        /^([a-zA-Z0-9_-]{11})$/ // Direct video ID (11 characters)\n    ];\n    for (const pattern of patterns){\n        const match = cleanUrl.match(pattern);\n        if (match && match[1]) {\n            return match[1];\n        }\n    }\n    return null;\n}\n/**\n * Validates if a string is a valid YouTube video ID\n */ function isValidYouTubeId(id) {\n    if (!id) return false;\n    // YouTube IDs are typically 11 characters and contain only certain characters\n    const validPattern = /^[a-zA-Z0-9_-]{11}$/;\n    return validPattern.test(id);\n}\n/**\n * Gets information about a YouTube video\n */ async function getVideoInfo(videoId) {\n    if (!videoId) {\n        return {\n            videoId: \"\",\n            title: \"\",\n            thumbnailUrl: \"\",\n            error: \"No video ID provided\"\n        };\n    }\n    try {\n        // Use YouTube API to get video info\n        const apiKey = \"AIzaSyCvUahUwoVQyozpRphtVWE0ev0ha46wo0I\";\n        if (!apiKey) {\n            console.error(\"[YouTube Service] No YouTube API key configured\");\n            return {\n                videoId,\n                title: `YouTube Video (${videoId})`,\n                thumbnailUrl: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,\n                error: \"YouTube API key not configured - using fallback data\"\n            };\n        }\n        const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`, {\n            next: {\n                revalidate: 3600\n            }\n        } // Cache for 1 hour\n        );\n        if (!response.ok) {\n            const errorData = await response.json();\n            console.error(\"[YouTube Service] YouTube API error:\", errorData);\n            // Fall back to basic info using video ID\n            return {\n                videoId,\n                title: `YouTube Video (${videoId})`,\n                thumbnailUrl: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,\n                error: `YouTube API error: ${errorData.error?.message || response.statusText}`\n            };\n        }\n        const data = await response.json();\n        if (!data.items || data.items.length === 0) {\n            console.error(\"[YouTube Service] Video not found:\", videoId);\n            return {\n                videoId,\n                title: `Video Not Found (${videoId})`,\n                thumbnailUrl: \"\",\n                error: \"Video not found\"\n            };\n        }\n        const videoDetails = data.items[0].snippet;\n        return {\n            videoId,\n            title: videoDetails.title,\n            description: videoDetails.description,\n            thumbnailUrl: videoDetails.thumbnails?.high?.url || videoDetails.thumbnails?.default?.url || \"\",\n            channelTitle: videoDetails.channelTitle,\n            publishedAt: videoDetails.publishedAt\n        };\n    } catch (error) {\n        console.error(\"[YouTube Service] Error fetching video info:\", error);\n        // Fall back to basic info using video ID\n        return {\n            videoId,\n            title: `YouTube Video (${videoId})`,\n            thumbnailUrl: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,\n            error: `Error fetching video info: ${error.message}`\n        };\n    }\n}\n/**\n * Gets the transcript for a YouTube video\n * Uses the new production-safe transcript extraction service\n */ async function getVideoTranscript(videoId) {\n    if (!videoId) {\n        return {\n            transcript: \"\",\n            error: \"No video ID provided\"\n        };\n    }\n    try {\n        console.log(`[YouTube Service] Extracting transcript for video: ${videoId}`);\n        // Use the new production-safe transcript extraction\n        const result = await (0,_youtube_transcript__WEBPACK_IMPORTED_MODULE_3__.extractYouTubeTranscript)(videoId);\n        if (result.error) {\n            console.warn(`[YouTube Service] Transcript extraction failed: ${result.error}`);\n            return {\n                transcript: \"\",\n                error: result.error\n            };\n        }\n        if (!result.transcript || result.transcript.trim().length === 0) {\n            return {\n                transcript: \"\",\n                error: \"No transcript content available for this video\"\n            };\n        }\n        console.log(`[YouTube Service] Successfully extracted transcript (${result.transcript.length} characters)`);\n        return {\n            transcript: result.transcript\n        };\n    } catch (error) {\n        console.error(\"[YouTube Service] Error extracting transcript:\", error);\n        return {\n            transcript: \"\",\n            error: `Error extracting transcript: ${error.message}`\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMveW91dHViZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFDbUQ7QUFDZDtBQUVKO0FBR3dFO0FBRXpHLHNEQUFzRDtBQUMvQjtBQUV2Qix1Q0FBdUM7QUFDdkMsTUFBTUksWUFBWUYsK0NBQVNBLENBQUNELCtDQUFJQTtBQXVCaEM7Ozs7Q0FJQyxHQUNNLFNBQVNJLGFBQWFDLFNBQWlCO0lBQzVDLElBQUk7UUFDRiwwQkFBMEI7UUFDMUIsSUFBSUMsZ0JBQWdCRCxVQUFVRSxJQUFJO1FBQ2xDLElBQUlELGNBQWNFLFVBQVUsQ0FBQyxPQUFPO1lBQ2xDRixnQkFBZ0IsQ0FBQyxNQUFNLEVBQUVBLGNBQWMsQ0FBQztRQUMxQyxPQUFPLElBQUksQ0FBQ0EsY0FBY0UsVUFBVSxDQUFDLGNBQWMsQ0FBQ0YsY0FBY0UsVUFBVSxDQUFDLGFBQWE7WUFDeEZGLGdCQUFnQixDQUFDLFFBQVEsRUFBRUEsY0FBYyxDQUFDO1FBQzVDO1FBRUEsT0FBTyxJQUFJRyxJQUFJSDtJQUNqQixFQUFFLE9BQU9JLE9BQU87UUFDZEMsUUFBUUMsSUFBSSxDQUFDLGtDQUFrQ0Y7UUFDL0MsT0FBTztJQUNUO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxTQUFTRyxpQkFBaUJDLEdBQVc7SUFDMUMsSUFBSSxDQUFDQSxLQUFLLE9BQU87SUFFakIscURBQXFEO0lBQ3JELElBQUlDLFdBQVdELElBQUlQLElBQUk7SUFFdkIsaURBQWlEO0lBQ2pELElBQUlRLFNBQVNDLFFBQVEsQ0FBQyxjQUFjO1FBQ2xDRCxXQUFXQSxTQUFTRSxPQUFPLENBQUMsYUFBYTtJQUMzQztJQUVBLElBQUk7UUFDRiw2RkFBNkY7UUFDN0YsTUFBTUMsU0FBUyxJQUFJVCxJQUFJTTtRQUV2Qix1Q0FBdUM7UUFDdkMsSUFBSUcsT0FBT0MsUUFBUSxDQUFDSCxRQUFRLENBQUMsa0JBQWtCRSxPQUFPRSxRQUFRLENBQUNKLFFBQVEsQ0FBQyxXQUFXO1lBQ2pGLE1BQU1LLFVBQVVILE9BQU9JLFlBQVksQ0FBQ0MsR0FBRyxDQUFDO1lBQ3hDLElBQUlGLFNBQVMsT0FBT0E7UUFDdEI7UUFFQSxxQ0FBcUM7UUFDckMsSUFBSUgsT0FBT0MsUUFBUSxDQUFDSCxRQUFRLENBQUMsY0FBY0UsT0FBT0UsUUFBUSxDQUFDSixRQUFRLENBQUMsWUFBWTtZQUM5RSxNQUFNUSxRQUFRTixPQUFPRSxRQUFRLENBQUNLLEtBQUssQ0FBQztZQUNwQyxPQUFPRCxLQUFLLENBQUNBLE1BQU1FLE9BQU8sQ0FBQyxXQUFXLEVBQUUsSUFBSTtRQUM5QztRQUVBLDJGQUEyRjtRQUMzRixJQUFJUixPQUFPQyxRQUFRLEtBQUssWUFBWTtZQUNsQyxPQUFPRCxPQUFPRSxRQUFRLENBQUNPLFNBQVMsQ0FBQyxNQUFNO1FBQ3pDO1FBRUEsaUNBQWlDO1FBQ2pDLElBQUlULE9BQU9DLFFBQVEsQ0FBQ0gsUUFBUSxDQUFDLGNBQWNFLE9BQU9FLFFBQVEsQ0FBQ0osUUFBUSxDQUFDLFFBQVE7WUFDMUUsTUFBTVEsUUFBUU4sT0FBT0UsUUFBUSxDQUFDSyxLQUFLLENBQUM7WUFDcEMsT0FBT0QsS0FBSyxDQUFDQSxNQUFNRSxPQUFPLENBQUMsT0FBTyxFQUFFLElBQUk7UUFDMUM7SUFDRixFQUFFLE9BQU9FLEdBQUc7UUFDVixtREFBbUQ7UUFDbkRqQixRQUFRRCxLQUFLLENBQUMsOENBQThDa0I7SUFDOUQ7SUFFQSxzREFBc0Q7SUFDdEQsTUFBTUMsV0FBVztRQUNmO1FBQ0Esd0JBQXlCLGtDQUFrQztLQUM1RDtJQUVELEtBQUssTUFBTUMsV0FBV0QsU0FBVTtRQUM5QixNQUFNRSxRQUFRaEIsU0FBU2dCLEtBQUssQ0FBQ0Q7UUFDN0IsSUFBSUMsU0FBU0EsS0FBSyxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPQSxLQUFLLENBQUMsRUFBRTtRQUNqQjtJQUNGO0lBRUEsT0FBTztBQUNUO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxpQkFBaUJDLEVBQVU7SUFDekMsSUFBSSxDQUFDQSxJQUFJLE9BQU87SUFFaEIsOEVBQThFO0lBQzlFLE1BQU1DLGVBQWU7SUFDckIsT0FBT0EsYUFBYUMsSUFBSSxDQUFDRjtBQUMzQjtBQUVBOztDQUVDLEdBQ00sZUFBZUcsYUFBYWYsT0FBZTtJQUNoRCxJQUFJLENBQUNBLFNBQVM7UUFDWixPQUFPO1lBQ0xBLFNBQVM7WUFDVGdCLE9BQU87WUFDUEMsY0FBYztZQUNkNUIsT0FBTztRQUNUO0lBQ0Y7SUFFQSxJQUFJO1FBQ0Ysb0NBQW9DO1FBQ3BDLE1BQU02QixTQUFTQyx5Q0FBdUM7UUFFdEQsSUFBSSxDQUFDRCxRQUFRO1lBQ1g1QixRQUFRRCxLQUFLLENBQUM7WUFDZCxPQUFPO2dCQUNMVztnQkFDQWdCLE9BQU8sQ0FBQyxlQUFlLEVBQUVoQixRQUFRLENBQUMsQ0FBQztnQkFDbkNpQixjQUFjLENBQUMsMkJBQTJCLEVBQUVqQixRQUFRLGNBQWMsQ0FBQztnQkFDbkVYLE9BQU87WUFDVDtRQUNGO1FBRUEsTUFBTWlDLFdBQVcsTUFBTUMsTUFDckIsQ0FBQyw2REFBNkQsRUFBRXZCLFFBQVEsS0FBSyxFQUFFa0IsT0FBTyxDQUFDLEVBQ3ZGO1lBQUVNLE1BQU07Z0JBQUVDLFlBQVk7WUFBSztRQUFFLEVBQUUsbUJBQW1COztRQUdwRCxJQUFJLENBQUNILFNBQVNJLEVBQUUsRUFBRTtZQUNoQixNQUFNQyxZQUFZLE1BQU1MLFNBQVNNLElBQUk7WUFDckN0QyxRQUFRRCxLQUFLLENBQUMsd0NBQXdDc0M7WUFFdEQseUNBQXlDO1lBQ3pDLE9BQU87Z0JBQ0wzQjtnQkFDQWdCLE9BQU8sQ0FBQyxlQUFlLEVBQUVoQixRQUFRLENBQUMsQ0FBQztnQkFDbkNpQixjQUFjLENBQUMsMkJBQTJCLEVBQUVqQixRQUFRLGNBQWMsQ0FBQztnQkFDbkVYLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRXNDLFVBQVV0QyxLQUFLLEVBQUV3QyxXQUFXUCxTQUFTUSxVQUFVLENBQUMsQ0FBQztZQUNoRjtRQUNGO1FBRUEsTUFBTUMsT0FBTyxNQUFNVCxTQUFTTSxJQUFJO1FBRWhDLElBQUksQ0FBQ0csS0FBS0MsS0FBSyxJQUFJRCxLQUFLQyxLQUFLLENBQUNDLE1BQU0sS0FBSyxHQUFHO1lBQzFDM0MsUUFBUUQsS0FBSyxDQUFDLHNDQUFzQ1c7WUFDcEQsT0FBTztnQkFDTEE7Z0JBQ0FnQixPQUFPLENBQUMsaUJBQWlCLEVBQUVoQixRQUFRLENBQUMsQ0FBQztnQkFDckNpQixjQUFjO2dCQUNkNUIsT0FBTztZQUNUO1FBQ0Y7UUFFQSxNQUFNNkMsZUFBZUgsS0FBS0MsS0FBSyxDQUFDLEVBQUUsQ0FBQ0csT0FBTztRQUUxQyxPQUFPO1lBQ0xuQztZQUNBZ0IsT0FBT2tCLGFBQWFsQixLQUFLO1lBQ3pCb0IsYUFBYUYsYUFBYUUsV0FBVztZQUNyQ25CLGNBQWNpQixhQUFhRyxVQUFVLEVBQUVDLE1BQU03QyxPQUFPeUMsYUFBYUcsVUFBVSxFQUFFRSxTQUFTOUMsT0FBTztZQUM3RitDLGNBQWNOLGFBQWFNLFlBQVk7WUFDdkNDLGFBQWFQLGFBQWFPLFdBQVc7UUFDdkM7SUFDRixFQUFFLE9BQU9wRCxPQUFZO1FBQ25CQyxRQUFRRCxLQUFLLENBQUMsZ0RBQWdEQTtRQUU5RCx5Q0FBeUM7UUFDekMsT0FBTztZQUNMVztZQUNBZ0IsT0FBTyxDQUFDLGVBQWUsRUFBRWhCLFFBQVEsQ0FBQyxDQUFDO1lBQ25DaUIsY0FBYyxDQUFDLDJCQUEyQixFQUFFakIsUUFBUSxjQUFjLENBQUM7WUFDbkVYLE9BQU8sQ0FBQywyQkFBMkIsRUFBRUEsTUFBTXdDLE9BQU8sQ0FBQyxDQUFDO1FBQ3REO0lBQ0Y7QUFDRjtBQUVBOzs7Q0FHQyxHQUNNLGVBQWVhLG1CQUFtQjFDLE9BQWU7SUFDdEQsSUFBSSxDQUFDQSxTQUFTO1FBQ1osT0FBTztZQUNMMkMsWUFBWTtZQUNadEQsT0FBTztRQUNUO0lBQ0Y7SUFFQSxJQUFJO1FBQ0ZDLFFBQVFzRCxHQUFHLENBQUMsQ0FBQyxtREFBbUQsRUFBRTVDLFFBQVEsQ0FBQztRQUUzRSxvREFBb0Q7UUFDcEQsTUFBTTZDLFNBQVMsTUFBTWhFLDZFQUF3QkEsQ0FBQ21CO1FBRTlDLElBQUk2QyxPQUFPeEQsS0FBSyxFQUFFO1lBQ2hCQyxRQUFRQyxJQUFJLENBQUMsQ0FBQyxnREFBZ0QsRUFBRXNELE9BQU94RCxLQUFLLENBQUMsQ0FBQztZQUM5RSxPQUFPO2dCQUNMc0QsWUFBWTtnQkFDWnRELE9BQU93RCxPQUFPeEQsS0FBSztZQUNyQjtRQUNGO1FBRUEsSUFBSSxDQUFDd0QsT0FBT0YsVUFBVSxJQUFJRSxPQUFPRixVQUFVLENBQUN6RCxJQUFJLEdBQUcrQyxNQUFNLEtBQUssR0FBRztZQUMvRCxPQUFPO2dCQUNMVSxZQUFZO2dCQUNadEQsT0FBTztZQUNUO1FBQ0Y7UUFFQUMsUUFBUXNELEdBQUcsQ0FBQyxDQUFDLHFEQUFxRCxFQUFFQyxPQUFPRixVQUFVLENBQUNWLE1BQU0sQ0FBQyxZQUFZLENBQUM7UUFDMUcsT0FBTztZQUNMVSxZQUFZRSxPQUFPRixVQUFVO1FBQy9CO0lBRUYsRUFBRSxPQUFPdEQsT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLGtEQUFrREE7UUFDaEUsT0FBTztZQUNMc0QsWUFBWTtZQUNadEQsT0FBTyxDQUFDLDZCQUE2QixFQUFFQSxNQUFNd0MsT0FBTyxDQUFDLENBQUM7UUFDeEQ7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1c2NyaWJlLy4vc3JjL3NlcnZpY2VzL3lvdXR1YmUudHM/MGI2NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgaXNMaWtlbHlVcmwgfSBmcm9tICcuL3lvdXR1YmUvdmFsaWRhdG9ycyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXh0cmFjdFlvdVR1YmVUcmFuc2NyaXB0LCBUcmFuc2NyaXB0UmVzdWx0IGFzIE5ld1RyYW5zY3JpcHRSZXN1bHQgfSBmcm9tICcuL3lvdXR1YmUtdHJhbnNjcmlwdCc7XG5cbi8vIFJlLWV4cG9ydCB0aGUgdmFsaWRhdG9ycyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuZXhwb3J0IHsgaXNMaWtlbHlVcmwgfTtcblxuLy8gUHJvbWlzaWZ5IGV4ZWMgZm9yIGFzeW5jL2F3YWl0IHVzYWdlXG5jb25zdCBleGVjQXN5bmMgPSBwcm9taXNpZnkoZXhlYyk7XG5cbi8qKlxuICogWW91VHViZSB2aWRlbyBpbmZvcm1hdGlvbiBvYmplY3RcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBZb3VUdWJlVmlkZW9JbmZvIHtcbiAgdmlkZW9JZDogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgdGh1bWJuYWlsVXJsOiBzdHJpbmc7XG4gIGNoYW5uZWxUaXRsZT86IHN0cmluZztcbiAgcHVibGlzaGVkQXQ/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRyYW5zY3JpcHQgZXh0cmFjdGlvbiByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0UmVzdWx0IHtcbiAgdHJhbnNjcmlwdDogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuLyoqXG4gKiBTYWZlbHkgYXR0ZW1wdHMgdG8gcGFyc2UgYSBVUkwgc3RyaW5nXG4gKiBAcGFyYW0gdXJsU3RyaW5nIFRoZSBVUkwgc3RyaW5nIHRvIHBhcnNlXG4gKiBAcmV0dXJucyBVUkwgb2JqZWN0IGlmIHN1Y2Nlc3NmdWwsIG51bGwgaWYgbm90XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYWZlUGFyc2VVcmwodXJsU3RyaW5nOiBzdHJpbmcpOiBVUkwgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICAvLyBBZGQgcHJvdG9jb2wgaWYgbWlzc2luZ1xuICAgIGxldCBub3JtYWxpemVkVXJsID0gdXJsU3RyaW5nLnRyaW0oKTtcbiAgICBpZiAobm9ybWFsaXplZFVybC5zdGFydHNXaXRoKCcvLycpKSB7XG4gICAgICBub3JtYWxpemVkVXJsID0gYGh0dHBzOiR7bm9ybWFsaXplZFVybH1gO1xuICAgIH0gZWxzZSBpZiAoIW5vcm1hbGl6ZWRVcmwuc3RhcnRzV2l0aCgnaHR0cDovLycpICYmICFub3JtYWxpemVkVXJsLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcbiAgICAgIG5vcm1hbGl6ZWRVcmwgPSBgaHR0cHM6Ly8ke25vcm1hbGl6ZWRVcmx9YDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG5ldyBVUkwobm9ybWFsaXplZFVybCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKCdbWW91VHViZV0gRmFpbGVkIHRvIHBhcnNlIFVSTDonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBFeHRyYWN0cyBhIFlvdVR1YmUgdmlkZW8gSUQgZnJvbSBhIFVSTFxuICogU3VwcG9ydHMgdmFyaW91cyBZb3VUdWJlIFVSTCBmb3JtYXRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0WW91VHViZUlkKHVybDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghdXJsKSByZXR1cm4gbnVsbDtcbiAgXG4gIC8vIENsZWFuIHRoZSBVUkwgYnkgdHJpbW1pbmcgYW5kIGhhbmRsaW5nIG1vYmlsZSBVUkxzXG4gIGxldCBjbGVhblVybCA9IHVybC50cmltKCk7XG4gIFxuICAvLyBDb252ZXJ0IG1vYmlsZSB5b3V0dWJlIFVSTHMgdG8gc3RhbmRhcmQgZm9ybWF0XG4gIGlmIChjbGVhblVybC5pbmNsdWRlcygneW91dHUuYmUvJykpIHtcbiAgICBjbGVhblVybCA9IGNsZWFuVXJsLnJlcGxhY2UoJ3lvdXR1LmJlLycsICd5b3V0dWJlLmNvbS93YXRjaD92PScpO1xuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIFRyeSB0byBwYXJzZSBhcyBVUkwgYW5kIGV4dHJhY3QgZnJvbSBzZWFyY2hQYXJhbXMgKHN0YW5kYXJkIHlvdXR1YmUuY29tL3dhdGNoP3Y9SUQgZm9ybWF0KVxuICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwoY2xlYW5VcmwpO1xuICAgIFxuICAgIC8vIEhhbmRsZSB5b3V0dWJlLmNvbS93YXRjaD92PUlEIGZvcm1hdFxuICAgIGlmICh1cmxPYmouaG9zdG5hbWUuaW5jbHVkZXMoJ3lvdXR1YmUuY29tJykgJiYgdXJsT2JqLnBhdGhuYW1lLmluY2x1ZGVzKCcvd2F0Y2gnKSkge1xuICAgICAgY29uc3QgdmlkZW9JZCA9IHVybE9iai5zZWFyY2hQYXJhbXMuZ2V0KCd2Jyk7XG4gICAgICBpZiAodmlkZW9JZCkgcmV0dXJuIHZpZGVvSWQ7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSB5b3V0dWJlLmNvbS9lbWJlZC9JRCBmb3JtYXRcbiAgICBpZiAodXJsT2JqLmhvc3RuYW1lLmluY2x1ZGVzKCd5b3V0dWJlJykgJiYgdXJsT2JqLnBhdGhuYW1lLmluY2x1ZGVzKCcvZW1iZWQvJykpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gdXJsT2JqLnBhdGhuYW1lLnNwbGl0KCcvJyk7XG4gICAgICByZXR1cm4gcGFydHNbcGFydHMuaW5kZXhPZignZW1iZWQnKSArIDFdIHx8IG51bGw7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSB5b3V0dS5iZS9JRCBmb3JtYXQgKGFscmVhZHkgY29udmVydGVkIHRvIHN0YW5kYXJkIGZvcm1hdCBhYm92ZSwgYnV0IGp1c3QgaW4gY2FzZSlcbiAgICBpZiAodXJsT2JqLmhvc3RuYW1lID09PSAneW91dHUuYmUnKSB7XG4gICAgICByZXR1cm4gdXJsT2JqLnBhdGhuYW1lLnN1YnN0cmluZygxKSB8fCBudWxsO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgeW91dHViZS5jb20vdi9JRCBmb3JtYXRcbiAgICBpZiAodXJsT2JqLmhvc3RuYW1lLmluY2x1ZGVzKCd5b3V0dWJlJykgJiYgdXJsT2JqLnBhdGhuYW1lLmluY2x1ZGVzKCcvdi8nKSkge1xuICAgICAgY29uc3QgcGFydHMgPSB1cmxPYmoucGF0aG5hbWUuc3BsaXQoJy8nKTtcbiAgICAgIHJldHVybiBwYXJ0c1twYXJ0cy5pbmRleE9mKCd2JykgKyAxXSB8fCBudWxsO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIElmIFVSTCBwYXJzaW5nIGZhaWxzLCB0cnkgcmVnZXgtYmFzZWQgZXh0cmFjdGlvblxuICAgIGNvbnNvbGUuZXJyb3IoJ1VSTCBwYXJzaW5nIGZhaWxlZCwgdHJ5aW5nIHJlZ2V4IGZhbGxiYWNrOicsIGUpO1xuICB9XG4gIFxuICAvLyBGYWxsYmFjayB0byByZWdleCBmb3IgY2FzZXMgd2hlcmUgVVJMIHBhcnNpbmcgZmFpbHNcbiAgY29uc3QgcGF0dGVybnMgPSBbXG4gICAgLyg/OnlvdXR1YmVcXC5jb21cXC93YXRjaFxcP3Y9fHlvdXR1XFwuYmVcXC98eW91dHViZVxcLmNvbVxcL2VtYmVkXFwvfHlvdXR1YmVcXC5jb21cXC92XFwvKShbXiZcXG4/I10rKS8sXG4gICAgL14oW2EtekEtWjAtOV8tXXsxMX0pJC8gIC8vIERpcmVjdCB2aWRlbyBJRCAoMTEgY2hhcmFjdGVycylcbiAgXTtcbiAgXG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gY2xlYW5VcmwubWF0Y2gocGF0dGVybik7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICByZXR1cm4gbWF0Y2hbMV07XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgaWYgYSBzdHJpbmcgaXMgYSB2YWxpZCBZb3VUdWJlIHZpZGVvIElEXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkWW91VHViZUlkKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKCFpZCkgcmV0dXJuIGZhbHNlO1xuICBcbiAgLy8gWW91VHViZSBJRHMgYXJlIHR5cGljYWxseSAxMSBjaGFyYWN0ZXJzIGFuZCBjb250YWluIG9ubHkgY2VydGFpbiBjaGFyYWN0ZXJzXG4gIGNvbnN0IHZhbGlkUGF0dGVybiA9IC9eW2EtekEtWjAtOV8tXXsxMX0kLztcbiAgcmV0dXJuIHZhbGlkUGF0dGVybi50ZXN0KGlkKTtcbn1cblxuLyoqXG4gKiBHZXRzIGluZm9ybWF0aW9uIGFib3V0IGEgWW91VHViZSB2aWRlb1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW9JbmZvKHZpZGVvSWQ6IHN0cmluZyk6IFByb21pc2U8WW91VHViZVZpZGVvSW5mbz4ge1xuICBpZiAoIXZpZGVvSWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmlkZW9JZDogJycsXG4gICAgICB0aXRsZTogJycsXG4gICAgICB0aHVtYm5haWxVcmw6ICcnLFxuICAgICAgZXJyb3I6ICdObyB2aWRlbyBJRCBwcm92aWRlZCdcbiAgICB9O1xuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIFVzZSBZb3VUdWJlIEFQSSB0byBnZXQgdmlkZW8gaW5mb1xuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1lPVVRVQkVfQVBJX0tFWTtcbiAgICBcbiAgICBpZiAoIWFwaUtleSkge1xuICAgICAgY29uc29sZS5lcnJvcignW1lvdVR1YmUgU2VydmljZV0gTm8gWW91VHViZSBBUEkga2V5IGNvbmZpZ3VyZWQnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZpZGVvSWQsXG4gICAgICAgIHRpdGxlOiBgWW91VHViZSBWaWRlbyAoJHt2aWRlb0lkfSlgLFxuICAgICAgICB0aHVtYm5haWxVcmw6IGBodHRwczovL2ltZy55b3V0dWJlLmNvbS92aS8ke3ZpZGVvSWR9L2hxZGVmYXVsdC5qcGdgLFxuICAgICAgICBlcnJvcjogJ1lvdVR1YmUgQVBJIGtleSBub3QgY29uZmlndXJlZCAtIHVzaW5nIGZhbGxiYWNrIGRhdGEnXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgYGh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvdmlkZW9zP3BhcnQ9c25pcHBldCZpZD0ke3ZpZGVvSWR9JmtleT0ke2FwaUtleX1gLFxuICAgICAgeyBuZXh0OiB7IHJldmFsaWRhdGU6IDM2MDAgfSB9IC8vIENhY2hlIGZvciAxIGhvdXJcbiAgICApO1xuICAgIFxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tZb3VUdWJlIFNlcnZpY2VdIFlvdVR1YmUgQVBJIGVycm9yOicsIGVycm9yRGF0YSk7XG4gICAgICBcbiAgICAgIC8vIEZhbGwgYmFjayB0byBiYXNpYyBpbmZvIHVzaW5nIHZpZGVvIElEXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2aWRlb0lkLFxuICAgICAgICB0aXRsZTogYFlvdVR1YmUgVmlkZW8gKCR7dmlkZW9JZH0pYCxcbiAgICAgICAgdGh1bWJuYWlsVXJsOiBgaHR0cHM6Ly9pbWcueW91dHViZS5jb20vdmkvJHt2aWRlb0lkfS9ocWRlZmF1bHQuanBnYCxcbiAgICAgICAgZXJyb3I6IGBZb3VUdWJlIEFQSSBlcnJvcjogJHtlcnJvckRhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2Uuc3RhdHVzVGV4dH1gXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIFxuICAgIGlmICghZGF0YS5pdGVtcyB8fCBkYXRhLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS5lcnJvcignW1lvdVR1YmUgU2VydmljZV0gVmlkZW8gbm90IGZvdW5kOicsIHZpZGVvSWQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmlkZW9JZCxcbiAgICAgICAgdGl0bGU6IGBWaWRlbyBOb3QgRm91bmQgKCR7dmlkZW9JZH0pYCxcbiAgICAgICAgdGh1bWJuYWlsVXJsOiAnJyxcbiAgICAgICAgZXJyb3I6ICdWaWRlbyBub3QgZm91bmQnXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB2aWRlb0RldGFpbHMgPSBkYXRhLml0ZW1zWzBdLnNuaXBwZXQ7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHZpZGVvSWQsXG4gICAgICB0aXRsZTogdmlkZW9EZXRhaWxzLnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IHZpZGVvRGV0YWlscy5kZXNjcmlwdGlvbixcbiAgICAgIHRodW1ibmFpbFVybDogdmlkZW9EZXRhaWxzLnRodW1ibmFpbHM/LmhpZ2g/LnVybCB8fCB2aWRlb0RldGFpbHMudGh1bWJuYWlscz8uZGVmYXVsdD8udXJsIHx8ICcnLFxuICAgICAgY2hhbm5lbFRpdGxlOiB2aWRlb0RldGFpbHMuY2hhbm5lbFRpdGxlLFxuICAgICAgcHVibGlzaGVkQXQ6IHZpZGVvRGV0YWlscy5wdWJsaXNoZWRBdFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbWW91VHViZSBTZXJ2aWNlXSBFcnJvciBmZXRjaGluZyB2aWRlbyBpbmZvOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBGYWxsIGJhY2sgdG8gYmFzaWMgaW5mbyB1c2luZyB2aWRlbyBJRFxuICAgIHJldHVybiB7XG4gICAgICB2aWRlb0lkLFxuICAgICAgdGl0bGU6IGBZb3VUdWJlIFZpZGVvICgke3ZpZGVvSWR9KWAsXG4gICAgICB0aHVtYm5haWxVcmw6IGBodHRwczovL2ltZy55b3V0dWJlLmNvbS92aS8ke3ZpZGVvSWR9L2hxZGVmYXVsdC5qcGdgLFxuICAgICAgZXJyb3I6IGBFcnJvciBmZXRjaGluZyB2aWRlbyBpbmZvOiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZXRzIHRoZSB0cmFuc2NyaXB0IGZvciBhIFlvdVR1YmUgdmlkZW9cbiAqIFVzZXMgdGhlIG5ldyBwcm9kdWN0aW9uLXNhZmUgdHJhbnNjcmlwdCBleHRyYWN0aW9uIHNlcnZpY2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvVHJhbnNjcmlwdCh2aWRlb0lkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHRSZXN1bHQ+IHtcbiAgaWYgKCF2aWRlb0lkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRyYW5zY3JpcHQ6ICcnLFxuICAgICAgZXJyb3I6ICdObyB2aWRlbyBJRCBwcm92aWRlZCdcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgW1lvdVR1YmUgU2VydmljZV0gRXh0cmFjdGluZyB0cmFuc2NyaXB0IGZvciB2aWRlbzogJHt2aWRlb0lkfWApO1xuICAgIFxuICAgIC8vIFVzZSB0aGUgbmV3IHByb2R1Y3Rpb24tc2FmZSB0cmFuc2NyaXB0IGV4dHJhY3Rpb25cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0WW91VHViZVRyYW5zY3JpcHQodmlkZW9JZCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5lcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBbWW91VHViZSBTZXJ2aWNlXSBUcmFuc2NyaXB0IGV4dHJhY3Rpb24gZmFpbGVkOiAke3Jlc3VsdC5lcnJvcn1gKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRyYW5zY3JpcHQ6ICcnLFxuICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBpZiAoIXJlc3VsdC50cmFuc2NyaXB0IHx8IHJlc3VsdC50cmFuc2NyaXB0LnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRyYW5zY3JpcHQ6ICcnLFxuICAgICAgICBlcnJvcjogJ05vIHRyYW5zY3JpcHQgY29udGVudCBhdmFpbGFibGUgZm9yIHRoaXMgdmlkZW8nXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhgW1lvdVR1YmUgU2VydmljZV0gU3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZCB0cmFuc2NyaXB0ICgke3Jlc3VsdC50cmFuc2NyaXB0Lmxlbmd0aH0gY2hhcmFjdGVycylgKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHJhbnNjcmlwdDogcmVzdWx0LnRyYW5zY3JpcHRcbiAgICB9O1xuICAgIFxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignW1lvdVR1YmUgU2VydmljZV0gRXJyb3IgZXh0cmFjdGluZyB0cmFuc2NyaXB0OicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHJhbnNjcmlwdDogJycsXG4gICAgICBlcnJvcjogYEVycm9yIGV4dHJhY3RpbmcgdHJhbnNjcmlwdDogJHtlcnJvci5tZXNzYWdlfWBcbiAgICB9O1xuICB9XG59ICJdLCJuYW1lcyI6WyJpc0xpa2VseVVybCIsImV4ZWMiLCJwcm9taXNpZnkiLCJleHRyYWN0WW91VHViZVRyYW5zY3JpcHQiLCJleGVjQXN5bmMiLCJzYWZlUGFyc2VVcmwiLCJ1cmxTdHJpbmciLCJub3JtYWxpemVkVXJsIiwidHJpbSIsInN0YXJ0c1dpdGgiLCJVUkwiLCJlcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiZXh0cmFjdFlvdVR1YmVJZCIsInVybCIsImNsZWFuVXJsIiwiaW5jbHVkZXMiLCJyZXBsYWNlIiwidXJsT2JqIiwiaG9zdG5hbWUiLCJwYXRobmFtZSIsInZpZGVvSWQiLCJzZWFyY2hQYXJhbXMiLCJnZXQiLCJwYXJ0cyIsInNwbGl0IiwiaW5kZXhPZiIsInN1YnN0cmluZyIsImUiLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJtYXRjaCIsImlzVmFsaWRZb3VUdWJlSWQiLCJpZCIsInZhbGlkUGF0dGVybiIsInRlc3QiLCJnZXRWaWRlb0luZm8iLCJ0aXRsZSIsInRodW1ibmFpbFVybCIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19ZT1VUVUJFX0FQSV9LRVkiLCJyZXNwb25zZSIsImZldGNoIiwibmV4dCIsInJldmFsaWRhdGUiLCJvayIsImVycm9yRGF0YSIsImpzb24iLCJtZXNzYWdlIiwic3RhdHVzVGV4dCIsImRhdGEiLCJpdGVtcyIsImxlbmd0aCIsInZpZGVvRGV0YWlscyIsInNuaXBwZXQiLCJkZXNjcmlwdGlvbiIsInRodW1ibmFpbHMiLCJoaWdoIiwiZGVmYXVsdCIsImNoYW5uZWxUaXRsZSIsInB1Ymxpc2hlZEF0IiwiZ2V0VmlkZW9UcmFuc2NyaXB0IiwidHJhbnNjcmlwdCIsImxvZyIsInJlc3VsdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/youtube.ts\n");

/***/ }),

/***/ "(rsc)/./src/services/youtube/validators.ts":
/*!********************************************!*\
  !*** ./src/services/youtube/validators.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isLikelyUrl: () => (/* binding */ isLikelyUrl)\n/* harmony export */ });\n/**\n * Validators for YouTube-related functionality\n */ /**\n * Checks if a string is likely a URL\n * @param url The string to check\n * @returns boolean indicating if the string is a valid URL\n */ function isLikelyUrl(url) {\n    try {\n        new URL(url);\n        return true;\n    } catch  {\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMveW91dHViZS92YWxpZGF0b3JzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Q0FFQyxHQUVEOzs7O0NBSUMsR0FDTSxTQUFTQSxZQUFZQyxHQUFXO0lBQ3JDLElBQUk7UUFDRixJQUFJQyxJQUFJRDtRQUNSLE9BQU87SUFDVCxFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdXNjcmliZS8uL3NyYy9zZXJ2aWNlcy95b3V0dWJlL3ZhbGlkYXRvcnMudHM/ZmY2ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFZhbGlkYXRvcnMgZm9yIFlvdVR1YmUtcmVsYXRlZCBmdW5jdGlvbmFsaXR5XG4gKi9cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBzdHJpbmcgaXMgbGlrZWx5IGEgVVJMXG4gKiBAcGFyYW0gdXJsIFRoZSBzdHJpbmcgdG8gY2hlY2tcbiAqIEByZXR1cm5zIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgc3RyaW5nIGlzIGEgdmFsaWQgVVJMXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0xpa2VseVVybCh1cmw6IHN0cmluZyk6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIG5ldyBVUkwodXJsKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59ICJdLCJuYW1lcyI6WyJpc0xpa2VseVVybCIsInVybCIsIlVSTCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/youtube/validators.ts\n");

/***/ }),

/***/ "(rsc)/./src/utils/splitTranscript.ts":
/*!**************************************!*\
  !*** ./src/utils/splitTranscript.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   estimateTokenCount: () => (/* binding */ estimateTokenCount),\n/* harmony export */   isChunkWithinTokenLimit: () => (/* binding */ isChunkWithinTokenLimit),\n/* harmony export */   splitTranscriptIntoChunks: () => (/* binding */ splitTranscriptIntoChunks)\n/* harmony export */ });\n/**\n * Represents a chunk of text with metadata\n */ /**\n * Splits a transcript into chunks based on word count\n * @param transcript The full transcript text to split\n * @param maxWords Maximum number of words per chunk (default: 800)\n * @returns Array of TranscriptChunk objects\n */ function splitTranscriptIntoChunks(transcript, maxWords = 800) {\n    // Split into words and filter out empty strings\n    const words = transcript.split(/\\s+/).filter((word)=>word.length > 0);\n    const chunks = [];\n    for(let i = 0; i < words.length; i += maxWords){\n        const startWord = i;\n        const endWord = Math.min(i + maxWords, words.length);\n        const chunkWords = words.slice(startWord, endWord);\n        chunks.push({\n            content: chunkWords.join(\" \"),\n            index: chunks.length,\n            wordCount: chunkWords.length,\n            startWord,\n            endWord\n        });\n    }\n    return chunks;\n}\n/**\n * Estimates the number of tokens in a text string\n * This is a rough estimate: ~4 characters per token on average\n * @param text The text to estimate tokens for\n * @returns Estimated number of tokens\n */ function estimateTokenCount(text) {\n    return Math.ceil(text.length / 4);\n}\n/**\n * Validates if a chunk is within safe token limits\n * @param chunk The chunk to validate\n * @param maxTokens Maximum allowed tokens (default: 3000)\n * @returns boolean indicating if chunk is within limits\n */ function isChunkWithinTokenLimit(chunk, maxTokens = 3000) {\n    return estimateTokenCount(chunk.content) <= maxTokens;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvdXRpbHMvc3BsaXRUcmFuc2NyaXB0LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztDQUVDLEdBb0JEOzs7OztDQUtDLEdBQ00sU0FBU0EsMEJBQ2RDLFVBQWtCLEVBQ2xCQyxXQUFtQixHQUFHO0lBRXRCLGdEQUFnRDtJQUNoRCxNQUFNQyxRQUFRRixXQUFXRyxLQUFLLENBQUMsT0FBT0MsTUFBTSxDQUFDQyxDQUFBQSxPQUFRQSxLQUFLQyxNQUFNLEdBQUc7SUFDbkUsTUFBTUMsU0FBNEIsRUFBRTtJQUVwQyxJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSU4sTUFBTUksTUFBTSxFQUFFRSxLQUFLUCxTQUFVO1FBQy9DLE1BQU1RLFlBQVlEO1FBQ2xCLE1BQU1FLFVBQVVDLEtBQUtDLEdBQUcsQ0FBQ0osSUFBSVAsVUFBVUMsTUFBTUksTUFBTTtRQUNuRCxNQUFNTyxhQUFhWCxNQUFNWSxLQUFLLENBQUNMLFdBQVdDO1FBRTFDSCxPQUFPUSxJQUFJLENBQUM7WUFDVkMsU0FBU0gsV0FBV0ksSUFBSSxDQUFDO1lBQ3pCQyxPQUFPWCxPQUFPRCxNQUFNO1lBQ3BCYSxXQUFXTixXQUFXUCxNQUFNO1lBQzVCRztZQUNBQztRQUNGO0lBQ0Y7SUFFQSxPQUFPSDtBQUNUO0FBRUE7Ozs7O0NBS0MsR0FDTSxTQUFTYSxtQkFBbUJDLElBQVk7SUFDN0MsT0FBT1YsS0FBS1csSUFBSSxDQUFDRCxLQUFLZixNQUFNLEdBQUc7QUFDakM7QUFFQTs7Ozs7Q0FLQyxHQUNNLFNBQVNpQix3QkFDZEMsS0FBc0IsRUFDdEJDLFlBQW9CLElBQUk7SUFFeEIsT0FBT0wsbUJBQW1CSSxNQUFNUixPQUFPLEtBQUtTO0FBQzlDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1c2NyaWJlLy4vc3JjL3V0aWxzL3NwbGl0VHJhbnNjcmlwdC50cz9jZmVlIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUmVwcmVzZW50cyBhIGNodW5rIG9mIHRleHQgd2l0aCBtZXRhZGF0YVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zY3JpcHRDaHVuayB7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgaW5kZXg6IG51bWJlcjtcbiAgd29yZENvdW50OiBudW1iZXI7XG4gIHN0YXJ0V29yZDogbnVtYmVyO1xuICBlbmRXb3JkOiBudW1iZXI7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIGZhaWxlZCBjaHVuayBwcm9jZXNzaW5nIGF0dGVtcHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGYWlsZWRDaHVuayB7XG4gIGluZGV4OiBudW1iZXI7XG4gIHJlYXNvbjogc3RyaW5nO1xuICBhdHRlbXB0czogbnVtYmVyO1xuICBzdGFydFdvcmQ6IG51bWJlcjtcbiAgZW5kV29yZDogbnVtYmVyO1xufVxuXG4vKipcbiAqIFNwbGl0cyBhIHRyYW5zY3JpcHQgaW50byBjaHVua3MgYmFzZWQgb24gd29yZCBjb3VudFxuICogQHBhcmFtIHRyYW5zY3JpcHQgVGhlIGZ1bGwgdHJhbnNjcmlwdCB0ZXh0IHRvIHNwbGl0XG4gKiBAcGFyYW0gbWF4V29yZHMgTWF4aW11bSBudW1iZXIgb2Ygd29yZHMgcGVyIGNodW5rIChkZWZhdWx0OiA4MDApXG4gKiBAcmV0dXJucyBBcnJheSBvZiBUcmFuc2NyaXB0Q2h1bmsgb2JqZWN0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gc3BsaXRUcmFuc2NyaXB0SW50b0NodW5rcyhcbiAgdHJhbnNjcmlwdDogc3RyaW5nLFxuICBtYXhXb3JkczogbnVtYmVyID0gODAwXG4pOiBUcmFuc2NyaXB0Q2h1bmtbXSB7XG4gIC8vIFNwbGl0IGludG8gd29yZHMgYW5kIGZpbHRlciBvdXQgZW1wdHkgc3RyaW5nc1xuICBjb25zdCB3b3JkcyA9IHRyYW5zY3JpcHQuc3BsaXQoL1xccysvKS5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA+IDApO1xuICBjb25zdCBjaHVua3M6IFRyYW5zY3JpcHRDaHVua1tdID0gW107XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkgKz0gbWF4V29yZHMpIHtcbiAgICBjb25zdCBzdGFydFdvcmQgPSBpO1xuICAgIGNvbnN0IGVuZFdvcmQgPSBNYXRoLm1pbihpICsgbWF4V29yZHMsIHdvcmRzLmxlbmd0aCk7XG4gICAgY29uc3QgY2h1bmtXb3JkcyA9IHdvcmRzLnNsaWNlKHN0YXJ0V29yZCwgZW5kV29yZCk7XG4gICAgXG4gICAgY2h1bmtzLnB1c2goe1xuICAgICAgY29udGVudDogY2h1bmtXb3Jkcy5qb2luKCcgJyksXG4gICAgICBpbmRleDogY2h1bmtzLmxlbmd0aCxcbiAgICAgIHdvcmRDb3VudDogY2h1bmtXb3Jkcy5sZW5ndGgsXG4gICAgICBzdGFydFdvcmQsXG4gICAgICBlbmRXb3JkXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gY2h1bmtzO1xufVxuXG4vKipcbiAqIEVzdGltYXRlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBpbiBhIHRleHQgc3RyaW5nXG4gKiBUaGlzIGlzIGEgcm91Z2ggZXN0aW1hdGU6IH40IGNoYXJhY3RlcnMgcGVyIHRva2VuIG9uIGF2ZXJhZ2VcbiAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IHRvIGVzdGltYXRlIHRva2VucyBmb3JcbiAqIEByZXR1cm5zIEVzdGltYXRlZCBudW1iZXIgb2YgdG9rZW5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlc3RpbWF0ZVRva2VuQ291bnQodGV4dDogc3RyaW5nKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGguY2VpbCh0ZXh0Lmxlbmd0aCAvIDQpO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyBpZiBhIGNodW5rIGlzIHdpdGhpbiBzYWZlIHRva2VuIGxpbWl0c1xuICogQHBhcmFtIGNodW5rIFRoZSBjaHVuayB0byB2YWxpZGF0ZVxuICogQHBhcmFtIG1heFRva2VucyBNYXhpbXVtIGFsbG93ZWQgdG9rZW5zIChkZWZhdWx0OiAzMDAwKVxuICogQHJldHVybnMgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIGNodW5rIGlzIHdpdGhpbiBsaW1pdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQ2h1bmtXaXRoaW5Ub2tlbkxpbWl0KFxuICBjaHVuazogVHJhbnNjcmlwdENodW5rLFxuICBtYXhUb2tlbnM6IG51bWJlciA9IDMwMDBcbik6IGJvb2xlYW4ge1xuICByZXR1cm4gZXN0aW1hdGVUb2tlbkNvdW50KGNodW5rLmNvbnRlbnQpIDw9IG1heFRva2Vucztcbn0gIl0sIm5hbWVzIjpbInNwbGl0VHJhbnNjcmlwdEludG9DaHVua3MiLCJ0cmFuc2NyaXB0IiwibWF4V29yZHMiLCJ3b3JkcyIsInNwbGl0IiwiZmlsdGVyIiwid29yZCIsImxlbmd0aCIsImNodW5rcyIsImkiLCJzdGFydFdvcmQiLCJlbmRXb3JkIiwiTWF0aCIsIm1pbiIsImNodW5rV29yZHMiLCJzbGljZSIsInB1c2giLCJjb250ZW50Iiwiam9pbiIsImluZGV4Iiwid29yZENvdW50IiwiZXN0aW1hdGVUb2tlbkNvdW50IiwidGV4dCIsImNlaWwiLCJpc0NodW5rV2l0aGluVG9rZW5MaW1pdCIsImNodW5rIiwibWF4VG9rZW5zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/utils/splitTranscript.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/abort-controller","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/get-intrinsic","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms","vendor-chunks/axios","vendor-chunks/asynckit","vendor-chunks/debug","vendor-chunks/mime-db","vendor-chunks/form-data","vendor-chunks/follow-redirects","vendor-chunks/youtube-transcript-api","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/mime-types","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/es-set-tostringtag","vendor-chunks/delayed-stream","vendor-chunks/combined-stream"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fvideo-notes%2Froute&page=%2Fapi%2Fvideo-notes%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fvideo-notes%2Froute.ts&appDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe%2Fsrc%2Fapp&pageExtensions=js&pageExtensions=jsx&pageExtensions=ts&pageExtensions=tsx&pageExtensions=mdx&rootDir=%2FUsers%2Fjanjedrach%2FCursor%2Feduscribe&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();