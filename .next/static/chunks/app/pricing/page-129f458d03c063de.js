(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{4654:function(){},2997:function(e,t,s){Promise.resolve().then(s.bind(s,5620))},5620:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var n=s(7437),r=s(2265),a=s(9376),i=s(7124);s(9142);var o=s(5566);o.env.STRIPE_STUDENT_MONTHLY_PRICE_ID,o.env.STRIPE_STUDENT_YEARLY_PRICE_ID,o.env.STRIPE_PRO_MONTHLY_PRICE_ID,o.env.STRIPE_PRO_YEARLY_PRICE_ID;let l=[{id:"free",name:"free",display_name:"Free",description:"Basic note generation for students",price_monthly:0,price_yearly:0,currency:"PLN",features:{notes_generation:!0,quizzes:!1,youtube_support:!0,ppt_support:!1,export:!1,copy_paste:!0,upload_video:!1,priority_generation:!1},limits:{notes_per_month:2,max_saved_notes:3,max_text_length:5e3},is_active:!0},{id:"student",name:"student",display_name:"Student",description:"Perfect for students with enhanced features",price_monthly:24.99,price_yearly:224.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!1},limits:{notes_per_month:10,max_saved_notes:12,max_text_length:1e4},is_active:!0},{id:"pro",name:"pro",display_name:"Pro",description:"Ultimate plan for power users and professionals",price_monthly:49.99,price_yearly:449.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!0},limits:{notes_per_month:-1,max_saved_notes:50,max_text_length:15e3},is_active:!0}];function c(){var e;let t=(0,a.useRouter)(),{user:s,supabase:o}=(0,i.$)(),[c]=(0,r.useState)(l),[d,u]=(0,r.useState)("free"),[x,m]=(0,r.useState)(null),[h,p]=(0,r.useState)("monthly"),[g,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(!1),[_,v]=(0,r.useState)(!0),[j,N]=(0,r.useState)(!1),[w,D]=(0,r.useState)(0),[S,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(!s||!o){u("free"),v(!1);return}try{console.log("[Pricing] Fetching user subscription for:",s.id);let{data:e,error:t}=await o.from("user_subscriptions").select("\n            plan_id,\n            billing_cycle,\n            status,\n            stripe_subscription_id,\n            current_period_end,\n            cancel_at_period_end,\n            subscription_plans (\n              display_name\n            )\n          ").eq("user_id",s.id).eq("status","active").single();t?(console.log("[Pricing] No active subscription found:",t.message),u("free"),m(null)):(console.log("[Pricing] Found subscription:",e),u(e.plan_id),m(e))}catch(e){console.error("[Pricing] Error fetching subscription:",e),u("free"),m(null)}finally{v(!1)}})()},[s,o]);let P=async()=>{if(!s||!o)return 0;C(!0);try{let{data:{session:e}}=await o.auth.getSession();if(!(null==e?void 0:e.access_token))throw Error("No authentication token available");let[t,n,r,a]=await Promise.all([o.from("text_notes").select("id",{count:"exact"}).eq("user_id",s.id),o.from("file_notes").select("id",{count:"exact"}).eq("user_id",s.id),o.from("video_notes").select("id",{count:"exact"}).eq("user_id",s.id),o.from("video_upload_notes").select("id",{count:"exact"}).eq("user_id",s.id).then(e=>e,e=>(console.warn("[Pricing] video_upload_notes table might not exist:",e.message),{count:0}))]),i=t.count||0,l=n.count||0,c=r.count||0,d=a.count||0,u=i+l+c+d;return console.log("[Pricing] Notes count:",{textCount:i,fileCount:l,videoCount:c,uploadVideoCount:d,totalCount:u}),D(u),u}catch(e){return console.error("[Pricing] Error fetching notes count:",e),D(0),0}finally{C(!1)}},k=async e=>{if(!s){t.push("/?signup=true");return}if("free"===e){x?(await P(),N(!0)):t.push("/dashboard");return}if(e!==d){b(!0);try{let{data:{session:t}}=await o.auth.getSession();if(!(null==t?void 0:t.access_token))throw Error("No valid session found. Please sign in again.");let s=await fetch("/api/stripe/checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({planId:e,billingCycle:h})}),n=await s.json();if(!s.ok)throw Error(n.error||"Failed to create checkout session");if(n.url)window.location.href=n.url;else throw Error("No checkout URL received")}catch(e){console.error("Error creating checkout session:",e),alert("Failed to start checkout process. Please try again.")}finally{b(!1)}}},E=async()=>{if(x&&s){y(!0);try{let{data:{session:e}}=await o.auth.getSession();if(!(null==e?void 0:e.access_token))throw Error("No valid session found. Please sign in again.");console.log("[Pricing] Cancelling subscription:",x.stripe_subscription_id);let t=await fetch("/api/stripe/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({subscriptionId:x.stripe_subscription_id})}),s=await t.json();if(console.log("[Pricing] Cancellation response:",s),!t.ok){console.error("[Pricing] Cancellation failed:",{status:t.status,data:s});let e="Failed to cancel subscription";throw s.error?e=s.error:s.details&&(e="".concat(e,": ").concat(s.details)),Error(e)}m(null),u("free"),N(!1);let n="Your subscription has been cancelled successfully!";n+="\n\nYou have been switched to the Free plan.",s.notesDeleted&&s.notesDeleted.total>0&&(n+="\n\nNote Management:\n• ".concat(s.notesDeleted.total," notes were deleted to comply with Free plan limits")+"\n• ".concat(s.remainingNotes," notes remain in your account"),s.notesDeleted.text>0&&(n+="\n• Text notes deleted: ".concat(s.notesDeleted.text)),s.notesDeleted.file>0&&(n+="\n• File notes deleted: ".concat(s.notesDeleted.file)),s.notesDeleted.video>0&&(n+="\n• Video notes deleted: ".concat(s.notesDeleted.video)),s.notesDeleted.video_upload>0&&(n+="\n• Video upload notes deleted: ".concat(s.notesDeleted.video_upload)),n+="\n\nYour 3 oldest notes have been preserved."),s.warning&&(n+="\n\nNote: ".concat(s.warning)),n+="\n\nYou can upgrade again anytime to unlock more features!",alert(n)}catch(t){console.error("[Pricing] Error cancelling subscription:",t);let e="Failed to cancel subscription. ";t.message.includes("authentication")||t.message.includes("session")?e+="Please try signing out and back in, then try again.":t.message.includes("network")||t.message.includes("fetch")?e+="Please check your internet connection and try again.":t.message.includes("Stripe")?e+="There was an issue with payment processing. Please contact support.":e+="Please try again or contact support if the problem persists.",t.message&&!t.message.includes("Failed to cancel subscription")&&(e+="\n\nError details: ".concat(t.message)),alert(e)}finally{y(!1)}}},I=e=>"".concat(e.toFixed(2)," ").concat(l[0].currency),B=e=>{let t=e.price_monthly,s=e.price_yearly,n=s/12;return{monthly:t,yearly:s,yearlyMonthlyEquivalent:n,discountPercentage:t>0?Math.round((1-n/t)*100):0,yearlySavings:12*t-s,currency:e.currency}},A=e=>{let t=[];-1===e.limits.notes_per_month?t.push({text:"Unlimited notes per month",available:!0}):t.push({text:"".concat(e.limits.notes_per_month," notes per month"),available:!0}),t.push({text:"".concat(e.limits.max_saved_notes," saved notes"),available:!0});let s=e.limits.max_text_length.toLocaleString();return t.push({text:"".concat(s," character limit per note"),available:!0}),t.push({text:"Generate quizzes",available:e.features.quizzes}),t.push({text:"PPT uploads",available:e.features.ppt_support}),t.push({text:"YouTube to Notes",available:e.features.youtube_support}),t.push({text:"Upload Video to Notes",available:e.features.upload_video}),t.push({text:"Export to Notepad",available:e.features.export}),e.features.priority_generation?t.push({text:"Highest processing priority",available:!0}):"student"===e.id?t.push({text:"Medium processing priority",available:!0}):t.push({text:"Lowest processing priority",available:!0}),t},z=e=>{let t=d===e.id,s=x&&"active"===x.status;return g?(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating checkout..."]}):f&&"free"===e.id?(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Cancelling..."]}):t?(null==x?void 0:x.cancel_at_period_end)?"Cancelling at Period End":"Current Plan":"free"===e.id&&s?"Cancel Subscription":"free"===e.id?"Get Started Free":"Choose Plan"},F=e=>d===e.id||g||f||_;return _?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading subscription information..."})]})}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsxs)("div",{className:"text-center mb-12",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Choose Your Plan"}),(0,n.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:"Unlock the full potential of AI-powered note generation"}),s&&x&&(0,n.jsxs)("div",{className:"mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg max-w-md mx-auto",children:[(0,n.jsxs)("p",{className:"text-blue-800",children:[(0,n.jsx)("strong",{children:"Current Plan:"})," ",(null===(e=l.find(e=>e.id===d))||void 0===e?void 0:e.display_name)||"Unknown"]}),x.cancel_at_period_end&&(0,n.jsxs)("p",{className:"text-orange-600 text-sm mt-1",children:["Subscription will end on ",new Date(x.current_period_end).toLocaleDateString()]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center mb-8",children:[(0,n.jsx)("span",{className:"mr-3 ".concat("monthly"===h?"text-gray-900 font-medium":"text-gray-500"),children:"Monthly"}),(0,n.jsx)("button",{onClick:()=>p("monthly"===h?"yearly":"monthly"),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 bg-blue-600",children:(0,n.jsx)("span",{className:"pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition duration-200 ease-in-out ".concat("yearly"===h?"translate-x-5":"translate-x-0")})}),(0,n.jsx)("span",{className:"ml-3 ".concat("yearly"===h?"text-gray-900 font-medium":"text-gray-500"),children:"Yearly"}),"yearly"===h&&(0,n.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:"Save up to 25%"})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:c.map(e=>{let t=B(e),s=A(e),r=d===e.id,a="yearly"===h?t.yearly:t.monthly,i="yearly"===h?t.yearlyMonthlyEquivalent:t.monthly,o="pro"===e.id?{borderClass:"border-purple-500 border-2",textClass:"text-purple-600",buttonClass:"bg-purple-600 hover:bg-purple-700"}:"student"===e.id?{borderClass:"border-blue-500 border-2",textClass:"text-blue-600",buttonClass:"bg-blue-600 hover:bg-blue-700"}:{borderClass:"border-gray-200",textClass:"text-gray-600",buttonClass:"bg-gray-600 hover:bg-gray-700"};return(0,n.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-8 ".concat(o.borderClass," ").concat(r?"ring-2 ring-blue-500":""),children:["student"===e.id&&(0,n.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,n.jsx)("span",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),r&&(0,n.jsx)("div",{className:"absolute -top-3 -right-3",children:(0,n.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("h3",{className:"text-2xl font-bold ".concat(o.textClass," mb-2"),children:e.display_name}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,n.jsx)("div",{className:"mb-4",children:0===e.price_monthly?(0,n.jsx)("div",{className:"text-4xl font-bold text-gray-900",children:"Free"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-4xl font-bold text-gray-900",children:[I(a),"yearly"===h&&(0,n.jsx)("span",{className:"text-lg font-normal text-gray-600",children:"/year"}),"monthly"===h&&(0,n.jsx)("span",{className:"text-lg font-normal text-gray-600",children:"/month"})]}),"yearly"===h&&(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[I(i),"/month when billed annually"]}),"yearly"===h&&t.discountPercentage>0&&(0,n.jsxs)("div",{className:"text-sm text-green-600 font-medium",children:["Save ",I(t.yearlySavings)," per year"]})]})})]}),(0,n.jsx)("ul",{className:"space-y-3 mb-8",children:s.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-start",children:[e.available?(0,n.jsx)("span",{className:"text-green-500 text-xl mr-3 mt-0.5 flex-shrink-0",children:"✅"}):(0,n.jsx)("span",{className:"text-red-500 text-xl mr-3 mt-0.5 flex-shrink-0",children:"❌"}),(0,n.jsx)("span",{className:"text-gray-700 ".concat(e.available?"":"line-through text-gray-400"),children:e.text})]},t))}),(0,n.jsx)("button",{onClick:()=>{"free"===e.id&&x&&"active"===x.status?N(!0):k(e.id)},disabled:F(e),className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(F(e)?"bg-gray-100 text-gray-500 cursor-not-allowed":"free"===e.id&&x&&"active"===x.status?"bg-red-600 hover:bg-red-700 text-white":"".concat(o.buttonClass," text-white")),children:z(e)})]},e.id)})}),(0,n.jsxs)("div",{className:"mt-16 max-w-4xl mx-auto",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-8",children:"Frequently Asked Questions"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Can I change my plan anytime?"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Yes, you can upgrade or downgrade your plan at any time. Changes take effect immediately for upgrades and at the end of your billing cycle for downgrades."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"What happens if I exceed my limits?"}),(0,n.jsx)("p",{className:"text-gray-600",children:"If you reach your monthly note generation limit, you'll need to upgrade your plan or wait until the next billing cycle. Your saved notes remain accessible."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Is there a free trial?"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Our Free plan allows you to try EduScribe with 2 notes per month. You can upgrade anytime to unlock more features and higher limits."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"How does billing work?"}),(0,n.jsx)("p",{className:"text-gray-600",children:"You'll be charged at the beginning of each billing cycle. Annual plans offer significant savings compared to monthly billing."})]})]})]}),(0,n.jsx)("div",{className:"text-center mt-12",children:(0,n.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"← Back to Dashboard"})})]}),(0,n.jsx)(()=>{if(!j)return null;let e=Math.max(0,w-3),t=e>0;return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(t?"bg-red-100":"bg-yellow-100"),children:(0,n.jsx)("span",{className:"text-xl",children:t?"⚠️":"\uD83D\uDD04"})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Cancel Subscription & Switch to Free Plan"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"This action will take effect immediately"})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:"You are about to cancel your subscription and switch to the Free plan. Please review the details below:"}),S?(0,n.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Checking your notes..."})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("span",{className:"text-blue-600 text-lg",children:"\uD83D\uDCCA"})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-blue-800",children:"Current Notes Status"}),(0,n.jsxs)("p",{className:"text-sm text-blue-700",children:["You currently have ",(0,n.jsxs)("strong",{children:[w," notes"]})," saved"]}),(0,n.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Free plan allows maximum 3 notes"})]})]})}),t&&(0,n.jsx)("div",{className:"bg-red-50 rounded-lg p-4 mb-4 border-2 border-red-300",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("span",{className:"text-red-600 text-xl",children:"\uD83D\uDEA8"})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h4",{className:"text-sm font-semibold text-red-900",children:"⚠️ DATA LOSS WARNING"}),(0,n.jsxs)("div",{className:"bg-red-100 rounded p-2 mt-2 border border-red-200",children:[(0,n.jsx)("p",{className:"text-sm text-red-800 font-medium mb-1",children:(0,n.jsxs)("strong",{children:[e," of your notes will be permanently deleted!"]})}),(0,n.jsxs)("p",{className:"text-xs text-red-700",children:["• Your ",(0,n.jsx)("strong",{children:"3 oldest notes"})," will be kept",(0,n.jsx)("br",{}),"• Your ",(0,n.jsxs)("strong",{children:[e," newest notes"]})," will be deleted forever",(0,n.jsx)("br",{}),"• This action ",(0,n.jsx)("strong",{children:"cannot be undone"})]})]}),(0,n.jsx)("p",{className:"text-xs text-red-600 mt-2 font-medium",children:"⚠️ Consider exporting your notes before proceeding"})]})]})}),!t&&w<=3&&w>0&&(0,n.jsx)("div",{className:"bg-green-50 rounded-lg p-4 mb-4 border border-green-200",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("span",{className:"text-green-600 text-lg",children:"✅"})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-green-800",children:"Notes Safe"}),(0,n.jsxs)("p",{className:"text-sm text-green-700",children:["All your ",w," notes will be preserved (within Free plan limit of 3 notes)"]})]})]})})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,n.jsx)("p",{className:"text-sm text-gray-700 font-medium mb-2",children:"What happens when you confirm:"}),(0,n.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,n.jsx)("li",{children:"• Subscription cancelled immediately"}),(0,n.jsx)("li",{children:"• Switched to Free plan (2 notes/month, 3 saved notes max)"}),t&&(0,n.jsxs)("li",{children:["• ",(0,n.jsxs)("strong",{children:[e," newest notes deleted permanently"]})]}),(0,n.jsx)("li",{children:"• No future charges"}),(0,n.jsx)("li",{children:"• Can upgrade again anytime"})]})]})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("button",{onClick:()=>N(!1),className:"flex-1 px-4 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium transition-colors",disabled:f,children:"Keep Subscription"}),(0,n.jsx)("button",{onClick:E,disabled:f||S,className:"flex-1 px-4 py-3 rounded-md font-medium transition-colors ".concat(t?"bg-red-600 hover:bg-red-700 text-white disabled:opacity-50":"bg-orange-600 hover:bg-orange-700 text-white disabled:opacity-50"),children:f?(0,n.jsxs)("div",{className:"flex items-center justify-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing..."]}):S?"Loading...":t?"⚠️ Yes, Delete ".concat(e," Notes"):"Yes, Cancel Subscription"})]}),t&&(0,n.jsxs)("p",{className:"text-xs text-red-600 text-center mt-2",children:["⚠️ This will permanently delete ",e," of your notes"]})]})})},{})]})}},7124:function(e,t,s){"use strict";s.d(t,{SupabaseProvider:function(){return x},$:function(){return m}});var n=s(7437),r=s(2265),a=s(5526);async function i(e){try{console.log("[DB] Checking if notes tables exist...");let t=await o(e),s=await l(e),n=await c(e);return t&&s&&n}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function o(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:t}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_text_notes_table",{});if(t)throw console.error("[DB] Error creating text_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function l(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:t}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_file_notes_table",{});if(t)throw console.error("[DB] Error creating file_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:t}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_youtube_notes_table",{});if(t)throw console.error("[DB] Error creating youtube_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function d(){console.log("[DB] Initializing database tables...");try{if(await i(a.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await o(a.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let t=await l(a.supabase);console.log("[DB] File notes table initialization:",t?"success":"failed");let s=await c(a.supabase);return console.log("[DB] YouTube notes table initialization:",s?"success":"failed"),e||t||s}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let u=(0,r.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:a.supabase});function x(e){let{children:t}=e,[s,i]=(0,r.useState)(null),[o,l]=(0,r.useState)(null),[c,x]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(0),b=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:t}=await a.supabase.auth.refreshSession();if(t)return console.error("[Auth] Error refreshing session:",t.message),h(t.message),g(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),l(e.session),i(e.session.user),h(null),g(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),l(null),i(null),g(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),h(e instanceof Error?e.message:"Unknown error during session refresh"),g(Date.now()),null}};return(0,r.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),x(!0);let{data:t,error:s}=await a.supabase.auth.getSession();if(s){console.error("[Auth] Error getting session:",s.message),e&&(h(s.message),x(!1));return}(null==t?void 0:t.session)?(console.log("[Auth] Initial session found for user:",{id:t.session.user.id,email:t.session.user.email,expires:new Date(1e3*t.session.expires_at).toISOString()}),e&&(l(t.session),i(t.session.user),d().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(l(null),i(null))),e&&x(!1)}catch(t){console.error("[Auth] Unexpected error during auth initialization:",t),e&&(h(t instanceof Error?t.message:"Unknown error during auth initialization"),x(!1))}})();let{data:{subscription:t}}=a.supabase.auth.onAuthStateChange((t,s)=>{console.log("[Auth] Auth state change detected: ".concat(t)),e&&(s?(console.log("[Auth] New session established for user:",{id:s.user.id,email:s.user.email,expires:new Date(1e3*s.expires_at).toISOString()}),l(s),i(s.user),h(null)):(console.log("[Auth] Session cleared"),l(null),i(null)),x(!1))});return()=>{e=!1,t.unsubscribe()}},[p]),(0,n.jsx)(u.Provider,{value:{user:s,session:o,isLoading:c,sessionError:m,refreshSession:b,supabase:a.supabase},children:t})}let m=()=>{let e=(0,r.useContext)(u);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,t,s){"use strict";s.d(t,{supabase:function(){return r}});var n=s(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let r=(0,n.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,142,971,117,744],function(){return e(e.s=2997)}),_N_E=e.O()}]);