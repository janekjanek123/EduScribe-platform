(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{4654:function(){},2997:function(e,t,s){Promise.resolve().then(s.bind(s,5620))},5620:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(7437),a=s(2265),n=s(9376),o=s(7124);s(9142);var i=s(5566);i.env.STRIPE_STUDENT_MONTHLY_PRICE_ID,i.env.STRIPE_STUDENT_YEARLY_PRICE_ID,i.env.STRIPE_PRO_MONTHLY_PRICE_ID,i.env.STRIPE_PRO_YEARLY_PRICE_ID;let l=[{id:"free",name:"free",display_name:"Free",description:"Basic note generation for students",price_monthly:0,price_yearly:0,currency:"PLN",features:{notes_generation:!0,quizzes:!1,youtube_support:!0,ppt_support:!1,export:!1,copy_paste:!0,upload_video:!1,priority_generation:!1},limits:{notes_per_month:2,max_saved_notes:3,max_text_length:5e3},is_active:!0},{id:"student",name:"student",display_name:"Student",description:"Perfect for students with enhanced features",price_monthly:24.99,price_yearly:224.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!1},limits:{notes_per_month:10,max_saved_notes:12,max_text_length:1e4},is_active:!0},{id:"pro",name:"pro",display_name:"Pro",description:"Ultimate plan for power users and professionals",price_monthly:49.99,price_yearly:449.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!0},limits:{notes_per_month:-1,max_saved_notes:50,max_text_length:15e3},is_active:!0}];function c(){var e;let t=(0,n.useRouter)(),{user:s,supabase:i}=(0,o.$)(),[c]=(0,a.useState)(l),[u,d]=(0,a.useState)("free"),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)("monthly"),[m,b]=(0,a.useState)(!1),[y,f]=(0,a.useState)(!1),[_,v]=(0,a.useState)(!0),[w,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(!s||!i){d("free"),v(!1);return}try{console.log("[Pricing] Fetching subscription for user:",s.id);let{data:e,error:t}=await i.from("user_subscriptions").select("*").eq("user_id",s.id).eq("status","active").single();t?("PGRST116"===t.code?console.log("[Pricing] No active subscription found, user is on free plan"):console.error("[Pricing] Error fetching subscription:",t),d("free"),p(null)):e&&(console.log("[Pricing] Active subscription found:",e),d(e.plan_id),p(e),g(e.billing_cycle))}catch(e){console.error("[Pricing] Unexpected error fetching subscription:",e),d("free"),p(null)}finally{v(!1)}})()},[s,i]);let j=async e=>{if(!s){t.push("/?signup=true");return}if("free"===e){h?N(!0):t.push("/dashboard");return}if(e!==u){b(!0);try{let{data:{session:t}}=await i.auth.getSession();if(!(null==t?void 0:t.access_token))throw Error("No valid session found. Please sign in again.");let s=await fetch("/api/stripe/checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({planId:e,billingCycle:x})}),r=await s.json();if(!s.ok)throw Error(r.error||"Failed to create checkout session");if(r.url)window.location.href=r.url;else throw Error("No checkout URL received")}catch(e){console.error("Error creating checkout session:",e),alert("Failed to start checkout process. Please try again.")}finally{b(!1)}}},C=async()=>{if(h&&s){f(!0);try{let{data:{session:e}}=await i.auth.getSession();if(!(null==e?void 0:e.access_token))throw Error("No valid session found. Please sign in again.");let t=await fetch("/api/stripe/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({subscriptionId:h.stripe_subscription_id})}),s=await t.json();if(!t.ok)throw Error(s.error||"Failed to cancel subscription");p({...h,cancel_at_period_end:!0}),N(!1),alert("Your subscription has been cancelled. You will retain access until the end of your current billing period, then be switched to the Free plan.")}catch(e){console.error("Error cancelling subscription:",e),alert("Failed to cancel subscription. Please try again or contact support.")}finally{f(!1)}}},S=e=>"".concat(e.toFixed(2)," ").concat(l[0].currency),D=e=>{let t=e.price_monthly,s=e.price_yearly,r=s/12;return{monthly:t,yearly:s,yearlyMonthlyEquivalent:r,discountPercentage:t>0?Math.round((1-r/t)*100):0,yearlySavings:12*t-s,currency:e.currency}},P=e=>{let t=[];-1===e.limits.notes_per_month?t.push({text:"Unlimited notes per month",available:!0}):t.push({text:"".concat(e.limits.notes_per_month," notes per month"),available:!0}),t.push({text:"".concat(e.limits.max_saved_notes," saved notes"),available:!0});let s=e.limits.max_text_length.toLocaleString();return t.push({text:"".concat(s," character limit per note"),available:!0}),t.push({text:"Generate quizzes",available:e.features.quizzes}),t.push({text:"PPT uploads",available:e.features.ppt_support}),t.push({text:"YouTube to Notes",available:e.features.youtube_support}),t.push({text:"Upload Video to Notes",available:e.features.upload_video}),t.push({text:"Export to Notepad",available:e.features.export}),e.features.priority_generation?t.push({text:"Highest processing priority",available:!0}):"student"===e.id?t.push({text:"Medium processing priority",available:!0}):t.push({text:"Lowest processing priority",available:!0}),t},E=e=>{let t=u===e.id,s=h&&"active"===h.status;return m?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating checkout..."]}):y&&"free"===e.id?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Cancelling..."]}):t?(null==h?void 0:h.cancel_at_period_end)?"Cancelling at Period End":"Current Plan":"free"===e.id&&s?"Cancel Subscription":"free"===e.id?"Get Started Free":"Choose Plan"},k=e=>u===e.id||m||y||_;return _?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading subscription information..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Choose Your Plan"}),(0,r.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:"Unlock the full potential of AI-powered note generation"}),s&&h&&(0,r.jsxs)("div",{className:"mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg max-w-md mx-auto",children:[(0,r.jsxs)("p",{className:"text-blue-800",children:[(0,r.jsx)("strong",{children:"Current Plan:"})," ",(null===(e=l.find(e=>e.id===u))||void 0===e?void 0:e.display_name)||"Unknown"]}),h.cancel_at_period_end&&(0,r.jsxs)("p",{className:"text-orange-600 text-sm mt-1",children:["Subscription will end on ",new Date(h.current_period_end).toLocaleDateString()]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center mb-8",children:[(0,r.jsx)("span",{className:"mr-3 ".concat("monthly"===x?"text-gray-900 font-medium":"text-gray-500"),children:"Monthly"}),(0,r.jsx)("button",{onClick:()=>g("monthly"===x?"yearly":"monthly"),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 bg-blue-600",children:(0,r.jsx)("span",{className:"pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition duration-200 ease-in-out ".concat("yearly"===x?"translate-x-5":"translate-x-0")})}),(0,r.jsx)("span",{className:"ml-3 ".concat("yearly"===x?"text-gray-900 font-medium":"text-gray-500"),children:"Yearly"}),"yearly"===x&&(0,r.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:"Save up to 25%"})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:c.map(e=>{let t=D(e),s=P(e),a=u===e.id,n="yearly"===x?t.yearly:t.monthly,o="yearly"===x?t.yearlyMonthlyEquivalent:t.monthly,i="pro"===e.id?{borderClass:"border-purple-500 border-2",textClass:"text-purple-600",buttonClass:"bg-purple-600 hover:bg-purple-700"}:"student"===e.id?{borderClass:"border-blue-500 border-2",textClass:"text-blue-600",buttonClass:"bg-blue-600 hover:bg-blue-700"}:{borderClass:"border-gray-200",textClass:"text-gray-600",buttonClass:"bg-gray-600 hover:bg-gray-700"};return(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-8 ".concat(i.borderClass," ").concat(a?"ring-2 ring-blue-500":""),children:["student"===e.id&&(0,r.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,r.jsx)("span",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-medium",children:"Most Popular"})}),a&&(0,r.jsx)("div",{className:"absolute -top-3 -right-3",children:(0,r.jsx)("span",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:"Current Plan"})}),(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold ".concat(i.textClass," mb-2"),children:e.display_name}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,r.jsx)("div",{className:"mb-4",children:0===e.price_monthly?(0,r.jsx)("div",{className:"text-4xl font-bold text-gray-900",children:"Free"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-4xl font-bold text-gray-900",children:[S(n),"yearly"===x&&(0,r.jsx)("span",{className:"text-lg font-normal text-gray-600",children:"/year"}),"monthly"===x&&(0,r.jsx)("span",{className:"text-lg font-normal text-gray-600",children:"/month"})]}),"yearly"===x&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[S(o),"/month when billed annually"]}),"yearly"===x&&t.discountPercentage>0&&(0,r.jsxs)("div",{className:"text-sm text-green-600 font-medium",children:["Save ",S(t.yearlySavings)," per year"]})]})})]}),(0,r.jsx)("ul",{className:"space-y-3 mb-8",children:s.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-start",children:[e.available?(0,r.jsx)("span",{className:"text-green-500 text-xl mr-3 mt-0.5 flex-shrink-0",children:"✅"}):(0,r.jsx)("span",{className:"text-red-500 text-xl mr-3 mt-0.5 flex-shrink-0",children:"❌"}),(0,r.jsx)("span",{className:"text-gray-700 ".concat(e.available?"":"line-through text-gray-400"),children:e.text})]},t))}),(0,r.jsx)("button",{onClick:()=>{"free"===e.id&&h&&"active"===h.status?N(!0):j(e.id)},disabled:k(e),className:"w-full py-3 px-6 rounded-lg font-medium transition-colors ".concat(k(e)?"bg-gray-100 text-gray-500 cursor-not-allowed":"free"===e.id&&h&&"active"===h.status?"bg-red-600 hover:bg-red-700 text-white":"".concat(i.buttonClass," text-white")),children:E(e)})]},e.id)})}),(0,r.jsxs)("div",{className:"mt-16 max-w-4xl mx-auto",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-8",children:"Frequently Asked Questions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Can I change my plan anytime?"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Yes, you can upgrade or downgrade your plan at any time. Changes take effect immediately for upgrades and at the end of your billing cycle for downgrades."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"What happens if I exceed my limits?"}),(0,r.jsx)("p",{className:"text-gray-600",children:"If you reach your monthly note generation limit, you'll need to upgrade your plan or wait until the next billing cycle. Your saved notes remain accessible."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Is there a free trial?"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Our Free plan allows you to try EduScribe with 2 notes per month. You can upgrade anytime to unlock more features and higher limits."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"How does billing work?"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You'll be charged at the beginning of each billing cycle. Annual plans offer significant savings compared to monthly billing."})]})]})]}),(0,r.jsx)("div",{className:"text-center mt-12",children:(0,r.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"← Back to Dashboard"})})]}),(0,r.jsx)(()=>w?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Cancel Subscription"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to cancel your current subscription and switch to the Free plan?"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"You will retain access to your current plan until the end of your billing period."}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("button",{onClick:()=>N(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:y,children:"Keep Subscription"}),(0,r.jsx)("button",{onClick:C,disabled:y,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:y?"Cancelling...":"Cancel Subscription"})]})]})}):null,{})]})}},7124:function(e,t,s){"use strict";s.d(t,{SupabaseProvider:function(){return h},$:function(){return p}});var r=s(7437),a=s(2265),n=s(5526);async function o(e){try{console.log("[DB] Checking if notes tables exist...");let t=await i(e),s=await l(e),r=await c(e);return t&&s&&r}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function i(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:t}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_text_notes_table",{});if(t)throw console.error("[DB] Error creating text_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function l(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:t}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_file_notes_table",{});if(t)throw console.error("[DB] Error creating file_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:t}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_youtube_notes_table",{});if(t)throw console.error("[DB] Error creating youtube_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function u(){console.log("[DB] Initializing database tables...");try{if(await o(n.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await i(n.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let t=await l(n.supabase);console.log("[DB] File notes table initialization:",t?"success":"failed");let s=await c(n.supabase);return console.log("[DB] YouTube notes table initialization:",s?"success":"failed"),e||t||s}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let d=(0,a.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:n.supabase});function h(e){let{children:t}=e,[s,o]=(0,a.useState)(null),[i,l]=(0,a.useState)(null),[c,h]=(0,a.useState)(!0),[p,x]=(0,a.useState)(null),[g,m]=(0,a.useState)(0),b=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:t}=await n.supabase.auth.refreshSession();if(t)return console.error("[Auth] Error refreshing session:",t.message),x(t.message),m(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),l(e.session),o(e.session.user),x(null),m(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),l(null),o(null),m(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),x(e instanceof Error?e.message:"Unknown error during session refresh"),m(Date.now()),null}};return(0,a.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),h(!0);let{data:t,error:s}=await n.supabase.auth.getSession();if(s){console.error("[Auth] Error getting session:",s.message),e&&(x(s.message),h(!1));return}(null==t?void 0:t.session)?(console.log("[Auth] Initial session found for user:",{id:t.session.user.id,email:t.session.user.email,expires:new Date(1e3*t.session.expires_at).toISOString()}),e&&(l(t.session),o(t.session.user),u().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(l(null),o(null))),e&&h(!1)}catch(t){console.error("[Auth] Unexpected error during auth initialization:",t),e&&(x(t instanceof Error?t.message:"Unknown error during auth initialization"),h(!1))}})();let{data:{subscription:t}}=n.supabase.auth.onAuthStateChange((t,s)=>{console.log("[Auth] Auth state change detected: ".concat(t)),e&&(s?(console.log("[Auth] New session established for user:",{id:s.user.id,email:s.user.email,expires:new Date(1e3*s.expires_at).toISOString()}),l(s),o(s.user),x(null)):(console.log("[Auth] Session cleared"),l(null),o(null)),h(!1))});return()=>{e=!1,t.unsubscribe()}},[g]),(0,r.jsx)(d.Provider,{value:{user:s,session:i,isLoading:c,sessionError:p,refreshSession:b,supabase:n.supabase},children:t})}let p=()=>{let e=(0,a.useContext)(d);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,t,s){"use strict";s.d(t,{supabase:function(){return a}});var r=s(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let a=(0,r.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,142,971,117,744],function(){return e(e.s=2997)}),_N_E=e.O()}]);