(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{4654:function(){},2997:function(e,t,r){Promise.resolve().then(r.bind(r,5620))},5620:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(7437),s=r(2265),n=r(9376),o=r(3949),i=r(7124);r(9142);var l=r(5566);l.env.STRIPE_STUDENT_MONTHLY_PRICE_ID,l.env.STRIPE_STUDENT_YEARLY_PRICE_ID,l.env.STRIPE_PRO_MONTHLY_PRICE_ID,l.env.STRIPE_PRO_YEARLY_PRICE_ID;let c=[{id:"free",name:"free",display_name:"Free",description:"Basic note generation for students",price_monthly:0,price_yearly:0,currency:"PLN",features:{notes_generation:!0,quizzes:!1,youtube_support:!0,ppt_support:!1,export:!1,copy_paste:!0,upload_video:!1,priority_generation:!1},limits:{notes_per_month:2,max_saved_notes:3,max_text_length:5e3},is_active:!0},{id:"student",name:"student",display_name:"Student",description:"Perfect for students with enhanced features",price_monthly:24.99,price_yearly:224.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!1},limits:{notes_per_month:10,max_saved_notes:12,max_text_length:1e4},is_active:!0},{id:"pro",name:"pro",display_name:"Pro",description:"Ultimate plan for power users and professionals",price_monthly:49.99,price_yearly:449.99,currency:"PLN",features:{notes_generation:!0,quizzes:!0,youtube_support:!0,ppt_support:!0,export:!0,copy_paste:!0,upload_video:!0,priority_generation:!0},limits:{notes_per_month:-1,max_saved_notes:50,max_text_length:15e3},is_active:!0}],d=e=>{let{message:t,type:r,onClose:n}=e;return(0,s.useEffect)(()=>{let e=setTimeout(()=>{n()},5e3);return()=>clearTimeout(e)},[n]),(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-in slide-in-from-top duration-300",children:(0,a.jsxs)("div",{className:"".concat("success"===r?"bg-green-600":"error"===r?"bg-red-600":"bg-blue-600"," text-white px-6 py-4 rounded-lg shadow-lg max-w-md flex items-center space-x-3"),children:[(0,a.jsx)("span",{className:"text-lg",children:"success"===r?"✅":"error"===r?"❌":"ℹ️"}),(0,a.jsx)("p",{className:"font-medium",children:t}),(0,a.jsx)("button",{onClick:n,className:"ml-4 text-white hover:text-gray-200 font-bold text-lg",children:"\xd7"})]})})};function u(){var e;let{t}=(0,o.$G)(),r=(0,n.useRouter)(),{user:l,supabase:u}=(0,i.$)(),[p]=(0,s.useState)(c),[g,x]=(0,s.useState)("free"),[m,h]=(0,s.useState)(null),[b,f]=(0,s.useState)("monthly"),[y,v]=(0,s.useState)(!1),[_,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(!0),[P,S]=(0,s.useState)(!1),[k,D]=(0,s.useState)(0),[E,C]=(0,s.useState)(!1),[B,I]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(!l||!u){x("free"),N(!1);return}try{console.log("[Pricing] Fetching user subscription for:",l.id);let{data:e,error:t}=await u.from("user_subscriptions").select("\n            plan_id,\n            billing_cycle,\n            status,\n            stripe_subscription_id,\n            current_period_end,\n            cancel_at_period_end,\n            subscription_plans (\n              display_name\n            )\n          ").eq("user_id",l.id).order("created_at",{ascending:!1}).limit(1).single();t?(console.log("[Pricing] No subscription found:",t.message),x("free"),h(null)):(console.log("[Pricing] Found subscription:",e),console.log("[Pricing] Subscription details:",{plan_id:e.plan_id,billing_cycle:e.billing_cycle,status:e.status,stripe_subscription_id:e.stripe_subscription_id,current_period_end:e.current_period_end,cancel_at_period_end:e.cancel_at_period_end}),"active"===e.status||"trialing"===e.status||e.cancel_at_period_end&&new Date(e.current_period_end)>new Date?(x(e.plan_id),h(e),console.log("[Pricing] Set as current plan:",e.plan_id)):(console.log("[Pricing] Subscription not active:",{status:e.status,cancel_at_period_end:e.cancel_at_period_end,current_period_end:e.current_period_end}),x("free"),h(e),console.log("[Pricing] Set as free plan but keeping subscription data for cancellation")))}catch(e){console.error("[Pricing] Error fetching subscription:",e),x("free"),h(null)}finally{N(!1)}})()},[l,u]),(0,s.useEffect)(()=>{P&&l&&(console.log("[Pricing] Cancel modal opened, refreshing notes count..."),T())},[P,l]);let T=async()=>{if(!l||!u)return 0;C(!0);try{let{data:{session:e}}=await u.auth.getSession(),t=null==e?void 0:e.access_token;if(!t)throw Error("No authentication token available");console.log("[Pricing] Fetching accurate notes count for user:",l.id);let[r,a,s,n]=await Promise.all([fetch("/api/video-notes",{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),fetch("/api/file-notes",{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),fetch("/api/text-notes",{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),fetch("/api/upload-video",{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})]),o=0;if(r.ok){let e=await r.json();e.success&&e.data&&(o+=e.data.length,console.log("[Pricing] Video notes count:",e.data.length))}if(n.ok){let e=await n.json();e.success&&e.data&&(o+=e.data.length,console.log("[Pricing] Upload video notes count:",e.data.length))}if(a.ok){let e=await a.json();e.success&&e.data&&(o+=e.data.length,console.log("[Pricing] File notes count:",e.data.length))}if(s.ok){let e=await s.json();e.success&&e.data&&(o+=e.data.length,console.log("[Pricing] Text notes count:",e.data.length))}return console.log("[Pricing] Total accurate notes count:",o),D(o),o}catch(e){console.error("[Pricing] Error fetching notes count:",e);try{let[e,t,r]=await Promise.all([u.from("text_notes").select("id",{count:"exact"}).eq("user_id",l.id),u.from("file_notes").select("id",{count:"exact"}).eq("user_id",l.id),u.from("video_notes").select("id",{count:"exact"}).eq("user_id",l.id)]),a=(e.count||0)+(t.count||0)+(r.count||0);return console.log("[Pricing] Fallback notes count:",a),D(a),a}catch(e){return console.error("[Pricing] Fallback counting also failed:",e),D(0),0}}finally{C(!1)}},z=async e=>{if(!l){r.push("/?signup=true");return}if("free"===e){m?(await T(),S(!0)):r.push("/dashboard");return}if(e!==g){v(!0);try{let{data:{session:t}}=await u.auth.getSession();if(!(null==t?void 0:t.access_token))throw Error("No valid session found. Please sign in again.");let r=await fetch("/api/stripe/checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({planId:e,billingCycle:b})}),a=await r.json();if(!r.ok)throw Error(a.error||"Failed to create checkout session");if(a.url)window.location.href=a.url;else throw Error("No checkout URL received")}catch(e){console.error("Error creating checkout session:",e),alert("Failed to start checkout process. Please try again.")}finally{v(!1)}}},A=async()=>{if(!m||!l){console.error("[Pricing] Cannot cancel - missing data:",{hasUserSubscription:!!m,hasUser:!!l,userSubscription:m});return}console.log("[Pricing] Starting cancellation process:",{userId:l.id,subscriptionId:m.stripe_subscription_id,planId:m.plan_id,status:m.status,fullUserSubscription:m}),j(!0);try{let{data:{session:e}}=await u.auth.getSession();if(!(null==e?void 0:e.access_token))throw Error("No valid session found. Please sign in again.");let r=m.stripe_subscription_id;if("object"==typeof r&&r&&r.id&&(r=r.id),"string"==typeof r&&r.startsWith("{"))try{let e=JSON.parse(r);e.id&&(r=e.id)}catch(e){console.error("[Pricing] Failed to parse subscription ID JSON:",e)}console.log("[Pricing] Original subscription ID:",m.stripe_subscription_id),console.log("[Pricing] Extracted subscription ID:",r),console.log("[Pricing] Request payload:",{subscriptionId:r}),console.log("[Pricing] Cancelling subscription:",r);let a=await fetch("/api/stripe/cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({subscriptionId:r})});console.log("[Pricing] Response status:",a.status),console.log("[Pricing] Response ok:",a.ok);let s=await a.json();if(console.log("[Pricing] Cancellation response:",s),!a.ok){console.error("[Pricing] Cancellation failed:",{status:a.status,statusText:a.statusText,data:s});let e="Failed to cancel subscription";throw s.error&&(e=s.error),s.details&&s.details!==s.error&&(e+="\n\nDetails: ".concat(s.details)),s.stripeErrorType&&(e+="\n\nStripe Error: ".concat(s.stripeErrorType)),s.stripeErrorCode&&(e+=" (".concat(s.stripeErrorCode,")")),Error(e)}h(null),x("free"),S(!1),I({message:t("pricing.cancelModal.successMessage"),type:"info"})}catch(e){console.error("[Pricing] Error cancelling subscription:",e),I({message:t("pricing.cancelModal.errorMessage",{error:e.message}),type:"error"})}finally{j(!1)}},R=e=>"".concat(e.toFixed(2)," ").concat(c[0].currency),q=e=>{let t=e.price_monthly,r=e.price_yearly,a=r/12;return{monthly:t,yearly:r,yearlyMonthlyEquivalent:a,discountPercentage:t>0?Math.round((1-a/t)*100):0,yearlySavings:12*t-r,currency:e.currency}},F=e=>{let r=[];return -1===e.limits.notes_per_month?r.push({text:t("pricing.features.unlimited")+" "+t("pricing.features.notesGeneration"),available:!0}):r.push({text:"".concat(e.limits.notes_per_month," ").concat(t("pricing.features.notesGeneration")),available:!0}),r.push({text:"".concat(e.limits.max_saved_notes," ").concat(t("pricing.features.savedNotes")),available:!0}),r.push({text:t("pricing.features.characterLimit",{limit:e.limits.max_text_length.toLocaleString()}),available:!0}),r.push({text:t("pricing.features.quizzes"),available:e.features.quizzes}),r.push({text:t("pricing.features.pptUploads"),available:e.features.ppt_support}),r.push({text:t("pricing.features.youtubeSupport"),available:e.features.youtube_support}),r.push({text:t("pricing.features.uploadVideo"),available:e.features.upload_video}),r.push({text:t("pricing.features.exportNotepad"),available:e.features.export}),e.features.priority_generation?r.push({text:t("pricing.features.highestPriority"),available:!0}):"student"===e.id?r.push({text:t("pricing.features.mediumPriority"),available:!0}):r.push({text:t("pricing.features.lowestPriority"),available:!0}),r},M=e=>{let r=g===e.id,s=m&&"active"===m.status;return y?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("pricing.buttons.creatingCheckout")]}):_&&"free"===e.id?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("pricing.buttons.cancelling")]}):r?(null==m?void 0:m.cancel_at_period_end)?t("pricing.buttons.cancellingAtPeriodEnd"):t("pricing.buttons.currentPlan"):"free"===e.id&&s?t("pricing.buttons.cancelSubscription"):"free"===e.id?t("pricing.buttons.getStartedFree"):t("pricing.buttons.choosePlan")},L=e=>g===e.id||y||_||w;return w?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"var(--bg-primary)"},children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full animate-spin mx-auto mb-6",style:{border:"4px solid var(--bg-tertiary)",borderTop:"4px solid var(--color-cta)"}}),(0,a.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading subscription information..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen py-16 px-4 sm:px-6 lg:px-8",style:{background:"var(--bg-primary)"},children:[B&&(0,a.jsx)(d,{message:B.message,type:B.type,onClose:()=>I(null)}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-16",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-6",style:{color:"var(--text-primary)"},children:t("pricing.title")}),(0,a.jsx)("p",{className:"text-xl mb-12",style:{color:"var(--text-secondary)"},children:t("pricing.subtitle")}),l&&m&&(0,a.jsxs)("div",{className:"mb-12 p-6 rounded-2xl max-w-md mx-auto",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--color-cta)",boxShadow:"var(--glow-cta)"},children:[(0,a.jsxs)("p",{style:{color:"var(--color-cta)"},children:[(0,a.jsxs)("strong",{children:[t("pricing.currentPlan"),":"]})," ",(null===(e=c.find(e=>e.id===g))||void 0===e?void 0:e.display_name)||t("pricing.unknown")]}),m.cancel_at_period_end&&(0,a.jsx)("p",{className:"text-sm mt-2",style:{color:"var(--color-video)"},children:t("pricing.subscriptionEndsOn",{date:new Date(m.current_period_end).toLocaleDateString()})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center mb-12",children:[(0,a.jsx)("span",{className:"mr-4 text-lg font-semibold ".concat(""),style:{color:"monthly"===b?"var(--color-cta)":"var(--text-muted)"},children:t("pricing.monthly")}),(0,a.jsx)("button",{onClick:()=>f("monthly"===b?"yearly":"monthly"),className:"relative inline-flex h-8 w-14 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-all duration-300 ease-in-out focus:outline-none transform hover:scale-110",style:{background:"var(--color-cta)",boxShadow:"var(--glow-cta)"},children:(0,a.jsx)("span",{className:"pointer-events-none inline-block h-6 w-6 rounded-full shadow transform ring-0 transition-all duration-300 ease-in-out ".concat("yearly"===b?"translate-x-6":"translate-x-0"),style:{background:"var(--bg-primary)"}})}),(0,a.jsx)("span",{className:"ml-4 text-lg font-semibold ".concat(""),style:{color:"yearly"===b?"var(--color-cta)":"var(--text-muted)"},children:t("pricing.yearly")}),"yearly"===b&&(0,a.jsx)("span",{className:"ml-3 px-3 py-1 text-sm font-semibold rounded-full",style:{background:"var(--color-file)",color:"var(--bg-primary)"},children:t("pricing.saveUpTo")})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:p.map(e=>{let r=q(e),s=F(e),n=g===e.id,o="yearly"===b?r.yearly:r.monthly,i="yearly"===b?r.yearlyMonthlyEquivalent:r.monthly;return"pro"===e.id||e.id,(0,a.jsxs)("div",{className:"relative rounded-2xl p-6 transition-all duration-300 transform hover:scale-102 hover:translate-y-[-2px] ".concat(n?"scale-102":""),style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"2px solid ".concat("pro"===e.id?"var(--color-text)":"student"===e.id?"var(--color-file)":"var(--bg-tertiary)"),boxShadow:n?"var(--glow-cta)":"var(--shadow-lg)"},children:["student"===e.id&&(0,a.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,a.jsx)("span",{className:"px-6 py-2 rounded-full text-sm font-semibold",style:{background:"var(--color-file)",color:"var(--bg-primary)",boxShadow:"var(--glow-file)"},children:t("pricing.mostPopular")})}),n&&(0,a.jsx)("div",{className:"absolute -top-3 -right-3",children:(0,a.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-semibold",style:{background:"var(--color-cta)",color:"var(--bg-primary)",boxShadow:"var(--glow-cta)"},children:t("pricing.currentPlan")})}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-3",style:{color:"pro"===e.id?"var(--color-text)":"student"===e.id?"var(--color-file)":"var(--text-primary)"},children:t("pricing.plans.".concat(e.id,".name"))}),(0,a.jsx)("p",{className:"mb-4 text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:t("pricing.plans.".concat(e.id,".description"))}),(0,a.jsx)("div",{className:"mb-4",children:0===e.price_monthly?(0,a.jsx)("div",{className:"text-3xl font-bold",style:{color:"var(--text-primary)"},children:t("pricing.free")}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-3xl font-bold",style:{color:"var(--text-primary)"},children:[R(o),"yearly"===b&&(0,a.jsxs)("span",{className:"text-lg font-normal",style:{color:"var(--text-secondary)"},children:["/",t("pricing.year")]}),"monthly"===b&&(0,a.jsxs)("span",{className:"text-lg font-normal",style:{color:"var(--text-secondary)"},children:["/",t("pricing.month")]})]}),"yearly"===b&&(0,a.jsxs)("div",{className:"text-sm mt-2",style:{color:"var(--text-secondary)"},children:[R(i),"/",t("pricing.month")," ",t("pricing.whenBilledAnnually")]}),"yearly"===b&&r.discountPercentage>0&&(0,a.jsx)("div",{className:"text-sm font-semibold mt-2",style:{color:"var(--color-file)"},children:t("pricing.saveAmount",{amount:R(r.yearlySavings)})})]})})]}),(0,a.jsx)("ul",{className:"space-y-4 mb-8",children:s.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start",children:[e.available?(0,a.jsx)("span",{className:"text-xl mr-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-cta)"},children:"✅"}):(0,a.jsx)("span",{className:"text-xl mr-4 mt-0.5 flex-shrink-0",style:{color:"#ef4444"},children:"❌"}),(0,a.jsx)("span",{className:"text-base leading-relaxed ".concat(e.available?"":"line-through"),style:{color:e.available?"var(--text-secondary)":"var(--text-muted)"},children:e.text})]},t))}),(0,a.jsx)("button",{onClick:()=>{"free"===e.id&&m&&"active"===m.status?T().then(()=>{S(!0)}):z(e.id)},disabled:L(e),className:"w-full py-4 px-8 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 ".concat(L(e)?"cursor-not-allowed":""),style:{background:L(e)?"var(--bg-tertiary)":"free"===e.id&&m&&"active"===m.status?"linear-gradient(135deg, #ef4444, #dc2626)":"pro"===e.id?"var(--color-text)":"student"===e.id?"var(--color-file)":"var(--color-cta)",color:L(e)?"var(--text-muted)":"var(--bg-primary)",boxShadow:L(e)?"none":"pro"===e.id?"var(--glow-text)":"student"===e.id?"var(--glow-file)":"var(--glow-cta)"},children:M(e)})]},e.id)})}),(0,a.jsxs)("div",{className:"mt-20 max-w-4xl mx-auto",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold text-center mb-12",style:{color:"var(--text-primary)"},children:t("pricing.faq.title")}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--bg-tertiary)",boxShadow:"var(--shadow-md)"},children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-cta)"},children:t("pricing.faq.changePlan.question")}),(0,a.jsx)("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:t("pricing.faq.changePlan.answer")})]}),(0,a.jsxs)("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--bg-tertiary)",boxShadow:"var(--shadow-md)"},children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-file)"},children:t("pricing.faq.exceedLimits.question")}),(0,a.jsx)("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:t("pricing.faq.exceedLimits.answer")})]}),(0,a.jsxs)("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--bg-tertiary)",boxShadow:"var(--shadow-md)"},children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-video)"},children:t("pricing.faq.freeTrial.question")}),(0,a.jsx)("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:t("pricing.faq.freeTrial.answer")})]}),(0,a.jsxs)("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--bg-tertiary)",boxShadow:"var(--shadow-md)"},children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-text)"},children:t("pricing.faq.billing.question")}),(0,a.jsx)("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:t("pricing.faq.billing.answer")})]})]})]}),(0,a.jsx)("div",{className:"text-center mt-16",children:(0,a.jsxs)("button",{onClick:()=>r.push("/dashboard"),className:"px-8 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105",style:{background:"var(--color-cta)",color:"var(--bg-primary)",boxShadow:"var(--glow-cta)"},children:["← ",t("pricing.backToDashboard")]})})]}),(0,a.jsx)(()=>{if(!P)return null;let e=k>3;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-8 max-w-lg mx-4 max-h-[90vh] overflow-y-auto shadow-2xl border-2 border-red-200",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center border-2 border-red-300",children:(0,a.jsx)("span",{className:"text-3xl",children:"⚠️"})})}),(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:t("pricing.cancelModal.title")})]}),(0,a.jsx)("div",{className:"mb-6 text-center",children:(0,a.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-4",children:[(0,a.jsx)("p",{className:"text-red-800 font-medium text-lg leading-relaxed",children:t("pricing.cancelModal.warningMessage")}),(0,a.jsx)("p",{className:"text-red-700 font-semibold mt-2",children:t("pricing.cancelModal.irreversible")})]})}),E?(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-3"}),(0,a.jsx)("span",{className:"text-gray-600 font-medium",children:t("pricing.cancelModal.checkingNotes")})]})}):(0,a.jsx)("div",{className:"rounded-lg p-4 mb-6 border-2 ".concat(e?"bg-red-50 border-red-300":"bg-blue-50 border-blue-300"),children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm ".concat(e?"text-red-700":"text-blue-700"," font-medium"),children:t("pricing.cancelModal.freePlanLimit")}),e&&(0,a.jsx)("div",{className:"text-red-800 font-bold mt-2 text-lg",children:t("pricing.cancelModal.notesWillBeDeleted",{count:Math.max(0,k-3)})})]})})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:()=>S(!1),className:"flex-1 px-6 py-4 border-2 border-gray-300 rounded-lg text-gray-800 hover:bg-gray-50 font-semibold text-lg transition-colors",disabled:_,children:t("pricing.cancelModal.keepSubscription")}),(0,a.jsx)("button",{onClick:A,disabled:_||E,className:"flex-1 px-6 py-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold text-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:_?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("common.loading")]}):E?t("common.loading"):t("pricing.cancelModal.confirmCancel")})]})]})})},{})]})}},7124:function(e,t,r){"use strict";r.d(t,{SupabaseProvider:function(){return p},$:function(){return g}});var a=r(7437),s=r(2265),n=r(5526);async function o(e){try{console.log("[DB] Checking if notes tables exist...");let t=await i(e),r=await l(e),a=await c(e);return t&&r&&a}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function i(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:t}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_text_notes_table",{});if(t)throw console.error("[DB] Error creating text_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function l(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:t}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_file_notes_table",{});if(t)throw console.error("[DB] Error creating file_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:t}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_youtube_notes_table",{});if(t)throw console.error("[DB] Error creating youtube_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function d(){console.log("[DB] Initializing database tables...");try{if(await o(n.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await i(n.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let t=await l(n.supabase);console.log("[DB] File notes table initialization:",t?"success":"failed");let r=await c(n.supabase);return console.log("[DB] YouTube notes table initialization:",r?"success":"failed"),e||t||r}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let u=(0,s.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:n.supabase});function p(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[i,l]=(0,s.useState)(null),[c,p]=(0,s.useState)(!0),[g,x]=(0,s.useState)(null),[m,h]=(0,s.useState)(0),b=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:t}=await n.supabase.auth.refreshSession();if(t)return console.error("[Auth] Error refreshing session:",t.message),x(t.message),h(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),l(e.session),o(e.session.user),x(null),h(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),l(null),o(null),h(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),x(e instanceof Error?e.message:"Unknown error during session refresh"),h(Date.now()),null}};return(0,s.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),p(!0);let{data:t,error:r}=await n.supabase.auth.getSession();if(r){console.error("[Auth] Error getting session:",r.message),e&&(x(r.message),p(!1));return}(null==t?void 0:t.session)?(console.log("[Auth] Initial session found for user:",{id:t.session.user.id,email:t.session.user.email,expires:new Date(1e3*t.session.expires_at).toISOString()}),e&&(l(t.session),o(t.session.user),d().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(l(null),o(null))),e&&p(!1)}catch(t){console.error("[Auth] Unexpected error during auth initialization:",t),e&&(x(t instanceof Error?t.message:"Unknown error during auth initialization"),p(!1))}})();let{data:{subscription:t}}=n.supabase.auth.onAuthStateChange((t,r)=>{console.log("[Auth] Auth state change detected: ".concat(t)),e&&(r?(console.log("[Auth] New session established for user:",{id:r.user.id,email:r.user.email,expires:new Date(1e3*r.expires_at).toISOString()}),l(r),o(r.user),x(null)):(console.log("[Auth] Session cleared"),l(null),o(null)),p(!1))});return()=>{e=!1,t.unsubscribe()}},[m]),(0,a.jsx)(u.Provider,{value:{user:r,session:i,isLoading:c,sessionError:g,refreshSession:b,supabase:n.supabase},children:t})}let g=()=>{let e=(0,s.useContext)(u);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,t,r){"use strict";r.d(t,{supabase:function(){return s}});var a=r(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let s=(0,a.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,949,142,971,117,744],function(){return e(e.s=2997)}),_N_E=e.O()}]);