(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[685],{2145:function(e,s,t){Promise.resolve().then(t.bind(t,7922))},7922:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var n=t(7437),r=t(2265),a=t(9376),i=t(3288);function o(){let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),[t,o]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null),[m,g]=(0,r.useState)("pending"),p=(0,i.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA");(0,r.useEffect)(()=>{(async()=>{try{let{data:{session:e},error:t}=await p.auth.getSession();if(t){console.error("[Payment Success] Error getting session:",t),h("Authentication error. Please sign in again."),u(!1);return}if(!(null==e?void 0:e.user)){console.log("[Payment Success] No authenticated user found"),h("Please sign in to view this page."),u(!1);return}o({id:e.user.id,email:e.user.email||""});let n=null==s?void 0:s.get("session_id");if(!n){h("No session ID found"),u(!1);return}await b(n,e.access_token)}catch(e){console.error("[Payment Success] Error getting user:",e),h(e.message||"Unknown error occurred"),u(!1)}})()},[s]);let b=async(e,s)=>{try{console.log("[Payment Success] Verifying session:",e);let t=await fetch("/api/stripe/verify-session?session_id=".concat(e)),n=await t.json();if(!t.ok)throw Error(n.error||"Failed to verify session");if(console.log("[Payment Success] Session verified:",n.session),c(n.session),"paid"===n.session.payment_status){console.log("[Payment Success] Payment successful, syncing subscription..."),g("syncing");let t=await fetch("/api/stripe/sync-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({sessionId:e})}),n=await t.json();t.ok?(console.log("[Payment Success] Subscription synced successfully:",n),g("success")):(console.error("[Payment Success] Failed to sync subscription:",n.error),g("error"))}}catch(e){console.error("[Payment Success] Error verifying session:",e),h(e.message),g("error")}finally{u(!1)}};if(d)return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"syncing"===m?"Activating your subscription...":"Verifying your payment..."})]})});if(!t)return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please Sign In"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to be signed in to view this page."}),(0,n.jsx)("button",{onClick:()=>e.push("/?signup=true"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700",children:"Sign In / Sign Up"})]})});if(x)return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Verification Failed"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:x}),(0,n.jsx)("button",{onClick:()=>e.push("/pricing"),className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700",children:"Back to Pricing"})]})});let y={student:{notes:"10",saved:"12",chars:"15K"},pro:{notes:"150",saved:"50",chars:"50K+"}};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),"success"===m?(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Subscription Activated Successfully!"}):"error"===m?(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),(0,n.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-yellow-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})}),(0,n.jsx)("p",{className:"text-yellow-800 text-sm",children:"Your payment was successful, but there was an issue activating your subscription. Please contact support if your limits don't update within a few minutes."})]})})]}):(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),l&&(0,n.jsxs)("p",{className:"text-gray-600",children:["Thank you for subscribing to the ",(0,n.jsx)("strong",{children:{student:"Student",pro:"Pro"}[l.metadata.planId]})," plan!"]})]}),l&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your New Plan"}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y[l.metadata.planId].notes}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Notes/Month"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y[l.metadata.planId].saved}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Saved Notes"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y[l.metadata.planId].chars}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Max Text Length"})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Included Features:"}),(0,n.jsx)("ul",{className:"space-y-1",children:({student:["Up to 10 notes per month","Max 12 saved notes","Interactive quizzes enabled","YouTube video support","PowerPoint presentation support","Extended text length (up to 15,000 characters)","Copy-paste note content"],pro:["Unlimited note generation (150 notes/month)","Max 50 saved notes","Full access to quizzes","YouTube and PowerPoint support","Full text length support (50,000+ characters)","Export to PDF and other formats","Priority generation (faster processing)","Copy-paste note content"]})[l.metadata.planId].map((e,s)=>(0,n.jsxs)("li",{className:"flex items-center text-sm text-gray-700",children:[(0,n.jsx)("svg",{className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e]},s))})]})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,n.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Dashboard"}),(0,n.jsx)("button",{onClick:()=>e.push("/generate/text"),className:"flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors",children:"Generate Your First Note"})]})]})]})})}function l(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading..."}),children:(0,n.jsx)(o,{})})}}},function(e){e.O(0,[395,971,117,744],function(){return e(e.s=2145)}),_N_E=e.O()}]);