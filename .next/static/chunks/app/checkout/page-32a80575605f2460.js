(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{4806:function(e,s,t){Promise.resolve().then(t.bind(t,5063))},5063:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(7437),a=t(2265),l=t(9376),n=t(7124);function i(){let e=(0,l.useRouter)(),s=(0,l.useSearchParams)(),{user:t}=(0,n.$)(),[i,o]=(0,a.useState)(null),[c,d]=(0,a.useState)("monthly"),[u,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)("checkout"),[g,b]=(0,a.useState)({firstName:"",lastName:"",email:"",agreeToTerms:!1}),[p,y]=(0,a.useState)({}),[f,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=null==s?void 0:s.get("plan"),r=null==s?void 0:s.get("billing");e&&o(e),r&&d(r),(null==t?void 0:t.email)&&b(e=>({...e,email:t.email||""}))},[s,t]);let N={student:{name:"Student",description:"Perfect for students with enhanced features",price_monthly:19.99,price_yearly:179.99,features:["Up to 10 notes per month","Max 12 saved notes","Interactive quizzes enabled","YouTube video support","PowerPoint presentation support","Extended text length (up to 15,000 characters)","Copy-paste note content"]},pro:{name:"Pro",description:"Ultimate plan for power users and professionals",price_monthly:49.99,price_yearly:449.99,features:["Unlimited note generation (150 notes/month)","Max 50 saved notes","Full access to quizzes","YouTube and PowerPoint support","Full text length support (50,000+ characters)","Export to PDF and other formats","Priority generation (faster processing)","Copy-paste note content"]}},v=()=>{let e={};return g.firstName.trim()||(e.firstName="First name is required"),g.lastName.trim()||(e.lastName="Last name is required"),g.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)||(e.email="Please enter a valid email address"):e.email="Email is required",g.agreeToTerms||(e.agreeToTerms="You must agree to the terms and conditions"),y(e),0===Object.keys(e).length},w=(e,s)=>{b(t=>({...t,[e]:s})),p[e]&&y(s=>({...s,[e]:void 0}))},P=async()=>{if(i&&t){m(!0);try{console.log("Processing payment with PayU:",{plan:i,billing:c,user:t.id,customer:g}),await new Promise(e=>setTimeout(e,2e3)),console.log("Payment successful, assigning subscription...");let e=await fetch("/api/assign-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:i,billingCycle:c,paymentData:{paymentMethod:"payu",transactionId:"test_".concat(Date.now()),amount:D,currency:"PLN"}})}),s=await e.json();if(!e.ok||!s.success)throw Error(s.error||"Failed to assign subscription");console.log("Subscription assigned successfully:",s.subscription),h("success"),j(s.subscription)}catch(e){console.error("Payment or subscription assignment error:",e),alert("Payment failed or subscription assignment error. Please try again.")}finally{m(!1)}}};if(!t)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please Sign In"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to be signed in to upgrade your plan."}),(0,r.jsx)("button",{onClick:()=>e.push("/?signup=true"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700",children:"Sign In / Sign Up"})]})});if(!i||!N[i])return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid Plan"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"The selected plan is not valid."}),(0,r.jsx)("button",{onClick:()=>e.push("/pricing"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700",children:"View Pricing Plans"})]})});let k=N[i],D="yearly"===c?k.price_yearly:k.price_monthly,C="yearly"===c?k.price_yearly/12:k.price_monthly,_="yearly"===c?12*k.price_monthly-k.price_yearly:0;return"success"===x?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),(0,r.jsxs)("p",{className:"text-lg text-gray-600 mb-4",children:["Welcome to EduScribe ",k.name,"! Your subscription is now active."]})]}),f&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-4",children:"Your Subscription Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-800",children:"Plan"}),(0,r.jsx)("div",{className:"text-blue-700",children:f.plan_display_name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-800",children:"Billing"}),(0,r.jsx)("div",{className:"text-blue-700 capitalize",children:f.billing_cycle})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-800",children:"Status"}),(0,r.jsx)("div",{className:"text-blue-700",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-blue-800",children:"Next Billing Date"}),(0,r.jsx)("div",{className:"text-blue-700",children:new Date(f.current_period_end).toLocaleDateString()})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"You now have access to:"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.features.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-green-500 mr-3 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),(0,r.jsx)("span",{className:"text-gray-700",children:e})]},s))})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-900 mb-4",children:"Your New Limits"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"student"===i?"10":"pro"===i?"150":"?"}),(0,r.jsx)("div",{className:"text-sm text-green-700",children:"Notes per month"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"student"===i?"12":"pro"===i?"50":"?"}),(0,r.jsx)("div",{className:"text-sm text-green-700",children:"Saved notes"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"student"===i?"15K":"pro"===i?"50K+":"?"}),(0,r.jsx)("div",{className:"text-sm text-green-700",children:"Characters per note"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Start Creating Notes →"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsx)("button",{onClick:()=>e.push("/generate/text"),className:"w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors",children:"Generate Text Notes"}),(0,r.jsx)("button",{onClick:()=>e.push("/generate/youtube"),className:"w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors",children:"YouTube Video Notes"})]})]}),(0,r.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200 text-center text-sm text-gray-500",children:(0,r.jsx)("p",{children:"Need help getting started? Contact our support team or check out the user guide."})})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,r.jsxs)("div",{className:"flex items-center ".concat("checkout"===x?"text-blue-600":"text-green-600"),children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("checkout"===x?"bg-blue-600 text-white":"bg-green-600 text-white"),children:"checkout"===x?"1":"✓"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:"Checkout Details"})]}),(0,r.jsx)("div",{className:"w-16 h-1 ".concat("payment"===x?"bg-blue-600":"bg-gray-300")}),(0,r.jsxs)("div",{className:"flex items-center ".concat("payment"===x?"text-blue-600":"text-gray-400"),children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("payment"===x?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"),children:"2"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:"Payment"})]})]})}),(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"checkout"===x?"Complete Your Order":"Payment Details"}),(0,r.jsx)("p",{className:"text-gray-600",children:"checkout"===x?"You're subscribing to the ".concat(k.name," plan"):"Complete your payment to activate your subscription"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:"checkout"===x?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),(0,r.jsx)("input",{type:"text",value:g.firstName,onChange:e=>w("firstName",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(p.firstName?"border-red-500":"border-gray-300"),placeholder:"Enter your first name"}),p.firstName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:p.firstName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),(0,r.jsx)("input",{type:"text",value:g.lastName,onChange:e=>w("lastName",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(p.lastName?"border-red-500":"border-gray-300"),placeholder:"Enter your last name"}),p.lastName&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:p.lastName})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,r.jsx)("input",{type:"email",value:g.email,onChange:e=>w("email",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(p.email?"border-red-500":"border-gray-300"),placeholder:"Enter your email address"}),p.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:p.email})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Billing Option"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("button",{onClick:()=>d("monthly"),className:"p-4 rounded-lg border text-left transition-colors ".concat("monthly"===c?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)("div",{className:"font-medium",children:"Monthly Billing"}),(0,r.jsxs)("div",{className:"text-sm",children:[k.price_monthly.toFixed(2)," PLN/month"]})]}),(0,r.jsxs)("button",{onClick:()=>d("yearly"),className:"p-4 rounded-lg border text-left transition-colors relative ".concat("yearly"===c?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)("div",{className:"font-medium",children:"Yearly Billing"}),(0,r.jsxs)("div",{className:"text-sm",children:[k.price_yearly.toFixed(2)," PLN/year"]}),(0,r.jsx)("span",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"Save 25%"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-start space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",checked:g.agreeToTerms,onChange:e=>w("agreeToTerms",e.target.checked),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsxs)("span",{className:"text-sm text-gray-700",children:["I agree to the"," ",(0,r.jsx)("a",{href:"/terms",className:"text-blue-600 hover:underline",children:"Terms of Service"})," ","and"," ",(0,r.jsx)("a",{href:"/privacy",className:"text-blue-600 hover:underline",children:"Privacy Policy"})]})]}),p.agreeToTerms&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:p.agreeToTerms})]}),(0,r.jsx)("button",{onClick:()=>{v()&&h("payment")},className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Proceed to Payment"})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Method"}),(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsx)("div",{className:"p-4 border border-blue-500 bg-blue-50 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"radio",checked:!0,readOnly:!0,className:"w-4 h-4 text-blue-600"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:"PayU Payment Gateway"}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Credit card, debit card, bank transfer, and more"})]})]})})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Customer Details"}),(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Name:"})," ",g.firstName," ",g.lastName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",g.email]})]})})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:P,disabled:u,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Processing Payment..."})]}):"Complete Payment - ".concat(D.toFixed(2)," PLN")}),(0,r.jsx)("button",{onClick:()=>h("checkout"),className:"w-full border border-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-50 transition-colors",children:"← Back to Checkout"})]}),(0,r.jsx)("div",{className:"text-center text-sm text-gray-500",children:(0,r.jsx)("p",{children:"\uD83D\uDD12 Payments are securely processed by PayU"})})]})})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 sticky top-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,r.jsxs)("div",{className:"border-b border-gray-200 pb-4 mb-4",children:[(0,r.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium text-gray-900",children:[k.name," Plan"]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:k.description})]})}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[D.toFixed(2)," PLN"]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"yearly"===c?"/year":"/month"}),"yearly"===c&&(0,r.jsxs)("div",{className:"text-sm text-green-600 font-medium",children:[C.toFixed(2)," PLN/month"]})]})]}),_>0&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm text-green-800",children:[(0,r.jsxs)("strong",{children:["You save ",_.toFixed(2)," PLN"]})," with yearly billing!"]})}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"What's included:"}),(0,r.jsxs)("ul",{className:"space-y-1",children:[k.features.slice(0,4).map((e,s)=>(0,r.jsxs)("li",{className:"flex items-start text-sm",children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),(0,r.jsx)("span",{className:"text-gray-700",children:e})]},s)),k.features.length>4&&(0,r.jsxs)("li",{className:"text-sm text-gray-500 ml-6",children:["+",k.features.length-4," more features"]})]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center text-lg font-semibold text-gray-900",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:[D.toFixed(2)," PLN"]})]})})]})})]}),(0,r.jsx)("div",{className:"text-center mt-8",children:(0,r.jsx)("button",{onClick:()=>e.push("/pricing"),className:"text-blue-600 hover:text-blue-800 hover:underline",children:"← Back to Pricing"})})]})})}function o(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"var(--bg-primary)"},children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-20 h-20 rounded-full animate-spin mx-auto mb-6",style:{border:"4px solid var(--bg-tertiary)",borderTop:"4px solid var(--color-cta)"}}),(0,r.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading checkout..."})]})}),children:(0,r.jsx)(i,{})})}},7124:function(e,s,t){"use strict";t.d(s,{SupabaseProvider:function(){return m},$:function(){return x}});var r=t(7437),a=t(2265),l=t(5526);async function n(e){try{console.log("[DB] Checking if notes tables exist...");let s=await i(e),t=await o(e),r=await c(e);return s&&t&&r}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function i(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:s}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(s){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:s}=await e.rpc("create_text_notes_table",{});if(s)throw console.error("[DB] Error creating text_notes table via RPC:",s),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function o(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:s}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(s){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:s}=await e.rpc("create_file_notes_table",{});if(s)throw console.error("[DB] Error creating file_notes table via RPC:",s),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:s}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(s){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:s}=await e.rpc("create_youtube_notes_table",{});if(s)throw console.error("[DB] Error creating youtube_notes table via RPC:",s),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function d(){console.log("[DB] Initializing database tables...");try{if(await n(l.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await i(l.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let s=await o(l.supabase);console.log("[DB] File notes table initialization:",s?"success":"failed");let t=await c(l.supabase);return console.log("[DB] YouTube notes table initialization:",t?"success":"failed"),e||s||t}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let u=(0,a.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:l.supabase});function m(e){let{children:s}=e,[t,n]=(0,a.useState)(null),[i,o]=(0,a.useState)(null),[c,m]=(0,a.useState)(!0),[x,h]=(0,a.useState)(null),[g,b]=(0,a.useState)(0),p=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:s}=await l.supabase.auth.refreshSession();if(s)return console.error("[Auth] Error refreshing session:",s.message),h(s.message),b(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),o(e.session),n(e.session.user),h(null),b(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),o(null),n(null),b(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),h(e instanceof Error?e.message:"Unknown error during session refresh"),b(Date.now()),null}};return(0,a.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),m(!0);let{data:s,error:t}=await l.supabase.auth.getSession();if(t){console.error("[Auth] Error getting session:",t.message),e&&(h(t.message),m(!1));return}(null==s?void 0:s.session)?(console.log("[Auth] Initial session found for user:",{id:s.session.user.id,email:s.session.user.email,expires:new Date(1e3*s.session.expires_at).toISOString()}),e&&(o(s.session),n(s.session.user),d().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(o(null),n(null))),e&&m(!1)}catch(s){console.error("[Auth] Unexpected error during auth initialization:",s),e&&(h(s instanceof Error?s.message:"Unknown error during auth initialization"),m(!1))}})();let{data:{subscription:s}}=l.supabase.auth.onAuthStateChange((s,t)=>{console.log("[Auth] Auth state change detected: ".concat(s)),e&&(t?(console.log("[Auth] New session established for user:",{id:t.user.id,email:t.user.email,expires:new Date(1e3*t.expires_at).toISOString()}),o(t),n(t.user),h(null)):(console.log("[Auth] Session cleared"),o(null),n(null)),m(!1))});return()=>{e=!1,s.unsubscribe()}},[g]),(0,r.jsx)(u.Provider,{value:{user:t,session:i,isLoading:c,sessionError:x,refreshSession:p,supabase:l.supabase},children:s})}let x=()=>{let e=(0,a.useContext)(u);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,s,t){"use strict";t.d(s,{supabase:function(){return a}});var r=t(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let a=(0,r.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,971,117,744],function(){return e(e.s=4806)}),_N_E=e.O()}]);