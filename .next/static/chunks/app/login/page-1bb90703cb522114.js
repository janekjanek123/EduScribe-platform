(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{268:function(e,t,s){Promise.resolve().then(s.bind(s,8991))},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return o.a}});var r=s(2972),o=s.n(r)},8991:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(7437),o=s(2265),a=s(9376),n=s(7124),i=s(5526),l=s(7648);function c(){let e=(0,a.useRouter)(),{user:t,refreshSession:s}=(0,n.$)(),[c,u]=(0,o.useState)(""),[d,g]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[b,f]=(0,o.useState)(!1),[p,x]=(0,o.useState)(""),[y,w]=(0,o.useState)("");(0,o.useEffect)(()=>{if(t){console.log("[LoginPage] User already logged in, redirecting...");let t=sessionStorage.getItem("login_redirect")||"/";sessionStorage.removeItem("login_redirect"),e.push(t)}},[t,e]),(0,o.useEffect)(()=>{let e=localStorage.getItem("auth_redirect_message");e&&(x(e),localStorage.removeItem("auth_redirect_message"));let t=sessionStorage.getItem("login_redirect");t&&(console.log("[LoginPage] Found redirect path:",t),w(t))},[]);let v=async t=>{if(t.preventDefault(),f(!0),m(""),!c||!d){m("Proszę wprowadzić email i hasło"),f(!1);return}try{let{error:t}=await i.supabase.auth.signInWithPassword({email:c,password:d});if(t)throw t;console.log("[LoginPage] Login successful"),await s();let r=y||"/";console.log("[LoginPage] Redirecting to:",r),sessionStorage.removeItem("login_redirect"),e.push(r)}catch(e){console.error("[LoginPage] Login error:",e),m(e.message||"Błąd logowania"),f(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md",children:[(0,r.jsxs)("div",{className:"text-center mb-10",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Logowanie"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Zaloguj się, aby kontynuować"}),y&&(0,r.jsx)("p",{className:"mt-2 text-sm text-primary-600",children:"Po zalogowaniu wr\xf3cisz do poprzedniej strony"})]}),p&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-md",children:(0,r.jsx)("p",{children:p})}),h&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-800 rounded-md",children:(0,r.jsx)("p",{children:h})}),(0,r.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 border border-gray-200",children:[(0,r.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"twoj@email.pl",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasło"}),(0,r.jsx)("input",{id:"password",type:"password",value:d,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"••••••••",required:!0})]}),(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("div",{className:"text-sm",children:(0,r.jsx)(l.default,{href:"/forgot-password",className:"text-primary-600 hover:text-primary-500",children:"Zapomniałeś hasła?"})})}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:b,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none ".concat(b?"bg-gray-400":"bg-primary-600 hover:bg-primary-700"),children:b?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Logowanie..."]}):"Zaloguj się"})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)("p",{className:"text-center text-sm text-gray-600",children:["Nie masz konta?"," ",(0,r.jsx)(l.default,{href:"/signup",className:"text-primary-600 hover:text-primary-500",children:"Zarejestruj się"})]})})]})]})})}},7124:function(e,t,s){"use strict";s.d(t,{SupabaseProvider:function(){return g},$:function(){return h}});var r=s(7437),o=s(2265),a=s(5526);async function n(e){try{console.log("[DB] Checking if notes tables exist...");let t=await i(e),s=await l(e),r=await c(e);return t&&s&&r}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function i(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:t}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_text_notes_table",{});if(t)throw console.error("[DB] Error creating text_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function l(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:t}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_file_notes_table",{});if(t)throw console.error("[DB] Error creating file_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:t}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_youtube_notes_table",{});if(t)throw console.error("[DB] Error creating youtube_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function u(){console.log("[DB] Initializing database tables...");try{if(await n(a.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await i(a.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let t=await l(a.supabase);console.log("[DB] File notes table initialization:",t?"success":"failed");let s=await c(a.supabase);return console.log("[DB] YouTube notes table initialization:",s?"success":"failed"),e||t||s}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let d=(0,o.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:a.supabase});function g(e){let{children:t}=e,[s,n]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[c,g]=(0,o.useState)(!0),[h,m]=(0,o.useState)(null),[b,f]=(0,o.useState)(0),p=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:t}=await a.supabase.auth.refreshSession();if(t)return console.error("[Auth] Error refreshing session:",t.message),m(t.message),f(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),l(e.session),n(e.session.user),m(null),f(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),l(null),n(null),f(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),m(e instanceof Error?e.message:"Unknown error during session refresh"),f(Date.now()),null}};return(0,o.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),g(!0);let{data:t,error:s}=await a.supabase.auth.getSession();if(s){console.error("[Auth] Error getting session:",s.message),e&&(m(s.message),g(!1));return}(null==t?void 0:t.session)?(console.log("[Auth] Initial session found for user:",{id:t.session.user.id,email:t.session.user.email,expires:new Date(1e3*t.session.expires_at).toISOString()}),e&&(l(t.session),n(t.session.user),u().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(l(null),n(null))),e&&g(!1)}catch(t){console.error("[Auth] Unexpected error during auth initialization:",t),e&&(m(t instanceof Error?t.message:"Unknown error during auth initialization"),g(!1))}})();let{data:{subscription:t}}=a.supabase.auth.onAuthStateChange((t,s)=>{console.log("[Auth] Auth state change detected: ".concat(t)),e&&(s?(console.log("[Auth] New session established for user:",{id:s.user.id,email:s.user.email,expires:new Date(1e3*s.expires_at).toISOString()}),l(s),n(s.user),m(null)):(console.log("[Auth] Session cleared"),l(null),n(null)),g(!1))});return()=>{e=!1,t.unsubscribe()}},[b]),(0,r.jsx)(d.Provider,{value:{user:s,session:i,isLoading:c,sessionError:h,refreshSession:p,supabase:a.supabase},children:t})}let h=()=>{let e=(0,o.useContext)(d);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,t,s){"use strict";s.d(t,{supabase:function(){return o}});var r=s(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let o=(0,r.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,972,971,117,744],function(){return e(e.s=268)}),_N_E=e.O()}]);