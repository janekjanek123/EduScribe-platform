(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{268:function(e,t,r){Promise.resolve().then(r.bind(r,8991))},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return o.a}});var s=r(2972),o=r.n(s)},8991:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(7437),o=r(2265),a=r(9376),n=r(7124),l=r(5526),i=r(7648);function c(){let e=(0,a.useRouter)(),{user:t,refreshSession:r}=(0,n.$)(),[c,u]=(0,o.useState)(""),[d,g]=(0,o.useState)(""),[b,h]=(0,o.useState)(""),[m,f]=(0,o.useState)(!1),[p,x]=(0,o.useState)(""),[y,v]=(0,o.useState)("");(0,o.useEffect)(()=>{if(t){console.log("[LoginPage] User already logged in, redirecting...");let t=sessionStorage.getItem("login_redirect")||"/";sessionStorage.removeItem("login_redirect"),e.push(t)}},[t,e]),(0,o.useEffect)(()=>{let e=localStorage.getItem("auth_redirect_message");e&&(x(e),localStorage.removeItem("auth_redirect_message"));let t=sessionStorage.getItem("login_redirect");t&&(console.log("[LoginPage] Found redirect path:",t),v(t))},[]);let w=async t=>{if(t.preventDefault(),f(!0),h(""),!c||!d){h("Proszę wprowadzić email i hasło"),f(!1);return}try{let{error:t}=await l.supabase.auth.signInWithPassword({email:c,password:d});if(t)throw t;console.log("[LoginPage] Login successful"),await r();let s=y||"/";console.log("[LoginPage] Redirecting to:",s),sessionStorage.removeItem("login_redirect"),e.push(s)}catch(e){console.error("[LoginPage] Login error:",e),h(e.message||"Błąd logowania"),f(!1)}};return(0,s.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",style:{background:"var(--bg-primary)"},children:(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsxs)("div",{className:"text-center mb-10",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",style:{color:"var(--text-primary)"},children:"Logowanie"}),(0,s.jsx)("p",{className:"mt-2",style:{color:"var(--text-secondary)"},children:"Zaloguj się, aby kontynuować"}),y&&(0,s.jsx)("p",{className:"mt-2 text-sm",style:{color:"var(--color-cta)"},children:"Po zalogowaniu wr\xf3cisz do poprzedniej strony"})]}),p&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-xl",style:{background:"linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 165, 0, 0.05))",border:"1px solid rgba(255, 165, 0, 0.3)",color:"var(--color-video)"},children:(0,s.jsx)("p",{children:p})}),b&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-xl",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1))",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444"},children:(0,s.jsx)("p",{children:b})}),(0,s.jsxs)("div",{className:"rounded-2xl p-6",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",border:"1px solid var(--bg-tertiary)",boxShadow:"var(--shadow-lg)"},children:[(0,s.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium mb-1",style:{color:"var(--text-primary)"},children:"Email"}),(0,s.jsx)("input",{id:"email",type:"email",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 rounded-md transition-all duration-300 focus:ring-2 focus:outline-none",style:{background:"var(--bg-primary)",border:"1px solid var(--bg-tertiary)",color:"var(--text-primary)",boxShadow:"var(--shadow-sm)"},placeholder:"twoj@email.pl",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium mb-1",style:{color:"var(--text-primary)"},children:"Hasło"}),(0,s.jsx)("input",{id:"password",type:"password",value:d,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 rounded-md transition-all duration-300 focus:ring-2 focus:outline-none",style:{background:"var(--bg-primary)",border:"1px solid var(--bg-tertiary)",color:"var(--text-primary)",boxShadow:"var(--shadow-sm)"},placeholder:"••••••••",required:!0})]}),(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsx)(i.default,{href:"/forgot-password",className:"transition-colors duration-300",style:{color:"var(--color-cta)"},children:"Zapomniałeś hasła?"})})}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"submit",disabled:m,className:"w-full flex justify-center py-3 px-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",style:{background:m?"var(--bg-tertiary)":"linear-gradient(135deg, var(--color-cta) 0%, var(--color-file) 100%)",color:m?"var(--text-muted)":"var(--bg-primary)",boxShadow:m?"var(--shadow-sm)":"var(--glow-cta)"},children:m?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full animate-spin mr-2",style:{border:"2px solid var(--bg-primary)",borderTop:"2px solid var(--color-cta)"}}),"Logowanie..."]}):"Zaloguj się"})})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsxs)("p",{className:"text-center text-sm",style:{color:"var(--text-secondary)"},children:["Nie masz konta?"," ",(0,s.jsx)(i.default,{href:"/signup",className:"transition-colors duration-300",style:{color:"var(--color-cta)"},children:"Zarejestruj się"})]})})]})]})})}},7124:function(e,t,r){"use strict";r.d(t,{SupabaseProvider:function(){return g},$:function(){return b}});var s=r(7437),o=r(2265),a=r(5526);async function n(e){try{console.log("[DB] Checking if notes tables exist...");let t=await l(e),r=await i(e),s=await c(e);return t&&r&&s}catch(e){return console.error("[DB] Error checking/creating notes tables:",e),!1}}async function l(e){try{console.log("[DB] Checking if text_notes table exists...");let{error:t}=await e.from("text_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Text_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_text_notes_table",{});if(t)throw console.error("[DB] Error creating text_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating text_notes table:",e),!1}}return console.log("[DB] Text_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating text_notes table:",e),!1}}async function i(e){try{console.log("[DB] Checking if file_notes table exists...");let{error:t}=await e.from("file_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] File_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_file_notes_table",{});if(t)throw console.error("[DB] Error creating file_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating file_notes table:",e),!1}}return console.log("[DB] File_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating file_notes table:",e),!1}}async function c(e){try{console.log("[DB] Checking if youtube_notes table exists...");let{error:t}=await e.from("youtube_notes").select("*",{count:"exact",head:!0}).limit(0);if(t){console.log("[DB] Youtube_notes table does not exist, creating it...");try{console.log("[DB] Attempting to create table via RPC...");let{error:t}=await e.rpc("create_youtube_notes_table",{});if(t)throw console.error("[DB] Error creating youtube_notes table via RPC:",t),Error("RPC failed, trying SQL approach");return console.log("[DB] Table created successfully via RPC"),!0}catch(e){return console.error("[DB] Error creating youtube_notes table:",e),!1}}return console.log("[DB] Youtube_notes table already exists"),!0}catch(e){return console.error("[DB] Error checking/creating youtube_notes table:",e),!1}}async function u(){console.log("[DB] Initializing database tables...");try{if(await n(a.supabase))return console.log("[DB] All database tables initialized successfully"),!0;{console.error("[DB] Failed to initialize all database tables"),console.log("[DB] Attempting to initialize tables individually");let e=await l(a.supabase);console.log("[DB] Text notes table initialization:",e?"success":"failed");let t=await i(a.supabase);console.log("[DB] File notes table initialization:",t?"success":"failed");let r=await c(a.supabase);return console.log("[DB] YouTube notes table initialization:",r?"success":"failed"),e||t||r}}catch(e){return console.error("[DB] Error initializing database:",e),!1}}let d=(0,o.createContext)({user:null,session:null,isLoading:!0,sessionError:null,refreshSession:async()=>null,supabase:a.supabase});function g(e){let{children:t}=e,[r,n]=(0,o.useState)(null),[l,i]=(0,o.useState)(null),[c,g]=(0,o.useState)(!0),[b,h]=(0,o.useState)(null),[m,f]=(0,o.useState)(0),p=async()=>{console.log("[Auth] Manually refreshing session state...");try{let{data:e,error:t}=await a.supabase.auth.refreshSession();if(t)return console.error("[Auth] Error refreshing session:",t.message),h(t.message),f(Date.now()),null;if(null==e?void 0:e.session)return console.log("[Auth] Session refreshed successfully:",{userId:e.session.user.id,expires:new Date(1e3*e.session.expires_at).toLocaleString()}),i(e.session),n(e.session.user),h(null),f(Date.now()),e.session;return console.log("[Auth] No session returned after refresh"),i(null),n(null),f(Date.now()),null}catch(e){return console.error("[Auth] Unexpected error during session refresh:",e),h(e instanceof Error?e.message:"Unknown error during session refresh"),f(Date.now()),null}};return(0,o.useEffect)(()=>{let e=!0;(async()=>{try{console.log("[Auth] Initializing auth state..."),g(!0);let{data:t,error:r}=await a.supabase.auth.getSession();if(r){console.error("[Auth] Error getting session:",r.message),e&&(h(r.message),g(!1));return}(null==t?void 0:t.session)?(console.log("[Auth] Initial session found for user:",{id:t.session.user.id,email:t.session.user.email,expires:new Date(1e3*t.session.expires_at).toISOString()}),e&&(i(t.session),n(t.session.user),u().then(e=>{console.log("[App] Database initialization:",e?"successful":"failed")}).catch(e=>{console.error("[App] Database initialization error:",e)}))):(console.log("[Auth] No active session found"),e&&(i(null),n(null))),e&&g(!1)}catch(t){console.error("[Auth] Unexpected error during auth initialization:",t),e&&(h(t instanceof Error?t.message:"Unknown error during auth initialization"),g(!1))}})();let{data:{subscription:t}}=a.supabase.auth.onAuthStateChange((t,r)=>{console.log("[Auth] Auth state change detected: ".concat(t)),e&&(r?(console.log("[Auth] New session established for user:",{id:r.user.id,email:r.user.email,expires:new Date(1e3*r.expires_at).toISOString()}),i(r),n(r.user),h(null)):(console.log("[Auth] Session cleared"),i(null),n(null)),g(!1))});return()=>{e=!1,t.unsubscribe()}},[m]),(0,s.jsx)(d.Provider,{value:{user:r,session:l,isLoading:c,sessionError:b,refreshSession:p,supabase:a.supabase},children:t})}let b=()=>{let e=(0,o.useContext)(d);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},5526:function(e,t,r){"use strict";r.d(t,{supabase:function(){return o}});var s=r(3288);console.log("Supabase URL:","https://xhljckmlzdshxibnqsbj.supabase.co"),console.log("Supabase Anon Key exists:",!0);let o=(0,s.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA")}},function(e){e.O(0,[395,972,971,117,744],function(){return e(e.s=268)}),_N_E=e.O()}]);