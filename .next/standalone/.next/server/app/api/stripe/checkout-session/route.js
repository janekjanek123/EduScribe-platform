(()=>{var e={};e.id=4454,e.ids=[4454],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},16939:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>I,routeModule:()=>p,serverHooks:()=>_,staticGenerationAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{POST:()=>l});var i=t(49303),o=t(88716),n=t(60670),a=t(87070),c=t(23517),u=t(46029);async function l(e){try{console.log("[Stripe] Creating checkout session - authenticating request");let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return console.error("[Stripe] Authentication missing"),a.NextResponse.json({error:"Authentication required"},{status:401});let t=r.replace("Bearer ",""),s=(0,c.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA",{global:{headers:{Authorization:`Bearer ${t}`}}}),{data:{user:i},error:o}=await s.auth.getUser(t);if(o||!i)return console.error("[Stripe] Authentication failed:",o?.message),a.NextResponse.json({error:"Authentication failed"},{status:401});console.log(`[Stripe] User authenticated: ${i.id}`);let{planId:n,billingCycle:l}=await e.json();if(console.log("[Stripe] Request data:",{planId:n,billingCycle:l}),!n||!l)return console.error("[Stripe] Missing required fields:",{planId:n,billingCycle:l}),a.NextResponse.json({error:"Plan ID and billing cycle are required"},{status:400});if(!["monthly","yearly"].includes(l))return console.error("[Stripe] Invalid billing cycle:",l),a.NextResponse.json({error:"Invalid billing cycle"},{status:400});if(!["student","pro"].includes(n))return console.error("[Stripe] Invalid plan ID:",n),a.NextResponse.json({error:"Invalid plan ID"},{status:400});console.log("[Stripe] Checking environment variables...");let p={STRIPE_STUDENT_MONTHLY_PRICE_ID:process.env.STRIPE_STUDENT_MONTHLY_PRICE_ID,STRIPE_STUDENT_YEARLY_PRICE_ID:process.env.STRIPE_STUDENT_YEARLY_PRICE_ID,STRIPE_PRO_MONTHLY_PRICE_ID:process.env.STRIPE_PRO_MONTHLY_PRICE_ID,STRIPE_PRO_YEARLY_PRICE_ID:process.env.STRIPE_PRO_YEARLY_PRICE_ID,NEXT_PUBLIC_APP_URL:"http://localhost:3000"};console.log("[Stripe] Environment variables status:",Object.keys(p).reduce((e,r)=>(e[r]=p[r]?"SET":"MISSING",e),{})),console.log("[Stripe] Available price IDs:",u.rg);let I=u.rg[n][l];if(console.log("[Stripe] Selected price ID:",I),!I)return console.error("[Stripe] Price ID not found:",{planId:n,billingCycle:l,availableIds:u.rg}),a.NextResponse.json({error:"Price ID not found for the selected plan"},{status:400});console.log("[Stripe] Creating checkout session:",{userId:i.id,email:i.email,planId:n,billingCycle:l,priceId:I});let d=(0,u.kJ)(),_=await d.checkout.sessions.create({mode:"subscription",payment_method_types:["card"],line_items:[{price:I,quantity:1}],success_url:"http://localhost:3000/payment-success?session_id={CHECKOUT_SESSION_ID}",cancel_url:"http://localhost:3000/payment-cancelled",customer_email:i.email,metadata:{userId:i.id,planId:n,billingCycle:l},subscription_data:{metadata:{userId:i.id,planId:n,billingCycle:l}},allow_promotion_codes:!0});return console.log("[Stripe] Checkout session created successfully:",_.id),a.NextResponse.json({sessionId:_.id,url:_.url})}catch(e){return console.error("[Stripe] Error creating checkout session:",e),a.NextResponse.json({error:"Failed to create checkout session"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/stripe/checkout-session/route",pathname:"/api/stripe/checkout-session",filename:"route",bundlePath:"app/api/stripe/checkout-session/route"},resolvedPagePath:"/Users/janjedrach/Cursor/eduscribe/src/app/api/stripe/checkout-session/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:I,staticGenerationAsyncStorage:d,serverHooks:_}=p,h="/api/stripe/checkout-session/route";function R(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:d})}},46029:(e,r,t)=>{"use strict";let s;t.d(r,{kJ:()=>o,rg:()=>n});var i=t(31059);let o=()=>{if(!s){let e=process.env.STRIPE_SECRET_KEY;if(!e)throw Error("STRIPE_SECRET_KEY is not defined in environment variables");s=new i.Z(e,{apiVersion:"2025-05-28.basil",appInfo:{name:"EduScribe",version:"1.0.0"}})}return s},n={student:{monthly:process.env.STRIPE_STUDENT_MONTHLY_PRICE_ID||"price_student_monthly",yearly:process.env.STRIPE_STUDENT_YEARLY_PRICE_ID||"price_student_yearly"},pro:{monthly:process.env.STRIPE_PRO_MONTHLY_PRICE_ID||"price_pro_monthly",yearly:process.env.STRIPE_PRO_YEARLY_PRICE_ID||"price_pro_yearly"}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,3517,2749,1059],()=>t(16939));module.exports=s})();