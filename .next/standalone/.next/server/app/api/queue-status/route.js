"use strict";(()=>{var e={};e.id=2570,e.ids=[2570],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},97147:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>p,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>l});var i=s(49303),u=s(88716),o=s(60670),a=s(87070),n=s(82227);async function l(e){try{var t;let s=new URL(e.url).searchParams.get("userId"),r=(0,n.DK)(s||void 0);return a.NextResponse.json({success:!0,data:{totalInQueue:r.stats.totalItems,priorityBreakdown:r.stats.priorityBreakdown,estimatedWaitTime:r.stats.estimatedWaitTime,userPosition:r.position,systemLoad:r.systemLoad,message:function(e){let{stats:t,position:s,systemLoad:r}=e;if(null!==s){if(1===s)return"You're next! Your request will be processed shortly.";if(s<=3)return`You're #${s} in queue. Almost ready!`;{let e=Math.ceil(t.estimatedWaitTime/60);return`You're #${s} in queue. Estimated wait: ${e} minutes.`}}return 0===r.loadPercentage&&0===t.totalItems?"System ready - no queue!":r.loadPercentage<50?"System running smoothly - minimal wait times.":r.loadPercentage<80?`Moderate load - ${t.totalItems} requests in queue.`:`High load - ${t.totalItems} requests waiting. Pro users get priority.`}(r),statusColor:(t=r.systemLoad.loadPercentage)<50?"green":t<80?"yellow":"red",timestamp:new Date().toISOString()}})}catch(e){return console.error("[Queue Status API] Error:",e),a.NextResponse.json({success:!1,error:"Failed to get queue status",message:"Unable to retrieve queue information"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/queue-status/route",pathname:"/api/queue-status",filename:"route",bundlePath:"app/api/queue-status/route"},resolvedPagePath:"/Users/janjedrach/Cursor/eduscribe/src/app/api/queue-status/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h}=d,p="/api/queue-status/route";function g(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},82227:(e,t,s)=>{s.d(t,{DK:()=>o,GV:()=>u});class r{async addToQueue(e,t,s,r,i){let u=this.getPriorityFromPlan(s),o=`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return new Promise((s,a)=>{let n={id:o,userId:e,priority:u,requestType:t,payload:r,resolve:async e=>{try{let e=await i();s(e)}catch(e){a(e)}finally{this.processing.delete(o),this.processNext()}},reject:e=>{this.processing.delete(o),a(e),this.processNext()},timestamp:new Date};this.insertByPriority(n),console.log(`[Queue] Added ${t} request for user ${e} with priority ${u}`),this.processNext()})}getQueueStats(e){let t=e?this.getUserPosition(e):null,s=this.queue.reduce((e,t)=>(1===t.priority?e.high++:2===t.priority?e.medium++:e.low++,e),{high:0,medium:0,low:0}),r=t?t*this.averageProcessingTime:this.queue.length*this.averageProcessingTime;return{totalItems:this.queue.length,priorityBreakdown:s,estimatedWaitTime:r}}getUserPosition(e){let t=this.queue.findIndex(t=>t.userId===e);return -1===t?null:t+1}processNext(){if(this.processing.size>=this.maxConcurrent||0===this.queue.length)return;let e=this.queue.shift();e&&(this.processing.set(e.id,!0),console.log(`[Queue] Processing ${e.requestType} for user ${e.userId} (priority ${e.priority})`),setTimeout(()=>{e.resolve(null)},100))}insertByPriority(e){let t=0;for(let s=0;s<this.queue.length;s++){let r=this.queue[s];if(e.priority<r.priority)break;e.priority===r.priority&&e.timestamp>=r.timestamp?t=s+1:e.priority>r.priority&&(t=s+1)}this.queue.splice(t,0,e)}getPriorityFromPlan(e){switch(e){case"pro":return 1;case"student":return 2;default:return 3}}removeFromQueue(e){let t=this.queue.length;return this.queue=this.queue.filter(t=>t.userId!==e),this.queue.length<t}updateAverageProcessingTime(e){this.averageProcessingTime=.8*this.averageProcessingTime+.2*e}getSystemLoad(){let e=this.processing.size,t=this.maxConcurrent;return{queueLength:this.queue.length,processing:e,capacity:t,loadPercentage:e/t*100}}constructor(){this.queue=[],this.processing=new Map,this.maxConcurrent=3,this.averageProcessingTime=90}}let i=new r;async function u(e,t,s,r){return i.addToQueue(e,s,t,{},r)}function o(e){return{stats:i.getQueueStats(e),position:e?i.getUserPosition(e):null,systemLoad:i.getSystemLoad()}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>s(97147));module.exports=r})();