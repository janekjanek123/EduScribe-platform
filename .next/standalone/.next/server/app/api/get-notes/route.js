(()=>{var e={};e.id=5237,e.ids=[5237],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},65523:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>A,requestAsyncStorage:()=>I,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>d,POST:()=>g,dynamic:()=>p});var o=s(49303),n=s(88716),i=s(60670),a=s(87070),c=s(20344),u=s(23517),l=s(71615);async function d(e){console.log("[API] GET /api/get-notes - Starting request processing");try{let t=Array.from(e.headers.keys());console.log("[API] Request headers:",t.filter(e=>"authorization"!==e.toLowerCase()));let s=(0,l.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>s}),o=s.has("sb-access-token"),n=s.has("sb-refresh-token");console.log("[API] Supabase auth cookies present:",{hasSbAccessToken:o,hasSbRefreshToken:n,cookieCount:s.size});let{data:{session:i},error:d}=await r.auth.getSession();d&&console.warn("[API] Error getting session from cookies:",d.message);let g=i?.user,p=i,h="cookies",I=null;if(!i||d){console.log("[API] No session from cookies, checking Authorization header");let t=e.headers.get("Authorization");if(t&&t.startsWith("Bearer ")){let e=t.replace("Bearer ","");console.log("[API] Found Bearer token, attempting to validate"),I=(0,u.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA");let{data:s,error:r}=await I.auth.getUser(e);if(s?.user&&!r){console.log("[API] Successfully authenticated via token:",s.user.id),g=s.user;let{data:e}=await I.auth.getSession();p=e.session,h="token"}else console.error("[API] Token validation failed:",r?.message)}else console.warn("[API] No Authorization header or invalid format")}else console.log("[API] Successfully authenticated via cookies:",i.user.id);if(!g)return console.error("[API] Authentication failed - no valid user found"),a.NextResponse.json({error:"Unauthorized",message:"Authentication required"},{status:401});console.log("[API] Authentication successful:",{userId:g.id,email:g.email,authMethod:h,sessionExpiry:p?.expires_at?new Date(1e3*p.expires_at).toLocaleString():"unknown"});let m=I||r,x=e.nextUrl.searchParams.get("id");if(!x)return console.error("[API] Missing note ID in request"),a.NextResponse.json({error:"Missing note ID"},{status:400});console.log(`[API] GET /api/get-notes - Fetching note with ID: ${x} for user: ${g.id}`);let f="text_notes";x.startsWith("file_")?f="file_notes":x.startsWith("video_")?f="video_notes":x.startsWith("text_")&&(f="text_notes"),console.log(`[API] Querying Supabase ${f} table for note: ${x}`);let{data:A,error:q}=await m.from(f).select("*").eq("id",x).single();if(q)return console.error(`[API] Supabase error fetching note from ${f}:`,q),console.error(`[API] Note ${x} not found in database`),a.NextResponse.json({error:"Note not found",message:"The requested note could not be found",debug:{noteId:x,userId:g.id,tableName:f,errorMessage:q.message}},{status:404});if(console.log(`[API] Found note ${x} in ${f} database:`,{title:A.title,userId:A.user_id,createdAt:A.created_at,contentLength:A.content?.length||0}),A.user_id&&A.user_id!==g.id)return console.warn(`[API] User ${g.id} attempted to access note ${x} belonging to user ${A.user_id}`),a.NextResponse.json({error:"Access denied",message:"You do not have permission to access this note"},{status:403});return console.log(`[API] Note found in ${f} database for user: ${g.id}, returning note data`),a.NextResponse.json(A)}catch(e){return console.error("[API] Error fetching notes:",e),a.NextResponse.json({error:"Server error",message:e?.message||"An error occurred while fetching notes"},{status:500})}}async function g(e){console.log("[API] POST /api/get-notes - Starting notes listing request");try{let t=(0,l.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:{session:r},error:o}=await s.auth.getSession(),n=r?.user,i=null;if(!r||o){console.log("[API] No session from cookies, checking Authorization header");let t=e.headers.get("Authorization");if(t&&t.startsWith("Bearer ")){let e=t.replace("Bearer ","");i=(0,u.eI)("https://xhljckmlzdshxibnqsbj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhobGpja21semRzaHhpYm5xc2JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NDIwNzIsImV4cCI6MjA2MzQxODA3Mn0.UuU3QBxwY3-DsSpXB-UiKarjgZWiFAFIzFbgUqacmIA");let{data:s,error:r}=await i.auth.getUser(e);s?.user&&!r&&(n=s.user)}}if(!n)return a.NextResponse.json({error:"Unauthorized",message:"Authentication required"},{status:401});let d=i||s,[g,p,h]=await Promise.all([d.from("text_notes").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}),d.from("file_notes").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}),d.from("video_notes").select("*").eq("user_id",n.id).order("created_at",{ascending:!1})]),I=[...g.data||[],...p.data||[],...h.data||[]];return I.sort((e,t)=>{let s=new Date(e.created_at).getTime();return new Date(t.created_at).getTime()-s}),a.NextResponse.json({notes:I,counts:{textNotes:g.data?.length||0,fileNotes:p.data?.length||0,videoNotes:h.data?.length||0,total:I.length}})}catch(e){return console.error("[API] Error listing notes:",e),a.NextResponse.json({error:"Server error",message:e?.message||"An error occurred while listing notes"},{status:500})}}let p="force-dynamic",h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/get-notes/route",pathname:"/api/get-notes",filename:"route",bundlePath:"app/api/get-notes/route"},resolvedPagePath:"/Users/janjedrach/Cursor/eduscribe/src/app/api/get-notes/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:I,staticGenerationAsyncStorage:m,serverHooks:x}=h,f="/api/get-notes/route";function A(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972,3517,958],()=>s(65523));module.exports=r})();